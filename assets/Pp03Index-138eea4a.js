import{_ as Z}from"./TableComponent-4a3766f9.js";import{l as f,r as o,a as q,j as z,U as K,a6 as I,o as m,d as Y,e as p,c as h,t as O,F as j,N as R,m as V,u as W,b as $,w as u,x as T,h as U,y as b,i as G,a1 as X}from"./index-04ec81ed.js";import{_ as ee}from"./FormComponent-2ed522db.js";import{u as te}from"./selectes-110ad443.js";import"./es-aeb4b26c.js";import{d as ae}from"./downloadExcel-7d194be6.js";import{C as ne}from"./CloudUploadOutlined-06df6e12.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-0257614a.js";import"./quill.snow-26414ae2.js";const le={class:"f-20"},ie={__name:"DrawerPP03",props:["info"],emits:["closeDraw"],setup(B,{emit:M}){f.locale("es");const _=o({nameEvent:{type:"iText",label:"NOMBRE DEL EVENTO",name:"nameEvent",required:!0,message:"Escribir nombre del evento",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:""},modality_id:{type:"iSelect",label:"MODALIDAD",name:"modality_id",required:!0,message:"Seleccionar la modalidad",disabled:!1},dates:{type:"iDatePicker",label:"FECHA DEL EVENTO",name:"dates",required:!0,message:"Seleccionar fecha",disabled:!1},hours:{type:"iText",label:"HORARIO",name:"hours",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"08"},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!0,message:"Escribir el detalle",disabled:!1,rows:5}});JSON.parse(localStorage.getItem("profile"));const C=M,r=B,y=o("GUARDAR"),e=q({}),v=o(!1),i=te(),D=o(null),t=o({city_id:[],province_id:[],district_id:[],modality_id:[]}),k=n=>{console.log("handleInputEvent",n)},P=async n=>{n=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),_.value.dateTramite.disabled=!1)},H=async n=>{n=="city_id"&&(await i.fetchProvinces(e.city_id),t.value.province_id=i.provinces,_.value.province_id.disabled=!1),n=="province_id"&&(await i.fetchDistricts(e.province_id),t.value.district_id=i.districts,_.value.district_id.disabled=!1)},A=async n=>{console.log("handleFocusSelect",n),n=="city_id"&&(await i.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,t.value.province_id=[],t.value.city_id=i.cities),n=="province_id"&&(e.province_id=null,e.district_id=null,t.value.district_id=[]),n=="modality_id"&&(await i.fetchModalities(),t.value.modality_id=i.modalities)},F=n=>{},L=async()=>{v.value=!0;const n={nameEvent:e.nameEvent,city_id:e.city_id,place:e.place,modality_id:e.modality_id,dateStart:f(e.dates.start).format("YYYY-MM-DD"),dateEnd:f(e.dates.end).format("YYYY-MM-DD"),hours:e.hours,description:e.description};try{const E=r.info?`pp03/update/${r.info.id}`:"pp03/store",g=r.info?"PUT":"POST",S=await R({url:E,method:g,data:n});S.status===200&&(V.success(S.message),x(),C("closeDraw",!0))}catch(E){console.error("Error:",E);const g=document.getElementsByClassName("ant-drawer-body")[0];g&&(g.scrollTop=0)}finally{v.value=!1}},x=()=>{e.nameEvent=null,e.city_id=null,e.place=null,e.modality_id=null,e.dates=null,e.hours=null,e.description=null},N=async n=>{n&&(e.nameEvent=n.nameEvent,e.place=n.place,e.hours=n.hours,e.description=n.description,await i.fetchCities(),t.value.city_id=i.cities,e.city_id=n.city_id,await i.fetchModalities(),t.value.modality_id=i.modalities,e.modality_id=n.modality_id,e.dates={start:f(n.dateStart).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),end:f(n.dateEnd).format("YYYY-MM-DDTHH:mm:ss.SSSZ")})};return z(()=>{r.info&&N(r.info)}),K(()=>r.info,n=>{n?N(n):x()}),I("formState",e),I("loadingState",v),(n,E)=>(m(),Y(j,null,[p("div",le,[h(ee,{fields:_.value,options:t.value,btnSaveName:y.value,onHandleInputEvent:k,resetSelect:D.value,onHandleChangeSelect:H,onHandleFocusSelect:A,onHandleBlurSelect:F,onHandleChangeClock:P,onOnSubmit:L},null,8,["fields","options","btnSaveName","resetSelect"])]),p("pre",null,O(e),1)],64))}};const oe={class:"advisory-table"},se={key:0,style:{"line-height":"1.5"}},re={key:1},de=["onClick"],ce=["onClick"],ue=["onClick"],we={__name:"Pp03Index",setup(B){const M=JSON.parse(localStorage.getItem("role"))||[],_=o([]),C=o(0),r=o(150),y=o(!1),e=W(),v=o(!1),i=o(null),D=o(!1),t=q({year:f("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),k=[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:70},{title:"LINK",dataIndex:"link",fixed:"left",width:70,align:"center"},{title:"EVENTO",dataIndex:"nameEvent",width:220},{title:"INSCRITOS",dataIndex:"number",width:120,align:"center"},{title:"REGIÓN",dataIndex:"city_name",width:150},{title:"LUGAR",dataIndex:"place",width:200},{title:"MODALIDAD",dataIndex:"modality_name",width:140,align:"center"},{title:"FECHA",dataIndex:"date",width:160,align:"center"},{title:"HORARIO",dataIndex:"hours",width:150,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:250},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],P=o([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),H=a=>{e.push(`/admin/asistencia/inscritos/${a.slug}`)},A=a=>{i.value=a,y.value=!0},F=()=>{w(),y.value=!1},L=()=>{i.value=null,y.value=!0},x=async a=>{try{const l=await R({url:`attendance/delete/${a.id}`,method:"DELETE"});l.status==200&&(w(),V.success(l.message))}catch(l){console.error("Error de red:",l)}},N=async a=>{try{const l=await R({url:`attendance/event-finally/${a.id}`,method:"PUT"});l.status==200&&(w(),V.success(l.message))}catch(l){console.error("Error de red:",l)}},n=async()=>{D.value=!0;try{const a={};t.year&&(a.year=f(t.year).format("YYYY")),t.range&&(a.dateStart=t.range[0].format("YYYY/MM/DD"),a.dateEnd=t.range[1].format("YYYY/MM/DD")),t.name&&(a.name=t.name),t.orderby&&(a.orderby=t.orderby),t.asesor&&(a.asesor=t.asesor),await ae("download/attendance-ugo","eventos-ugo",a)}catch(a){console.error("Error de red:",a)}finally{D.value=!1}},E=async a=>{t.page=a,await w()},g=async a=>{a&&(t.page=1,await w())},S=a=>M.some(l=>a.includes(l.id)),w=async()=>{try{v.value=!0;const a={page:t.page};t.year&&(a.year=f(t.year).format("YYYY")),t.range&&(a.dateStart=t.range[0].format("YYYY/MM/DD"),a.dateEnd=t.range[1].format("YYYY/MM/DD")),t.name&&(a.name=t.name),t.orderby&&(a.orderby=t.orderby);const d=await R({url:"pp03/list",method:"GET",params:a});_.value=d.data.data,C.value=d.data.total,r.value=d.data.per_page}catch(a){console.error("Error de red:",a)}finally{v.value=!1}};return z(async()=>{await w()}),I("search",t),I("loading",v),I("loadingFile",D),(a,l)=>{const d=$("a-menu-item"),J=$("a-popconfirm"),Q=$("a-drawer");return m(),Y("div",oe,[h(Z,{title:"LISTA EVENTOS PP03",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:k,othersList:P.value,titleSearch:"BUSCAR POR EVENTO",pageSize:r.value,nameTotal:"Eventos PP03",dataSource:_.value,total:C.value,onHandleNew:L,onHandleDownloadExcel:n,onHandleSearch:g,onHandlePaginator:E},{"data-cell":u(({column:s,record:c})=>[s.dataIndex=="link"?(m(),T(U(ne),{key:0})):b("",!0),s.dataIndex=="date"?(m(),Y(j,{key:1},[c.dateStart!=c.dateEnd?(m(),Y("span",se,[l[1]||(l[1]=p("b",null,"Desde:",-1)),G(" "+O(c.dateStartFormat)+" ",1),l[2]||(l[2]=p("b",null,"Hasta:",-1)),G(" "+O(c.dateEndFormat),1)])):(m(),Y("span",re,O(c.dateStartFormat),1))],64)):b("",!0)]),"custom-options":u(({record:s})=>[h(d,null,{default:u(()=>[p("a",{onClick:c=>H(s)},"Inscritos",8,de)]),_:2},1024),S([1,5])?(m(),T(d,{key:0},{default:u(()=>[p("a",{onClick:c=>A(s)},"Editar",8,ce)]),_:2},1024)):b("",!0),S([1,5])?(m(),T(d,{key:1},{default:u(()=>[p("span",{style:{color:"#ff4d4f"},onClick:c=>N(s)},"Finalizar",8,ue)]),_:2},1024)):b("",!0),S([1,5])?(m(),T(d,{key:2},{default:u(()=>[h(J,{placement:"rightBottom",title:`¿Quieres eliminar ${s.title} ?`,onConfirm:c=>x(s)},{icon:u(()=>[h(U(X),{style:{color:"red"}})]),default:u(()=>[l[3]||(l[3]=p("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):b("",!0)]),_:1},8,["othersList","pageSize","dataSource","total"]),h(Q,{open:y.value,"onUpdate:open":l[0]||(l[0]=s=>y.value=s),title:i.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:u(()=>[h(ie,{onCloseDraw:F,info:i.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{we as default};
