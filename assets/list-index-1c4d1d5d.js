import{_ as ae}from"./TableComponent-7c6d41b1.js";import{l as g,r as y,E as te,a as X,X as j,j as K,b as _,o as i,x as m,w as o,e as Y,d as x,F as q,s as ne,c as p,y as c,h as A,M as le,i as R,t as ee,R as V,m as N,u as se,a6 as Q,f as re,a2 as oe}from"./index-ce9884b9.js";import{u as ie}from"./selectes-cde3eb19.js";import"./es-a27f7f23.js";import{d as de}from"./downloadExcel-f7db1855.js";import{g as ce}from"./usePermissions-9a22f7b4.js";import"./icoexcel-1b303edf.js";import"./UploadOutlined-11c96663.js";import"./MoreOutlined-000b6261.js";const ue={class:"form-attendance"},me="DD/MM/YYYY",pe={__name:"EventosUgo",props:["dataRow"],emits:["closeDraw"],setup(F,{emit:L}){g.locale("es");const u=ie();u.$patch({cities:u.cities}),u.$patch({provinces:u.provinces}),u.$patch({districts:u.districts}),u.fetchCities(),u.fetchAsesores();const w=y(!1),v=F,b=L;te();const e=X({}),f=y({eventsoffice_id:{type:"iSelect",label:"TIPO DE EVENTO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD DEL EVENTO",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO DE LA ACTIVIDAD",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA CIERRE DE LA ACTIVIDAD",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1,placeholder:"Ejemplo: Lunes 20 de enero"},modality:{type:"iSelect",label:"MODALIDAD DEL EVENTO",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN DEL EVENTO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA DEL EVENTO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO DEL EVENTO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"LUGAR DEL EVENTO",name:"address",required:!0,message:"Escribir lugar del evento",disabled:!0,max:100,placeholder:"Ejemplo: Av. Los Incas 1234 - San Miguel"},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}}),T=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}],O={hora:{type:"iText",label:"TEMA DE LA CAPACITACIÓN",name:"hora",required:!0,message:"Escribir tema de la capacitación",disabled:!0,max:100,placeholder:""}},s=(n,d)=>{if(n=="eventsoffice_id")if(d==3)f.value={...f.value,...O};else{const{hora:E,...t}=f.value;f.value=t}};j(()=>e.startDate,n=>{e.endDate&&new Date(n)>new Date(e.endDate)&&(e.endDate=null)}),j(()=>e.endDate,n=>{e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=null)});const S=(n,d)=>{const E=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return d.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(E)},P=n=>{if(n=="modality")return T;if(n=="powerBy")return pertenece;if(n=="fairtype_id")return typeFair;if(n=="eventsoffice_id")return $()},$=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],U=n=>{e.province_id=null,e.district_id=null,u.fetchProvinces(n)},k=n=>{e.district_id=null,u.fetchDistricts(n)},C=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null,e.hora=null;const{fecha:n,hora:d,...E}=f.value;f.value=E},B=async()=>{w.value=!0;const n={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:g(e.startDate).format("YYYY-MM-DD"),endDate:g(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,fecha:e.fecha,hora:e.hora,asesorId:e.people_id,description:e.description};try{const d=v.dataRow?"PUT":"POST",E=v.dataRow?`attendance/update/${v.dataRow.id}`:"attendance/create",t=await V({url:E,method:d,data:n});t.status==200&&(N.success(t.message),b("closeDraw"),C()),t.status==500&&(N.error(t.message),C())}catch(d){N.error("Se presentó un error, los valores son requeridos",d)}finally{w.value=!1}},G=n=>{const d=e[n]?e[n].trim():"";e[n]=d};function M(n){e.eventsoffice_id=n.id_pnte,e.title=n.title,e.startDate=n.startDate?g(n.startDate,"DD/MM/YYYY"):null,e.endDate=n.endDate?g(n.endDate,"DD/MM/YYYY"):null,e.modality=n.modality,e.city_id=n.city_id,U(n.city_id),e.province_id=n.province_id,k(n.province_id),e.district_id=n.district_id,e.address=n.address,e.fecha=n.fecha,e.hora=n.hora,e.people_id=n.asesorId,e.description=n.description,s("eventsoffice_id",n.id_pnte)}return K(()=>{v.dataRow&&M(v.dataRow)}),j(()=>v.dataRow,n=>{n?M(n):C()}),(n,d)=>{const E=_("a-input"),t=_("a-form-item"),l=_("a-select"),h=_("a-textarea"),I=_("a-input-number"),z=_("a-date-picker"),H=_("a-button"),W=_("a-form");return i(),m(W,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:B},{default:o(()=>[Y("div",ue,[(i(!0),x(q,null,ne(f.value,(a,D)=>(i(),x(q,{key:D},[a.type==="iText"?(i(),m(t,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:o(()=>[p(E,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,maxlength:a.max,onBlur:r=>G(a.name),placeholder:a.placeholder},null,8,["value","onUpdate:value","maxlength","onBlur","placeholder"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iSelect"?(i(),m(t,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[p(l,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:P(a.name),onChange:r=>s(a.name,r)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iTextarea"?(i(),m(t,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[p(h,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iNumber"?(i(),m(t,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[p(I,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iDate"?(i(),m(t,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[p(z,{locale:A(le),value:e[a.name],"onUpdate:value":r=>e[a.name]=r,style:{width:"100%"},format:me,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iSelectWrite"?(i(),m(t,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[a.name=="city_id"?(i(),m(l,{key:0,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(u).cities,"show-search":"","filter-option":S,onChange:U},null,8,["value","onUpdate:value","options"])):c("",!0),a.name=="province_id"?(i(),m(l,{key:1,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(u).provinces,"show-search":"","filter-option":S,onChange:k,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):c("",!0),a.name=="district_id"?(i(),m(l,{key:2,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(u).districts,"show-search":"","filter-option":S,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):c("",!0),a.name=="people_id"?(i(),m(l,{key:3,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(u).asesores,"show-search":"","filter-option":S},null,8,["value","onUpdate:value","options"])):c("",!0)]),_:2},1032,["name","label","rules"])):c("",!0)],64))),128))]),p(t,null,{default:o(()=>[p(H,{type:"primary","html-type":"submit",loading:w.value},{default:o(()=>[R(ee(F.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const _e={class:"advisory-table"},ve={key:0},fe=["href"],ye=["onClick"],Ee=["onClick"],Te={__name:"list-index",setup(F){JSON.parse(localStorage.getItem("role"));const L=y([]),u=y(0),w=y(150),v=y({}),b=y(!1);se();const e=y(!1),f=y(null),T=y(!1),O=y([]),s=X({year:g("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),S=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],P=y([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),$=t=>{f.value=t,b.value=!0},U=()=>{d(),b.value=!1},k=()=>{f.value=null,b.value=!0},C=async t=>{try{const l=await V({url:`attendance/delete/${t.id}`,method:"DELETE"});l.status==200&&(d(),N.success(l.message))}catch(l){console.error("Error de red:",l)}},B=async t=>{try{const l=await V({url:`attendance/event-finally/${t.id}`,method:"PUT"});l.status==200&&(d(),N.success(l.message))}catch(l){console.error("Error de red:",l)}},G=async()=>{T.value=!0;try{const t={};s.year&&(t.year=g(s.year).format("YYYY")),s.range&&(t.dateStart=s.range[0].format("YYYY/MM/DD"),t.dateEnd=s.range[1].format("YYYY/MM/DD")),s.name&&(t.name=s.name),s.orderby&&(t.orderby=s.orderby),s.asesor&&(t.asesor=s.asesor),await de("download/attendance-ugo","Eventos-UGO",t)}catch(t){console.error("Error de red:",t)}finally{T.value=!1}},M=async t=>{s.page=t,await d()},n=async t=>{t&&(s.page=1,await d())},d=async()=>{try{e.value=!0;const t={page:s.page};s.year&&(t.year=g(s.year).format("YYYY")),s.range&&(t.dateStart=s.range[0].format("YYYY/MM/DD"),t.dateEnd=s.range[1].format("YYYY/MM/DD")),s.name&&(t.name=s.name),s.orderby&&(t.orderby=s.orderby),s.asesor&&(t.asesor=s.asesor);const h=await V({url:"attendance/list",method:"GET",params:t});L.value=h.data.data,u.value=h.data.total,w.value=h.data.per_page}catch(t){console.error("Error de red:",t)}finally{e.value=!1}},E=async()=>{try{const t=await re({url:"select/asesores",method:"GET"});t.status==200&&(O.value=t.data)}catch{console.log("Failed to delete")}};return K(async()=>{v.value=await ce("eventos-ugo-lista"),await d(),await E()}),Q("search",s),Q("loading",e),Q("loadingFile",T),(t,l)=>{const h=_("a-tag"),I=_("a-menu-item"),z=_("router-link"),H=_("a-popconfirm"),W=_("a-drawer");return i(),x("div",_e,[p(ae,{title:"LISTA EVENTOS UGO",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:S,othersList:P.value,titleSearch:"BUSCAR POR EVENTO",pageSize:w.value,nameTotal:"Eventos UGO",asesoresList:O.value,dataSource:L.value,total:u.value,btnUpdate:!0,onHandleNew:k,onHandleDownloadExcel:G,onHandleSearch:n,permisos:v.value,onHandleCallFetchData:d,onHandlePaginator:M,btnImport:!0},{"data-cell":o(({column:a,record:D})=>[a.dataIndex=="type_activity"?(i(),x("span",ve,ee(D.pnte),1)):c("",!0),a.dataIndex=="modality"?(i(),x(q,{key:1},[D.modality=="p"?(i(),m(h,{key:0,color:"blue"},{default:o(()=>l[1]||(l[1]=[R("PRESENCIAL")])),_:1})):c("",!0),D.modality=="v"?(i(),m(h,{key:1,color:"orange"},{default:o(()=>l[2]||(l[2]=[R("VIRTUAL")])),_:1})):c("",!0)],64)):c("",!0),a.dataIndex=="dateDiff"?(i(),x(q,{key:2},[D.finally?(i(),m(h,{key:0,color:"red"},{default:o(()=>l[3]||(l[3]=[R(" FINALIZADO ")])),_:1})):c("",!0)],64)):c("",!0)]),"custom-options":o(({record:a})=>{var D,r,Z;return[p(I,null,{default:o(()=>[Y("a",{href:a.eventsoffice_id===3?`https://inscripcion.soporte-pnte.com/fortalece-tu-mercado/${a.slug}`:`/asistencias/${a.slug}`,target:"_blank"}," Ver Link ",8,fe)]),_:2},1024),p(I,null,{default:o(()=>[p(z,{to:`inscritos/${a.slug}`},{default:o(()=>l[4]||(l[4]=[R("Inscritos")])),_:2},1032,["to"])]),_:2},1024),(D=v.value)!=null&&D.can_update?(i(),m(I,{key:0},{default:o(()=>[Y("a",{onClick:J=>$(a)},"Editar",8,ye)]),_:2},1024)):c("",!0),(r=v.value)!=null&&r.can_finish?(i(),m(I,{key:1},{default:o(()=>[Y("span",{style:{color:"#ff4d4f"},onClick:J=>B(a)},"Finalizar",8,Ee)]),_:2},1024)):c("",!0),(Z=v.value)!=null&&Z.can_delete?(i(),m(I,{key:2},{default:o(()=>[p(H,{placement:"rightBottom",title:`¿Quieres eliminar ${a.title} ?`,onConfirm:J=>C(a)},{icon:o(()=>[p(A(oe),{style:{color:"red"}})]),default:o(()=>[l[5]||(l[5]=Y("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):c("",!0)]}),_:1},8,["othersList","pageSize","asesoresList","dataSource","total","permisos"]),p(W,{open:b.value,"onUpdate:open":l[0]||(l[0]=a=>b.value=a),title:f.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:o(()=>[p(pe,{onCloseDraw:U,dataRow:f.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{Te as default};
