import{_ as K}from"./TableComponent-cae59e15.js";import{l as w,r as h,E as ee,a as Z,X as j,j as J,b as y,o as r,x as c,w as o,e as N,d as T,F as M,s as ae,c as f,y as i,h as x,M as te,i as L,t as X,R as q,m as O,u as ne,a6 as Q,f as le,a2 as se}from"./index-fec5dae2.js";import{u as re}from"./selectes-7d19b6fb.js";import"./es-0c792ca1.js";import{d as oe}from"./downloadExcel-f2cb0a64.js";import"./icoexcel-1b303edf.js";import"./UploadOutlined-9af71870.js";import"./MoreOutlined-9b18a223.js";const ie={class:"form-attendance"},de="DD/MM/YYYY",ce={__name:"EventosUgo",props:["dataRow"],emits:["closeDraw"],setup(F,{emit:P}){w.locale("es");const u=re();u.$patch({cities:u.cities}),u.$patch({provinces:u.provinces}),u.$patch({districts:u.districts}),u.fetchCities(),u.fetchAsesores();const S=h(!1),g=F,b=P;ee();const e=Z({}),E=h({eventsoffice_id:{type:"iSelect",label:"TIPO DE EVENTO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD DEL EVENTO",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO DE LA ACTIVIDAD",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA CIERRE DE LA ACTIVIDAD",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1,placeholder:"Ejemplo: Lunes 20 de enero"},modality:{type:"iSelect",label:"MODALIDAD DEL EVENTO",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN DEL EVENTO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA DEL EVENTO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO DEL EVENTO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"LUGAR DEL EVENTO",name:"address",required:!0,message:"Escribir lugar del evento",disabled:!0,max:100,placeholder:"Ejemplo: Av. Los Incas 1234 - San Miguel"},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}}),C=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}],U={hora:{type:"iText",label:"TEMA DE LA CAPACITACIÓN",name:"hora",required:!0,message:"Escribir tema de la capacitación",disabled:!0,max:100,placeholder:""}},d=(t,p)=>{if(t=="eventsoffice_id")if(p==3)E.value={...E.value,...U};else{const{hora:v,...m}=E.value;E.value=m}};j(()=>e.startDate,t=>{e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=null)}),j(()=>e.endDate,t=>{e.startDate&&new Date(t)<new Date(e.startDate)&&(e.startDate=null)});const A=(t,p)=>{const v=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return p.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(v)},$=t=>{if(t=="modality")return C;if(t=="powerBy")return pertenece;if(t=="fairtype_id")return typeFair;if(t=="eventsoffice_id")return B()},B=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],Y=t=>{e.province_id=null,e.district_id=null,u.fetchProvinces(t)},k=t=>{e.district_id=null,u.fetchDistricts(t)},R=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null,e.hora=null;const{fecha:t,hora:p,...v}=E.value;E.value=v},G=async()=>{S.value=!0;const t={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:w(e.startDate).format("YYYY-MM-DD"),endDate:w(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,fecha:e.fecha,hora:e.hora,asesorId:e.people_id,description:e.description};try{const p=g.dataRow?"PUT":"POST",v=g.dataRow?`attendance/update/${g.dataRow.id}`:"attendance/create",m=await q({url:v,method:p,data:t});m.status==200&&(O.success(m.message),b("closeDraw"),R()),m.status==500&&(O.error(m.message),R())}catch(p){O.error("Se presentó un error, los valores son requeridos",p)}finally{S.value=!1}},z=t=>{const p=e[t]?e[t].trim():"";e[t]=p};function V(t){e.eventsoffice_id=t.id_pnte,e.title=t.title,e.startDate=t.startDate?w(t.startDate,"DD/MM/YYYY"):null,e.endDate=t.endDate?w(t.endDate,"DD/MM/YYYY"):null,e.modality=t.modality,e.city_id=t.city_id,Y(t.city_id),e.province_id=t.province_id,k(t.province_id),e.district_id=t.district_id,e.address=t.address,e.fecha=t.fecha,e.hora=t.hora,e.people_id=t.asesorId,e.description=t.description,d("eventsoffice_id",t.id_pnte)}return J(()=>{g.dataRow&&V(g.dataRow)}),j(()=>g.dataRow,t=>{t?V(t):R()}),(t,p)=>{const v=y("a-input"),m=y("a-form-item"),n=y("a-select"),l=y("a-textarea"),D=y("a-input-number"),I=y("a-date-picker"),H=y("a-button"),W=y("a-form");return r(),c(W,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:G},{default:o(()=>[N("div",ie,[(r(!0),T(M,null,ae(E.value,(a,_)=>(r(),T(M,{key:_},[a.type==="iText"?(r(),c(m,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:o(()=>[f(v,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,maxlength:a.max,onBlur:s=>z(a.name),placeholder:a.placeholder},null,8,["value","onUpdate:value","maxlength","onBlur","placeholder"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iSelect"?(r(),c(m,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[f(n,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:$(a.name),onChange:s=>d(a.name,s)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iTextarea"?(r(),c(m,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[f(l,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iNumber"?(r(),c(m,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[f(D,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iDate"?(r(),c(m,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[f(I,{locale:x(te),value:e[a.name],"onUpdate:value":s=>e[a.name]=s,style:{width:"100%"},format:de,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iSelectWrite"?(r(),c(m,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[a.name=="city_id"?(r(),c(n,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:x(u).cities,"show-search":"","filter-option":A,onChange:Y},null,8,["value","onUpdate:value","options"])):i("",!0),a.name=="province_id"?(r(),c(n,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:x(u).provinces,"show-search":"","filter-option":A,onChange:k,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="district_id"?(r(),c(n,{key:2,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:x(u).districts,"show-search":"","filter-option":A,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="people_id"?(r(),c(n,{key:3,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:x(u).asesores,"show-search":"","filter-option":A},null,8,["value","onUpdate:value","options"])):i("",!0)]),_:2},1032,["name","label","rules"])):i("",!0)],64))),128))]),f(m,null,{default:o(()=>[f(H,{type:"primary","html-type":"submit",loading:S.value},{default:o(()=>[L(X(F.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const ue={class:"advisory-table"},me={key:0},pe=["href"],_e=["onClick"],ve=["onClick"],we={__name:"list-index",setup(F){const P=JSON.parse(localStorage.getItem("role"))||[],u=h([]),S=h(0),g=h(150),b=h(!1);ne();const e=h(!1),E=h(null),C=h(!1),U=h([]),d=Z({year:w("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),A=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],$=h([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),B=n=>{E.value=n,b.value=!0},Y=()=>{v(),b.value=!1},k=()=>{E.value=null,b.value=!0},R=async n=>{try{const l=await q({url:`attendance/delete/${n.id}`,method:"DELETE"});l.status==200&&(v(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},G=async n=>{try{const l=await q({url:`attendance/event-finally/${n.id}`,method:"PUT"});l.status==200&&(v(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},z=async()=>{C.value=!0;try{await oe("download/list-ugo-by-components-id/5","Potencia-tu-empresa",{})}catch(n){console.error("Error de red:",n)}finally{C.value=!1}},V=async n=>{d.page=n,await v()},t=async n=>{n&&(d.page=1,await v())},p=n=>P.some(l=>n.includes(l.id)),v=async()=>{try{e.value=!0;const n={page:d.page};d.year&&(n.year=w(d.year).format("YYYY")),d.range&&(n.dateStart=d.range[0].format("YYYY/MM/DD"),n.dateEnd=d.range[1].format("YYYY/MM/DD")),d.name&&(n.name=d.name),d.orderby&&(n.orderby=d.orderby),d.asesor&&(n.asesor=d.asesor);const D=await q({url:"attendance/list",method:"GET",params:n});u.value=D.data.data,S.value=D.data.total,g.value=D.data.per_page}catch(n){console.error("Error de red:",n)}finally{e.value=!1}},m=async()=>{try{const n=await le({url:"select/asesores",method:"GET"});n.status==200&&(U.value=n.data)}catch{console.log("Failed to delete")}};return J(async()=>{await v(),await m()}),Q("search",d),Q("loading",e),Q("loadingFile",C),(n,l)=>{const D=y("a-tag"),I=y("a-menu-item"),H=y("router-link"),W=y("a-popconfirm"),a=y("a-drawer");return r(),T("div",ue,[f(K,{title:"LISTA EVENTOS UGO",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:A,othersList:$.value,titleSearch:"BUSCAR POR EVENTO",pageSize:g.value,nameTotal:"Eventos UGO",asesoresList:U.value,dataSource:u.value,total:S.value,onHandleNew:k,onHandleDownloadExcel:z,onHandleSearch:t,onHandlePaginator:V,btnImport:!0},{"data-cell":o(({column:_,record:s})=>[_.dataIndex=="type_activity"?(r(),T("span",me,X(s.pnte),1)):i("",!0),_.dataIndex=="modality"?(r(),T(M,{key:1},[s.modality=="p"?(r(),c(D,{key:0,color:"blue"},{default:o(()=>l[1]||(l[1]=[L("PRESENCIAL")])),_:1})):i("",!0),s.modality=="v"?(r(),c(D,{key:1,color:"orange"},{default:o(()=>l[2]||(l[2]=[L("VIRTUAL")])),_:1})):i("",!0)],64)):i("",!0),_.dataIndex=="dateDiff"?(r(),T(M,{key:2},[s.finally?(r(),c(D,{key:0,color:"red"},{default:o(()=>l[3]||(l[3]=[L(" FINALIZADO ")])),_:1})):i("",!0)],64)):i("",!0)]),"custom-options":o(({record:_})=>[f(I,null,{default:o(()=>[N("a",{href:_.eventsoffice_id===3?`https://inscripcion.soporte-pnte.com/fortalece-tu-mercado/${_.slug}`:`/asistencias/${_.slug}`,target:"_blank"}," Ver Link ",8,pe)]),_:2},1024),p([1,5])?(r(),c(I,{key:0},{default:o(()=>[f(H,{to:`inscritos/${_.slug}`},{default:o(()=>l[4]||(l[4]=[L("Inscritos")])),_:2},1032,["to"])]),_:2},1024)):i("",!0),p([1,5])?(r(),c(I,{key:1},{default:o(()=>[N("a",{onClick:s=>B(_)},"Editar",8,_e)]),_:2},1024)):i("",!0),p([1,5])?(r(),c(I,{key:2},{default:o(()=>[N("span",{style:{color:"#ff4d4f"},onClick:s=>G(_)},"Finalizar",8,ve)]),_:2},1024)):i("",!0),p([1,5])?(r(),c(I,{key:3},{default:o(()=>[f(W,{placement:"rightBottom",title:`¿Quieres eliminar ${_.title} ?`,onConfirm:s=>R(_)},{icon:o(()=>[f(x(se),{style:{color:"red"}})]),default:o(()=>[l[5]||(l[5]=N("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):i("",!0)]),_:1},8,["othersList","pageSize","asesoresList","dataSource","total"]),f(a,{open:b.value,"onUpdate:open":l[0]||(l[0]=_=>b.value=_),title:E.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:o(()=>[f(ce,{onCloseDraw:Y,dataRow:E.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{we as default};
