import{_ as R}from"./FormComponent-b7f15a59.js";import{u as k}from"./selectes-af8b5888.js";import{l as u,r as l,a as q,j as A,X as x,a6 as g,o as m,d as v,x as L,h as M,L as j,c as B,e as Y,t as F,F as G,R as H}from"./index-4f60820b.js";import"./es-0f141d4f.js";const U={key:1,class:"f-20"},X={__name:"DrawerSolicitante.componente",props:["info"],emits:["closeDraw"],setup(h,{emit:S}){u.locale("es");const t=k(),_=JSON.parse(localStorage.getItem("role"));t.fetchCities();const s=l({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!_.some(i=>i.id==1||i.id==5)},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!_.some(i=>i.id==1||i.id==5),rules:[{validator:(i,a)=>{if(!a)return Promise.reject(new Error("Escribe número de documento"));const n=String(a);if(!/^\d+$/.test(n))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(n.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(n.length<3||n.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},country_id:{type:"iSelect",label:"PAÍS ORIGEN",name:"country_id",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(i,a)=>{if(!a)return Promise.reject(new Error("El número es requerido"));const n=a.toString();return n.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):n.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(i,a)=>a?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},sick:{type:"iSelect",label:"¿TIENE DISCAPACIDAD?",name:"sick",required:!0,message:"Seleccionar"},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS?",name:"hasSoon",required:!1,message:"¿Tiene hijos?"}});JSON.parse(localStorage.getItem("profile"));const f=S,d=h,o=l(!0),E=l("ACTUALIZAR"),e=q({}),c=l(!1),O=l(null),r=l({country_id:[],city_id:[],province_id:[],district_id:[],modality_id:[],comercialactivity_id:[],isbic:[],typecapital_id:[],component_id:[],theme_id:[],typedocument_id:[],gender_id:[],sick:[],hasSoon:[]}),D=i=>{console.log("handleInputEvent",i)},I=async i=>{i=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),s.value.dateTramite.disabled=!1)},N=async i=>{i=="city_id"&&(e.province_id=null,e.district_id=null,r.value.province_id=[],await t.fetchProvinces(e.city_id),r.value.province_id=t.provinces,s.value.province_id.disabled=!1),i=="province_id"&&(await t.fetchDistricts(e.province_id),r.value.district_id=t.districts,s.value.district_id.disabled=!1)},C=async i=>{console.log("handleFocusSelect",i),i=="city_id"&&(r.value.city_id=t.cities),i=="province_id"&&(e.province_id=null,e.district_id=null,r.value.district_id=[]),i=="typedocument_id"&&(r.value.typedocument_id=t.typeDocuments),i=="country_id"&&(r.value.country_id=t.countries),i=="gender_id"&&(r.value.gender_id=t.genders),i=="sick"&&p(),i=="hasSoon"&&y()},T=i=>{},p=()=>{r.value.sick=[{value:"yes",label:"SI"},{value:"no",label:"NO"}]},y=()=>{r.value.hasSoon=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}]},P=async()=>{c.value=!0;const i={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,phone:e.phone,email:e.email,gender_id:e.gender_id,birthday:e.birthday?u(e.birthday).format("YYYY-MM-DD"):null,sick:e.sick=="SI"?"yes":"no",hasSoon:e.hasSoon,country_id:e.country_id};try{(await H({url:`person/update/${d.info.id}`,method:"PUT",data:i})).status===200&&(w(),f("closeDraw",!0))}catch(a){console.error("Error:",a);const n=document.getElementsByClassName("ant-drawer-body")[0];n&&(n.scrollTop=0)}finally{c.value=!1}},w=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},b=async i=>{o.value=!0;try{i&&(await t.fetchTypeDocuments(),r.value.typedocument_id=t.typeDocuments,e.typedocument_id=i.typedocument_id,e.documentnumber=i.document,e.lastname=i.lastname,e.middlename=i.middlename,e.name=i.name,await t.fetchCountries(),r.value.country_id=t.countries,e.country_id=i.country_id,e.address=i.address,i.birthday&&(e.birthday=u(i.birthday,"YYYY-MM-DD")),e.phone=i.phone,e.email=i.email,await t.fetchGenders(),r.value.gender_id=t.genders,e.gender_id=i.gender_id,p(),e.sick=i.sick,y(),e.address=i.address,e.hasSoon=i.hasSoon,await t.fetchCities(),r.value.city_id=t.cities,e.city_id=i.city_id,await t.fetchProvinces(e.city_id),r.value.province_id=t.provinces,s.value.province_id.disabled=!1,e.province_id=i.province_id,await t.fetchDistricts(e.province_id),r.value.district_id=t.districts,s.value.district_id.disabled=!1,e.district_id=i.district_id)}catch(a){console.error("Error al cargar la información:",a)}finally{o.value=!1}};return A(()=>{d.info&&b(d.info)}),x(()=>d.info,i=>{i&&b(i)}),g("formState",e),g("loadingState",c),(i,a)=>(m(),v(G,null,[o.value?(m(),L(M(j),{key:0,style:{color:"#00a6db"}})):(m(),v("div",U,[B(R,{fields:s.value,options:r.value,btnSaveName:E.value,onHandleInputEvent:D,resetSelect:O.value,onHandleChangeSelect:N,onHandleFocusSelect:C,onHandleBlurSelect:T,onHandleChangeClock:I,onOnSubmit:P},null,8,["fields","options","btnSaveName","resetSelect"])])),Y("pre",null,F(),1)],64))}};export{X as _};
