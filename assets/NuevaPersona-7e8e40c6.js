import{G,r as c,v as ue,u as ce,a as me,l as pe,b as u,o,d as T,c as b,w as m,e as q,t as be,i as x,B as r,F,f as I,h as U,m as g,z as ve,y as i,H as _e,j as ye,p as fe,k as he}from"./index-eadd5391.js";import"./es-eb9ba457.js";import{g as ge,d as qe}from"./selects-1ceaf713.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";const ke={document_type:{type:"iSelect",label:"Tipo de documento",name:"document_type",required:!0,message:"Seleccionar tipo de documento",disabled:!1},number_document:{type:"iSearch",label:"Ingresar número",name:"number_document",required:!0,message:"Escribe número de documento",disabled:!1},last_name:{type:"iText",label:"Apellido Paterno",name:"last_name",required:!0,message:"Escribir apellido",disabled:!1},middle_name:{type:"iText",label:"Apellido Materno",name:"middle_name",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!1},department:{type:"iSelect",label:"Departamento",name:"department",required:!1,message:"Seleccionar departamento",disabled:!1},province:{type:"iSelect",label:"Provincia",name:"province",required:!1,message:"Seleccionar provincia",disabled:!1},district:{type:"iSelect",label:"Distrito",name:"district",required:!1,message:"Seleccionar distrito",disabled:!1},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!1,message:"Número de contacto y 9 max",max:9,disabled:!1},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Número de contacto y 9 max",email:"email",disabled:!1},birthdate:{type:"iDate",label:"Fecha de nacimiento",name:"birthdate",required:!1,message:"Seleccionar fecha",disabled:!1},gender:{type:"iSelect",label:"Género",name:"gender",required:!1,message:"Seleccionar tipo de documento"},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!1,message:"Seleccionar un tipo"}};const j=S=>(fe("data-v-30c725b8"),S=S(),he(),S),De=j(()=>q("br",null,null,-1)),Te={class:"uppercase"},xe=j(()=>q("br",null,null,-1)),Ue={key:1,class:"agreement-wrapper"},Ee={class:"grid-item"},O="YYYY-MM-DD",Ne={__name:"NuevaPersona",setup(S){G.locale("es");const M=JSON.parse(localStorage.getItem("user")),s=c(ke),d=ue(),k=ce(),Y=c([]),E=c(!0),N=c(!1),w=c(!1),P=c([]),D=c([]),y=c([]),f=c(null),z=[{label:"DNI",value:"dni"},{label:"CE",value:"ce"},{label:"PAS",value:"pas"},{label:"PTP",value:"ptp"}],e=me({document_type:"dni",number_document:null,last_name:null,middle_name:null,name:null,department:null,province:null,district:null,phone:null,email:null,birthdate:null,gender:null,lession:null,created_by:M.id,update_by:M.id,post:d.query.access}),R=()=>{e.document_type=null,e.number_document=null,e.last_name=null,e.middle_name=null,e.name=null,e.department=null,e.province=null,e.district=null,e.phone=null,e.email=null},A=()=>{s.value.last_name.disabled=!1,s.value.middle_name.disabled=!1,s.value.name.disabled=!1,s.value.department.disabled=!1,s.value.province.disabled=!1,s.value.district.disabled=!1,s.value.phone.disabled=!1,s.value.email.disabled=!1,s.value.birthdate.disabled=!1,s.value.gender.disabled=!1,s.value.lession.disabled=!1},C=()=>{s.value.last_name.disabled=!0,s.value.middle_name.disabled=!0,s.value.name.disabled=!0,s.value.department.disabled=!0,s.value.province.disabled=!0,s.value.district.disabled=!0,s.value.phone.disabled=!0,s.value.email.disabled=!0,s.value.birthdate.disabled=!0,s.value.gender.disabled=!0,s.value.lession.disabled=!0},H=()=>{if(d.query.rol==="asesor"){const t={type:"iSelect",label:"Supervisor",name:"supervisor",required:!0,message:"Seleccionar el supervisor"};s.value={...s.value,supervisor:t}}},L=()=>{e.number_document=e.number_document.replace(/\D/g,"")},J=async()=>{if(!e.document_type)return g.warning("Debes escoger un tipo de documento");N.value=!0;try{const l=await U({url:`/person/${e.document_type}/${e.number_document}`,method:"GET"});if(l.status===404)return A();const t=l.data;e.name=t.nombres,e.last_name=t.apellidoPaterno,e.middle_name=t.apellidoMaterno,t.department&&(e.department=t.department,$(t.department)),t.province&&(e.province=t.province,V(t.province)),t.document_type&&(e.document_type=t.document_type),t.district&&(e.district=t.district),t.email&&(e.email=t.email),t.phone&&(e.phone=t.phone),t.birthdate&&(f.value=G(t.birthdate,O)),t.gender&&(e.gender=t.gender),e.lession=t.lession,A()}catch(l){console.log("Hhhhh",l)}finally{N.value=!1}},K=l=>{R(),C(),e.document_type=l},Q=(l,t)=>{e.province=null,e.district=null,D.value=[],y.value=[],$(t.value)},W=(l,t)=>{e.district=null,y.value=[],V(t.value)},B=()=>{if(d.query.dni){const l={dni:d.query.dni};k.push({name:"asesorias-formalizaciones",query:l})}else{const l=d.query.access;l==1&&k.push("/admin/asesorias/supervisores"),l==2&&k.push("/admin/asesorias/asesores"),l==3&&k.push("/admin/asesorias/solicitantes")}},X=async()=>{s.value.document_type.disabled=!1;try{const{data:l}=await I({url:"/departaments",method:"GET"});let t=l.map(p=>({label:p.label,value:p.id}));P.value=[...P.value,...t],E.value=!1,C(),H()}catch(l){console.log(l)}},$=async l=>{try{const{data:t}=await I({url:`/province/${l}`,method:"GET"});let p=t.map(v=>({label:v.label,value:v.id}));D.value=[...D.value,...p]}catch(t){console.log(t)}},V=async l=>{try{const{data:t}=await I({url:`/district/${l}`,method:"GET"});let p=t.map(v=>({label:v.label,value:v.id}));y.value=[...y.value,...p]}catch(t){console.log(t)}},Z=async()=>{e.birthdate=f.value?G(f.value).format("YYYY-MM-DD"):null;const l=e;w.value=!0;try{const t=await U({url:"/new-person",method:"POST",data:l});t&&(R(),C(),e.document_type="dni",g.success(t.message),B())}catch(t){if(t.response.status==550)return g.error("El usuario ya se encuentra registrado");g.error("Error al registrar")}finally{w.value=!1}},ee=()=>{g.error("Debes de completar todos los espacios requeridos")},ae=async()=>{try{const l=await U({url:"/supervisores",method:"GET"});Y.value=l}catch(l){console.error("Error de red:",l)}},te=async()=>{if(d.query.dni){const l=await U({url:`/person/dni/${d.query.dni}`,method:"GET"});l.status==404?e.number_document=d.query.dni:(e.number_document=d.query.dni,e.last_name=l.data.apellidoPaterno,e.middle_name=l.data.apellidoMaterno,e.name=l.data.nombres),A(),E.value=!1}};return pe(()=>{X(),te(),d.query.rol==="asesor"&&ae()}),(l,t)=>{const p=u("a-breadcrumb-item"),v=u("a-breadcrumb"),le=u("a-spin"),_=u("a-select"),h=u("a-form-item"),se=u("a-input-search"),ne=u("a-input"),oe=u("a-date-picker"),re=u("a-button"),de=u("a-form");return o(),T(F,null,[b(v,null,{default:m(()=>[b(p,null,{default:m(()=>[q("a",{onClick:B},"Atrás")]),_:1})]),_:1}),De,q("h3",Te,"REGISTRO DE "+be(x(d).query.rol),1),xe,E.value?(o(),r(le,{key:0})):(o(),T("div",Ue,[b(de,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Z,onFinishFailed:ee},{default:m(()=>[q("div",Ee,[(o(!0),T(F,null,ve(s.value,(a,ie)=>(o(),T(F,{key:ie},[a.type==="iSelect"?(o(),r(h,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[a.name=="document_type"?(o(),r(_,{key:0,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:z,disabled:a.disabled,onChange:K},null,8,["value","onUpdate:value","disabled"])):i("",!0),a.name=="department"?(o(),r(_,{key:1,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:P.value,onChange:Q,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="province"?(o(),r(_,{key:2,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:D.value,onChange:W,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="district"?(o(),r(_,{key:3,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:y.value,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="gender"?(o(),r(_,{key:4,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:x(ge),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="lession"?(o(),r(_,{key:5,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:x(qe),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),a.name=="supervisor"?(o(),r(_,{key:6,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,options:Y.value,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0)]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iSearch"?(o(),r(h,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[b(se,{maxlength:15,loading:N.value,value:e[a.name],"onUpdate:value":n=>e[a.name]=n,onSearch:J,onInput:L},null,8,["loading","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iText"?(o(),r(h,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:m(()=>[b(ne,{value:e[a.name],"onUpdate:value":n=>e[a.name]=n,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):i("",!0),a.type==="iDate"?(o(),r(h,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[b(oe,{locale:x(_e),value:f.value,"onUpdate:value":t[0]||(t[0]=n=>f.value=n),style:{width:"100%"},format:O,disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):i("",!0)],64))),128))]),b(h,null,{default:m(()=>[b(re,{type:"primary","html-type":"submit",loading:w.value},{default:m(()=>[ye("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))],64)}}},Ge=Se(Ne,[["__scopeId","data-v-30c725b8"]]);export{Ge as default};
