import{c as e,A as ne,g as le,r,v as se,k as J,b as v,o as h,d as b,e as s,i as R,t as g,w as o,s as C,q as j,h as T,O as re,Q as ie,I as de,J as ce,F as Z,y as k,m as G,G as ue,P as pe,a as me,B as ve,R as _e,S as fe,T as he,U as ge,p as ye,j as we}from"./index-e385c1d5.js";import{D as be}from"./DrawDriveUsers.component-de71f4de.js";import{M as Fe}from"./MoreOutlined-12414a85.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32z"}}]},name:"folder",theme:"filled"};const De=ke;function Q(i){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},u=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(t).filter(function(_){return Object.getOwnPropertyDescriptor(t,_).enumerable}))),u.forEach(function(_){Ee(i,_,t[_])})}return i}function Ee(i,n,t){return n in i?Object.defineProperty(i,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[n]=t,i}var Y=function(n,t){var u=Q({},n,t.attrs);return e(ne,Q({},u,{icon:De}),null)};Y.displayName="FolderFilled";Y.inheritAttrs=!1;const Oe=Y;const Se={style:{color:"#959595","font-weight":"300"}},$e=s("br",null,null,-1),xe={key:0},Ae={key:1,class:"uppercase"},Ie=["onClick"],Ue=s("a",null,"Eliminar",-1),Re={class:"paginator-drive"},Te={__name:"ArchivosFolder.component",props:["idFile"],emits:["handleDeleteItem"],setup(i,{emit:n}){const t=i,u=n,_="https://apituempresa.soporte-pnte.com/api/",z="http://127.0.0.1:8000/api/",H=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?z:_,p=le.get("token"),S=r(!1),N=r([]),B=r(null),$=r(null),F=r({}),D=r([]),x=r(!1),E=r(0),a=[{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],d=async l=>{var c;B.value=l.id;try{const f=await k({url:`drive/users-selected/${l.id}`,method:"GET"});f.data[0]&&($.value=(c=f.data[0])==null?void 0:c.user_ids)}catch(f){console.error("Error de red:",f)}S.value=!0},O=()=>{t.idFile&&(D.value=t.idFile.dataSource,E.value=t.idFile.total)},P=async l=>{try{const c=await k({url:`drive/delete-file/${l.id}`,method:"DELETE"});G.success(c.message);const f={id:t.idFile.id,name:t.idFile.nameFolder};u("handleDeleteItem",f)}catch(c){console.error("Error de red:",c)}},V=async l=>{F.value={...F.value,[l]:!0};try{const c=await ue.get(`${H}drive/download/${l}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${p}`}}),f=window.URL.createObjectURL(new Blob([c.data])),y=document.createElement("a");y.href=f,y.setAttribute("download",l),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(c){console.error("Error al descargar el archivo",c)}finally{F.value={...F.value,[l]:!1}}},A=l=>pe(l).format("DD/MM/YYYY HH:mm A"),M=r(window.innerHeight-100),I=()=>{M.value=window.innerHeight-300};se(()=>{window.removeEventListener("resize",I)});const m=r({page:1}),L=l=>{m.value.page=l,W()},W=async()=>{try{x.value=!0;const{data:l}=await k({url:`drive/data-files/${t.idFile}`,method:"GET"});D.value=l.data,E.value=l.total}catch(l){console.error("Error de red:",l)}finally{x.value=!1}};return J(()=>{window.addEventListener("resize",I),I()}),(l,c)=>{const f=v("a-button"),y=v("a-menu-item"),X=v("a-popconfirm"),K=v("a-menu"),ee=v("a-dropdown"),te=v("a-table"),ae=v("a-tag"),oe=v("a-pagination");return h(),b(Z,null,[s("div",null,[s("h3",null,[R("ARCHIVOS "),s("span",Se,"/ "+g(t.idFile.nameFolder),1)]),$e,e(te,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:M.value},columns:a,"data-source":D.value,pagination:!1,loading:x.value,size:"small"},{bodyCell:o(({column:U,record:w})=>[U.dataIndex=="date"?(h(),b("div",xe,g(A(w.created_at)),1)):C("",!0),U.dataIndex=="user"?(h(),b("div",Ae,g(w.profile.name)+" "+g(w.profile.lastname)+" "+g(w.profile.middlename),1)):C("",!0),U.dataIndex=="download"?(h(),j(f,{key:2,size:"small",onClick:q=>V(w.path),type:"primary",ghost:"",loading:F.value[w.path]},{icon:o(()=>[e(T(re))]),default:o(()=>[R(" Descargar ")]),_:2},1032,["onClick","loading"])):C("",!0),U.dataIndex=="actions"?(h(),j(ee,{key:3,trigger:["click"]},{overlay:o(()=>[e(K,null,{default:o(()=>[e(y,null,{default:o(()=>[s("a",{onClick:q=>d(w)},"Visible para",8,Ie)]),_:2},1024),e(y,null,{default:o(()=>[e(X,{title:"Â¿Seguro de eliminar?",onConfirm:q=>P(w)},{icon:o(()=>[e(T(ie),{style:{color:"red"}})]),default:o(()=>[Ue]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[s("a",{class:"ant-dropdown-link",onClick:c[0]||(c[0]=de(()=>{},["prevent"]))},[e(f,{shape:"circle",icon:ce(T(Fe))},null,8,["icon"])])]),_:2},1024)):C("",!0)]),_:1},8,["scroll","data-source","loading"])]),s("div",null,g(O()),1),s("div",Re,[s("span",null,[e(ae,{color:"blue"},{default:o(()=>[s("b",null,g(D.value.length),1)]),_:1}),R(" Archivos Subidos")]),e(oe,{size:"small",pageSize:20,total:E.value,onChange:L,showSizeChanger:!1},null,8,["total"])]),S.value?(h(),j(be,{key:0,plainOptions:N.value,idFile:B.value,selectedUsers:$.value,onHandleCloseDrawer:c[1]||(c[1]=U=>S.value=!1)},null,8,["plainOptions","idFile","selectedUsers"])):C("",!0)],64)}}};const ze=i=>(ye("data-v-3840c391"),i=i(),we(),i),He={key:0},Be=ze(()=>s("h3",null,"MIS CARPETAS",-1)),Me={class:"file-wrapper"},Ne={class:"file-options"},Pe=["onClick"],Ve=["onClick"],Le={class:"text"},je={key:1,class:"section-table"},Ge={__name:"DriveCarpetas",setup(i){const n=r(null),t=r("files"),u=r(!1),_=r(!1),z=r(null),H=r(null),p=me({name:"",color:"#000000"}),S=()=>{u.value=!1,p.name="",p.color="#000000",n.value=null},N=()=>{u.value=!0},B=a=>{$(a)},$=async a=>{try{_.value=!0;const{data:d}=await k({url:`drive/data-files/${a.id}`,method:"GET"}),O={id:a.id,dataSource:d.data,total:d.total,nameFolder:a.name};H.value=O,t.value="table"}catch(d){console.error("Error de red:",d)}finally{_.value=!1}},F=a=>{p.name=a.name,p.color=a.color,u.value=!0,n.value=a.id},D=async()=>{_.value=!0;try{let a;n.value?a=await k({url:`drive/update-file/${n.value}`,method:"PUT",data:p}):a=await k({url:"drive/create-file",method:"POST",data:p}),a.status==200&&(p.name=null,u.value=!1,G.success(a.message),E(),n.value=null)}catch{G.error("No tienes permisos")}finally{_.value=!1}},x=()=>{console.log("Failed:")},E=async()=>{try{const{data:a}=await k({url:"drive/files",method:"GET"});z.value=a}catch(a){console.error("Error de red:",a)}};return J(()=>{E()}),(a,d)=>{const O=v("a-button"),P=v("a-popover"),V=v("a-input"),A=v("a-form-item"),M=v("a-form"),I=v("a-drawer");return h(),b("div",null,[t.value=="files"?(h(),b("section",He,[Be,e(O,{style:{margin:"1rem 0 1.5rem 0"},class:"btn-produce",type:"primary",onClick:N},{default:o(()=>[R("NUEVO")]),_:1}),s("div",Me,[(h(!0),b(Z,null,ve(z.value,m=>(h(),b("div",{class:"file",key:m.id},[e(P,{trigger:"click"},{content:o(()=>[s("div",Ne,[s("span",{onClick:L=>$(m)},"Abrir",8,Pe),s("span",{onClick:L=>F(m)},"Editar",8,Ve)])]),default:o(()=>[e(T(Oe),{class:"ico",style:_e({color:m.color})},null,8,["style"])]),_:2},1024),s("span",Le,g(m.name),1)]))),128))])])):C("",!0),t.value=="table"?(h(),b("section",je,[e(T(fe),{class:"close",onClick:d[0]||(d[0]=m=>t.value="files")}),e(Te,{idFile:H.value,onHandleDeleteItem:B},null,8,["idFile"])])):C("",!0),e(I,{open:u.value,"onUpdate:open":d[3]||(d[3]=m=>u.value=m),title:"Nueva carpeta",placement:"right",onClose:S},{default:o(()=>[e(M,{layout:"vertical",model:p,name:"basic",onFinish:D,onFinishFailed:x},{default:o(()=>[e(A,{label:"Nombre de la carpeta",name:"name",rules:[{required:!0,message:"Escribe un nombre del archivo"}]},{default:o(()=>[e(V,{value:p.name,"onUpdate:value":d[1]||(d[1]=m=>p.name=m)},null,8,["value"])]),_:1}),e(A,{label:"Color de la carpeta",name:"color"},{default:o(()=>[he(s("input",{type:"color","onUpdate:modelValue":d[2]||(d[2]=m=>p.color=m)},null,512),[[ge,p.color]])]),_:1}),e(A,null,{default:o(()=>[e(O,{class:"btn-produce",type:"primary","html-type":"submit",loading:_.value},{default:o(()=>[R(g(n.value?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Ze=Ce(Ge,[["__scopeId","data-v-3840c391"]]);export{Ze as default};
