import{G as I,r as p,y as ue,u as ce,b as me,l as pe,d as c,o,e as w,i as q,s as d,w as b,v as u,f as k,t as be,c as _,F as M,g as Y,m as y,h as S,B as ve,H as _e,j as ye,p as fe,k as he}from"./index-79c492b1.js";import"./es-3ce5d4e1.js";import{g as ge,d as qe}from"./selects-0fbcf7fc.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";const ke={document_type:{type:"iSelect",label:"Tipo de documento",name:"document_type",required:!0,message:"Seleccionar tipo de documento",disabled:!1},number_document:{type:"iSearch",label:"Ingresar número",name:"number_document",required:!0,message:"Escribe número de documento",disabled:!1},last_name:{type:"iText",label:"Apellido Paterno",name:"last_name",required:!0,message:"Escribir apellido",disabled:!1},middle_name:{type:"iText",label:"Apellido Materno",name:"middle_name",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!1},department:{type:"iSelect",label:"Departamento",name:"department",required:!0,message:"Seleccionar departamento",disabled:!1},province:{type:"iSelect",label:"Provincia",name:"province",required:!0,message:"Seleccionar provincia",disabled:!1},district:{type:"iSelect",label:"Distrito",name:"district",required:!0,message:"Seleccionar distrito",disabled:!1},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!1,message:"Número de contacto y 9 max",max:9,disabled:!1},email:{type:"iText",label:"Correo electrónico",name:"email",required:!0,message:"Número de contacto y 9 max",email:"email",disabled:!1},birthdate:{type:"iDate",label:"Fecha de nacimiento",name:"birthdate",required:!1,message:"Seleccionar fecha",disabled:!1},gender:{type:"iSelect",label:"Género",name:"gender",required:!1,message:"Seleccionar tipo de documento"},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!1,message:"Seleccionar un tipo"}};const H=T=>(fe("data-v-2135f55e"),T=T(),he(),T),Te=H(()=>k("br",null,null,-1)),De={class:"uppercase"},xe=H(()=>k("br",null,null,-1)),Ue={key:2,class:"agreement-wrapper"},we={class:"grid-item"},j="YYYY-MM-DD",Ee={__name:"NuevaPersona",setup(T){I.locale("es");const D=JSON.parse(localStorage.getItem("user")),n=p(ke),r=ue(),x=ce(),R=p([]),E=p(!0),N=p(!1),P=p(!1),A=p([]),U=p([]),f=p([]),h=p(null),L=[{label:"DNI",value:"dni"},{label:"CE",value:"ce"},{label:"PAS",value:"pas"},{label:"PTP",value:"ptp"}],e=me({document_type:"dni",number_document:null,last_name:null,middle_name:null,name:null,department:null,province:null,district:null,phone:null,email:null,birthdate:null,gender:null,lession:null,created_by:D.id,update_by:D.id,post:r.query.access}),B=()=>{e.document_type=null,e.number_document=null,e.last_name=null,e.middle_name=null,e.name=null,e.department=null,e.province=null,e.district=null,e.phone=null,e.email=null},C=()=>{n.value.last_name.disabled=!1,n.value.middle_name.disabled=!1,n.value.name.disabled=!1,n.value.department.disabled=!1,n.value.province.disabled=!1,n.value.district.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthdate.disabled=!1,n.value.gender.disabled=!1,n.value.lession.disabled=!1},G=()=>{n.value.last_name.disabled=!0,n.value.middle_name.disabled=!0,n.value.name.disabled=!0,n.value.department.disabled=!0,n.value.province.disabled=!0,n.value.district.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthdate.disabled=!0,n.value.gender.disabled=!0,n.value.lession.disabled=!0},z=()=>{if(r.query.rol==="asesor"){const t={type:"iSelect",label:"Supervisor",name:"supervisor",required:!0,message:"Seleccionar el supervisor"};n.value={...n.value,supervisor:t}}},J=()=>{e.number_document=e.number_document.replace(/\D/g,"")},K=async()=>{if(!e.document_type)return S.warning("Debes escoger un tipo de documento");N.value=!0;try{const l=await y({url:`/person/${e.document_type}/${e.number_document}`,method:"GET"});if(l.status===404)return C();const t=l.data;e.name=t.nombres,e.last_name=t.apellidoPaterno,e.middle_name=t.apellidoMaterno,t.department&&(e.department=t.department,O(t.department)),t.province&&(e.province=t.province,V(t.province)),t.document_type&&(e.document_type=t.document_type),t.district&&(e.district=t.district),t.email&&(e.email=t.email),t.phone&&(e.phone=t.phone),t.birthdate&&(h.value=I(t.birthdate,j)),t.gender&&(e.gender=t.gender),e.lession=t.lession,C()}catch(l){console.log("Hhhhh",l)}finally{N.value=!1}},Q=l=>{B(),G(),e.document_type=l},W=(l,t)=>{e.province=null,e.district=null,U.value=[],f.value=[],O(t.value)},X=(l,t)=>{e.district=null,f.value=[],V(t.value)},$=()=>{if(r.query.dni){const l={dni:r.query.dni};x.push({name:"asesorias-formalizaciones",query:l})}else{const l=r.query.access;l==1&&x.push("/admin/asesorias/supervisores"),l==2&&x.push("/admin/asesorias/asesores"),l==3&&x.push("/admin/asesorias/solicitantes")}},Z=async()=>{n.value.document_type.disabled=!1;try{const{data:l}=await Y({url:"/departaments",method:"GET"});let t=l.map(i=>({label:i.label,value:i.id}));A.value=[...A.value,...t],E.value=!1,G(),z()}catch(l){console.log(l)}},O=async l=>{try{const{data:t}=await Y({url:`/province/${l}`,method:"GET"});let i=t.map(m=>({label:m.label,value:m.id}));U.value=[...U.value,...i]}catch(t){console.log(t)}},V=async l=>{try{const{data:t}=await Y({url:`/district/${l}`,method:"GET"});let i=t.map(m=>({label:m.label,value:m.id}));f.value=[...f.value,...i]}catch(t){console.log(t)}},ee=async()=>{e.birthdate=h.value?I(h.value).format("YYYY-MM-DD"):null;const l=e;P.value=!0;try{const t=await y({url:"/new-person",method:"POST",data:l});if(t){let i=null;if(r.query.rol=="supervisor"&&(i=30),r.query.rol=="asesor"&&(i=31),r.query.rol=="supervisor"||r.query.rol=="asesor"){const m={birthdate:e.birthdate,gender:e.gender,lession:e.lession,phone_number:e.phone,document_type:e.document_type=="dni"?1:e.document_type=="ce"?2:3,document_number:e.number_document,last_name:e.last_name,middle_name:e.middle_name,name:e.name,country_code:173,email:e.email,password:e.number_document,office_code:1,sede_code:1,role:i,created_by:D.id,updated_by:D.id};await y({url:"/new-user",method:"POST",data:m});const F={id_supervisor:e.supervisor,created_by:e.created_by,number_document:e.number_document};r.query.rol=="asesor"&&await y({url:"/user-asesor",method:"POST",data:F})}B(),G(),e.document_type="dni",S.success(t.message),$()}}catch(t){if(t.response.status==550)return S.error("El usuario ya se encuentra registrado");S.error("Error al registrar")}finally{P.value=!1}},ae=()=>{S.error("Debes de completar todos los espacios requeridos")},te=async()=>{try{const l=await y({url:"/supervisores",method:"GET"});R.value=l}catch(l){console.error("Error de red:",l)}},le=async()=>{if(r.query.dni){const l=await y({url:`/person/dni/${r.query.dni}`,method:"GET"});l.status==404?e.number_document=r.query.dni:(e.number_document=r.query.dni,e.last_name=l.data.apellidoPaterno,e.middle_name=l.data.apellidoMaterno,e.name=l.data.nombres),C(),E.value=!1}};return pe(()=>{Z(),le(),r.query.rol==="asesor"&&te()}),(l,t)=>{const i=c("a-breadcrumb-item"),m=c("a-breadcrumb"),F=c("a-spin"),v=c("a-select"),g=c("a-form-item"),ne=c("a-input-search"),se=c("a-input"),re=c("a-date-picker"),oe=c("a-button"),de=c("a-form");return o(),w(M,null,[q(r).query.dni?u("",!0):(o(),d(m,{key:0},{default:b(()=>[_(i,null,{default:b(()=>[k("a",{onClick:$},"Atrás")]),_:1})]),_:1})),Te,k("h3",De,"REGISTRO DE "+be(q(r).query.rol),1),xe,E.value?(o(),d(F,{key:1})):(o(),w("div",Ue,[_(de,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:ee,onFinishFailed:ae},{default:b(()=>[k("div",we,[(o(!0),w(M,null,ve(n.value,(a,ie)=>(o(),w(M,{key:ie},[a.type==="iSelect"?(o(),d(g,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:b(()=>[a.name=="document_type"?(o(),d(v,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:L,disabled:a.disabled,onChange:Q},null,8,["value","onUpdate:value","disabled"])):u("",!0),a.name=="department"?(o(),d(v,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:A.value,onChange:W,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="province"?(o(),d(v,{key:2,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:U.value,onChange:X,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="district"?(o(),d(v,{key:3,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:f.value,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="gender"?(o(),d(v,{key:4,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(ge),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="lession"?(o(),d(v,{key:5,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(qe),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="supervisor"?(o(),d(v,{key:6,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:R.value,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0)]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iSearch"?(o(),d(g,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:b(()=>[_(ne,{maxlength:15,loading:N.value,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,onSearch:K,onInput:J},null,8,["loading","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iText"?(o(),d(g,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:b(()=>[_(se,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iDate"?(o(),d(g,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:b(()=>[_(re,{locale:q(_e),value:h.value,"onUpdate:value":t[0]||(t[0]=s=>h.value=s),style:{width:"100%"},format:j,disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):u("",!0)],64))),128))]),_(g,null,{default:b(()=>[_(oe,{type:"primary","html-type":"submit",loading:P.value},{default:b(()=>[ye("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))],64)}}},Ge=Se(Ee,[["__scopeId","data-v-2135f55e"]]);export{Ge as default};
