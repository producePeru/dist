import{L as I,x as le,r as p,u as se,a as ie,j as re,b as c,o as r,d as x,e as q,c as y,w as m,F as P,v as de,p as d,h,q as o,M as oe,t as ue,i as ce,m as _,y as F,Q as me,f as $}from"./index-e0613bd6.js";import{u as pe}from"./selectes-59b4dc10.js";import"./es-55c1a072.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";const ve={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country_id:{type:"iSelect",label:"País Origen",name:"country_id",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"Región residente",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",min:9,max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},hasSoon:{type:"iSelect",label:"¿Tiene hijos? (Opcional)",name:"hasSoon",required:!1,message:"¿Tiene hijos?",disabled:!1}};const ye={class:"agreement-wrapper"},_e={class:"grid-item"},fe="DD/MM/YYYY",ge={__name:"NuevaPersona",setup(he){I.locale("es");const f=le(),s=pe();s.$patch({typeDocuments:s.typeDocuments}),s.$patch({cities:s.countries}),s.$patch({cities:s.cities}),s.$patch({provinces:s.provinces}),s.$patch({districts:s.districts}),s.$patch({genders:s.genders}),s.fetchTypeDocuments(),s.fetchCountries(),s.fetchCities(),s.fetchGenders();const D=p(null),U=p(null),M=se(),N=JSON.parse(localStorage.getItem("profile")),n=p(ve),g=p(!0),b=p(null),k=p(!1),O=p(!0),Y=[{value:"yes",label:"SI"},{value:"no",label:"NO"}],L=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}],a=ie({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,country_id:155,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,sick:null,people_id:N.user_id,from_id:1}),R=async i=>{try{const{data:t}=await $({url:`select/provinces/${i}`,method:"GET"});D.value=t}catch(t){console.error("Error de red:",t)}},z=async i=>{try{const{data:t}=await $({url:`select/districts/${i}`,method:"GET"});U.value=t}catch(t){console.error("Error de red:",t)}},S=(i,t)=>{const u=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(u)},G=()=>{s.typeDocuments&&(O.value=!1)},j=()=>{n.value.lastname.disabled=!1,n.value.middlename.disabled=!1,n.value.name.disabled=!1,n.value.city_id.disabled=!1,n.value.province_id.disabled=!1,n.value.district_id.disabled=!1,n.value.address.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthday.disabled=!1,n.value.gender_id.disabled=!1,n.value.sick.disabled=!1},T=i=>{i&&(n.value.documentnumber.disabled=!1,a.documentnumber=null)},w=async i=>{if(g.value=!0,!i)return _.warning("Ingresa un número de documento"),g.value=!1;try{if(a.typedocument_id==1){const t=await F({url:`user/only-dni/${a.documentnumber}`,method:"GET"});t.status===404&&me.open({message:"Notificación",description:"Se superó el número de consultas, comentale a tu supervisor"}),t.status==200&&(a.lastname=t.data.apellidoPaterno,a.middlename=t.data.apellidoMaterno,a.name=t.data.nombres)}}catch(t){console.log("err",t)}finally{return j(),g.value=!1}},A=()=>{a.documentnumber=a.documentnumber.replace(/\D/g,"")},B=()=>{a.phone=a.phone.replace(/\D/g,"")},V=i=>{a.province_id=null,a.district_id=null,R(i)},J=i=>{a.district_id=null,z(i)},Q=()=>{a.lastname=null,a.middlename=null,a.name=null,a.city_id=null,a.province_id=null,a.district_id=null,a.address=null,a.phone=null,a.email=null,a.birthday=null,a.gender_id=null,a.sick=null,a.typedocument_id=null,a.documentnumber=null,a.from_id=1,a.people_id=N.id,b.value=null,E()},E=()=>{n.value.documentnumber.disabled=!0,n.value.lastname.disabled=!0,n.value.middlename.disabled=!0,n.value.name.disabled=!0,n.value.city_id.disabled=!0,n.value.city_id.disabled=!0,n.value.province_id.disabled=!0,n.value.address.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthday.disabled=!0,n.value.gender_id.disabled=!0,n.value.sick.disabled=!0},H=async()=>{k.value=!0,a.birthday=b.value?I(b.value).format("YYYY-MM-DD"):null;try{const i=await F({url:"person/create",method:"POST",data:a});if(i.status==400)return _.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(i.status==401)return _.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(i.status==200){const t={type:a.typedocument_id,number:a.documentnumber};return M.push({name:"asesorias-formalizaciones",query:t}),_.success(i.message),Q()}}catch{_.error("No se pudo registrar este usuario")}finally{k.value=!1}},K=()=>{_.error("Debes de completar todos los espacios requeridos")},W=async()=>{E(),f.query&&(a.typedocument_id=+f.query.type,T(f.query.type),a.documentnumber=f.query.number,await s.fetchCities(),await w(f.query.number))};return re(()=>{W()}),(i,t)=>{const u=c("a-select"),v=c("a-form-item"),X=c("a-input-search"),C=c("a-input"),Z=c("a-date-picker"),ee=c("a-button"),ae=c("a-form"),te=c("a-spin");return r(),x("div",ye,[t[3]||(t[3]=q("h3",null,"Formulario de registro",-1)),t[4]||(t[4]=q("br",null,null,-1)),y(te,{spinning:g.value},{default:m(()=>[y(ae,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:H,onFinishFailed:K},{default:m(()=>[q("div",_e,[(r(!0),x(P,null,de(n.value,(e,ne)=>(r(),x(P,{key:ne},[e.type==="iSelect"?(r(),d(v,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:m(()=>[e.name=="typedocument_id"?(r(),d(u,{key:0,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:h(s).typeDocuments,disabled:e.disabled,onChange:T},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),e.name=="country_id"?(r(),d(u,{key:1,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:h(s).countries,"show-search":"","filter-option":S},null,8,["value","onUpdate:value","options"])):o("",!0),e.name=="city_id"?(r(),d(u,{key:2,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:h(s).cities,"show-search":"","filter-option":S,onChange:V,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),e.name=="province_id"?(r(),d(u,{key:3,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:D.value,"show-search":"","filter-option":S,onChange:J,disabled:!a.city_id},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),e.name=="district_id"?(r(),d(u,{key:4,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:U.value,"show-search":"","filter-option":S,disabled:!a.province_id},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),e.name=="gender_id"?(r(),d(u,{key:5,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:h(s).genders,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),e.name=="sick"?(r(),d(u,{key:6,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:Y,disabled:e.disabled},null,8,["value","onUpdate:value","disabled"])):o("",!0),e.name=="hasSoon"?(r(),d(u,{key:7,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:L,disabled:e.disabled},null,8,["value","onUpdate:value","disabled"])):o("",!0)]),_:2},1032,["name","label","rules"])):o("",!0),e.type==="iSearch"?(r(),d(v,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:m(()=>[y(X,{loading:g.value,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,onSearch:w,onInput:A,maxlength:a.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):o("",!0),e.type==="iText"?(r(),d(v,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email,max:e.max,min:e.min}]},{default:m(()=>[e.name=="phone"?(r(),d(C,{key:0,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,disabled:e.disabled,maxlength:e.max,onInput:B},null,8,["value","onUpdate:value","disabled","maxlength"])):(r(),d(C,{key:1,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,disabled:e.disabled,maxlength:e.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):o("",!0),e.type==="iDate"?(r(),d(v,{key:3,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:m(()=>[y(Z,{locale:h(oe),value:b.value,"onUpdate:value":t[0]||(t[0]=l=>b.value=l),style:{width:"100%"},format:fe,placeholder:"día/mes/año",onChange:t[1]||(t[1]=l=>a.birthday=b.value),disabled:e.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):o("",!0)],64))),128))]),q("div",null,ue(G()),1),y(v,null,{default:m(()=>[y(ee,{class:"btn-produce",type:"primary","html-type":"submit",loading:k.value},{default:m(()=>t[2]||(t[2]=[ce("REGISTRAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},De=be(ge,[["__scopeId","data-v-145006d2"]]);export{De as default};
