import"./es-6c78391e.js";import{p as F,r as i,a as j,k as z,U as H,X as b,b as h,o as c,d as p,c as d,w as u,F as x,v as L,i as V,$ as M,j as P,z as w,m as G,h as X,e as B,t as q,y as Q}from"./index-9c3e0987.js";import{_ as J}from"./TableComponent-c5a6df1c.js";import{_ as K}from"./FormComponent-f7493c4e.js";import{g as W}from"./publicInscripcion-ebc9ecb9.js";import"./icoexcel-1b303edf.js";import"./selectes-3a5ea8f7.js";import"./SyncOutlined-b244af5a.js";import"./MoreOutlined-97be7c4c.js";import"./quill.snow-e524dd0a.js";const Y={class:"draw-mp-capacitador"},Z={key:0,style:{"background-color":"#f9f9f9",padding:"1rem","border-radius":"6px"}},ee={key:0,class:"space-y-4"},te={__name:"MujerPreguntasDiagnostico",props:["info"],emits:["closeDraw"],setup($,{emit:I}){F.locale("es");const s=i({label:{type:"iText",label:"PREGUNTA",name:"label",required:!0,message:"Escribir PREGUNTA",disabled:!1,max:200},required:{type:"iSelect",label:"¿ES OBLIGATORIA?",name:"required",required:!0,message:"Seleccionar ¿ES OBLIGATORIA?"},type:{type:"iSelect",label:"TIPO DE PREGUNTA",name:"type",required:!0,message:"Seleccionar TIPO DE PREGUNTA"}}),T=I,l=$,y=i("GUARDAR"),m=i(!1),e=j({options:[]}),f=i({type:[{label:"TEXTO",value:"t"},{label:"OPCIONES",value:"o"}],required:[{label:"SI",value:"s"},{label:"NO",value:"n"}]}),R=()=>{e.options.push({value:""})},U=a=>{e.options.splice(a,1)},A=async a=>{if(a==="type")if(e.options=[],e.type==="o")s.value={...s.value,options:{type:"iSlot",name:"iSlotOptions"}};else{const{options:n,...o}=s.value;s.value=o}},D=async()=>{m.value=!0;try{const a={label:e.label,type:e.type,required:e.required,options:e.options},n=l.info?`mp/update-question-diagnostic/${l.info.id}`:"mp/create-question-diagnostic",o=l.info?"PUT":"POST",t=await G({url:n,method:o,data:a});t.status===200&&(X.success(t.message),E(),T("closeDraw",!0))}catch(a){console.error("Error:",a);const n=document.getElementsByClassName("ant-drawer-body")[0];n&&(n.scrollTop=0)}finally{m.value=!1}},E=()=>{e.dni=null,e.name=null},k=async a=>{if(a)if(e.label=a.label,e.required=a.required==1?"s":"n",e.type=a.type,e.type==="o")s.value={...s.value,options:{type:"iSlot",name:"iSlotOptions"}},e.options=a.options.map(n=>({value:n.name}));else{const{options:n,...o}=s.value;s.value=o}};return z(()=>{l.info&&k(l.info)}),H(()=>l.info,a=>{a?k(a):E()}),b("formState",e),b("loadingState",m),(a,n)=>{const o=h("a-input"),t=h("a-form-item"),r=h("a-button");return c(),p("div",Y,[d(K,{fields:s.value,options:f.value,btnSaveName:y.value,mayus:!0,onHandleChangeSelect:A,onOnSubmit:D},{default:u(({field:g})=>[g.name=="iSlotOptions"?(c(),p("div",Z,[e.type==="o"?(c(),p("div",ee,[(c(!0),p(x,null,L(e.options,(C,S)=>(c(),p("div",{key:S,style:{position:"relative"}},[d(t,{label:`OPCIÓN N° ${S+1}`,class:"flex-1"},{default:u(()=>[d(o,{value:C.value,"onUpdate:value":N=>C.value=N},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),d(V(M),{style:{"font-size":"16px",color:"#ff4d4f",cursor:"pointer",position:"absolute",top:"2.4rem",right:".5rem","background-color":"#fff","padding-left":"1rem"},onClick:N=>U(S)},null,8,["onClick"])]))),128)),d(r,{type:"dashed",onClick:R},{default:u(()=>n[0]||(n[0]=[P(" Agregar opción ")])),_:1})])):w("",!0)])):w("",!0)]),_:1},8,["fields","options","btnSaveName"])])}}},ae={class:"layout-content"},ne=["onClick"],fe={__name:"mp-preguntas-diagnostico",setup($){const I=i([]),s=i(0),T=i(100),l=i(!1),y=i(!1),m=i(null),e=i(!1),f=j({name:null,page:1}),R=[{title:"#",dataIndex:"idx",align:"center",width:10},{title:"TIPO",dataIndex:"type",width:40},{title:"PREGUNTA",dataIndex:"label",width:180},{title:"REQUERIDO",dataIndex:"required",width:40,align:"center"},{title:"OPCIONES",dataIndex:"options",width:120},{title:"ACTIVO",dataIndex:"status",width:40,align:"center"},{title:"",dataIndex:"actions",width:20,align:"center",fixed:"right"}],U=()=>{const t=`${W()}/mujer-produce-diagnostico`;window.open(t,"_blank")},A=t=>{m.value=t,l.value=!0},D=()=>{o(),l.value=!1},E=()=>{m.value=null,l.value=!0},k=async t=>{f.page=t,await o()},a=async t=>{t&&(f.page=1,await o())},n=async t=>{const r=await G({url:`mp/update-status/${t.id}`,method:"PUT"});console.log("response",r)},o=async()=>{y.value=!0;try{const t={page:f.page};f.name&&(t.name=f.name);const r=await G({url:"mp/get-question-diagnostic",method:"GET",params:t}),{data:g}=r;I.value=g.data,s.value=g.total,T.value=g.per_page}catch(t){console.error("Error de red:",t)}finally{y.value=!1}};return z(async()=>{await o()}),b("search",f),b("loading",y),b("loadingFile",e),(t,r)=>{const g=h("a-button"),C=h("a-switch"),S=h("a-menu-item"),N=h("a-drawer");return c(),p("div",ae,[d(J,{title:"PREGUNTAS DEL DIAGNÓSTICO",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",columns:R,titleSearch:"BUSCAR",pageSize:T.value,nameTotal:"Capacitadores",dataSource:I.value,total:s.value,btnUpdate:!0,onHandleNew:E,onHandleCallFetchData:o,onHandleSearch:a,onHandlePaginator:k},{header:u(()=>[d(g,{onClick:U},{default:u(()=>r[1]||(r[1]=[B("span",{class:"fs-13"},"Link al diagnóstico",-1)])),_:1})]),"data-cell":u(({column:v,record:_})=>[v.dataIndex==="type"?(c(),p(x,{key:0},[P(q(_.type==="t"?"Texto":"Opciones"),1)],64)):w("",!0),v.dataIndex==="required"?(c(),p(x,{key:1},[P(q(_.required?"Sí":"No"),1)],64)):v.dataIndex==="options"?(c(),p(x,{key:2},[P(q(_.options.map(O=>O.name).join(", ")),1)],64)):w("",!0),v.dataIndex==="status"?(c(),Q(C,{key:3,checked:_.status,"onUpdate:checked":O=>_.status=O,"checked-value":1,"unchecked-value":0,onChange:O=>n(_)},null,8,["checked","onUpdate:checked","onChange"])):w("",!0)]),"custom-options":u(({record:v})=>[d(S,null,{default:u(()=>[B("a",{onClick:_=>A(v)},"Editar",8,ne)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),d(N,{open:l.value,"onUpdate:open":r[0]||(r[0]=v=>l.value=v),title:m.value?"EDITAR PREGUNTA":"REGISTRAR PREGUNTA",placement:"right",width:"550"},{default:u(()=>[d(te,{onCloseDraw:D,info:m.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{fe as default};
