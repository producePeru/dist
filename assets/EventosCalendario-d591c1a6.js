import{r as _,a as G,l as E,j as Q,T as ee,b as o,o as r,d as c,c as a,w as l,e as u,F as O,s as te,x as P,q as x,h as j,i as I,t as k,m as F,K as J,E as _e,X as fe,p as W,y as ve,J as ge}from"./index-64c8e466.js";import{u as ae}from"./selectes-803715fb.js";import{Q as ne}from"./quill.snow-915e3d55.js";import"./es-de1b7527.js";import{M as ye}from"./MoreOutlined-eeae97a5.js";const be={class:"grid-events"},we={style:{display:"flex",margin:"1rem 0 .5rem"}},he={key:3,class:"grid-events-hour"},Ee={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup($,{emit:T}){const g=ae();g.$patch({officesPnte:g.officesPnte}),g.fetchOfficesPnte();const D=T,m=$,R=_(!1),C={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=_([{dates:new Date}]),p=_({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),t=G({allDay:1}),M=_([{start:null,end:E().subtract(0,"day").format("YYYY-MM-DD")}]),b=n=>n==="id_pnte"?g.officesPnte:[],d={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},H=n=>{if(n==2||n==7){const s=Object.entries(p.value),v=s.findIndex(([z])=>z==="title"),f=[...s.slice(0,v+1),...Object.entries(d),...s.slice(v+1)];p.value=Object.fromEntries(f)}else{const s={...p.value};delete s.organiza,delete s.numMypes,p.value=s}},L=(n,s)=>{const v=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(v)},Y=async()=>{if(!t.date)return F.warning("Debes de seleccionar una fecha del calendario");if(!t.hours)return F.warning("Debes de seleccionar una hora");const n={id_pnte:t.id_pnte,title:t.title,...t.organiza&&{organiza:t.organiza},...t.numMypes&&{numMypes:t.numMypes},dateStart:E(t.date.start).format("YYYY-MM-DD"),dateEnd:E(t.date.end).format("YYYY-MM-DD"),start:E(t.hours[0]).format("HH:mm"),end:E(t.hours[1]).format("HH:mm"),description:t.description,nameUser:t.nameUser,link:t.link};R.value=!0;try{const s=m.dataRow?`event/update/${m.dataRow.id}`:"event/create",v=m.dataRow?"PUT":"POST",f=await J({url:s,method:v,data:n});f.status===200&&(F.success(f.message),t.title="",t.hours=[],t.organiza="",t.numMypes="",t.description="</p>",t.nameUser="",t.link="",t.date=null,D("closeDraw"))}catch(s){F.error(s.message)}finally{R.value=!1}},U=()=>{t.id_pnte=null,t.numMypes="",t.organiza="",t.title="",t.description="</p>",t.nameUser="",t.link="",t.date=null},N=n=>{if(n){if(t.id_pnte=n.id_pnte,n.id_pnte==2||n.id_pnte==7){const s=Object.entries(p.value),v=s.findIndex(([z])=>z==="title"),f=[...s.slice(0,v+1),...Object.entries(d),...s.slice(v+1)];p.value=Object.fromEntries(f)}t.numMypes=n.numMypes,t.organiza=n.organiza,t.title=n.title,t.description=n.description,t.nameUser=n.nameUser,t.link=n.link,t.date={start:E(n.dateStart).toISOString(),end:E(n.dateEnd).toISOString()},t.hours=[E(n.start,"HH:mm"),E(n.end,"HH:mm")]}};return Q(()=>{m.dataRow&&N(m.dataRow)}),ee(()=>m.dataRow,n=>{n?N(n):U()}),(n,s)=>{const v=o("a-select"),f=o("a-form-item"),z=o("a-input"),V=o("VDatePicker"),B=o("a-time-range-picker"),A=o("a-button"),i=o("a-form");return r(),c("div",null,[a(i,{class:"form-events",layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:Y},{default:l(()=>[u("div",be,[(r(!0),c(O,null,te(p.value,(e,w)=>(r(),c(O,{key:w},[e.type==="iSelect"?(r(),P(f,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[a(v,{value:t[e.name],"onUpdate:value":S=>t[e.name]=S,options:b(e.name),"show-search":"","filter-option":L,onChange:H},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):x("",!0),e.type==="iText"?(r(),P(f,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[a(z,{value:t[e.name],"onUpdate:value":S=>t[e.name]=S,maxlength:e.max,disabled:e.disabled,placeholder:e.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):x("",!0),e.type==="iDate"?(r(),P(f,{key:2,name:e.name,label:e.label},{default:l(()=>[a(V,{modelValue:t[e.name],"onUpdate:modelValue":S=>t[e.name]=S,modelModifiers:{range:!0},mode:"date",attributes:q.value,"disabled-dates":M.value},null,8,["modelValue","onUpdate:modelValue","attributes","disabled-dates"]),u("div",we,[u("div",null,[s[1]||(s[1]=u("label",{style:{display:"block"},for:""},"HORARIO",-1)),a(B,{minuteStep:30,value:t.hours,"onUpdate:value":s[0]||(s[0]=S=>t.hours=S),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):x("",!0),e.type==="iSwitch"?(r(),c("div",he)):x("",!0),e.type==="iTextArea"?(r(),P(f,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[a(j(ne),{class:"quill-editor",content:t[e.name],"onUpdate:content":S=>t[e.name]=S,options:C,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):x("",!0)],64))),128))]),a(f,null,{default:l(()=>[a(A,{type:"primary","html-type":"submit",loading:R.value,style:{"margin-top":"1rem"}},{default:l(()=>[I(k(m.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),u("pre",null,k(t),1),s[2]||(s[2]=u("hr",null,null,-1)),u("pre",null,k(m.dataRow),1)])}}};const xe={class:"grid-event-resultado"},Re={__name:"DrawResultados",props:["dataRow"],emits:["closeDraw"],setup($,{emit:T}){const g=ae();g.$patch({officesPnte:g.officesPnte}),g.fetchOfficesPnte();const D=T,m=$,R=_(!1),C={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=_({resultados:{type:"iTextArea",label:"DESCRIBIR RESULTADOS",name:"resultados",required:!1,message:"Escribe los resultados de los evento",max:500}}),p=G({resultado:null}),t=async()=>{const b={resultado:p.resultado};R.value=!0;try{const d=await J({url:`event/update/${m.dataRow.id}`,method:"PUT",data:b});d.status===200&&(F.success(d.message),D("closeDraw"))}catch(d){console.error("Failed to update record",d)}finally{R.value=!1}},M=b=>{console.log("Setting info",b),p.resultado=b.resultado};return Q(()=>{m.dataRow&&M(m.dataRow)}),ee(()=>m.dataRow,b=>{b&&M(b)}),(b,d)=>{const H=o("a-form-item"),L=o("a-button"),Y=o("a-form");return r(),c("div",null,[a(Y,{class:"form-events",layout:"vertical",model:p,name:"basic",autocomplete:"off",onFinish:t},{default:l(()=>[u("div",xe,[(r(!0),c(O,null,te(q.value,(U,N)=>(r(),c(O,{key:N},[U.type==="iTextArea"?(r(),P(H,{key:0,name:U.name,label:U.label,rules:[{required:U.required,message:U.message}]},{default:l(()=>[a(j(ne),{class:"quill-editor",content:p.resultado,"onUpdate:content":d[0]||(d[0]=n=>p.resultado=n),options:C,contentType:"html"},null,8,["content"])]),_:2},1032,["name","label","rules"])):x("",!0)],64))),128))]),a(H,null,{default:l(()=>[a(L,{type:"primary","html-type":"submit",loading:R.value,style:{"margin-top":"1rem"}},{default:l(()=>d[1]||(d[1]=[I("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Se={key:0},ke={key:1},De={key:0},Ie={key:1},Te=["innerHTML"],Ue=["onClick"],Oe=["onClick"],Ce={class:"paginator"},Pe={__name:"EventosCalendario",setup($){E.locale("es"),JSON.parse(localStorage.getItem("role"));const T=_(!1),g=_(!1),D=_(null),m=_(0),R=_(50),C=_({page:0}),q=_(1200),p=_([]),t=_(!1),M=_(window.innerHeight-100),b=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"ÁREA",fixed:"left",dataIndex:"office",width:100},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"results",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],d=G({search:""}),H=()=>{A(),T.value=!1},L=i=>{D.value=i,g.value=!0},Y=i=>{D.value=i,T.value=!0},U=()=>{D.value=null,console.log("Nueva Feria"),T.value=!0},N=()=>{let i={search:d.search};A(i)},n=()=>{d.search||A()},s=i=>E(i).format("DD/MM/YYYY"),v=i=>E(i,"HH:mm:ss").format("HH:mm"),f=i=>({ferias:"FERIAS",rd:"RUTA DIGITAL",ugse:"UGSE",uger:"UGGER",ugo:"UGO"})[i],z=i=>{C.value.page=i,A()},V=()=>{M.value=window.innerHeight-330},B=_e(()=>i=>C.value.page*R.value+i+1),A=async i=>{try{t.value=!0;let e;e=C.value.page==0?"":C.value,e=i?{...e,...i}:e;const{data:w}=await J({url:"event/list",method:"GET",params:e});p.value=w==null?void 0:w.data,m.value=w.total,R.value=w.per_page}catch(e){console.error("Error de red:",e)}finally{t.value=!1}};return fe(()=>{window.removeEventListener("resize",V)}),Q(()=>{window.addEventListener("resize",V),V(),A()}),(i,e)=>{const w=o("a-button"),S=o("router-link"),K=o("a-col"),se=o("a-input"),le=o("a-input-group"),oe=o("a-row"),X=o("a-menu-item"),re=o("a-menu"),ie=o("a-dropdown"),de=o("a-table"),ue=o("a-tag"),me=o("a-pagination"),Z=o("a-drawer");return r(),c(O,null,[u("div",null,[e[10]||(e[10]=u("h3",{class:"title-produce"},"EVENTOS PNTE 2025",-1)),a(oe,{style:{margin:"1rem 0"}},{default:l(()=>[a(K,{xs:24,md:12,lg:18},{default:l(()=>[a(w,{type:"primary",onClick:U,class:"box-btn-add"},{default:l(()=>e[5]||(e[5]=[I(" NUEVO EVENTO ")])),_:1}),a(S,{to:"/eventos",target:"_blank",style:{"margin-left":"1rem"}},{default:l(()=>[a(w,{type:"dashed",icon:W(j(ve))},{default:l(()=>e[6]||(e[6]=[I("Ver Calendario")])),_:1},8,["icon"])]),_:1})]),_:1}),a(K,{xs:24,md:12,lg:6},{default:l(()=>[a(le,{compact:""},{default:l(()=>[a(se,{value:d.search,"onUpdate:value":e[0]||(e[0]=y=>d.search=y),style:{width:"calc(100% - 80px)"},onInput:n},null,8,["value"]),a(w,{type:"primary",disabled:d.search==="",onClick:N},{default:l(()=>e[7]||(e[7]=[I("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(de,{bordered:"",scroll:{x:q.value,y:M.value},class:"table-events-google",columns:b,"data-source":p.value,pagination:!1,loading:t.value,size:"small"},{bodyCell:l(({column:y,record:h,index:ce})=>[y.dataIndex=="idx"?(r(),c(O,{key:0},[I(k(B.value(ce)),1)],64)):x("",!0),y.dataIndex=="date"?(r(),c(O,{key:1},[h.dateStart!=h.dateEnd?(r(),c("span",Se,[e[8]||(e[8]=u("b",null,"Desde:",-1)),I(" "+k(s(h.dateStart))+" ",1),e[9]||(e[9]=u("b",null,"Hasta:",-1)),I(" "+k(s(h.dateEnd)),1)])):(r(),c("span",ke,k(s(h.dateStart)),1))],64)):x("",!0),y.dataIndex=="office"?(r(),c(O,{key:2},[I(k(f(h.office)),1)],64)):x("",!0),y.dataIndex=="hours"?(r(),c(O,{key:3},[h.allDay==1?(r(),c("span",De,"Todo el día")):(r(),c("span",Ie,k(v(h.start))+" - "+k(v(h.end)),1))],64)):x("",!0),y.dataIndex=="results"?(r(),c("div",{key:4,class:"html-format",innerHTML:h.resultado},null,8,Te)):x("",!0),y.dataIndex=="actions"?(r(),P(ie,{key:5,trigger:["click"]},{overlay:l(()=>[a(re,null,{default:l(()=>[a(X,null,{default:l(()=>[u("a",{onClick:pe=>L(h)},"Resultados",8,Ue)]),_:2},1024),a(X,null,{default:l(()=>[u("a",{onClick:pe=>Y(h)},"Editar",8,Oe)]),_:2},1024)]),_:2},1024)]),default:l(()=>[u("a",{class:"ant-dropdown-link",onClick:e[1]||(e[1]=ge(()=>{},["prevent"]))},[a(w,{shape:"circle",icon:W(j(ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):x("",!0)]),_:1},8,["scroll","data-source","loading"])]),u("div",Ce,[u("span",null,[a(ue,{color:"blue"},{default:l(()=>[u("b",null,k(m.value),1)]),_:1}),e[11]||(e[11]=I("Eventos creados"))]),a(me,{size:"small",total:m.value,pageSize:R.value,onChange:z,showSizeChanger:!1},null,8,["total","pageSize"])]),a(Z,{open:T.value,"onUpdate:open":e[2]||(e[2]=y=>T.value=y),title:D.value?"EDITAR EVENTO":"NUEVO EVENTO",placement:"right",width:"450"},{default:l(()=>[a(Ee,{onCloseDraw:H,dataRow:D.value},null,8,["dataRow"])]),_:1},8,["open","title"]),a(Z,{open:g.value,"onUpdate:open":e[4]||(e[4]=y=>g.value=y),title:"RESULTADOS",placement:"right",width:"550"},{default:l(()=>[a(Re,{dataRow:D.value,onCloseDraw:e[3]||(e[3]=y=>{g.value=!1,A()})},null,8,["dataRow"])]),_:1},8,["open"])],64)}}};export{Pe as default};
