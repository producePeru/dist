import{_ as $}from"./TableComponent-1cf70542.js";import{l as v,r as l,a as P,j as U,T as G,a5 as h,o as S,x as k,h as z,L as V,d as B,c as p,f as F,K as x,b as L,w as _,e as M,a0 as j,q as J,m as K}from"./index-3c161ff3.js";import{d as Q}from"./downloadExcel-a3d38cbb.js";import{_ as Z}from"./FormComponent-fda8be4b.js";import{u as W}from"./selectes-c920f157.js";import"./es-f05a21c9.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-4bbfa680.js";const X={key:1,class:"f-20"},ee={__name:"RutaTalleresNuevo",props:["info"],emits:["closeDraw"],setup(Y,{emit:w}){v.locale("es");const s=l({workshopName:{type:"iText",label:"NOMBRE DEL TALLER",name:"workshopName",required:!0,message:"Seleccionar el sector económico",disabled:!1},date:{type:"iDate",label:"FECHA DEL TALLER",name:"date",required:!0,message:"Seleccionar una fecha",disabled:!1,disabledDate:e=>{const o=v().startOf("day");return e&&v(e).isBefore(o)}},hour:{type:"iText",label:"NOMBRE DEL TALLER",name:"hour",required:!0,message:"Seleccionar el sector económico",disabled:!1},component_id:{type:"iSelect",label:"COMPONENTE",name:"component_id",required:!0,message:"Seleccionar un componente",disabled:!1},theme_id:{type:"iSelect",label:"TEMA DEL COMPONENTE",name:"theme_id",required:!0,message:"Seleccionar un tema del componente",disabled:!0},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCIÓN",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},ruc:{type:"iNumber",label:"RUC",name:"ruc",message:"Escribir número de RUC",disabled:!1,maxlength:11,rules:[{validator:(e,o)=>{if(!o)return Promise.resolve();const r=o.toString();return r.length!==11?Promise.reject(new Error("El número debe tener exactamente 11 dígitos")):["10","15","20"].includes(r.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 10, 15 o 20"))},trigger:"change"}]},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},observations:{type:"iText",label:"NRO DE RESERVA / OBSERVACIONES",name:"observations",required:!1,message:"Seleccionar tipo de documento",disabled:!1}}),E=JSON.parse(localStorage.getItem("profile")),g=w,d=Y,c=l(!1),f=l("ACTUALIZAR"),a=P({}),u=l(!1),t=W(),I=l(null),n=l({city_id:[],province_id:[],district_id:[],modality_id:[],comercialactivity_id:[],isbic:[],typecapital_id:[],component_id:[],theme_id:[]}),b=e=>{console.log("handleInputEvent",e)},C=async e=>{e=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),s.value.dateTramite.disabled=!1)},T=async e=>{e=="city_id"&&(await t.fetchProvinces(a.city_id),n.value.province_id=t.provinces,s.value.province_id.disabled=!1),e=="province_id"&&(await t.fetchDistricts(a.province_id),n.value.district_id=t.districts,s.value.district_id.disabled=!1),e=="component_id"&&(await t.fetchComponentThemes(a.component_id),n.value.theme_id=t.componentThemes,a.theme_id=null,s.value.theme_id.disabled=!1)},D=async e=>{console.log("handleFocusSelect",e),e=="city_id"&&(await t.fetchCities(),a.city_id=null,a.province_id=null,a.district_id=null,n.value.province_id=[],n.value.city_id=t.cities),e=="province_id"&&(a.province_id=null,a.district_id=null,n.value.district_id=[]),e=="modality_id"&&(await t.fetchModalities(),n.value.modality_id=t.modalities),e=="regime_id"&&(await t.fetchRegimes(),n.value.regime_id=t.regimes),e=="economicsector_id"&&(await t.fetchEconomicSectors(),n.value.economicsector_id=t.economicSectors),e=="comercialactivity_id"&&(await t.fetchComercialActivities(),n.value.comercialactivity_id=t.comercialActivities),e=="notary_id"&&O(),e=="isbic"&&A(),e=="typecapital_id"&&(await t.fetchTypeCapital(),n.value.typecapital_id=t.typeCapital),e=="component_id"&&(await t.fetchComponents(),n.value.component_id=t.components)},N=e=>{},A=()=>{n.value.isbic=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}]},O=async()=>{try{const{data:e}=await F({url:"public/notaries-filters",method:"GET"}),o=e.map(r=>({value:r.id,name:r.name,city:r.city.name,province:r.province.name,district:r.district.name,address:r.address}));n.value.notary_id=o}catch(e){console.error("Error de red:",e)}},m=async()=>{u.value=!0;const e={economicsector_id:a.economicsector_id,comercialactivity_id:a.comercialactivity_id,component_id:a.component_id,theme_id:a.theme_id,modality_id:a.modality_id,ruc:a.ruc,city_id:a.city_id,province_id:a.province_id,district_id:a.district_id,observations:a.observations,updated_by:E.user_id};try{(await x({url:`advisory/update/${d.info.id}`,method:"PUT",data:e})).status===200&&(R(),g("closeDraw",!0))}catch(o){console.error("Error:",o);const r=document.getElementsByClassName("ant-drawer-body")[0];r&&(r.scrollTop=0)}finally{u.value=!1}},R=()=>{a.economicsector_id=null,a.comercialactivity_id=null,a.component_id=null,a.theme_id=null,a.modality_id=null,a.ruc=null,a.city_id=null,a.province_id=null,a.district_id=null,a.observations=null},i=async e=>{console.log("set info",e),c.value=!0;try{}catch(o){console.error("Error al cargar la información:",o)}finally{c.value=!1}};return U(()=>{d.info&&i(d.info)}),G(()=>d.info,e=>{e&&i(e)}),h("formState",a),h("loadingState",u),(e,o)=>c.value?(S(),k(z(V),{key:0,style:{color:"#00a6db"}})):(S(),B("div",X,[p(Z,{fields:s.value,options:n.value,btnSaveName:f.value,onHandleInputEvent:b,resetSelect:I.value,onHandleChangeSelect:T,onHandleFocusSelect:D,onHandleBlurSelect:N,onHandleChangeClock:C,onOnSubmit:m},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const te={class:"advisory-table"},ae=["onClick"],ue={__name:"RutaTalleres",setup(Y){const w=JSON.parse(localStorage.getItem("role"))||[],s=l([]),E=l(0),g=l(150),d=l(!1),c=l(!1),f=l("Asesorías"),a=l(!1),u=l(null),t=P({year:v("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1}),I=l([]),n=l([{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:80},{title:"FECHA",fixed:"left",dataIndex:"date",width:100,align:"center"},{title:"ASESOR",dataIndex:"asesor",width:200},{title:"SOLICITANTE APELLIDO PATERNO",dataIndex:"emp_lastname",width:150},{title:"SOLICITANTE APELLIDO MATERNO",dataIndex:"emp_middlename",width:150},{title:"SOLICITANTE NONBRE",dataIndex:"emp_name",width:150},{title:"TIPO DOCUMENTO",dataIndex:"emp_document_type",width:100,align:"center"},{title:"NÚMERO DE DOCUMENTO",dataIndex:"emp_document_number",align:"center",width:140},{title:"PAÍS",dataIndex:"emp_country",align:"center",width:120},{title:"FEC. NAC",dataIndex:"emp_birth",align:"center",width:120},{title:"EDAD",dataIndex:"emp_age",align:"center",width:80},{title:"GÉNERO",dataIndex:"emp_gender",width:80,align:"center"},{title:"DISCAPACIDAD",dataIndex:"emp_discapabilities",width:120,align:"center"},{title:"HIJOS",dataIndex:"emp_soons",width:80,align:"center"},{title:"CELULAR",dataIndex:"emp_phone",width:120,align:"center"},{title:"EMAIL",dataIndex:"emp_email",width:200},{title:"CIUDAD",dataIndex:"city",width:120,align:"center"},{title:"PROVINCIA",dataIndex:"province",width:140,align:"center"},{title:"DISTRITO",dataIndex:"district",width:140,align:"center"},{title:"RUC",dataIndex:"ruc",width:120,align:"center"}]),b=()=>{u.value=null,a.value=!0},C=async i=>{try{let e=null;f.value=="Asesorias"&&(e=`advisory/delete/${i.id}`),f.value=="Formalizaciones RUC 10"&&(e=`formalization/delete-ruc-10/${i.id}`),f.value=="Formalizaciones RUC 20"&&(e=`formalization/delete-ruc-20/${i.id}`);const o=await x({url:e,method:"DELETE"});m(),K.success(o.message)}catch(e){console.error("Error de red:",e)}},T=async()=>{c.value=!0;try{const i={};t.year&&(i.year=v(t.year).format("YYYY")),t.range&&(i.dateStart=t.range[0].format("YYYY/MM/DD"),i.dateEnd=t.range[1].format("YYYY/MM/DD")),t.asesor&&(i.asesor=t.asesor),t.name&&(i.name=t.name);let e=null,o=null;t.type==1&&(e="download/asesories",o="Asesorías"),t.type==2&&(e="download/formalizations-ruc10",o="Formalizaciones 10"),t.type==3&&(e="download/formalizations-ruc20",o="Formalizaciones 20"),await Q(e,o,i)}catch(i){console.error("Error de red:",i)}finally{c.value=!1}},D=async i=>{t.page=i,await m()},N=async i=>{i&&(t.page=1,await m())},A=i=>{u.value=i,t.type==1&&(a.value=!0),t.type==2&&(open2.value=!0),t.type==3&&(open3.value=!0)},O=i=>w.some(e=>i.includes(e.id)),m=async()=>{d.value=!0;try{const i={page:t.page};t.year&&(i.year=v(t.year).format("YYYY")),t.range&&(i.dateStart=t.range[0].format("YYYY/MM/DD"),i.dateEnd=t.range[1].format("YYYY/MM/DD")),t.asesor&&(i.asesor=t.asesor),t.name&&(i.name=t.name);let e=null;t.type==1&&(e="historial/advisories/filters"),t.type==2&&(e="historial/formalizations-10/filters"),t.type==3&&(e="historial/formalizations-20/filters");const o=await x({url:e,method:"GET",params:i});s.value=o.data.data,E.value=o.data.total,g.value=o.data.per_page}catch(i){console.error("Error de red:",i)}finally{d.value=!1}},R=async()=>{try{const i=await F({url:"select/asesores-report",method:"GET"});i.status==200&&(I.value=i.data)}catch{console.log("Failed to delete")}};return U(async()=>{await m(),await R()}),h("search",t),h("loading",d),h("loadingFile",c),(i,e)=>{const o=L("a-menu-item"),r=L("a-popconfirm"),q=L("a-drawer");return S(),B("div",te,[p($,{title:"TALLERES DE RUTA DIGITAL",new:!0,textNuevo:"NUEVO TALLER",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:n.value,titleSearch:"NOMBRE TALLER",pageSize:g.value,nameTotal:f.value,dataSource:s.value,total:E.value,onHandleNew:b,onHandleDownloadExcel:T,onHandleSearch:N,onHandlePaginator:D},{"custom-options":_(({record:y})=>[p(o,null,{default:_(()=>[M("a",{onClick:H=>A(y)},"Editar",8,ae)]),_:2},1024),O([1,5])?(S(),k(o,{key:0},{default:_(()=>[p(r,{title:"¿Eliminar?",onConfirm:H=>C(y),class:"prod-alert",placement:"topRight"},{icon:_(()=>[p(z(j),{style:{color:"red"}})]),default:_(()=>[e[2]||(e[2]=M("a",null,"Eliminar",-1))]),_:2},1032,["onConfirm"])]),_:2},1024)):J("",!0)]),_:1},8,["columns","pageSize","nameTotal","dataSource","total"]),p(q,{width:"500",title:"DETALLES DEL TALLER",open:a.value,"onUpdate:open":e[1]||(e[1]=y=>a.value=y),placement:"right"},{default:_(()=>[p(ee,{info:u.value,onCloseDraw:e[0]||(e[0]=y=>(a.value=!1,m()))},null,8,["info"])]),_:1},8,["open"])])}}};export{ue as default};
