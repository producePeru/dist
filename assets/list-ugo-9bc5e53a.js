import{_ as V}from"./TableComponent-e5bca209.js";import{p as C,r,a as H,k as q,T as B,W as b,o as k,d as M,c as i,m as L,h as R,b as Y,w as u,t as j,z,e as A,i as Q,a2 as W}from"./index-84c073bc.js";import{_ as J}from"./FormComponent-a2f7c62f.js";import{u as K}from"./selectes-25eb6dd3.js";import"./es-985b2996.js";import{_ as X,a as Z}from"./AsignarVistas-4c6f86ee.js";import"./downloadExcel-eceed9d3.js";import{g as ee}from"./usePermissions-e30a77a7.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-7e0a4342.js";import"./quill.snow-3304a402.js";const ae={class:"usuarios-pnte"},te={__name:"UsuariosUgo",props:["info"],emits:["closeDraw"],setup(G,{emit:I}){C.locale("es");const w=r({dni:{type:"iInputSearch",label:"DNI",name:"dni",required:!0,message:"Ingrese el DNI",disabled:!1,max:8,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("Escribe número de documento"));const o=String(c).trim();return/^\d{8}$/.test(o)?Promise.resolve():Promise.reject(new Error("DNI incorrecto."))},trigger:["change","blur"]}]},name:{type:"iText",label:"NOMBRE",name:"name",required:!0,message:"Ingrese el nombre",disabled:!1},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Ingrese el apellido paterno",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Ingrese el apellido materno",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("El número es requerido"));const o=c.toString();return o.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):o.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!1,message:"Seleccione la fecha de nacimiento",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccione el género",disabled:!1},cde_id:{type:"iSelect",label:"CDE",name:"cde_id",required:!0,message:"Seleccione la CDE",disabled:!1}}),D=I,m=G,v=r("GUARDAR"),e=H({office_id:1}),p=r(!1),l=K(),g=r(null),d=r({gender_id:[],office_id:[],cde_id:[]}),f=a=>{console.log("handleInputEvent",a)},T=async a=>{a=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),w.value.dateTramite.disabled=!1)},y=async a=>{console.log("handleChangeSelect",a)},U=async a=>{a=="gender_id"&&(await l.fetchGenders(),d.value.gender_id=l.genders),a=="office_id"&&(await l.fetchOffices(),d.value.office_id=l.Offices),a=="cde_id"&&(await l.fetchCdes(),d.value.cde_id=l.cdes)},P=async()=>{var c;p.value=!0;const a={dni:e.dni,name:e.name,lastname:e.lastname,middlename:e.middlename,phone:(c=e.phone)==null?void 0:c.toString().trim(),birthday:C(e.birthday).format("YYYY-MM-DD"),gender_id:e.gender_id,office_id:e.office_id,cde_id:e.cde_id,rol:2};try{let o,_=null;m.info?(o=`users/update-user-pnte/${m.info.id}`,_="PUT"):(o="users/register-user-pnte",_="POST");const x=await L({url:o,method:_,data:a});x.status===200&&(R.success(x.message),O(),D("closeDraw",!0))}catch(o){o.response&&o.response.data&&o.response.data.message?R.error(o.response.data.message):R.error("Ocurrió un error inesperado.");const _=document.getElementsByClassName("ant-drawer-body")[0];_&&(_.scrollTop=0)}finally{p.value=!1}},O=()=>{e.dni=null,e.name=null,e.lastname=null,e.middlename=null,e.phone=null,e.birthday=null,e.gender_id=null,e.office_id=null,e.cde_id=null},N=async a=>{a&&(e.dni=a.dni,e.name=a.name,e.lastname=a.lastname,e.middlename=a.middlename,await l.fetchCdes(),d.value.cde_id=l.cdes,e.cde_id=a.cde_id,await l.fetchOffices(),d.value.office_id=l.Offices,e.office_id=a.office_id,await l.fetchGenders(),d.value.gender_id=l.genders,e.gender_id=a.gender_id,e.phone=a.phone,a.birthday&&(e.birthday=C(a.birthday,"YYYY-MM-DD")))};return q(()=>{m.info&&N(m.info)}),B(()=>m.info,a=>{a?N(a):O()}),b("formState",e),b("loadingState",p),(a,c)=>(k(),M("div",ae,[i(J,{fields:w.value,options:d.value,btnSaveName:v.value,onHandleInputEvent:f,resetSelect:g.value,onHandleChangeSelect:y,onHandleFocusSelect:U,onHandleChangeClock:T,onOnSubmit:P,mayus:!0},null,8,["fields","options","btnSaveName","resetSelect"])]))}},ne={class:"layout-content"},le={key:0},se=["onClick"],oe=["onClick"],re=["onClick"],Ee={__name:"list-ugo",setup(G){const I=r([]),w=r(0),D=r(150),m=r(!1),v=r(!1),e=r({}),p=r(!1),l=r(!1),g=r(null),d=r(!1),f=H({year:C("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),T=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"dni",fixed:"left",width:100,align:"center"},{title:"NOMBRES",dataIndex:"name",width:160},{title:"APELLIDOS",dataIndex:"fullname",width:160},{title:"CORREO PNTE",dataIndex:"email",width:240},{title:"CELULAR",dataIndex:"phone",width:100,align:"center"},{title:"FECHA NACIMIENTO",dataIndex:"birthday",width:100,align:"center"},{title:"OFICINA",dataIndex:"office_name",width:120,align:"center"},{title:"CDE",dataIndex:"cde_name",width:140},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],y=(t,n)=>{g.value=t,n.value=!0},U=t=>y(t,p),P=t=>y(t,v),O=t=>y(t,m),N=()=>{g.value=null,p.value=!0},a=()=>{E(),p.value=!1},c=async t=>{try{const n=await L({url:`users/delete-user-pnte/${t.id}`,method:"DELETE"});n.status==200&&(E(),R.success(n.message))}catch(n){console.error("Error de red:",n)}},o=async()=>{d.value=!0;try{}catch(t){console.error("Error de red:",t)}finally{d.value=!1}},_=async t=>{f.page=t,await E()},x=async t=>{t&&(f.page=1,await E())},E=async()=>{try{l.value=!0;const t={page:f.page};f.year&&(t.year=C(f.year).format("YYYY")),f.name&&(t.name=f.name);const h=await L({url:"users/ugo",method:"GET",params:t});I.value=h.data.data,w.value=h.data.total,D.value=h.data.per_page}catch(t){console.error("Error de red:",t)}finally{l.value=!1}};return q(async()=>{e.value=await ee("usuarios-lista-ugo"),await E()}),b("search",f),b("loading",l),b("loadingFile",d),(t,n)=>{const h=Y("a-menu-item"),F=Y("a-popconfirm"),$=Y("a-drawer");return k(),M("div",ne,[i(V,{title:"USUARIOS UGO",nameTotal:"Usuarios UGO",titleSearch:"FILTRAR POR NÚMERO DE DNI",placeholderSearch:"Buscar",textNuevo:"NUEVO REGISTRO",new:!0,columns:T,pageSize:D.value,dataSource:I.value,total:w.value,btnUpdate:!0,permisos:e.value,onHandleNew:N,onHandleDownloadExcel:o,onHandleSearch:x,onHandleCallFetchData:E,onHandlePaginator:_},{"data-cell":u(({column:s,record:S})=>[s.dataIndex=="type_activity"?(k(),M("span",le,j(S.pnte),1)):z("",!0)]),"custom-options":u(({record:s})=>[i(h,null,{default:u(()=>[A("a",{onClick:S=>U(s)},"Editar",8,se)]),_:2},1024),i(h,null,{default:u(()=>[A("a",{onClick:S=>P(s)},"Cambiar de contraseña",8,oe)]),_:2},1024),i(h,null,{default:u(()=>[A("a",{onClick:S=>O(s)},"Vistas",8,re)]),_:2},1024),i(h,null,{default:u(()=>[i(F,{placement:"rightBottom",title:`¿Quieres eliminar a ${s.name} ${s.lastname} ?`,onConfirm:S=>c(s)},{icon:u(()=>[i(Q(W),{style:{color:"red"}})]),default:u(()=>[n[5]||(n[5]=A("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total","permisos"]),i($,{open:p.value,"onUpdate:open":n[0]||(n[0]=s=>p.value=s),title:g.value?"EDITAR DATOS PNTE":"NUEVO USUARIO UGO",placement:"right",width:"550"},{default:u(()=>[i(te,{onCloseDraw:a,info:g.value},null,8,["info"])]),_:1},8,["open","title"]),i($,{open:v.value,"onUpdate:open":n[2]||(n[2]=s=>v.value=s),title:"CAMBIAR CONTRASEÑA",placement:"right",width:"450"},{default:u(()=>[i(X,{onCloseDraw:n[1]||(n[1]=s=>v.value=!1),info:g.value},null,8,["info"])]),_:1},8,["open"]),i($,{open:m.value,"onUpdate:open":n[4]||(n[4]=s=>m.value=s),title:"ASIGNAR VISTAS",placement:"right",width:"1300"},{default:u(()=>[i(Z,{onCloseDraw:n[3]||(n[3]=s=>m.value=!1),info:g.value,typeOffice:"UGO"},null,8,["info"])]),_:1},8,["open"])])}}};export{Ee as default};
