import{r as u,a as B,l as O,b as l,o as r,d as c,c as n,w as o,e as h,F as k,v as X,y as A,q as b,i as S,m as G,K as j,j as Z,T as ce,h as $,G as pe,X as _e,p as K,z as fe,t as M,J as ve}from"./index-ea11d354.js";import{u as W}from"./selectes-c2dea557.js";import{Q as ge}from"./quill.snow-8adf6866.js";import"./es-3eeaf2f8.js";import{M as ye}from"./MoreOutlined-527c1c6c.js";const be={class:"grid-events"},he={style:{display:"flex",margin:"1rem 0 .5rem"}},we={key:3,class:"grid-events-hour"},xe={__name:"DrawEventosCalendario",props:["type"],emits:["closeDraw"],setup(H,{emit:q}){const p=W();p.$patch({officesPnte:p.officesPnte}),p.fetchOfficesPnte();const E=u(!1),w=u([{dates:new Date}]),_=u({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:150},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),t=B({allDay:1}),I=u([{start:null,end:O().subtract(0,"day").format("YYYY-MM-DD")}]),D=i=>i==="id_pnte"?p.officesPnte:[],z=i=>{const s={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!0,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!0,message:"",disabled:!1,max:10}};if(i==2){const m=Object.entries(_.value),v=m.findIndex(([T])=>T==="title"),x=[...m.slice(0,v+1),...Object.entries(s),...m.slice(v+1)];_.value=Object.fromEntries(x)}else{const m={..._.value};delete m.organiza,delete m.numMypes,_.value=m}},U=(i,s)=>{const m=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(m)},f=async()=>{if(!t.date)return G.error("Debes de seleccionar una fecha");const i={id_pnte:t.id_pnte,title:t.title,...t.organiza&&{organiza:t.organiza},...t.numMypes&&{numMypes:t.numMypes},date:O(t.date).format("YYYY-MM-DD"),start:O(t.hours[0]).format("HH:mm"),end:O(t.hours[1]).format("HH:mm"),description:t.description,nameUser:t.nameUser,link:t.link};E.value=!0;try{const s=await j({url:"event/create",method:"POST",data:i});s.status===200&&(G.success(s.message),t.title="")}catch(s){console.error("Failed to update record",s)}finally{E.value=!1}};return(i,s)=>{const m=l("a-select"),v=l("a-form-item"),x=l("a-input"),T=l("VDatePicker"),P=l("a-time-range-picker"),V=l("a-textarea"),F=l("a-button"),L=l("a-form");return r(),c("div",null,[n(L,{class:"form-events",layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:f},{default:o(()=>[h("div",be,[(r(!0),c(k,null,X(_.value,(e,Y)=>(r(),c(k,{key:Y},[e.type==="iSelect"?(r(),A(v,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(m,{value:t[e.name],"onUpdate:value":g=>t[e.name]=g,options:D(e.name),"show-search":"","filter-option":U,onChange:z},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):b("",!0),e.type==="iText"?(r(),A(v,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(x,{value:t[e.name],"onUpdate:value":g=>t[e.name]=g,maxlength:e.max,disabled:e.disabled,placeholder:e.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):b("",!0),e.type==="iDate"?(r(),A(v,{key:2,name:e.name,label:e.label},{default:o(()=>[n(T,{modelValue:t[e.name],"onUpdate:modelValue":g=>t[e.name]=g,mode:"date",attributes:w.value,"disabled-dates":I.value},null,8,["modelValue","onUpdate:modelValue","attributes","disabled-dates"]),h("div",he,[h("div",null,[s[1]||(s[1]=h("label",{style:{display:"block"},for:""},"HORARIO",-1)),n(P,{"use12-hours":"",value:t.hours,"onUpdate:value":s[0]||(s[0]=g=>t.hours=g),format:"h:mm a"},null,8,["value"])])])]),_:2},1032,["name","label"])):b("",!0),e.type==="iSwitch"?(r(),c("div",we)):b("",!0),e.type==="iTextArea"?(r(),A(v,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(V,{value:t[e.name],"onUpdate:value":g=>t[e.name]=g,rows:6,maxlength:e.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):b("",!0)],64))),128))]),n(v,null,{default:o(()=>[n(F,{type:"primary","html-type":"submit",loading:E.value,style:{"margin-top":"1rem"}},{default:o(()=>s[2]||(s[2]=[S("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Ee={class:"grid-event-resultado"},Re={__name:"DrawResultados",props:["dataRow"],emits:["closeDraw"],setup(H,{emit:q}){const p=W();p.$patch({officesPnte:p.officesPnte}),p.fetchOfficesPnte();const E=q,w=H,_=u(!1),t={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},I=u({resultados:{type:"iTextArea",label:"DESCRIBIR RESULTADOS",name:"resultados",required:!1,message:"Escribe los resultados de los evento",max:500}}),D=B({resultado:null}),z=async()=>{const f={resultado:D.resultado};_.value=!0;try{const i=await j({url:`event/update/${w.dataRow.id}`,method:"PUT",data:f});i.status===200&&(G.success(i.message),E("closeDraw"))}catch(i){console.error("Failed to update record",i)}finally{_.value=!1}},U=f=>{console.log("Setting info",f),D.resultado=f.resultado};return Z(()=>{w.dataRow&&U(w.dataRow)}),ce(()=>w.dataRow,f=>{f&&U(f)}),(f,i)=>{const s=l("a-form-item"),m=l("a-button"),v=l("a-form");return r(),c("div",null,[n(v,{class:"form-events",layout:"vertical",model:D,name:"basic",autocomplete:"off",onFinish:z},{default:o(()=>[h("div",Ee,[(r(!0),c(k,null,X(I.value,(x,T)=>(r(),c(k,{key:T},[x.type==="iTextArea"?(r(),A(s,{key:0,name:x.name,label:x.label,rules:[{required:x.required,message:x.message}]},{default:o(()=>[n($(ge),{class:"quill-editor",content:D.resultado,"onUpdate:content":i[0]||(i[0]=P=>D.resultado=P),options:t,contentType:"html"},null,8,["content"])]),_:2},1032,["name","label","rules"])):b("",!0)],64))),128))]),n(s,null,{default:o(()=>[n(m,{type:"primary","html-type":"submit",loading:_.value,style:{"margin-top":"1rem"}},{default:o(()=>i[1]||(i[1]=[S("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const De={key:0},Se={key:1},ke=["innerHTML"],Ie=["onClick"],Ue={class:"paginator"},Me={__name:"EventosCalendario",setup(H){O.locale("es");const q=JSON.parse(localStorage.getItem("role"))||[],p=u(!1),E=u(!1),w=u(null),_=u(0),t=u(50),I=u({page:0}),D=u(1200),z=u([]),U=u(!1),f=u(window.innerHeight-100),i=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"ÁREA",fixed:"left",dataIndex:"office",width:100},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"results",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],s=B({search:""}),m=d=>q.some(a=>d.includes(a.id)),v=()=>{N(),p.value=!1},x=d=>{w.value=d,E.value=!0},T=()=>{p.value=!0},P=()=>{let d={search:s.search};N(d)},V=()=>{s.search||N()},F=d=>O(d).format("DD/MM/YYYY"),L=d=>O(d,"HH:mm:ss").format("HH:mm"),e=d=>({ferias:"FERIAS",rd:"RUTA DIGITAL",ugse:"UGSE",uger:"UGGER",ugo:"UGO"})[d],Y=d=>{I.value.page=d,N()},g=()=>{f.value=window.innerHeight-330},ee=pe(()=>d=>I.value.page*t.value+d+1),N=async d=>{try{U.value=!0;let a;a=I.value.page==0?"":I.value,a=d?{...a,...d}:a;const{data:R}=await j({url:"event/list",method:"GET",params:a});z.value=R==null?void 0:R.data,_.value=R.total,t.value=R.per_page}catch(a){console.error("Error de red:",a)}finally{U.value=!1}};return _e(()=>{window.removeEventListener("resize",g)}),Z(()=>{window.addEventListener("resize",g),g(),N()}),(d,a)=>{const R=l("a-button"),te=l("router-link"),Q=l("a-col"),ae=l("a-input"),ne=l("a-input-group"),oe=l("a-row"),se=l("a-menu-item"),le=l("a-menu"),re=l("a-dropdown"),ie=l("a-table"),de=l("a-tag"),ue=l("a-pagination"),J=l("a-drawer");return r(),c(k,null,[h("div",null,[a[8]||(a[8]=h("h3",{class:"title-produce"},"EVENTOS PNTE 2025",-1)),n(oe,{style:{margin:"1rem 0"}},{default:o(()=>[n(Q,{xs:24,md:12,lg:18},{default:o(()=>[n(R,{type:"primary",onClick:T,class:"box-btn-add"},{default:o(()=>a[5]||(a[5]=[S(" NUEVO EVENTO ")])),_:1}),n(te,{to:"/calendario/eventos",target:"_blank",style:{"margin-left":"1rem"}},{default:o(()=>[n(R,{type:"dashed",icon:K($(fe))},{default:o(()=>a[6]||(a[6]=[S("Ver Calendario")])),_:1},8,["icon"])]),_:1})]),_:1}),n(Q,{xs:24,md:12,lg:6},{default:o(()=>[n(ne,{compact:""},{default:o(()=>[n(ae,{value:s.search,"onUpdate:value":a[0]||(a[0]=y=>s.search=y),style:{width:"calc(100% - 80px)"},onInput:V},null,8,["value"]),n(R,{type:"primary",disabled:s.search==="",onClick:P},{default:o(()=>a[7]||(a[7]=[S("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(ie,{bordered:"",scroll:{x:D.value,y:f.value},class:"table-events-google",columns:i,"data-source":z.value,pagination:!1,loading:U.value,size:"small"},{bodyCell:o(({column:y,record:C,index:me})=>[y.dataIndex=="idx"?(r(),c(k,{key:0},[S(M(ee.value(me)),1)],64)):b("",!0),y.dataIndex=="date"?(r(),c(k,{key:1},[S(M(F(C.date)),1)],64)):b("",!0),y.dataIndex=="office"?(r(),c(k,{key:2},[S(M(e(C.office)),1)],64)):b("",!0),y.dataIndex=="hours"?(r(),c(k,{key:3},[C.allDay==1?(r(),c("span",De,"Todo el día")):(r(),c("span",Se,M(L(C.start))+" - "+M(L(C.end)),1))],64)):b("",!0),y.dataIndex=="results"?(r(),c("div",{key:4,innerHTML:C.resultado},null,8,ke)):b("",!0),y.dataIndex=="actions"?(r(),A(re,{key:5,trigger:["click"]},{overlay:o(()=>[n(le,null,{default:o(()=>[m([5,10,11])?(r(),A(se,{key:0},{default:o(()=>[h("a",{onClick:Te=>x(C)},"Resultados",8,Ie)]),_:2},1024)):b("",!0)]),_:2},1024)]),default:o(()=>[h("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=ve(()=>{},["prevent"]))},[n(R,{shape:"circle",icon:K($(ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):b("",!0)]),_:1},8,["scroll","data-source","loading"])]),h("div",Ue,[h("span",null,[n(de,{color:"blue"},{default:o(()=>[h("b",null,M(_.value),1)]),_:1}),a[9]||(a[9]=S("Eventos creados"))]),n(ue,{size:"small",total:_.value,pageSize:t.value,onChange:Y,showSizeChanger:!1},null,8,["total","pageSize"])]),n(J,{open:p.value,"onUpdate:open":a[2]||(a[2]=y=>p.value=y),title:w.value?"Editar Evento":"NUEVO EVENTO",placement:"right",width:"450"},{default:o(()=>[n(xe,{onCloseDraw:v,dataRow:w.value,type:"events"},null,8,["dataRow"])]),_:1},8,["open","title"]),n(J,{open:E.value,"onUpdate:open":a[4]||(a[4]=y=>E.value=y),title:"RESULTADOS",placement:"right",width:"550"},{default:o(()=>[n(Re,{dataRow:w.value,onCloseDraw:a[3]||(a[3]=y=>{E.value=!1,N()})},null,8,["dataRow"])]),_:1},8,["open"])],64)}}};export{Me as default};
