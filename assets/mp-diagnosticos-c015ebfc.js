import{_ as j}from"./TableComponent-8dbb725f.js";import{p as A,r as o,k as F,U as J,aa as B,b as x,o as r,y as D,d as h,e as s,F as G,v as W,z as k,t as g,u as X,a as Z,X as T,c as w,w as E,m as U,j as H}from"./index-de9d4c9c.js";import{C as K}from"./auto-ba4ecebb.js";import"./es-05e43534.js";import{u as Q,t as ee}from"./timezone-dfebb835.js";import{d as ae}from"./downloadExcel-7c04975b.js";import"./icoexcel-1b303edf.js";import"./selectes-d8dee7d1.js";import"./SyncOutlined-2baf36ed.js";import"./MoreOutlined-4eb1e390.js";const te={key:1},oe={key:1},ne={class:"chart-wrapper-diagnostic"},se={class:"mp-diagnostic-detail"},le={key:0,class:"hp"},re={key:1,class:"ge"},de={class:"mp-diagnostic-detail"},ie={class:"mp-diagnostic-detail"},ce={class:"mp-diagnostic-detail"},ue={__name:"MPShares",props:["info","statusLoading","valuesChart"],setup(L){A.locale("es"),A.extend(Q),A.extend(ee);const i=L,d=o(null),c=o(null);o([0,0]),o("100px");const m=o([]),S=o(!0);function v(){var e,_;if(!d.value)return;c.value&&c.value.destroy();const n=d.value.getContext("2d");c.value=new K(n,{type:"bar",data:{labels:["HABILIDADES PERSONALES","GESTIÓN EMPRESARIAL"],datasets:[{data:[(e=i.valuesChart)==null?void 0:e.habilidades_personales,(_=i.valuesChart)==null?void 0:_.gestion_empresarial],backgroundColor:["#ff5462","#1890ff"],borderColor:["#ff5462","#1890ff"],borderWidth:1,barThickness:60}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}const I=async n=>{try{if(!n||n.length===0)return;m.value=n,await B(),v()}catch(e){console.error("Error al cargar la información:",e)}},y=()=>{c.value&&(c.value.destroy(),c.value=null),d.value&&d.value.getContext("2d").clearRect(0,0,d.value.width,d.value.height)};return F(async()=>{i.info?I(i.info):S.value=!1}),J(()=>i.info,async n=>{if(!n||n.length===0){m.value=[],y();return}m.value=n,await B(),v()},{immediate:!0}),(n,e)=>{const _=x("a-skeleton"),N=x("a-empty");return i.statusLoading?(r(),D(_,{key:0,active:""})):(r(),h("div",te,[m.value.length==0?(r(),D(N,{key:0})):(r(),h("div",oe,[s("div",ne,[s("canvas",{ref_key:"myChart",ref:d},null,512)]),e[4]||(e[4]=s("h4",{style:{"margin-bottom":".5rem"}},"DETALLES",-1)),(r(!0),h(G,null,W(m.value,(u,b)=>(r(),h("div",{class:"mp-diagnostic-box",key:b},[s("div",se,[e[0]||(e[0]=s("span",null,"Tipo de componente: ",-1)),u.component=="HABILIDADES PERSONALES"?(r(),h("span",le,"HABILIDADES PERSONALES")):k("",!0),u.component=="GESTIÓN EMPRESARIAL"?(r(),h("span",re,"GESTIÓN EMPRESARIAL")):k("",!0)]),s("div",de,[e[1]||(e[1]=s("span",null,"Exponente: ",-1)),s("span",null,g(u.capacitador),1)]),s("div",ie,[e[2]||(e[2]=s("span",null,"Fecha y hora: ",-1)),s("span",null,g(u.date)+" - "+g(u.hourStart)+" "+g(u.hourEnd),1)]),s("div",ce,[e[3]||(e[3]=s("span",null,"Modalidad: ",-1)),s("span",null,g(u.modalidad),1)])]))),128))]))]))}}};const me={class:"layout-content"},pe=["onClick"],Ce={__name:"mp-diagnosticos",setup(L){JSON.parse(localStorage.getItem("role"));const i=o([]),d=o(0),c=o(150),m=o(null),S=o(!0),v=o(!1);o(!1),X();const I=o(!1),y=o(null),n=o(!1),e=Z({name:null,page:1}),_=o([]),N=()=>{y.value=null,open.value=!0},u=async()=>{n.value=!0;try{const t={};e.name&&(t.name=e.name),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),await ae("download/mp-export-participants-excel","diagnosticos",t)}catch(t){console.error("Error de red:",t)}finally{n.value=!1}},b=async t=>{e.page=t,await C()},$=async t=>{t&&(e.page=1,await C())},z=async t=>{v.value=!0,S.value=!0;try{const l=await U({url:`mp/detail-share/${t.participant_id}`,method:"GET"});l.status==200&&(y.value=l.data,m.value=l.totals)}catch(l){console.error("Error de red:",l)}finally{S.value=!1}},C=async()=>{try{I.value=!0;const t={page:e.page};e.year&&(t.year=A(e.year).format("YYYY")),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),e.name&&(t.name=e.name),e.orderby&&(t.orderby=e.orderby);const l=await U({url:"mp/participant-diagnostic",method:"GET",params:t}),p=l,O=[{title:"#",dataIndex:"idx",align:"center",width:80,fixed:"left"},{title:"NOMBRE COMPLETO",dataIndex:"nombre_completo",width:160},{title:"APELLIDOS",dataIndex:"apellidos",width:160},{title:"FECHA NACIMIENTO",dataIndex:"fecha_nacimiento",width:100,align:"center"},{title:"CELULAR",dataIndex:"celular",width:90,align:"center"},{title:"TIPO DOCUMENTO",dataIndex:"tipo_documento",width:100,align:"center"},{title:"DOCUMENTO",dataIndex:"doc_number",width:100,align:"center"},{title:"EMAIL",dataIndex:"email",width:200},{title:"RUC",dataIndex:"ruc",width:100,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"actividad",width:160},{title:"RUBRO",dataIndex:"rubro",width:140},{title:"SECTOR ECONÓMICO",dataIndex:"economicSector",width:100},{title:"FECHA DEL DIAGNÓSTICO",dataIndex:"registrado",width:120,align:"center"},{title:"ASISTENCIA EN CAPACITACIONES",dataIndex:"shares",width:140,align:"center"}],R=l.questions.map(a=>({title:a.label,dataIndex:a.model,width:160}));_.value=[...O,...R,{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}];const f=p.data.map((a,V)=>{const M={idx:V+1,participant_id:a.participant_id,ruc:a.ruc,nombre_completo:a.nombre_completo,apellidos:a.apellidos,fecha_nacimiento:a.fecha_nacimiento,celular:a.celular,tipo_documento:a.tipo_documento,doc_number:a.doc_number,email:a.email,actividad:a.actividad,rubro:a.rubro,economicSector:a.economicSector,registrado:a.registrado,shares:a.shares};return p.questions.forEach(Y=>{const P=a.responses.find(q=>q.question_model===Y.model);M[Y.model]=P?P.answer:null}),M});i.value=f,d.value=p.total,c.value=p.per_page}catch(t){console.error("Error de red:",t)}finally{I.value=!1}};return F(async()=>{await C()}),T("search",e),T("loading",I),T("loadingFile",n),(t,l)=>{const p=x("a-tag"),O=x("a-menu-item"),R=x("a-drawer");return r(),h("div",me,[w(j,{title:"DIAGNÓSTICOS DE EMPRESAS",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",columns:_.value,titleSearch:"BUSCAR DNI - RUC - NOMBRES",pageSize:c.value,downloadExcel:!0,nameTotal:"Registros",dataSource:i.value,total:d.value,btnUpdate:!0,onHandleNew:N,onHandleCallFetchData:C,onHandleDownloadExcel:u,onHandleSearch:$,onHandlePaginator:b},{"data-cell":E(({column:f,record:a})=>[f.dataIndex=="shares"?(r(),h(G,{key:0},[a.shares<1?(r(),D(p,{key:0,color:"pink"},{default:E(()=>[H(g(a.shares),1)]),_:2},1024)):(r(),D(p,{key:1,color:"blue"},{default:E(()=>[H(g(a.shares),1)]),_:2},1024))],64)):k("",!0)]),"custom-options":E(({record:f})=>[w(O,null,{default:E(()=>[s("span",{onClick:a=>z(f)}," Detalle ",8,pe)]),_:2},1024)]),_:1},8,["columns","pageSize","dataSource","total"]),w(R,{open:v.value,"onUpdate:open":l[0]||(l[0]=f=>v.value=f),title:"PARTICIPACIONES",placement:"right",width:"500"},{default:E(()=>[w(ue,{info:y.value,valuesChart:m.value,statusLoading:S.value},null,8,["info","valuesChart","statusLoading"])]),_:1},8,["open"])])}}};export{Ce as default};
