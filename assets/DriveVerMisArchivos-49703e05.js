import{g as t,f as Z,x as ee,l as ae,r as d,o as c,a5 as g,a6 as s,z as te,H as oe,a as n,w as o,L as k,c as C,aa as u,F as z,a8 as p,u as D,I as ne,h as le}from"./quill-blot-formatter-d287386b.js";import{a as se,e as b,D as ie,Q as re,M as de,m as ce,b as ue,o as pe}from"./index-c50fff99.js";import{D as me}from"./DrawDriveUsers.component-c7cabd26.js";import{M as ve}from"./MoreOutlined-0446c62c.js";import"./_plugin-vue_export-helper-c27b6911.js";const _e={class:"w-search"},fe={key:1},ge={key:2,class:"uppercase"},we=["onClick"],he={class:"paginator-drive"},ye=20,Ie={__name:"DriveVerMisArchivos",setup(xe){const E=JSON.parse(localStorage.getItem("role"));JSON.parse(localStorage.getItem("profile"));const R="https://apituempresa.soporte-pnte.com/api/",H="http://127.0.0.1:8000/api/",U=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?H:R,V=se.get("token"),I=t(null),w=t(!1),m=t({}),A=t([]),_=t(!1),h=t(0);t(0);const S=t(null);t(""),t(!1);const B=t([]),$=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:40},{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},...E[0].id===3||E[0].id===1?[{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}]:[]],F=Z(()=>a=>(f.value.page-1)*ye+a+1),L=async a=>{var e;I.value=a.id;try{const l=await b({url:`drive/users-selected/${a.id}`,method:"GET"});l.data[0]&&(S.value=(e=l.data[0])==null?void 0:e.user_ids)}catch(l){console.error("Error de red:",l)}w.value=!0},N=()=>{w.value=!1},T=async a=>{try{const e=await b({url:`drive/delete-file/${a.id}`,method:"DELETE"});e.status==500?de.warning({title:"Aviso",content:e.message}):(x(),ce.success(e.message))}catch(e){console.error("Error de red:",e)}},Y=async a=>{m.value={...m.value,[a]:!0};try{const e=await ue.get(`${U}drive/download/${a}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${V}`}}),l=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.href=l,i.setAttribute("download",a),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(e){console.error("Error al descargar el archivo",e)}finally{m.value={...m.value,[a]:!1}}},G=a=>pe(a).format("DD/MM/YYYY HH:mm A"),O=t(window.innerHeight-100),y=()=>{O.value=window.innerHeight-300};ee(()=>{window.removeEventListener("resize",y)});const f=t({page:1}),j=a=>{f.value.page=a,x()},x=async()=>{try{_.value=!0;let a=f.value.page==1?"":f.value;const{data:e}=await b({url:"drive/list-files",method:"GET",params:a});A.value=e.data,h.value=e.total}catch(a){console.error("Error de red:",a)}finally{_.value=!1}};return ae(()=>{x(),window.addEventListener("resize",y),y()}),(a,e)=>{const l=d("a-button"),i=d("a-menu-item"),J=d("a-popconfirm"),Q=d("a-menu"),q=d("a-dropdown"),P=d("a-table"),K=d("a-tag"),W=d("a-pagination");return c(),g(z,null,[s("div",null,[e[3]||(e[3]=s("h3",null,"MIS ARCHIVOS",-1)),te(s("div",_e,null,512),[[oe,!_.value]]),n(P,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:O.value},columns:$,"data-source":A.value,pagination:!1,loading:_.value,size:"small"},{bodyCell:o(({column:v,record:r,index:X})=>[v.dataIndex=="idx"?(c(),g(z,{key:0},[k(p(F.value(X)),1)],64)):u("",!0),v.dataIndex=="date"?(c(),g("div",fe,p(G(r.created_at)),1)):u("",!0),v.dataIndex=="user"?(c(),g("div",ge,p(r.profile.name)+" "+p(r.profile.lastname)+" "+p(r.profile.middlename),1)):u("",!0),v.dataIndex=="download"?(c(),C(l,{key:3,size:"small",onClick:M=>Y(r.path),type:"primary",ghost:"",loading:m.value[r.path]},{icon:o(()=>[n(D(ie))]),default:o(()=>[e[1]||(e[1]=k(" Descargar "))]),_:2},1032,["onClick","loading"])):u("",!0),v.dataIndex=="actions"?(c(),C(q,{key:4,trigger:["click"]},{overlay:o(()=>[n(Q,null,{default:o(()=>[n(i,null,{default:o(()=>[s("a",{onClick:M=>L(r)},"Visible para",8,we)]),_:2},1024),n(i,null,{default:o(()=>[n(J,{title:"Â¿Seguro de eliminar?",onConfirm:M=>T(r)},{icon:o(()=>[n(D(re),{style:{color:"red"}})]),default:o(()=>[e[2]||(e[2]=s("a",null,"Eliminar",-1))]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[s("a",{class:"ant-dropdown-link",onClick:e[0]||(e[0]=ne(()=>{},["prevent"]))},[n(l,{shape:"circle",icon:le(D(ve))},null,8,["icon"])])]),_:2},1024)):u("",!0)]),_:1},8,["scroll","data-source","loading"])]),s("div",he,[s("span",null,[n(K,{color:"blue"},{default:o(()=>[s("b",null,p(h.value),1)]),_:1}),e[4]||(e[4]=k(" Archivos Subidos"))]),n(W,{size:"small",pageSize:20,total:h.value,onChange:j,showSizeChanger:!1},null,8,["total"])]),w.value?(c(),C(me,{key:0,plainOptions:B.value,idFile:I.value,selectedUsers:S.value,onHandleCloseDrawer:N},null,8,["plainOptions","idFile","selectedUsers"])):u("",!0)],64)}}};export{Ie as default};
