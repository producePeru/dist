import{r as s,a as se,p as C,k as de,X as A,b as d,o as p,d as F,c as r,w as n,m as k,f as ce,s as ue,i as b,z as w,e as m,y as E,a1 as pe,O as me,j as fe,a2 as _e,h as g}from"./index-389451b6.js";import{_ as ve}from"./TableComponent-84f8432e.js";import{_ as ye}from"./EventosUgo-becfc8eb.js";import{d as L}from"./downloadExcel-5a6edee5.js";import{g as we}from"./usePermissions-e007267c.js";import"./es-2b761259.js";import{g as V,a as he}from"./publicInscripcion-ebc9ecb9.js";import{F as Ee}from"./FileExcelOutlined-68900d97.js";import"./icoexcel-1b303edf.js";import"./selectes-8f92e328.js";import"./SyncOutlined-4626500b.js";import"./MoreOutlined-0bbf32d4.js";const ge={class:"layout-content"},Ie={key:0},xe={class:"filter-asesor",style:{width:"280px"}},De=["onClick"],Ce=["onClick"],Ae=["onClick"],Ue={__name:"eventos-index",setup(ke){const T=s([]),Y=s(0),O=s(150),i=s({}),f=s(!1),I=s(!1),h=s(null),u=s(!1),S=s([]),a=se({year:C("2026","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),U=[{title:"",dataIndex:"copy",fixed:"left",width:50},{title:"TIPO DE ACTIVIDAD",dataIndex:"tipo_actividad",width:180},{title:"NOMBRE DE ACTIVIDAD",dataIndex:"nombre_actividad",width:180},{title:"TEMA DE ACTIVIDAD",dataIndex:"tema",width:180},{title:"ENTIDAD",dataIndex:"entidad_aliada",width:180},{title:"ASESOR",dataIndex:"asesor",width:180},{title:"NÚMERO DE BENEFICIARIOS",dataIndex:"beneficiarios",align:"center",width:120},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"MODALIDAD",dataIndex:"modality",align:"center",width:120},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:120},{title:"DISTRITO",dataIndex:"district",width:120},{title:"LUGAR",dataIndex:"address",width:120},{title:"¿REQUERIRÁ PASAJES?",dataIndex:"pasaje",align:"center",width:100},{title:"MONTO",dataIndex:"monto",align:"center",width:100},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],z=(e,t)=>{const o=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(o)};async function P(e,t){const o=G(e,t);await B(o)?g.success("Link copiado"):g.error("No se pudo copiar el link")}function G(e,t){return e===3?`${V()}/fortalece-tu-mercado/${t}`:`${he()}/asistencias/${t}`}async function B(e){var t;try{if((t=navigator.clipboard)!=null&&t.writeText)return await navigator.clipboard.writeText(e),!0;const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),o.select();const _=document.execCommand("copy");return document.body.removeChild(o),_}catch{return!1}}const H=s([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]);function j(e,t){if(e==3){const o=`${V()}/fortalece-tu-mercado/${t}`;window.open(o,"_blank")}else{const o=`/asistencias/${t}`;window.open(o,"_blank")}}const Q=e=>{h.value=e,f.value=!0},q=()=>{c(),f.value=!1},J=()=>{h.value=null,f.value=!0},X=async e=>{try{const t=await k({url:`attendance/delete/${e.id}`,method:"DELETE"});t.status==200&&(c(),g.success(t.message))}catch(t){console.error("Error de red:",t)}},K=async e=>{try{const t=await k({url:`attendance/event-finally/${e.id}`,method:"PUT"});t.status==200&&(c(),g.success(t.message))}catch(t){console.error("Error de red:",t)}},W=async()=>{u.value=!0;try{const e={};a.year&&(e.year=C(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor),await L("download/attendance-ugo","Eventos-UGO",e)}catch(e){console.error("Error de red:",e)}finally{u.value=!1}},Z=async()=>{u.value=!0;try{await L("download/all-activities-the-year","Actividades-UGO-2025")}catch(e){console.error("Error de red:",e)}finally{u.value=!1}},ee=async e=>{a.page=e,await c()},te=async e=>{e&&(a.page=1,await c())},c=async()=>{try{I.value=!0;const e={page:a.page};a.year&&(e.year=C(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor);const o=await k({url:"events-ugo/list",method:"GET",params:e});T.value=o.data.data,Y.value=o.data.total,O.value=o.data.per_page}catch(e){console.error("Error de red:",e)}finally{I.value=!1}},ae=async()=>{try{const e=await ce({url:"select/asesores",method:"GET"});e.status==200&&(S.value=e.data)}catch{console.log("Failed to delete")}};return de(async()=>{var e;i.value=await we("eventos-ugo"),(e=i.value)!=null&&e.can_view_all&&(await c(),await ae())}),A("search",a),A("loading",I),A("loadingFile",u),(e,t)=>{var N,R,$;const o=d("a-button"),_=d("a-select"),oe=d("a-tooltip"),ne=d("a-input-group"),v=d("a-menu-item"),le=d("router-link"),re=d("a-popconfirm"),ie=d("a-drawer");return p(),F("div",ge,[r(ve,{title:"LISTA ACTIVIDADES UGO",textNuevo:"NUEVO EVENTO",new:(N=i.value)==null?void 0:N.can_create,searchYear:!0,rangeDate:(R=i.value)==null?void 0:R.can_date_range,btnUpdate:!0,btnImport:!0,downloadExcel:($=i.value)==null?void 0:$.can_download_reporte,placeholderSearch:"Buscar",columns:U,othersList:H.value,titleSearch:"BUSCAR POR EVENTO",pageSize:O.value,nameTotal:"Actividades UGO",dataSource:T.value,total:Y.value,onHandleNew:J,onHandleDownloadExcel:W,onHandleSearch:te,permisos:i.value,onHandleCallFetchData:c,onHandlePaginator:ee},{header:n(()=>[i.value.can_download_everything?(p(),F("div",Ie,[r(o,{loading:u.value,type:"text",icon:ue(b(Ee)),onClick:Z},null,8,["loading","icon"])])):w("",!0),m("div",xe,[t[2]||(t[2]=m("small",null,"POR ASESOR",-1)),r(_,{allowClear:!0,value:a.asesor,"onUpdate:value":t[0]||(t[0]=l=>a.asesor=l),placeholder:"Selecciona Asesor","show-search":"",options:S.value,"filter-option":z},null,8,["value","options"])])]),"data-cell":n(({column:l,record:y})=>[l.dataIndex=="copy"?(p(),E(ne,{key:0,compact:""},{default:n(()=>[r(oe,{title:"copiar link"},{default:n(()=>[r(o,{type:"text",onClick:x=>P(y.eventsoffice_id,y.slug)},{icon:n(()=>[r(b(pe),{style:{"font-size":"11px"}})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):w("",!0)]),"custom-options":n(({record:l})=>{var y,x,M;return[r(v,null,{default:n(()=>[m("a",{href:"#",onClick:me(D=>j(l.eventsoffice_id,l.slug),["prevent"])}," Ver Link ",8,De)]),_:2},1024),r(v,null,{default:n(()=>[r(le,{to:`eventos-inscritos/${l.slug}`},{default:n(()=>t[3]||(t[3]=[fe("Inscritos")])),_:2},1032,["to"])]),_:2},1024),(y=i.value)!=null&&y.can_update?(p(),E(v,{key:0},{default:n(()=>[m("a",{onClick:D=>Q(l)},"Editar",8,Ce)]),_:2},1024)):w("",!0),(x=i.value)!=null&&x.can_finish?(p(),E(v,{key:1},{default:n(()=>[m("span",{style:{color:"#ff4d4f"},onClick:D=>K(l)},"Finalizar",8,Ae)]),_:2},1024)):w("",!0),(M=i.value)!=null&&M.can_delete?(p(),E(v,{key:2},{default:n(()=>[r(re,{placement:"rightBottom",title:`¿Quieres eliminar ${l.title} ?`,onConfirm:D=>X(l)},{icon:n(()=>[r(b(_e),{style:{color:"red"}})]),default:n(()=>[t[4]||(t[4]=m("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):w("",!0)]}),_:1},8,["new","rangeDate","downloadExcel","othersList","pageSize","dataSource","total","permisos"]),r(ie,{open:f.value,"onUpdate:open":t[1]||(t[1]=l=>f.value=l),title:h.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:n(()=>[r(ye,{onCloseDraw:q,dataRow:h.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{Ue as default};
