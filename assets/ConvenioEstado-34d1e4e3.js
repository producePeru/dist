import{c as a,A as ce,N as F,r as v,a as ne,k as K,M as oe,b as p,o as d,s as U,w as l,e as S,d as w,F as B,y as Ce,h as z,v as E,O as _e,B as G,m as Y,a3 as Le,a4 as De,t as j,i as H,a5 as fe,g as we,R as Oe,a6 as Pe,J as ae,K as Fe,x as qe,W as Ve,L as Be,p as je,j as He}from"./index-b150b294.js";import{_ as Ge}from"./icoexcel-1b303edf.js";import{u as xe}from"./selectes-944090b6.js";import"./es-cf3cccba.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Je}from"./MoreOutlined-7217296d.js";var Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};const Qe=Ze;function ge(c){for(var i=1;i<arguments.length;i++){var n=arguments[i]!=null?Object(arguments[i]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),u.forEach(function(g){We(c,g,n[g])})}return c}function We(c,i,n){return i in c?Object.defineProperty(c,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):c[i]=n,c}var de=function(i,n){var u=ge({},i,n.attrs);return a(ce,ge({},u,{icon:Qe}),null)};de.displayName="CloudUploadOutlined";de.inheritAttrs=!1;const Xe=de;var Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};const et=Ke;function he(c){for(var i=1;i<arguments.length;i++){var n=arguments[i]!=null?Object(arguments[i]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),u.forEach(function(g){tt(c,g,n[g])})}return c}function tt(c,i,n){return i in c?Object.defineProperty(c,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):c[i]=n,c}var ue=function(i,n){var u=he({},i,n.attrs);return a(ce,he({},u,{icon:et}),null)};ue.displayName="MessageOutlined";ue.inheritAttrs=!1;const at=ue;var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};const ot=nt;function ye(c){for(var i=1;i<arguments.length;i++){var n=arguments[i]!=null?Object(arguments[i]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),u.forEach(function(g){st(c,g,n[g])})}return c}function st(c,i,n){return i in c?Object.defineProperty(c,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):c[i]=n,c}var pe=function(i,n){var u=ye({},i,n.attrs);return a(ce,ye({},u,{icon:ot}),null)};pe.displayName="SaveOutlined";pe.inheritAttrs=!1;const it=pe,lt={city_id:{type:"iSelect",label:"Región",name:"city_id",required:!0,message:"Seleccionar una región",disabled:!0},province_id:{type:"iSelect",label:"Provincia",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},alliedEntity:{type:"iText",label:"Entidad Aliada",name:"alliedEntity",required:!0,message:"Escribir la entidad aliada",disabled:!0},homeOperations:{type:"iDate",label:"Fecha de suscripción del convenio",name:"homeOperations",required:!0,message:"Seleccionar fecha",disabled:!0},space:{type:"iSpace"},startDate:{type:"iDate",label:"Inicio Convenio Vigente",name:"startDate",required:!0,message:"Seleccionar fecha de convenio vigente",disabled:!0},years:{type:"iSelect",label:"Número de años vigente",name:"years",required:!0,message:"Seleccionar años",disabled:!1},observations:{type:"iTextarea",label:"Observaciones",name:"observations",required:!1,message:"Seleccionar",disabled:!1}};const rt={class:"grid-convenios"},ct={key:4},dt={key:0},ut={key:1},be="DD/MM/YYYY",pt={__name:"DrawConvenio",props:["idConvenio"],emits:["closeDraw"],setup(c,{emit:i}){F.locale("es");const n=JSON.parse(localStorage.getItem("profile")),u=xe(),g=i,O=c;u.$patch({cities:u.cities}),u.$patch({provinces:u.provinces}),u.$patch({districts:u.districts}),u.fetchCities();const f=v(!1),k=v(!1),t=ne({}),C=[{value:1,label:"1 Año"},{value:2,label:"2 Años"},{value:3,label:"3 Años"},{value:4,label:"4 Años"},{value:5,label:"5 Años"},{value:6,label:"6 Años"},{value:7,label:"7 Años"},{value:8,label:"8 Años"},{value:9,label:"9 Años"},{value:10,label:"10 Años"}],M=e=>{const s=F(t.startDate).add(1,"day").startOf("day");return F(e).startOf("day").isBefore(s,"day")},q=e=>{t.province_id=null,t.district_id=null,u.fetchProvinces(e)},R=e=>{t.district_id=null,u.fetchDistricts(e)},$=(e,s)=>{const y=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(y)},L=()=>{t.city_id=null,t.province_id=null,t.district_id=null,t.alliedEntity=null,t.homeOperations=null,t.startDate=null,t.years=null,t.endDate=null,t.observations=null,t.created_id=n.user_id},T=async()=>{f.value=!0;const e={city_id:t.city_id,province_id:t.province_id,district_id:t.district_id,alliedEntity:t.alliedEntity,homeOperations:F(t.homeOperations).format("YYYY-MM-DD"),startDate:F(t.startDate).format("YYYY-MM-DD"),years:t.years,endDate:F(t.startDate).add(t.years,"year").format("YYYY-MM-DD"),observations:t.observations,created_id:n.user_id};try{const s=O.idConvenio?"PUT":"POST",y=O.idConvenio?`agreement/update-values/${O.idConvenio.id}`:"agreement/create",D=await G({url:y,method:s,data:e});D.status==200&&(Y.success(D.message),g("closeDraw",!0),L())}catch(s){Y.error("Se originó un error: "+s.message)}finally{f.value=!1}},P=()=>{Y.error("Debes de completar todos los espacios requeridos")},m=async e=>{e.id&&(t.city_id=e.city_id,q(e.city_id),t.province_id=e.province_id,R(e.province_id),t.district_id=e.district_id,t.homeOperations=F(e.startOperations,"YYYY-MM-DD"),t.startDate=F(e.startDate,"YYYY-MM-DD"),t.years=e.years,t.observations=e.observations,t.alliedEntity=e.entity)};return K(()=>{O.idConvenio&&m(O.idConvenio)}),oe(()=>O.idConvenio,e=>{e?m(e):L()}),(e,s)=>{const y=p("a-input"),D=p("a-form-item"),V=p("a-select"),J=p("a-date-picker"),x=p("a-textarea"),Q=p("a-button"),N=p("a-form"),se=p("a-spin");return d(),U(se,{spinning:k.value},{default:l(()=>[a(N,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:T,onFinishFailed:P},{default:l(()=>[S("div",rt,[(d(!0),w(B,null,Ce(z(lt),(o,X)=>(d(),w(B,{key:X},[o.type==="iText"?(d(),U(D,{key:0,name:o.name,label:o.label,rules:[{required:o.required,message:o.message,max:o.max}]},{default:l(()=>[a(y,{value:t[o.name],"onUpdate:value":A=>t[o.name]=A,maxlength:o.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):E("",!0),o.type==="iSelect"?(d(),U(D,{key:1,class:"item-max",name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:l(()=>[o.name=="city_id"?(d(),U(V,{key:0,value:t[o.name],"onUpdate:value":A=>t[o.name]=A,options:z(u).cities,"show-search":"","filter-option":$,onChange:q},null,8,["value","onUpdate:value","options"])):E("",!0),o.name=="province_id"?(d(),U(V,{key:1,value:t[o.name],"onUpdate:value":A=>t[o.name]=A,options:z(u).provinces,"show-search":"","filter-option":$,onChange:R,disabled:!t.city_id},null,8,["value","onUpdate:value","options","disabled"])):E("",!0),o.name=="district_id"?(d(),U(V,{key:2,value:t[o.name],"onUpdate:value":A=>t[o.name]=A,options:z(u).districts,"show-search":"","filter-option":$,disabled:!t.province_id},null,8,["value","onUpdate:value","options","disabled"])):E("",!0),o.name=="years"?(d(),U(V,{key:3,value:t[o.name],"onUpdate:value":A=>t[o.name]=A,options:C,"show-search":"","filter-option":$},null,8,["value","onUpdate:value"])):E("",!0)]),_:2},1032,["name","label","rules"])):E("",!0),o.type==="iDate"?(d(),U(D,{key:2,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:l(()=>[o.name=="endDate"?(d(),U(J,{key:0,"disabled-date":M,locale:z(_e),disabled:!t.startDate,value:t[o.name],"onUpdate:value":A=>t[o.name]=A,style:{width:"100%"},format:be,placeholder:"día/mes/año"},null,8,["locale","disabled","value","onUpdate:value"])):(d(),U(J,{key:1,locale:z(_e),value:t[o.name],"onUpdate:value":A=>t[o.name]=A,style:{width:"100%"},format:be,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"]))]),_:2},1032,["name","label","rules"])):E("",!0),o.type==="iTextarea"?(d(),U(D,{key:3,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:l(()=>[a(x,{value:t[o.name],"onUpdate:value":A=>t[o.name]=A,rows:3},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):E("",!0),o.type==="iSpace"?(d(),w("span",ct)):E("",!0)],64))),128))]),a(D,null,{default:l(()=>[a(Q,{type:"primary","html-type":"submit",loading:f.value},{default:l(()=>[c.idConvenio?(d(),w("span",dt,"ACTUALIZAR")):(d(),w("span",ut,"GUARDAR"))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])}}},mt=Ee(pt,[["__scopeId","data-v-f5a2cfb4"]]);const vt={class:"accion-icons"},_t={key:0},ft={key:1},gt={__name:"DrawAcciones",props:["idConvenio"],emits:["refreshTable"],setup(c,{emit:i}){const n=c,u=i,g=v([]),O=v(!0),f=v(null),k=v(""),t=v(!1);v(null);const C=ne({description:null});K(()=>{n.idConvenio&&T(n.idConvenio)}),oe(()=>n.idConvenio,m=>{m&&T()});function M(m){f.value=m.id,k.value=m.description,fe(()=>{P()})}function q(m){const e=g.value.findIndex(s=>s.id===m.id);e!==-1&&(g.value[e].description=k.value),f.value=null,$(m.id)}const R=async m=>{try{const e=await G({url:`agreement/delete-acction/${m.id}`,method:"DELETE"});e.status==200&&(T(),Y.success(e.message),u("refreshTable",!0))}catch(e){console.error("Error de red:",e)}},$=async m=>{try{const e={description:k.value},s=await G({url:`agreement/update/${m}`,method:"PUT",data:e});s.status==200&&(Y.success(s.message),T())}catch(e){console.error("Error de red:",e)}},L=async()=>{try{const m={description:C.description,agreements_id:n.idConvenio},e=await G({url:"agreement/create-acction",method:"POST",data:m});e.status==200&&(Y.success(e.message),u("refreshTable",!0),T(),C.description=null)}catch(m){console.error("Error de red:",m)}},T=async()=>{O.value=!0;try{const m=await G({url:`agreement/list/${n.idConvenio}`,method:"GET"});m.status==200&&(g.value=m.data)}catch{}finally{O.value=!1}},P=()=>{fe(()=>{const m=document.getElementById("auto-resize");m.style.height="auto",m.style.height=m.scrollHeight+"px"})};return(m,e)=>{const s=p("a-textarea"),y=p("a-spin"),D=p("a-form-item"),V=p("a-button"),J=p("a-form");return d(),w("div",null,[a(y,{spinning:O.value},{default:l(()=>[(d(!0),w(B,null,Ce(g.value,(x,Q)=>(d(),w("div",{class:"acciones",key:Q},[S("div",vt,[a(z(Le),{class:"pointer ico-acc",onClick:N=>M(x)},null,8,["onClick"]),f.value===x.id?(d(),U(z(it),{key:0,class:"pointer ico-save",onClick:N=>q(x)},null,8,["onClick"])):E("",!0),a(z(De),{class:"pointer ico-acc",onClick:N=>R(x)},null,8,["onClick"])]),f.value===x.id?(d(),w("div",_t,[a(s,{value:k.value,"onUpdate:value":e[0]||(e[0]=N=>k.value=N),onInput:P,id:"auto-resize"},null,8,["value"])])):(d(),w("p",ft,j(x.description),1))]))),128))]),_:1},8,["spinning"]),a(J,{layout:"vertical",model:C,name:"basic",autocomplete:"off",onFinish:L},{default:l(()=>[a(D,{name:"description",label:"Registra una acción",rules:[{required:!0,message:"Escribir la descripción"}]},{default:l(()=>[a(s,{value:C.description,"onUpdate:value":e[1]||(e[1]=x=>C.description=x),maxlength:250,rows:4},null,8,["value"])]),_:1}),a(D,null,{default:l(()=>[a(V,{type:"primary","html-type":"submit",loading:t.value},{default:l(()=>[H("CREAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const ht={__name:"DrawObservations",props:["idConvenio"],emits:["refreshTable"],setup(c,{emit:i}){const n=c,u=i;v([]);const g=v(!0);v(null),v("");const O=v(!1);v(null);const f=ne({description:null});K(()=>{n.idConvenio&&t(n.idConvenio)}),oe(()=>n.idConvenio,C=>{C&&t()});const k=async()=>{O.value=!0;try{const C={observations:f.description},M=await G({url:`agreement/update-values/${n.idConvenio.id}`,method:"PUT",data:C});M.status==200&&(Y.success(M.message),u("refreshTable",!0))}catch(C){console.error("Error de red:",C)}finally{O.value=!1}},t=async()=>{f.description=n.idConvenio.observations,f.description!=null&&(g.value=!1)};return(C,M)=>{const q=p("a-textarea"),R=p("a-form-item"),$=p("a-button"),L=p("a-form"),T=p("a-spin");return d(),w("div",null,[a(T,{spinning:g.value},{default:l(()=>[a(L,{layout:"vertical",model:f,name:"basic",autocomplete:"off",onFinish:k},{default:l(()=>[a(R,{name:"description",label:"Orbservaciones",rules:[{required:!0,message:"Escribir la descripción"}]},{default:l(()=>[a(q,{value:f.description,"onUpdate:value":M[0]||(M[0]=P=>f.description=P),rows:6},null,8,["value"])]),_:1}),a(R,null,{default:l(()=>[a($,{type:"primary","html-type":"submit",loading:O.value},{default:l(()=>[H("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}};const yt=S("div",{class:"agreements-file"},[S("b",null,"Formatos a subir"),S("span",null,"pdf, doc, docx, xls, xlsx, ppt, pptx"),S("span",null,"*(Máximo 20MB)")],-1),bt={class:"file-options"},Ct={style:{"line-height":"1.3"}},Dt=["onClick"],wt=["onClick"],Ot={__name:"DrawFiles",props:["idConvenio"],setup(c){F.locale("es");const i=we.get("token"),n=c,u="https://apituempresa.soporte-pnte.com/api/",g="http://127.0.0.1:8000/api/",O=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?g:u,f=v(!1),k=v([]),t=v(null),C=v(null),M=Oe(Pe,{style:{fontSize:"20px"},spin:!0});K(()=>{n.idConvenio&&m(n.idConvenio)}),oe(()=>n.idConvenio,e=>{e&&m(e)});const q=e=>F(e).format("DD-MM-YYYY HH:mm"),R=e=>($(e),!1),$=async e=>{const s=new FormData;s.append("file",e),s.append("agreements_id",n.idConvenio),f.value=!0;try{const{data:y}=await ae.post(`${O}agreement/file`,s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${i}`}});y.status==200&&(Y.success(y.message),m(n.idConvenio))}catch{Y.error("Error al subir este tipo de archivo")}finally{f.value=!1}},L=async e=>{t.value=e.uid;try{const s=await ae({url:`${O}agreement/file-download/${e.uid}`,method:"POST",responseType:"blob",headers:{Authorization:`Bearer ${i}`}}),y=window.URL.createObjectURL(new Blob([s.data])),D=document.createElement("a");D.href=y,D.setAttribute("download",e.name),document.body.appendChild(D),D.click(),window.URL.revokeObjectURL(y),document.body.removeChild(D)}catch(s){console.error("Error downloading file:",s)}finally{t.value=null}},T=e=>{e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?(Y.success(`${e.file.name} file uploaded successfully`),k.value=e.fileList.filter(s=>s.status!=="error")):e.file.status==="error"&&(Y.error(`${e.file.name} file upload failed.`),k.value=e.fileList.filter(s=>s.uid!==e.file.uid))},P=async e=>{C.value=e.uid;try{const s=await G({url:`agreement/delete/file/${e.uid}`,method:"DELETE"});s.status==200&&(m(n.idConvenio),Y.success(s.message))}catch(s){console.error("Error de red:",s)}finally{C.value=null}},m=async e=>{try{const{data:s}=await ae.get(`${O}agreement/list-files/${e}`,{headers:{Authorization:`Bearer ${i}`}});s.status===200&&(k.value=s.data.map(y=>({uid:y.id,name:y.name,status:"done",url:y.path,date:y.created_at})))}catch(s){console.error("Error fetching files:",s)}};return(e,s)=>{const y=p("a-button"),D=p("a-spin"),V=p("a-space"),J=p("a-upload");return d(),w("div",null,[yt,a(J,{"file-list":k.value,name:"file",onChange:T,"custom-request":$,"before-upload":R},{itemRender:l(({file:x,actions:Q})=>[a(V,{style:{margin:"0rem 0","font-size":"13px",width:"100%"}},{default:l(()=>[S("div",bt,[S("span",Ct,j(x.name),1),S("span",null,j(q(x.date)),1),t.value!=x.uid?(d(),w("a",{key:0,onClick:N=>L(x)},"Descargar",8,Dt)):(d(),U(D,{key:1,indicator:z(M)},null,8,["indicator"])),C.value==x.uid?(d(),U(D,{key:2,indicator:z(M)},null,8,["indicator"])):(d(),w("a",{key:3,onClick:N=>P(x),style:{color:"var(--error)"}},[a(z(De))],8,wt))])]),_:2},1024)]),default:l(()=>[a(y,{style:{"margin-bottom":".6rem"},loading:f.value},{default:l(()=>[a(z(Xe)),H(" SUBIR ARCHIVO ")]),_:1},8,["loading"])]),_:1},8,["file-list"])])}}};const me=c=>(je("data-v-8c04ed3a"),c=c(),He(),c),xt=me(()=>S("h3",{class:"title-produce"},"ESTADO DE CONVENIOS",-1)),Et=me(()=>S("img",{width:"20",style:{margin:"-2px 0 0 0"},src:Ge},null,-1)),St={key:0,class:"list-days"},kt={key:1,class:"list-days"},It=["onClick"],$t=["onClick"],At=me(()=>S("a",null,"Eliminar",-1)),Ut={class:"paginator"},Tt={__name:"ConvenioEstado",props:["idConvenio"],setup(c){F.locale("es"),JSON.parse(localStorage.getItem("profile")),xe();const i=we.get("token"),n="https://apituempresa.soporte-pnte.com/api/",u="http://127.0.0.1:8000/api/",g=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?u:n;v(null),v(null);const O=v(!1),f=v(null),k=v(0),t=v(50),C=v({page:0}),M=v(1200),q=v([]),R=v(!1),$=v(!1),L=v(!1),T=v(!1),P=v(!1);v(null),v(null);const m=v(window.innerHeight-100),e=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGIÓN",dataIndex:"city",fixed:"left",width:120},{title:"PROVINCIA",dataIndex:"province",fixed:"left",width:120},{title:"DISTRITO",dataIndex:"district",fixed:"left",width:140},{title:"ENTIDAD ALIADA",dataIndex:"entity",width:300},{title:"FECHA DE SUSCRIPCIÓN DE CONVENIO",dataIndex:"startOperations",align:"center",width:180},{title:"INICIO DE CONVENIO VIGENTE",dataIndex:"startDate",align:"center",width:180},{title:"N° DE AÑOS VIGENTE",dataIndex:"years",width:120,align:"center"},{title:"FIN DEL CONVENIO",dataIndex:"endDate",align:"center",width:180},{title:"ESTADO",dataIndex:"status",align:"center",width:150},{title:"FECHA RESTANTE",dataIndex:"numbrestantes",align:"center",width:140},{title:"OBSERVACIONES",dataIndex:"observations",align:"center",width:140},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],s=ne({search:""}),y=()=>{let _={search:s.search};Z(_)},D=()=>{s.search||Z()},V=_=>{f.value=_,$.value=!0},J=_=>{f.value=_,T.value=!0},x=_=>F(_).format("DD/MM/YYYY"),Q=_=>{f.value=_.id,P.value=!0},N=(_,r)=>{const I=new Date(_),W=new Date,ie=I.getTime()-W.getTime();return Math.floor(ie/(1e3*3600*24))+1},se=_=>_<=0||_<20?"red":_<40?"#f9e717":"#11d811",o=_=>{C.value.page=_,Z()},X=()=>{m.value=window.innerHeight-320},A=()=>{f.value=null,$.value=!0},ee=_=>{Z(),_==1&&($.value=!1,f.value=null),_==2&&(L.value=!1),_==4&&(T.value=!1),f.value=null},Se=async _=>{try{const r=await G({url:`agreement/delete/${_.id}`,method:"DELETE"});r.status==200&&(Z(),Y.success(r.message))}catch(r){console.error("Error de red:",r)}},ke=Fe(()=>_=>C.value.page*t.value+_+1),Z=async _=>{try{R.value=!0;let r;r=C.value.page==0?"":C.value,r=_?{...r,..._}:r;const{data:I}=await G({url:"agreement/list",method:"GET",params:r});q.value=I==null?void 0:I.data,k.value=I.total,t.value=I.per_page}catch(r){console.error("Error de red:",r)}finally{R.value=!1}},Ie=async()=>{O.value=!0;try{const _=await ae({url:`${g}agreement/download`,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${i}`}}),r=window.URL.createObjectURL(new Blob([_.data])),I=document.createElement("a"),W="convenios.xlsx";I.href=r,I.setAttribute("download",W),document.body.appendChild(I),I.click(),window.URL.revokeObjectURL(r),document.body.removeChild(I)}catch(_){console.error("Error downloading file:",_)}finally{O.value=!1}};return qe(()=>{window.removeEventListener("resize",X)}),K(()=>{window.addEventListener("resize",X),X(),Z()}),(_,r)=>{const I=p("a-button"),W=p("a-col"),ie=p("a-input"),ve=p("a-input-group"),$e=p("a-row"),Ae=p("a-progress"),le=p("a-menu-item"),Ue=p("a-popconfirm"),Te=p("a-menu"),ze=p("a-dropdown"),Me=p("a-table"),Ne=p("a-tag"),Re=p("a-pagination"),te=p("a-drawer");return d(),w(B,null,[S("div",null,[xt,a($e,{style:{margin:"1rem 0"}},{default:l(()=>[a(W,{xs:24,md:12,lg:18},{default:l(()=>[a(I,{type:"primary",onClick:A,style:{"margin-right":".5rem"}},{default:l(()=>[H("NUEVO")]),_:1}),a(I,{class:"btn-excel",onClick:Ie,loading:O.value,type:"primary"},{default:l(()=>[Et]),_:1},8,["loading"])]),_:1}),a(W,{xs:24,md:12,lg:6},{default:l(()=>[a(ve,{compact:""},{default:l(()=>[a(ie,{value:s.search,"onUpdate:value":r[0]||(r[0]=h=>s.search=h),style:{width:"calc(100% - 80px)"},onInput:D},null,8,["value"]),a(I,{type:"primary",disabled:s.search==="",onClick:y},{default:l(()=>[H("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(Me,{bordered:"",scroll:{x:M.value,y:m.value},class:"table-agreements",columns:e,"data-source":q.value,pagination:!1,loading:R.value,size:"small"},{headerCell:l(({column:h})=>[]),bodyCell:l(({column:h,record:b,index:Ye})=>[h.dataIndex=="idx"?(d(),w(B,{key:0},[H(j(ke.value(Ye)),1)],64)):E("",!0),h.dataIndex=="startOperations"?(d(),w(B,{key:1},[H(j(x(b.startOperations)),1)],64)):E("",!0),h.dataIndex=="startDate"?(d(),w(B,{key:2},[H(j(x(b==null?void 0:b.startDate)),1)],64)):E("",!0),h.dataIndex=="endDate"?(d(),w(B,{key:3},[H(j(x(b==null?void 0:b.endDate)),1)],64)):E("",!0),h.dataIndex=="numbrestantes"?(d(),w(B,{key:4},[N(b.endDate,b.startDate)>=1?(d(),w("p",St,j(N(b.endDate,b.startDate))+" días faltantes",1)):(d(),w("p",kt,j(N(b.endDate,b.startDate))+" días vencidos",1))],64)):E("",!0),h.dataIndex=="status"?(d(),U(Ae,{key:5,style:{margin:"0"},percent:N(b.endDate,b.startDate),size:4,showInfo:!1,strokeColor:se(N(b.endDate,b.startDate))},null,8,["percent","strokeColor"])):E("",!0),h.dataIndex=="observations"?(d(),w(B,{key:6},[b!=null&&b.observations?(d(),U(z(at),{key:0,class:"observation-icon",onClick:re=>J(b)},null,8,["onClick"])):E("",!0)],64)):E("",!0),h.dataIndex=="actions"?(d(),U(ze,{key:7,trigger:["click"]},{overlay:l(()=>[a(Te,null,{default:l(()=>[a(le,null,{default:l(()=>[S("a",{onClick:re=>Q(b)},"Archivos",8,It)]),_:2},1024),a(le,null,{default:l(()=>[S("a",{onClick:re=>V(b)},"Editar",8,$t)]),_:2},1024),a(le,null,{default:l(()=>[a(Ue,{title:"¿Seguro de eliminar?",onConfirm:re=>Se(b)},{icon:l(()=>[a(z(Ve),{style:{color:"red"}})]),default:l(()=>[At]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:l(()=>[S("a",{class:"ant-dropdown-link",onClick:r[1]||(r[1]=Be(()=>{},["prevent"]))},[a(I,{shape:"circle",icon:Oe(z(Je)),size:"small"},null,8,["icon"])])]),_:2},1024)):E("",!0)]),_:1},8,["scroll","data-source","loading"])]),S("div",Ut,[S("span",null,[a(Ne,{color:"blue"},{default:l(()=>[S("b",null,j(k.value),1)]),_:1}),H("Convenios")]),a(Re,{size:"small",total:k.value,pageSize:t.value,onChange:o,showSizeChanger:!1},null,8,["total","pageSize"])]),a(te,{open:$.value,"onUpdate:open":r[3]||(r[3]=h=>$.value=h),"root-class-name":"root-class-name",title:"Convenios",placement:"right",width:"650"},{default:l(()=>[a(mt,{idConvenio:f.value,onCloseDraw:r[2]||(r[2]=h=>ee(1))},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:L.value,"onUpdate:open":r[6]||(r[6]=h=>L.value=h),title:"Acciones",placement:"right",width:"550"},{default:l(()=>[a(gt,{idConvenio:f.value,onCloseDraw:r[4]||(r[4]=h=>ee(2)),onRefreshTable:r[5]||(r[5]=h=>Z())},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:P.value,"onUpdate:open":r[8]||(r[8]=h=>P.value=h),title:"Cargar Archivos",placement:"right",width:"550"},{default:l(()=>[a(Ot,{idConvenio:f.value,onCloseDraw:r[7]||(r[7]=h=>ee(3))},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:T.value,"onUpdate:open":r[11]||(r[11]=h=>T.value=h),title:"Observaciones",placement:"right",width:"550"},{default:l(()=>[a(ht,{idConvenio:f.value,onCloseDraw:r[9]||(r[9]=h=>ee(4)),onRefreshTable:r[10]||(r[10]=h=>Z())},null,8,["idConvenio"])]),_:1},8,["open"])],64)}}},Pt=Ee(Tt,[["__scopeId","data-v-8c04ed3a"]]);export{Pt as default};
