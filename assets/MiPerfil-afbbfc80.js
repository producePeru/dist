import{f as E}from"./actualizarUsuario-dcb6b189.js";import{u as R}from"./selectes-4156b334.js";import{J as x,r as b,a as j,k as G,b as r,o as n,d as D,e as y,c as l,w as c,y as w,F as Y,B as J,q as i,h as m,s as u,K as L,i as K,p as Z,j as z,m as q}from"./index-196a8fcf.js";import"./es-896c0dda.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const Q=v=>(Z("data-v-ceecb883"),v=v(),z(),v),W={class:"profile-header"},X=Q(()=>y("h3",null,"MIS DATOS",-1)),ee={class:"my-profile"},ae={class:"grid-profile"},C="YYYY-MM-DD",te={__name:"MiPerfil",props:["updateUser"],emits:["closeDraw"],setup(v,{emit:oe}){x.locale("es");const t=R(),g=JSON.parse(localStorage.getItem("profile")),k=b(!1);t.$patch({genders:t.genders}),t.$patch({cdes:t.cdes}),t.$patch({Offices:t.Offices}),t.$patch({roles:t.roles}),t.$patch({supervisores:t.supervisores}),t.fetchGenders(),t.fetchCdes(),t.fetchOffices(),t.fetchRoles();const S=b(!1),p=b(E),_=b(null),a=j({documentnumber:null,name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:g.id}),F=o=>{const d={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(o===2)t.fetchSupervisores(),p.value={...p.value,supervisor_id:d};else{const{supervisor_id:M,...U}=p.value;p.value=U}},I=async()=>{S.value=!0,a.birthday=_.value?x(_.value).format("YYYY-MM-DD"):null;let o=a;delete o.documentnumber;try{const d=await w({url:`user/update/${g.id}`,method:"PUT",data:o});q.success(d.message)}catch{q.error("No se pudo registrar este usuario")}finally{S.value=!1}},N=()=>{q.error("Debes de completar todos los espacios requeridos")},O=async()=>{try{k.value=!0;const{data:o}=await w({url:"user/my-profile",method:"GET"});o&&(a.documentnumber=g.documentnumber,a.name=o.name,a.lastname=o.lastname,a.middlename=o.middlename,a.birthday=o.birthday,a.sick=o.sick,a.phone=o.phone,a.gender_id=o.gender_id,a.cde_id=o.cde_id,a.office_id=o.office_id,o.birthday&&(_.value=x(o.birthday,C)))}catch(o){console.error("Error de red:",o)}finally{k.value=!1}};return G(()=>{O()}),(o,d)=>{const M=r("router-link"),U=r("a-divider"),f=r("a-select"),h=r("a-form-item"),T=r("a-input"),$=r("a-date-picker"),B=r("a-button"),V=r("a-form"),A=r("a-spin");return n(),D("div",null,[y("div",W,[X,l(M,{to:"cambiar-clave"})]),l(U),y("section",ee,[l(A,{spinning:k.value},{default:c(()=>[l(V,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:I,onFinishFailed:N},{default:c(()=>[y("div",ae,[(n(!0),D(Y,null,J(p.value,(e,P)=>(n(),D(Y,{key:P},[e.type==="iSelect"?(n(),i(h,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:c(()=>[e.name=="gender_id"?(n(),i(f,{key:0,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).genders},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="cde_id"?(n(),i(f,{key:1,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).cdes},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="office_id"?(n(),i(f,{key:2,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).Offices},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="role_id"?(n(),i(f,{key:3,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).roles,onChange:F},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="supervisor_id"?(n(),i(f,{key:4,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).supervisores},null,8,["value","onUpdate:value","options"])):u("",!0)]),_:2},1032,["name","label","rules"])):u("",!0),e.type==="iText"?(n(),i(h,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:c(()=>[l(T,{value:a[e.name],"onUpdate:value":s=>a[e.name]=s,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):u("",!0),e.type==="iDate"?(n(),i(h,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:c(()=>[l($,{locale:m(L),value:_.value,"onUpdate:value":d[0]||(d[0]=s=>_.value=s),style:{width:"100%"},format:C},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):u("",!0)],64))),128))]),l(h,null,{default:c(()=>[l(B,{class:"btn-produce",type:"primary","html-type":"submit",loading:S.value},{default:c(()=>[K("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])])}}},ue=H(te,[["__scopeId","data-v-ceecb883"]]);export{ue as default};
