import{l as g,aa as F,r as f,E as ie,X as oe,j as G,b as v,o as p,d as b,e as u,t as E,c as r,w as y,x as O,i as q,q as h,h as n,L as $,F as V,ab as H,J as le,p as ne,a as se,T as ce,a5 as Y,f as re,K as de}from"./index-cc0124c1.js";import{_ as ue}from"./icoexcel-1b303edf.js";import"./es-82ab1b78.js";import{M as me}from"./MoreOutlined-e98d8e08.js";import{_ as _e}from"./FormComponent-555efea9.js";import{u as pe}from"./selectes-df222431.js";const ve={class:"table-component"},ye={class:"title-produce"},fe={class:"table-filters"},he={key:0,class:"filter-type"},ge={key:1,class:"filter-year"},be={key:2,class:"filter-range-date"},Se={key:3,class:"filter-asesor"},Ce={class:"filter-search"},we={key:1},Ee={class:"paginator"},Ne="DD/MM/YYYY",Re={__name:"TableComponent",props:["title","new","textNuevo","columns","dataSource","total","placeholderSearch","asesoresList","nameTotal","pageSize","titleSearch","tipoformalizacion","searchYear","rangeDate"],emits:["handleNew","handleDownloadExcel","handleSearch","handlePaginator"],setup(k,{emit:I}){g.locale("es");const i=k,S=I,T=JSON.parse(localStorage.getItem("role"))||[],s=F("search"),C=F("loading"),D=F("loadingFile"),t=f(window.innerHeight-100),w=f({page:1}),a=f(1200),A=f([{label:"Últimos 7 días",value:[g().add(-7,"d"),g()]},{label:"Últimos 14 días",value:[g().add(-14,"d"),g()]},{label:"Último mes",value:[g().add(-30,"d"),g()]}]),l=f([{label:"ASESORÍAS",value:1},{label:"F. RUC 10",value:2},{label:"F. RUC 20",value:3}]),x=m=>T.some(o=>m.includes(o.id)),R=ie(()=>m=>(w.value.page-1)*i.pageSize+m+1),z=()=>{S("handleNew")},L=async()=>{S("handleDownloadExcel")},P=()=>{S("handleSearch",!0)},M=m=>{w.value.page=m,S("handlePaginator",m)},N=()=>{t.value=window.innerHeight-310},U=(m,o)=>{const e=m.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(e)};return oe(()=>{window.removeEventListener("resize",N)}),G(()=>{window.addEventListener("resize",N),N()}),(m,o)=>{const e=v("a-button"),d=v("a-col"),c=v("a-select"),j=v("a-date-picker"),J=v("a-range-picker"),X=v("a-input"),K=v("a-row"),Z=v("a-menu"),Q=v("a-dropdown"),W=v("a-table"),ee=v("a-tag"),te=v("a-pagination");return p(),b(V,null,[u("div",ve,[u("h3",ye,E(i.title),1),r(K,{style:{margin:"1rem 0"}},{default:y(()=>[r(d,{xs:24,md:5},{default:y(()=>[i.new?(p(),O(e,{key:0,type:"primary",onClick:z,style:{"margin-right":".6rem"}},{default:y(()=>[q(E(i.textNuevo),1)]),_:1})):h("",!0),r(e,{class:"btn-excel",onClick:L,loading:n(D),type:"primary"},{default:y(()=>o[6]||(o[6]=[u("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:ue},null,-1)])),_:1},8,["loading"])]),_:1}),r(d,{xs:24,md:19},{default:y(()=>[u("div",fe,[i.tipoformalizacion?(p(),b("div",he,[o[7]||(o[7]=u("small",null,"TIPO",-1)),r(c,{value:n(s).type,"onUpdate:value":o[0]||(o[0]=_=>n(s).type=_),options:l.value},null,8,["value","options"])])):h("",!0),i.searchYear?(p(),b("div",ge,[o[8]||(o[8]=u("small",null,"AÑO",-1)),r(j,{allowClear:!1,value:n(s).year,"onUpdate:value":o[1]||(o[1]=_=>n(s).year=_),picker:"year",placeholder:"Seleccionar año"},null,8,["value"])])):h("",!0),i.rangeDate?(p(),b("div",be,[o[9]||(o[9]=u("small",null,"Por rango de fechas",-1)),r(J,{value:n(s).range,"onUpdate:value":o[2]||(o[2]=_=>n(s).range=_),presets:A.value,format:Ne},null,8,["value","presets"])])):h("",!0),x([1,5])&&i.asesoresList?(p(),b("div",Se,[o[10]||(o[10]=u("small",null,"Por asesor",-1)),i.asesoresList?(p(),O(c,{key:0,allowClear:!0,value:n(s).asesor,"onUpdate:value":o[3]||(o[3]=_=>n(s).asesor=_),placeholder:"Selecciona Asesor","show-search":"",options:i.asesoresList,"filter-option":U},null,8,["value","options"])):h("",!0)])):h("",!0),u("div",Ce,[u("small",null,E(i.titleSearch),1),r(X,{value:n(s).name,"onUpdate:value":o[4]||(o[4]=_=>n(s).name=_),placeholder:i.placeholderSearch},null,8,["value","placeholder"])]),r(e,{type:"primary",onClick:P},{default:y(()=>[n(C)?(p(),O(n($),{key:0})):(p(),b("span",we,"BUSCAR"))]),_:1})])]),_:1})]),_:1}),r(W,{bordered:"",scroll:{x:a.value,y:t.value},class:"table-pnte",columns:i==null?void 0:i.columns,"data-source":i==null?void 0:i.dataSource,pagination:!1,loading:n(C),size:"small"},{bodyCell:y(({column:_,record:B,index:ae})=>[_.dataIndex=="idx"?(p(),b(V,{key:0},[q(E(R.value(ae)),1)],64)):h("",!0),H(m.$slots,"data-cell",{column:_,record:B}),_.dataIndex=="actions"?(p(),O(Q,{key:1,trigger:["click"]},{overlay:y(()=>[r(Z,null,{default:y(()=>[H(m.$slots,"custom-options",{record:B})]),_:2},1024)]),default:y(()=>[u("a",{class:"ant-dropdown-link",onClick:o[5]||(o[5]=le(()=>{},["prevent"]))},[r(e,{shape:"circle",icon:ne(n(me)),size:"small"},null,8,["icon"])])]),_:2},1024)):h("",!0)]),_:3},8,["scroll","columns","data-source","loading"])]),u("div",Ee,[u("span",null,[r(ee,{color:"blue"},{default:y(()=>[u("b",null,E(i==null?void 0:i.total),1)]),_:1}),q(E(i.nameTotal),1)]),r(te,{size:"small",total:i==null?void 0:i.total,pageSize:i.pageSize,onChange:M,showSizeChanger:!1},null,8,["total","pageSize"])])],64)}}},Oe={key:1,class:"f-20"},ze={__name:"EditarAsesoria",props:["info"],emits:["closeDraw"],setup(k,{emit:I}){g.locale("es");const i=f({economicsector_id:{type:"iSelect",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!0,message:"Seleccionar el sector económico",disabled:!1},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!1},component_id:{type:"iSelect",label:"COMPONENTE",name:"component_id",required:!0,message:"Seleccionar un componente",disabled:!1},theme_id:{type:"iSelect",label:"TEMA DEL COMPONENTE",name:"theme_id",required:!0,message:"Seleccionar un tema del componente",disabled:!0},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCIÓN",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},ruc:{type:"iNumber",label:"RUC",name:"ruc",message:"Escribir número de RUC",disabled:!1,maxlength:11,rules:[{validator:(e,d)=>{if(!d)return Promise.resolve();const c=d.toString();return c.length!==11?Promise.reject(new Error("El número debe tener exactamente 11 dígitos")):["10","15","20"].includes(c.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 10, 15 o 20"))},trigger:"change"}]},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},observations:{type:"iText",label:"NRO DE RESERVA / OBSERVACIONES",name:"observations",required:!1,message:"Seleccionar tipo de documento",disabled:!1}}),S=JSON.parse(localStorage.getItem("profile")),T=I,s=k,C=f(!0),D=f("ACTUALIZAR"),t=se({}),w=f(!1),a=pe(),A=f(null),l=f({city_id:[],province_id:[],district_id:[],modality_id:[],comercialactivity_id:[],isbic:[],typecapital_id:[],component_id:[],theme_id:[]}),x=e=>{console.log("handleInputEvent",e)},R=async e=>{e=="dateReception"&&(t.dateTramite&&(t.dateTramite=null),i.value.dateTramite.disabled=!1)},z=async e=>{e=="city_id"&&(await a.fetchProvinces(t.city_id),l.value.province_id=a.provinces,i.value.province_id.disabled=!1),e=="province_id"&&(await a.fetchDistricts(t.province_id),l.value.district_id=a.districts,i.value.district_id.disabled=!1),e=="component_id"&&(await a.fetchComponentThemes(t.component_id),l.value.theme_id=a.componentThemes,t.theme_id=null,i.value.theme_id.disabled=!1)},L=async e=>{console.log("handleFocusSelect",e),e=="city_id"&&(await a.fetchCities(),t.city_id=null,t.province_id=null,t.district_id=null,l.value.province_id=[],l.value.city_id=a.cities),e=="province_id"&&(t.province_id=null,t.district_id=null,l.value.district_id=[]),e=="modality_id"&&(await a.fetchModalities(),l.value.modality_id=a.modalities),e=="regime_id"&&(await a.fetchRegimes(),l.value.regime_id=a.regimes),e=="economicsector_id"&&(await a.fetchEconomicSectors(),l.value.economicsector_id=a.economicSectors),e=="comercialactivity_id"&&(await a.fetchComercialActivities(),l.value.comercialactivity_id=a.comercialActivities),e=="notary_id"&&N(),e=="isbic"&&M(),e=="typecapital_id"&&(await a.fetchTypeCapital(),l.value.typecapital_id=a.typeCapital),e=="component_id"&&(await a.fetchComponents(),l.value.component_id=a.components)},P=e=>{},M=()=>{l.value.isbic=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}]},N=async()=>{try{const{data:e}=await re({url:"public/notaries-filters",method:"GET"}),d=e.map(c=>({value:c.id,name:c.name,city:c.city.name,province:c.province.name,district:c.district.name,address:c.address}));l.value.notary_id=d}catch(e){console.error("Error de red:",e)}},U=async()=>{w.value=!0;const e={economicsector_id:t.economicsector_id,comercialactivity_id:t.comercialactivity_id,component_id:t.component_id,theme_id:t.theme_id,modality_id:t.modality_id,ruc:t.ruc,city_id:t.city_id,province_id:t.province_id,district_id:t.district_id,observations:t.observations,updated_by:S.user_id};try{(await de({url:`advisory/update/${s.info.id}`,method:"PUT",data:e})).status===200&&(m(),T("closeDraw",!0))}catch(d){console.error("Error:",d);const c=document.getElementsByClassName("ant-drawer-body")[0];c&&(c.scrollTop=0)}finally{w.value=!1}},m=()=>{t.economicsector_id=null,t.comercialactivity_id=null,t.component_id=null,t.theme_id=null,t.modality_id=null,t.ruc=null,t.city_id=null,t.province_id=null,t.district_id=null,t.observations=null},o=async e=>{C.value=!0;try{e&&(await a.fetchEconomicSectors(),l.value.economicsector_id=a.economicSectors,t.economicsector_id=e.econimic_sector_id,await a.fetchComercialActivities(),l.value.comercialactivity_id=a.comercialActivities,t.comercialactivity_id=e.activity_comercial_id,await a.fetchComponents(),l.value.component_id=a.components,i.value.theme_id.disabled=!1,t.component_id=e.component_id,await a.fetchComponentThemes(t.component_id),l.value.theme_id=a.componentThemes,t.theme_id=e.theme_id,await a.fetchModalities(),l.value.modality_id=a.modalities,t.modality_id=e.modality_id,t.ruc=e.ruc,t.observations=e.observations,await a.fetchCities(),l.value.city_id=a.cities,t.city_id=e.city_id,await a.fetchProvinces(t.city_id),l.value.province_id=a.provinces,i.value.province_id.disabled=!1,t.province_id=e.province_id,await a.fetchDistricts(t.province_id),l.value.district_id=a.districts,i.value.district_id.disabled=!1,t.district_id=e.district_id)}catch(d){console.error("Error al cargar la información:",d)}finally{C.value=!1}};return G(()=>{s.info&&o(s.info)}),ce(()=>s.info,e=>{e&&o(e)}),Y("formState",t),Y("loadingState",w),(e,d)=>C.value?(p(),O(n($),{key:0,style:{color:"#00a6db"}})):(p(),b("div",Oe,[r(_e,{fields:i.value,options:l.value,btnSaveName:D.value,onHandleInputEvent:x,resetSelect:A.value,onHandleChangeSelect:z,onHandleFocusSelect:L,onHandleBlurSelect:P,onHandleChangeClock:R,onOnSubmit:U},null,8,["fields","options","btnSaveName","resetSelect"])]))}};export{Re as _,ze as a};
