import{P as X,g as ee,l as ae,u as te,r as f,a as oe,n as ne,b as m,o as r,d as k,e as h,t as se,i as p,c as d,B as u,w as _,F as E,h as w,m as D,f as re,v as le,s as i,K as ue,L as ie,R as de,j as I,p as ce,k as me}from"./index-8d6a1282.js";import"./es-8b9f291b.js";import{d as pe,g as _e,f as ve,o as be,h as ye}from"./selects-0563509c.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const ge={document_type:{type:"iSelect",label:"Tipo de documento",name:"document_type",required:!0,message:"Seleccionar tipo de documento",disabled:!0},document_number:{type:"iText",label:"Ingresar número",name:"document_number",required:!0,message:"Escribe número de documento",disabled:!1,max:8},last_name:{type:"iText",label:"Apellido paterno",name:"last_name",required:!0,message:"Escribe el apellido paterno"},middle_name:{type:"iText",label:"Apellido materno",name:"middle_name",required:!0,message:"Escribe el apellido materno"},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribe el nombre"},country_code:{type:"iSelectWrite",label:"País",name:"country_code",required:!0,message:"Seleccionar país"},email:{type:"iText",label:"Correo",name:"email",required:!0,email:"email",message:"Escribe el correo del usuario"},password:{type:"iPassword",label:"Contraseña",name:"password",required:!1,message:"Registra la contraseña"},office_code:{type:"iSelect",label:"Oficina",name:"office_code",required:!0,message:"Seleccionar un tipo"},sede_code:{type:"iSelect",label:"Sede donde labora",name:"sede_code",required:!0,message:"Seleccionar un tipo"},role:{type:"iSelect",label:"Tipo de usuario",name:"role",required:!0,message:"Seleccionar un tipo"},gender:{type:"iSelect",label:"Género",name:"gender",required:!1,message:"Seleccionar tipo de documento"}},he=[{value:"Subir archivo"},{value:"Mis archivos"}];const Se=S=>(ce("data-v-bf403cdd"),S=S(),me(),S),qe={key:1,class:"user"},Ue={class:"grid-item"},ke={class:"roles"},we=Se(()=>h("br",null,null,-1)),De="YYYY-MM-DD",xe={__name:"NuevoUsuarios",setup(S){X.locale("es");const x=ee.get("usuario"),q=ae(),F=te(),T=f(!0),U=f(!1),N=f([]),R=f([]),L=f(!1),A=f(!1),a=oe({nick_name:null,birthdate:null,gender:null,is_disabled:0,phone_number:null,document_type:1,document_number:null,last_name:null,middle_name:null,name:null,country_code:173,email:null,password:null,office_code:null,sede_code:1,role:null,created_by:x,updated_by:x}),O=()=>{a.document_type=1,a.document_number=null,a.last_name=null,a.middle_name=null,a.middle_name=null,a.name=null,a.country_code=173,a.email=null,a.password=null,a.office_code=null,a.sede_code=1,a.role=null},b=f({drive:[],usuarios:[],rutaDigital:[]}),g=f({rutaDigital:!1,usuarios:!1,drive:!1}),G=t=>{b.value[t].length>0?g.value[t]=!0:g.value[t]=!1},P=async t=>{const n=Object.fromEntries(Object.entries(b.value).filter(([v,l])=>l.length>0)),y={id_user:t,created_by:x,views:n,exclusions:null};try{const v=await w({url:"/permission",method:"POST",data:y});D.success(v.message),F.push("/admin/usuarios/lista")}catch{D.error("No se pudo registrar este usuario")}finally{U.value=!1}},V=async()=>{const t=a;U.value=!0;try{const n=await w({url:"/register-user",method:"POST",data:t});await P(n.user_id)}catch{D.error("No se pudo registrar este usuario")}finally{U.value=!1}},z=()=>{D.error("Debes de completar todos los espacios requeridos")},B=async t=>{console.log("Hello",t)},j=()=>{a.document_number=a.document_number.replace(/\D/g,"")},M=(t,n)=>{const y=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(y)},Y=async()=>{try{const{data:t}=await re({url:"/countries",method:"GET"});N.value=t}catch(t){console.error("Error de red:",t)}},W=async()=>{try{const{data:t}=await w({url:"/sedes",method:"GET"});R.value=t}catch(t){console.error("Error de red:",t)}},$=async()=>{var t,n,y,v,l,c;if(q.query.dni)try{const{data:s}=await w({url:`user/${q.query.dni}`,method:"GET"});a.document_number=s.document_number,A.value=!0,a.last_name=s.last_name,a.middle_name=s.middle_name,a.name=s.name,a.country_code=s.country_code,a.email=s.email,a.office_code=s.office_code,a.sede_code=s.sede_code,a.role=s.role,a.gender=s.gender,a.birthdate=s.birthdate,a.phone_number=s.phone_number,b.value=s.permission,((n=(t=b.value)==null?void 0:t.drive)==null?void 0:n.length)>=1&&(g.value.drive=!0),((v=(y=b.value)==null?void 0:y.usuarios)==null?void 0:v.length)>=1&&(g.value.usuarios=!0),((c=(l=b.value)==null?void 0:l.rutaDigital)==null?void 0:c.length)>=1&&(g.value.rutaDigital=!0),T.value=!1}catch(s){console.error("Error de red:",s)}else O(),T.value=!1};return ne(()=>{Y(),W(),$()}),(t,n)=>{const y=m("a-divider"),v=m("a-spin"),l=m("a-select"),c=m("a-form-item"),s=m("a-input-search"),C=m("a-input"),H=m("a-date-picker"),K=m("a-button"),Z=m("a-form"),J=m("a-checkbox");return r(),k(E,null,[h("h3",null,se(p(q).query.dni?"ACTUALIZAR":"REGISTRO DE")+" USUARIO",1),d(y),T.value?(r(),u(v,{key:0})):(r(),k("div",qe,[d(Z,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:V,onFinishFailed:z},{default:_(()=>[h("div",Ue,[(r(!0),k(E,null,le(p(ge),(e,Q)=>(r(),k(E,{key:Q},[e.type==="iSelect"?(r(),u(c,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[e.name=="document_type"?(r(),u(l,{key:0,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:p(pe),disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),e.name=="gender"?(r(),u(l,{key:1,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:p(_e)},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="isDisabled"?(r(),u(l,{key:2,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:p(ve)},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="office_code"?(r(),u(l,{key:3,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:p(be)},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="sede_code"?(r(),u(l,{key:4,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:R.value},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="role"?(r(),u(l,{key:5,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,options:p(ye)},null,8,["value","onUpdate:value","options"])):i("",!0)]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iSearch"?(r(),u(c,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message,max:e.max}]},{default:_(()=>[d(s,{maxlength:15,loading:L.value,value:a[e.name],"onUpdate:value":o=>a[e.name]=o,onSearch:B,onInput:j,disabled:A.value},null,8,["loading","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iText"?(r(),u(c,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:_(()=>[d(C,{value:a[e.name],"onUpdate:value":o=>a[e.name]=o},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iPassword"?ue((r(),u(c,{key:3,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[d(C,{value:a[e.name],"onUpdate:value":o=>a[e.name]=o},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])),[[ie,!p(q).query.dni]]):i("",!0),e.type==="iSelectWrite"?(r(),u(c,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[d(l,{value:a[e.name],"onUpdate:value":o=>a[e.name]=o,"show-search":"",options:N.value,"filter-option":M},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iDate"?(r(),u(c,{key:5,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[d(H,{locale:p(de),value:a.birthdate,"onUpdate:value":n[0]||(n[0]=o=>a.birthdate=o),style:{width:"100%"},format:De},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):i("",!0)],64))),128))]),d(c,null,{default:_(()=>[d(K,{type:"primary","html-type":"submit",loading:U.value},{default:_(()=>[I("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),h("section",ke,[h("div",null,[d(J,{checked:g.value.drive,"onUpdate:checked":n[1]||(n[1]=e=>g.value.drive=e)},{default:_(()=>[I("Drive")]),_:1},8,["checked"]),d(l,{value:b.value.drive,"onUpdate:value":n[2]||(n[2]=e=>b.value.drive=e),mode:"multiple",style:{width:"100%"},placeholder:"Agrega vistas para este usuario",onChange:n[3]||(n[3]=e=>G("drive")),options:p(he)},null,8,["value","options"])]),we])]))],64)}}},Ae=fe(xe,[["__scopeId","data-v-bf403cdd"]]);export{Ae as default};
