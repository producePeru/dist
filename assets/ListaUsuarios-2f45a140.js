import{L as be,r as c,a as H,b as i,o as n,q as k,w as o,e as C,d as x,F as U,x as we,h as z,s as r,c as s,M as xe,t as h,i as m,z as B,m as G,k as ce,K as ue,v as Ue,I as Ce,J as Ie,N as Se}from"./index-3f8df86a.js";import{u as pe}from"./selectes-de5ace00.js";import{f as De}from"./actualizarUsuario-3eaca126.js";import"./es-6ef31301.js";import{_ as Ae}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Ee}from"./MoreOutlined-fc7ade7c.js";const $e={class:"grid-profile"},Le="YYYY-MM-DD",Oe={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(M,{emit:N}){be.locale("es");const a=pe(),P=JSON.parse(localStorage.getItem("profile")),A=N;a.$patch({genders:a.genders}),a.$patch({cdes:a.cdes}),a.$patch({Offices:a.Offices}),a.$patch({roles:a.roles}),a.$patch({supervisores:a.supervisores}),a.fetchGenders(),a.fetchCdes(),a.fetchOffices(),a.fetchRoles();const S=M,I=c(!1),d=c(De),L=c(null),t=H({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:P.id}),$=l=>{l&&(t.name=l.profile.name,t.lastname=l.profile.lastname,t.middlename=l.profile.middlename,t.birthday=l.profile.birthday,t.sick=l.profile.sick,t.phone=l.profile.phone,t.gender_id=l.profile.gender_id,t.cde_id=l.profile.cde_id,t.office_id=l.profile.office_id,t.email=l.email)},p=l=>{const D={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(l===2)a.fetchSupervisores(),d.value={...d.value,supervisor_id:D};else{const{supervisor_id:y,...E}=d.value;d.value=E}},b=async()=>{I.value=!0;let l=t;delete l.email;try{const D=await B({url:`user/update/${S.updateUser.profile.id}`,method:"PUT",data:l});G.success(D.message),A("closeDraw",!0)}catch{G.error("No se pudo registrar este usuario")}finally{I.value=!1}},q=()=>{G.error("Debes de completar todos los espacios requeridos")};return(l,D)=>{const y=i("a-select"),E=i("a-form-item"),O=i("a-input"),T=i("a-date-picker"),Y=i("a-button"),j=i("a-form");return n(),k(j,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:b,onFinishFailed:q},{default:o(()=>[C("div",$e,[(n(!0),x(U,null,we(d.value,(e,R)=>(n(),x(U,{key:R},[e.type==="iSelect"?(n(),k(E,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[e.name=="gender_id"?(n(),k(y,{key:0,value:t[e.name],"onUpdate:value":v=>t[e.name]=v,options:z(a).genders},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="cde_id"?(n(),k(y,{key:1,value:t[e.name],"onUpdate:value":v=>t[e.name]=v,options:z(a).cdes},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="office_id"?(n(),k(y,{key:2,value:t[e.name],"onUpdate:value":v=>t[e.name]=v,options:z(a).Offices},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="role_id"?(n(),k(y,{key:3,value:t[e.name],"onUpdate:value":v=>t[e.name]=v,options:z(a).roles,onChange:p},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="supervisor_id"?(n(),k(y,{key:4,value:t[e.name],"onUpdate:value":v=>t[e.name]=v,options:z(a).supervisores},null,8,["value","onUpdate:value","options"])):r("",!0)]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iText"?(n(),k(E,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:o(()=>[s(O,{value:t[e.name],"onUpdate:value":v=>t[e.name]=v,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iDate"?(n(),k(E,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[s(T,{locale:z(xe),value:L.value,"onUpdate:value":D[0]||(D[0]=v=>L.value=v),style:{width:"100%"},format:Le},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):r("",!0)],64))),128))]),C("div",null,h($(S.updateUser)),1),s(E,null,{default:o(()=>[s(Y,{class:"btn-produce",type:"primary","html-type":"submit",loading:I.value},{default:o(()=>[m("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},Re=Ae(Oe,[["__scopeId","data-v-3578053d"]]),ze=C("br",null,null,-1),Ne=C("br",null,null,-1),qe={__name:"DrawAdministrarVistasUsuario",props:["idUser"],emits:["closeDraw"],setup(M,{emit:N}){const a=M,P=N,A=c(!0),S=c(!1),I=["home","asesorias","planes-accion","asesorias-formalizaciones","solicitudes","solicitantes","notarias","asesores","supervisores","usuarios","usuarios-nuevo","usuarios-lista","drive-mis-archivos","drive-subir-archivo","drive-mis-carpetas","convenios","estado-convenio","configuraciones","tokens"];ce(()=>{a.idUser&&$(a.idUser)});const d=H({indeterminate:!0,checkAll:!1,checkedList:[]}),L=p=>{Object.assign(d,{checkedList:p.target.checked?I:[],indeterminate:!1})};ue(()=>d.checkedList,p=>{d.indeterminate=!!p.length&&p.length<I.length,d.checkAll=p.length===I.length}),ue(()=>a.idUser,p=>{p&&$()});const t=async()=>{S.value=!0;const p={views:d.checkedList};try{const b=await B({url:`user/views/${a.idUser.id}`,method:"PUT",data:p});if(b.status==403)return G.error(b.message);G.success(b.message),P("closeDraw",!0)}catch{G.error("No se pudo registrar este usuario")}finally{S.value=!1}},$=async()=>{A.value=!0;try{const{data:p}=await B({url:`user/views/${a.idUser.id}`,method:"GET"});d.checkedList=p}catch(p){console.log("Error",p)}finally{A.value=!1}};return(p,b)=>{const q=i("a-checkbox"),l=i("a-divider"),D=i("a-checkbox-group"),y=i("a-spin"),E=i("a-button");return n(),x(U,null,[C("div",null,[s(q,{checked:d.checkAll,"onUpdate:checked":b[0]||(b[0]=O=>d.checkAll=O),indeterminate:d.indeterminate,onChange:L},{default:o(()=>[m(h(d.checkAll?"Desactivar":"Activar")+" todos ",1)]),_:1},8,["checked","indeterminate"])]),s(l),s(y,{spinning:A.value},{default:o(()=>[s(D,{value:d.checkedList,"onUpdate:value":b[1]||(b[1]=O=>d.checkedList=O),options:I,style:{display:"grid","grid-template-columns":"repeat(2,1fr)",gap:".5rem"}},null,8,["value"])]),_:1},8,["spinning"]),ze,Ne,s(E,{type:"primary","html-type":"submit",loading:S.value,onClick:t},{default:o(()=>[m("GUARDAR")]),_:1},8,["loading"])],64)}}};const Fe=C("h3",{class:"title-produce"},"USUARIOS DEL PROGRAMA PNTE",-1),Ge=["onClick"],Pe=["onClick"],Ve={class:"paginator"},Je={__name:"ListaUsuarios",setup(M){const N=pe();N.$patch({cdes:N.cdes});const a=c(!1),P=g=>{console.log("open",g)},A=c(null);c(!1),c(!1),c(!1);const S=c(!1);c(0);const I=c(50),d=c([]),L=c(!1),t=c(0),$=c({page:0}),p=c("user/list"),b=c(1200),q=c(window.innerHeight-100),l=()=>{q.value=window.innerHeight-300};Ue(()=>{window.removeEventListener("resize",l)});const D=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:80},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Fecha Nac.",dataIndex:"birthday",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"ROL",dataIndex:"role",width:160},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],y=H({search:""}),E=()=>{let g={search:y.search};R(g)},O=()=>{y.search||R()},T=()=>{R(),a.value=!1,S.value=!1},Y=g=>{$.value.page=g,R()},j=g=>{A.value=g,a.value=!0},e=g=>{A.value=g,S.value=!0},R=async g=>{try{L.value=!0;let f;f=$.value.page==0?"":$.value,f=g?{...f,...g}:f;const{data:F}=await B({url:p.value,method:"GET",params:f});d.value=F.data,t.value=F.total,I.value=F.per_page}catch(f){console.error("Error de red:",f)}finally{L.value=!1}},v=Ce(()=>g=>$.value.page*I.value+g+1);return ce(()=>{R(),window.addEventListener("resize",l),l()}),(g,f)=>{const F=i("a-col"),me=i("a-input"),J=i("a-button"),fe=i("a-input-group"),_e=i("a-row"),V=i("a-tag"),K=i("a-menu-item"),he=i("a-menu"),ve=i("a-dropdown"),ge=i("a-table"),ye=i("a-pagination"),X=i("a-drawer");return n(),x(U,null,[C("div",null,[Fe,s(_e,{style:{margin:"1rem 0"}},{default:o(()=>[s(F,{xs:24,md:12,lg:18}),s(F,{xs:24,md:12,lg:6},{default:o(()=>[s(fe,{compact:""},{default:o(()=>[s(me,{value:y.search,"onUpdate:value":f[0]||(f[0]=_=>y.search=_),style:{width:"calc(100% - 80px)"},onInput:O},null,8,["value"]),s(J,{type:"primary",disabled:y.search==="",onClick:E},{default:o(()=>[m("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),s(ge,{bordered:"",scroll:{x:b.value,y:q.value},class:"table-users",columns:D,"data-source":d.value,pagination:!1,loading:L.value,size:"small"},{bodyCell:o(({column:_,record:u,index:ke})=>{var Q,W,Z,ee,ae,te,ne,oe,se,le,ie,re,de;return[_.dataIndex=="idx"?(n(),x(U,{key:0},[m(h(v.value(ke)),1)],64)):r("",!0),_.dataIndex=="documentnumber"?(n(),x(U,{key:1},[m(h((Q=u.profile)==null?void 0:Q.documentnumber),1)],64)):r("",!0),_.dataIndex=="name"?(n(),x(U,{key:2},[m(h((W=u.profile)==null?void 0:W.name),1)],64)):r("",!0),_.dataIndex=="lastname"?(n(),x(U,{key:3},[m(h((Z=u.profile)==null?void 0:Z.lastname)+" "+h((ee=u.profile)==null?void 0:ee.middlename),1)],64)):r("",!0),_.dataIndex=="phone"?(n(),x(U,{key:4},[m(h((ae=u.profile)!=null&&ae.phone?(te=u.profile)==null?void 0:te.phone:"ðŸ”’"),1)],64)):r("",!0),_.dataIndex=="birthday"?(n(),x(U,{key:5},[m(h((ne=u.profile)!=null&&ne.birthday?(oe=u.profile)==null?void 0:oe.birthday:"ðŸ”’"),1)],64)):r("",!0),_.dataIndex=="office"?(n(),x(U,{key:6},[((se=u.profile)==null?void 0:se.office.name)=="UGSE"?(n(),k(V,{key:0,color:"blue"},{default:o(()=>{var w;return[m(h((w=u.profile)==null?void 0:w.office.name),1)]}),_:2},1024)):r("",!0),((le=u.profile)==null?void 0:le.office.name)=="UGO"?(n(),k(V,{key:1,color:"orange"},{default:o(()=>{var w;return[m(h((w=u.profile)==null?void 0:w.office.name),1)]}),_:2},1024)):r("",!0),((ie=u.profile)==null?void 0:ie.office.name)=="DE"?(n(),k(V,{key:2,color:"green"},{default:o(()=>{var w;return[m(h((w=u.profile)==null?void 0:w.office.name),1)]}),_:2},1024)):r("",!0),((re=u.profile)==null?void 0:re.office.name)=="UGEER"?(n(),k(V,{key:3,color:"gray"},{default:o(()=>{var w;return[m(h((w=u.profile)==null?void 0:w.office.name),1)]}),_:2},1024)):r("",!0)],64)):r("",!0),_.dataIndex=="cde"?(n(),x(U,{key:7},[m(h((de=u.profile)==null?void 0:de.cde.name),1)],64)):r("",!0),_.dataIndex=="role"?(n(),x(U,{key:8},[m(h(u.roles[0].name),1)],64)):r("",!0),_.dataIndex=="actions"?(n(),k(ve,{key:9,trigger:["click"]},{overlay:o(()=>[s(he,null,{default:o(()=>[s(K,null,{default:o(()=>[C("a",{onClick:w=>j(u)},"Editar",8,Ge)]),_:2},1024),s(K,null,{default:o(()=>[C("a",{onClick:w=>e(u)},"Vistas",8,Pe)]),_:2},1024)]),_:2},1024)]),default:o(()=>[C("a",{class:"ant-dropdown-link",onClick:f[1]||(f[1]=Ie(()=>{},["prevent"]))},[s(J,{shape:"circle",icon:Se(z(Ee)),size:"small"},null,8,["icon"])])]),_:2},1024)):r("",!0)]}),_:1},8,["scroll","data-source","loading"])]),C("div",Ve,[C("span",null,[s(V,{color:"blue"},{default:o(()=>[C("b",null,h(t.value),1)]),_:1}),m("Usuarios")]),s(ye,{size:"small",total:t.value,pageSize:I.value,onChange:Y,showSizeChanger:!1},null,8,["total","pageSize"])]),s(X,{width:"550",open:a.value,"onUpdate:open":f[2]||(f[2]=_=>a.value=_),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:P},{default:o(()=>[s(Re,{updateUser:A.value,onCloseDraw:T},null,8,["updateUser"])]),_:1},8,["open"]),s(X,{width:"450",open:S.value,"onUpdate:open":f[3]||(f[3]=_=>S.value=_),class:"draw-notary",title:"Administrar Vistas",placement:"right"},{default:o(()=>[s(qe,{idUser:A.value,onCloseDraw:T},null,8,["idUser"])]),_:1},8,["open"])],64)}}};export{Je as default};
