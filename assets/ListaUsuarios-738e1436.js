import{L as ye,r as h,a as H,b as r,o,q as v,w as s,e as x,d as b,F as w,x as ke,h as N,s as u,c as l,M as be,t as _,i as m,z as T,m as P,k as ce,K as ue,I as we,J as xe,N as Ue}from"./index-c45e0ab0.js";import{f as Ce}from"./actualizarUsuario-3eaca126.js";import{u as Ie}from"./selectes-4c8debd6.js";import"./es-9f6813cd.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";import{M as De}from"./MoreOutlined-c204d566.js";const Ae={class:"grid-profile"},Ee="YYYY-MM-DD",Oe={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(V,{emit:O}){ye.locale("es");const a=Ie(),$=JSON.parse(localStorage.getItem("profile")),D=O;a.$patch({genders:a.genders}),a.$patch({cdes:a.cdes}),a.$patch({Offices:a.Offices}),a.$patch({roles:a.roles}),a.$patch({supervisores:a.supervisores}),a.fetchGenders(),a.fetchCdes(),a.fetchOffices(),a.fetchRoles();const A=V,U=h(!1),d=h(Ce),E=h(null),t=H({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:$.id}),z=i=>{i&&(t.name=i.profile.name,t.lastname=i.profile.lastname,t.middlename=i.profile.middlename,t.birthday=i.profile.birthday,t.sick=i.profile.sick,t.phone=i.profile.phone,t.gender_id=i.profile.gender_id,t.cde_id=i.profile.cde_id,t.office_id=i.profile.office_id,t.email=i.email)},p=i=>{const C={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(i===2)a.fetchSupervisores(),d.value={...d.value,supervisor_id:C};else{const{supervisor_id:S,...I}=d.value;d.value=I}},g=async()=>{U.value=!0;let i=t;delete i.email;try{const C=await T({url:`user/update/${A.updateUser.profile.id}`,method:"PUT",data:i});P.success(C.message),D("closeDraw",!0)}catch{P.error("No se pudo registrar este usuario")}finally{U.value=!1}},q=()=>{P.error("Debes de completar todos los espacios requeridos")};return(i,C)=>{const S=r("a-select"),I=r("a-form-item"),L=r("a-input"),B=r("a-date-picker"),Y=r("a-button"),R=r("a-form");return o(),v(R,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:g,onFinishFailed:q},{default:s(()=>[x("div",Ae,[(o(!0),b(w,null,ke(d.value,(e,j)=>(o(),b(w,{key:j},[e.type==="iSelect"?(o(),v(I,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[e.name=="gender_id"?(o(),v(S,{key:0,value:t[e.name],"onUpdate:value":n=>t[e.name]=n,options:N(a).genders},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="cde_id"?(o(),v(S,{key:1,value:t[e.name],"onUpdate:value":n=>t[e.name]=n,options:N(a).cdes},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="office_id"?(o(),v(S,{key:2,value:t[e.name],"onUpdate:value":n=>t[e.name]=n,options:N(a).Offices},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="role_id"?(o(),v(S,{key:3,value:t[e.name],"onUpdate:value":n=>t[e.name]=n,options:N(a).roles,onChange:p},null,8,["value","onUpdate:value","options"])):u("",!0),e.name=="supervisor_id"?(o(),v(S,{key:4,value:t[e.name],"onUpdate:value":n=>t[e.name]=n,options:N(a).supervisores},null,8,["value","onUpdate:value","options"])):u("",!0)]),_:2},1032,["name","label","rules"])):u("",!0),e.type==="iText"?(o(),v(I,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:s(()=>[l(L,{value:t[e.name],"onUpdate:value":n=>t[e.name]=n,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):u("",!0),e.type==="iDate"?(o(),v(I,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[l(B,{locale:N(be),value:E.value,"onUpdate:value":C[0]||(C[0]=n=>E.value=n),style:{width:"100%"},format:Ee},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):u("",!0)],64))),128))]),x("div",null,_(z(A.updateUser)),1),l(I,null,{default:s(()=>[l(Y,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:s(()=>[m("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},$e=Se(Oe,[["__scopeId","data-v-3578053d"]]),Le=x("br",null,null,-1),Re=x("br",null,null,-1),Ne={__name:"DrawAdministrarVistasUsuario",props:["idUser"],emits:["closeDraw"],setup(V,{emit:O}){const a=V,$=O,D=h(!0),A=h(!1),U=["home","asesorias","planes-accion","asesorias-formalizaciones","solicitudes","solicitantes","notarias","asesores","supervisores","usuarios","usuarios-nuevo","usuarios-lista","drive-mis-archivos","drive-subir-archivo","drive-mis-carpetas","convenios","estado-convenio","configuraciones","tokens"];ce(()=>{a.idUser&&z(a.idUser)});const d=H({indeterminate:!0,checkAll:!1,checkedList:[]}),E=p=>{Object.assign(d,{checkedList:p.target.checked?U:[],indeterminate:!1})};ue(()=>d.checkedList,p=>{d.indeterminate=!!p.length&&p.length<U.length,d.checkAll=p.length===U.length}),ue(()=>a.idUser,p=>{p&&z()});const t=async()=>{A.value=!0;const p={views:d.checkedList};try{const g=await T({url:`user/views/${a.idUser.id}`,method:"PUT",data:p});if(g.status==403)return P.error(g.message);P.success(g.message),$("closeDraw",!0)}catch{P.error("No se pudo registrar este usuario")}finally{A.value=!1}},z=async()=>{D.value=!0;try{const{data:p}=await T({url:`user/views/${a.idUser.id}`,method:"GET"});d.checkedList=p}catch(p){console.log("Error",p)}finally{D.value=!1}};return(p,g)=>{const q=r("a-checkbox"),i=r("a-divider"),C=r("a-checkbox-group"),S=r("a-spin"),I=r("a-button");return o(),b(w,null,[x("div",null,[l(q,{checked:d.checkAll,"onUpdate:checked":g[0]||(g[0]=L=>d.checkAll=L),indeterminate:d.indeterminate,onChange:E},{default:s(()=>[m(_(d.checkAll?"Desactivar":"Activar")+" todos ",1)]),_:1},8,["checked","indeterminate"])]),l(i),l(S,{spinning:D.value},{default:s(()=>[l(C,{value:d.checkedList,"onUpdate:value":g[1]||(g[1]=L=>d.checkedList=L),options:U,style:{display:"grid","grid-template-columns":"repeat(2,1fr)",gap:".5rem"}},null,8,["value"])]),_:1},8,["spinning"]),Le,Re,l(I,{type:"primary","html-type":"submit",loading:A.value,onClick:t},{default:s(()=>[m("GUARDAR")]),_:1},8,["loading"])],64)}}};const ze=x("h3",{class:"title-produce"},"USUARIOS DEL PROGRAMA PNTE",-1),qe=["onClick"],Pe=["onClick"],Fe={class:"paginator"},je={__name:"ListaUsuarios",setup(V){const O=h(null),a=h(!1),$=h(!1),D=h(50),A=h([]),U=h(!1),d=h(0),E=h({page:1}),t=h("user/list"),z=h(1200),p=h(window.innerHeight-100),g=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:80},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Fecha Nac.",dataIndex:"birthday",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"ROL",dataIndex:"role",width:160},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],q=()=>{p.value=window.innerHeight-300},i=H({search:""}),C=()=>{let n={search:i.search};R(n)},S=()=>{i.search||R()},I=()=>{R(),a.value=!1,$.value=!1},L=n=>{E.value.page=n,R()},B=n=>{O.value=n,a.value=!0},Y=n=>{O.value=n,$.value=!0},R=async n=>{try{U.value=!0;const y=E.value.page===1?"":E.value,M=n?{...y,...n}:y,{data:F}=await T({url:t.value,method:"GET",params:M});A.value=F.data,d.value=F.total,D.value=F.per_page}catch(y){console.error("Error de red:",y)}finally{U.value=!1}},e=we(()=>n=>(E.value.page-1)*D.value+n+1);ce(()=>{R(),window.addEventListener("resize",q),q()});const j=()=>{console.log("Drawer state changed")};return(n,y)=>{const M=r("a-col"),F=r("a-input"),J=r("a-button"),pe=r("a-input-group"),me=r("a-row"),G=r("a-tag"),K=r("a-menu-item"),fe=r("a-menu"),_e=r("a-dropdown"),he=r("a-table"),ve=r("a-pagination"),X=r("a-drawer");return o(),b(w,null,[x("div",null,[ze,l(me,{style:{margin:"1rem 0"}},{default:s(()=>[l(M,{xs:24,md:12,lg:18}),l(M,{xs:24,md:12,lg:6},{default:s(()=>[l(pe,{compact:""},{default:s(()=>[l(F,{value:i.search,"onUpdate:value":y[0]||(y[0]=f=>i.search=f),style:{width:"calc(100% - 80px)"},onInput:S},null,8,["value"]),l(J,{type:"primary",disabled:i.search==="",onClick:C},{default:s(()=>[m("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),l(he,{bordered:"",scroll:{x:z.value,y:p.value},class:"table-users",columns:g,"data-source":A.value,pagination:!1,loading:U.value,size:"small"},{bodyCell:s(({column:f,record:c,index:ge})=>{var Q,W,Z,ee,ae,te,ne,oe,se,le,ie,re,de;return[f.dataIndex==="idx"?(o(),b(w,{key:0},[m(_(e.value(ge)),1)],64)):u("",!0),f.dataIndex=="documentnumber"?(o(),b(w,{key:1},[m(_((Q=c.profile)==null?void 0:Q.documentnumber),1)],64)):u("",!0),f.dataIndex=="name"?(o(),b(w,{key:2},[m(_((W=c.profile)==null?void 0:W.name),1)],64)):u("",!0),f.dataIndex=="lastname"?(o(),b(w,{key:3},[m(_((Z=c.profile)==null?void 0:Z.lastname)+" "+_((ee=c.profile)==null?void 0:ee.middlename),1)],64)):u("",!0),f.dataIndex=="phone"?(o(),b(w,{key:4},[m(_((ae=c.profile)!=null&&ae.phone?(te=c.profile)==null?void 0:te.phone:"ðŸ”’"),1)],64)):u("",!0),f.dataIndex=="birthday"?(o(),b(w,{key:5},[m(_((ne=c.profile)!=null&&ne.birthday?(oe=c.profile)==null?void 0:oe.birthday:"ðŸ”’"),1)],64)):u("",!0),f.dataIndex=="office"?(o(),b(w,{key:6},[((se=c.profile)==null?void 0:se.office.name)=="UGSE"?(o(),v(G,{key:0,color:"blue"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):u("",!0),((le=c.profile)==null?void 0:le.office.name)=="UGO"?(o(),v(G,{key:1,color:"orange"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):u("",!0),((ie=c.profile)==null?void 0:ie.office.name)=="DE"?(o(),v(G,{key:2,color:"green"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):u("",!0),((re=c.profile)==null?void 0:re.office.name)=="UGEER"?(o(),v(G,{key:3,color:"gray"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):u("",!0)],64)):u("",!0),f.dataIndex=="cde"?(o(),b(w,{key:7},[m(_((de=c.profile)==null?void 0:de.cde.name),1)],64)):u("",!0),f.dataIndex=="role"?(o(),b(w,{key:8},[m(_(c.roles[0].name),1)],64)):u("",!0),f.dataIndex=="actions"?(o(),v(_e,{key:9,trigger:["click"]},{overlay:s(()=>[l(fe,null,{default:s(()=>[l(K,null,{default:s(()=>[x("a",{onClick:k=>B(c)},"Editar",8,qe)]),_:2},1024),l(K,null,{default:s(()=>[x("a",{onClick:k=>Y(c)},"Vistas",8,Pe)]),_:2},1024)]),_:2},1024)]),default:s(()=>[x("a",{class:"ant-dropdown-link",onClick:y[1]||(y[1]=xe(()=>{},["prevent"]))},[l(J,{shape:"circle",icon:Ue(N(De)),size:"small"},null,8,["icon"])])]),_:2},1024)):u("",!0)]}),_:1},8,["scroll","data-source","loading"])]),x("div",Fe,[x("span",null,[l(G,{color:"blue"},{default:s(()=>[x("b",null,_(d.value),1)]),_:1}),m("Usuarios")]),l(ve,{size:"small",total:d.value,pageSize:D.value,onChange:L,showSizeChanger:!1},null,8,["total","pageSize"])]),l(X,{width:"550",open:a.value,"onUpdate:open":y[2]||(y[2]=f=>a.value=f),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:j},{default:s(()=>[l($e,{updateUser:O.value,onCloseDraw:I},null,8,["updateUser"])]),_:1},8,["open"]),l(X,{width:"450",open:$.value,"onUpdate:open":y[3]||(y[3]=f=>$.value=f),class:"draw-notary",title:"Administrar Vistas",placement:"right"},{default:s(()=>[l(Ne,{idUser:O.value,onCloseDraw:I},null,8,["idUser"])]),_:1},8,["open"])],64)}}};export{je as default};
