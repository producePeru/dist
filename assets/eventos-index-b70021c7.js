import{r as s,a as Z,p as E,k as ee,X as g,b as i,o as Y,d as te,c as n,w as l,m as x,f as ae,e as d,s as oe,i as C,y as ne,a1 as le,z as re,O as se,j as ie,a2 as ce,h as y}from"./index-b7079dd1.js";import{_ as de}from"./TableComponent-429ef20b.js";import{_ as ue}from"./EventosUgo-165253b9.js";import{d as S}from"./downloadExcel-01235e87.js";import{g as pe}from"./usePermissions-c853c3d0.js";import"./es-ff465591.js";import{g as N,a as me}from"./publicInscripcion-ebc9ecb9.js";import{F as fe}from"./FileExcelOutlined-8fceb3aa.js";import"./icoexcel-1b303edf.js";import"./selectes-ea112819.js";import"./MoreOutlined-48c3fdeb.js";const ve={class:"layout-content"},_e={class:"filter-asesor",style:{width:"280px"}},ye=["onClick"],he=["onClick"],we=["onClick"],Te={__name:"eventos-index",setup(Ee){const I=s([]),D=s(0),b=s(150),h=s({}),m=s(!1),w=s(!1),_=s(null),u=s(!1),k=s([]),a=Z({year:E("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),A=[{title:"",dataIndex:"copy",fixed:"left",width:50},{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],O=(e,t)=>{const o=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(o)};async function T(e,t){const o=R(e,t);await $(o)?y.success("Link copiado"):y.error("No se pudo copiar el link")}function R(e,t){return e===3?`${N()}/fortalece-tu-mercado/${t}`:`${me()}/asistencias/${t}`}async function $(e){var t;try{if((t=navigator.clipboard)!=null&&t.writeText)return await navigator.clipboard.writeText(e),!0;const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),o.select();const f=document.execCommand("copy");return document.body.removeChild(o),f}catch{return!1}}const F=s([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]);function L(e,t){if(e==3){const o=`${N()}/fortalece-tu-mercado/${t}`;window.open(o,"_blank")}else{const o=`/asistencias/${t}`;window.open(o,"_blank")}}const U=e=>{_.value=e,m.value=!0},V=()=>{c(),m.value=!1},M=()=>{_.value=null,m.value=!0},z=async e=>{try{const t=await x({url:`attendance/delete/${e.id}`,method:"DELETE"});t.status==200&&(c(),y.success(t.message))}catch(t){console.error("Error de red:",t)}},G=async e=>{try{const t=await x({url:`attendance/event-finally/${e.id}`,method:"PUT"});t.status==200&&(c(),y.success(t.message))}catch(t){console.error("Error de red:",t)}},P=async()=>{u.value=!0;try{const e={};a.year&&(e.year=E(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor),await S("download/attendance-ugo","Eventos-UGO",e)}catch(e){console.error("Error de red:",e)}finally{u.value=!1}},B=async()=>{u.value=!0;try{await S("download/all-activities-the-year","Actividades-UGO-2025")}catch(e){console.error("Error de red:",e)}finally{u.value=!1}},H=async e=>{a.page=e,await c()},j=async e=>{e&&(a.page=1,await c())},c=async()=>{try{w.value=!0;const e={page:a.page};a.year&&(e.year=E(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor);const o=await x({url:"events-ugo/list",method:"GET",params:e});I.value=o.data.data,D.value=o.data.total,b.value=o.data.per_page}catch(e){console.error("Error de red:",e)}finally{w.value=!1}},q=async()=>{try{const e=await ae({url:"select/asesores",method:"GET"});e.status==200&&(k.value=e.data)}catch{console.log("Failed to delete")}};return ee(async()=>{var e;h.value=await pe("eventos-ugo"),(e=h.value)!=null&&e.can_view_all&&(await c(),await q())}),g("search",a),g("loading",w),g("loadingFile",u),(e,t)=>{const o=i("a-button"),f=i("a-select"),Q=i("a-tooltip"),X=i("a-input-group"),v=i("a-menu-item"),J=i("router-link"),K=i("a-popconfirm"),W=i("a-drawer");return Y(),te("div",ve,[n(de,{title:"LISTA EVENTOS UGO",textNuevo:"NUEVO EVENTO",new:!0,searchYear:!0,rangeDate:!0,btnUpdate:!0,btnImport:!0,downloadExcel:!0,placeholderSearch:"Buscar",columns:A,othersList:F.value,titleSearch:"BUSCAR POR EVENTO",pageSize:b.value,nameTotal:"Eventos UGO",dataSource:I.value,total:D.value,onHandleNew:M,onHandleDownloadExcel:P,onHandleSearch:j,permisos:h.value,onHandleCallFetchData:c,onHandlePaginator:H},{header:l(()=>[d("div",null,[n(o,{loading:u.value,type:"text",icon:oe(C(fe)),onClick:B},null,8,["loading","icon"])]),d("div",_e,[t[2]||(t[2]=d("small",null,"POR ASESOR",-1)),n(f,{allowClear:!0,value:a.asesor,"onUpdate:value":t[0]||(t[0]=r=>a.asesor=r),placeholder:"Selecciona Asesor","show-search":"",options:k.value,"filter-option":O},null,8,["value","options"])])]),"data-cell":l(({column:r,record:p})=>[r.dataIndex=="copy"?(Y(),ne(X,{key:0,compact:""},{default:l(()=>[n(Q,{title:"copiar link"},{default:l(()=>[n(o,{type:"text",onClick:ge=>T(p.eventsoffice_id,p.slug)},{icon:l(()=>[n(C(le),{style:{"font-size":"11px"}})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):re("",!0)]),"custom-options":l(({record:r})=>[n(v,null,{default:l(()=>[d("a",{href:"#",onClick:se(p=>L(r.eventsoffice_id,r.slug),["prevent"])}," Ver Link ",8,ye)]),_:2},1024),n(v,null,{default:l(()=>[n(J,{to:`eventos-inscritos/${r.slug}`},{default:l(()=>t[3]||(t[3]=[ie("Inscritos")])),_:2},1032,["to"])]),_:2},1024),n(v,null,{default:l(()=>[d("a",{onClick:p=>U(r)},"Editar",8,he)]),_:2},1024),n(v,null,{default:l(()=>[d("span",{style:{color:"#ff4d4f"},onClick:p=>G(r)},"Finalizar",8,we)]),_:2},1024),n(v,null,{default:l(()=>[n(K,{placement:"rightBottom",title:`¿Quieres eliminar ${r.title} ?`,onConfirm:p=>z(r)},{icon:l(()=>[n(C(ce),{style:{color:"red"}})]),default:l(()=>[t[4]||(t[4]=d("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["othersList","pageSize","dataSource","total","permisos"]),n(W,{open:m.value,"onUpdate:open":t[1]||(t[1]=r=>m.value=r),title:_.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:l(()=>[n(ue,{onCloseDraw:V,dataRow:_.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{Te as default};
