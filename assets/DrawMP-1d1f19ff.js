import{_ as q}from"./FormComponent-0ecdcdc5.js";import{u as R}from"./selectes-4cbab4f8.js";import{U as H}from"./UpImage-a0b64055.js";import{p as r,r as c,a as M,k as x,T as w,W as y,o as u,y as V,i as P,L as F,d as E,c as b,w as U,z as B,m as j,h as G}from"./index-4d8c910a.js";import"./es-e28260b3.js";import{u as z,t as K}from"./timezone-53ea1625.js";const Z={key:1,class:"mp"},$={key:0},ie={__name:"DrawMP",props:["info"],emits:["closeDraw"],setup(f,{emit:g}){r.locale("es"),r.extend(z),r.extend(K);const t=c({title:{type:"iText",label:"NOMBRE DEL EVENTO",name:"title",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},component:{type:"iSelect",label:"TIPO DE COMPONENTE",name:"component",required:!0,message:"Seleccionar tipo de Componente",disabled:!1},capacitador_id:{type:"iSelect",label:"CAPACITADOR",name:"capacitador_id",required:!0,message:"Seleccionar capacitador",disabled:!1},dates:{type:"iDatePicker",label:"SELECCIONAR FECHA DE INICIO Y FIN DE INSCRIPCIÓN AL EVENTO",name:"dates",required:!0,message:"Seleccionar fecha",disabled:!1},date:{type:"iDate",label:"FECHA DEL EVENTO",name:"date",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"Ejemplo: Lunes: 12 de mayo"},hours:{type:"iHour",label:"HORARIO DEL EVENTO",name:"hours",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"Ejemplo: 5:00 pm a 8:00 pm",max:100},modality_id:{type:"iSelect",label:"MODALIDAD DEL EVENTO",name:"modality_id",required:!0,message:"Seleccionar la modalidad",disabled:!1}});JSON.parse(localStorage.getItem("profile"));const S=g,o=f,n=c(!0),D=c("GUARDAR"),a=M({}),m=c(!1),h=c(null),l=R(),I=c(null),s=c({city_id:[],fairtype_id:[],modality_id:[],capacitador_id:[]}),O=()=>o.info?{name:o.info.image.name,url:o.info.image.url}:null,T=e=>{e=="modality_id"&&console.log("a9a9a9a99a9a9")},N=async e=>{e=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),t.value.dateTramite.disabled=!1)},L=async e=>{h.value=e.id},k=async e=>{e=="city_id"&&(a.city_id=null),e=="capacitador_id"&&(s.value.capacitadores=l.capacitadores)},A=async(e,i)=>{if(e=="modality_id"){if(i==1){const d={...t.value};delete d.link,t.value=d,t.value={...t.value,city_id:{type:"iSelect",label:"REGIÓN DEL EVENTO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL EVENTO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL EVENTO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"Ejemplo: PRODUCE 2",max:255},aliado:{type:"iText",label:"ALIADO",name:"aliado",required:!0,message:"Escribir nombre del aliado",disabled:!1,placeholder:"",max:255}}}else if(i==2){t.value={...t.value,link:{type:"iText",label:"LINK DE LA SALA",name:"link",required:!0,message:"Ingresar link de la sala",disabled:!1,rules:[{required:!0,message:"Ingresar link"},{type:"url",message:"Ingrese un link válido (https://...)",trigger:"blur"}]}};const d={...t.value};delete d.city_id,delete d.province_id,delete d.district_id,delete d.place,delete d.aliado,t.value=d}}e=="city_id"&&(await l.fetchProvinces(a.city_id),s.value.province_id=l.provinces,t.value.province_id.disabled=!1,a.province_id=null,a.district_id=null),e=="province_id"&&(await l.fetchDistricts(a.province_id),s.value.district_id=l.districts,t.value.district_id.disabled=!1,a.district_id=null)},C=async()=>{m.value=!0;try{const e={title:a.title,component:a.component,capacitador_id:a.capacitador_id,startDate:r(a.dates.start).format("YYYY-MM-DD"),endDate:r(a.dates.end).format("YYYY-MM-DD"),date:r(a.date).format("YYYY-MM-DD"),modality_id:a.modality_id,hourStart:r(a.hours[0]).format("HH:mm"),hourEnd:r(a.hours[1]).format("HH:mm"),...a.modality_id==1?{city_id:a.city_id,province_id:a.province_id,district_id:a.district_id,place:a.place,aliado:a.aliado}:{},...a.modality_id==2?{link:a.link}:{}},i=o.info?`mp/update-event/${o.info.id}`:"mp/store-event",d=o.info?"PUT":"POST",v=await j({url:i,method:d,data:e});v.status===200&&(G.success(v.message),p(),S("closeDraw",!0))}catch(e){console.error("Error:",e);const i=document.getElementsByClassName("ant-drawer-body")[0];i&&(i.scrollTop=0)}finally{m.value=!1}},p=()=>{a.modality_id,Object.assign(a,{title:null,component:null,capacitador_id:null,dates:null,date:null,hours:null,modality_id:null,training_time:null,city_id:null,province_id:null,district_id:null,place:null});const e={...t.value};delete e.link,delete e.city_id,delete e.province_id,delete e.district_id,delete e.place,t.value=e},Y=e=>{const i={...t.value};delete i.link,delete i.city_id,delete i.province_id,delete i.district_id,delete i.place,delete i.aliado,e===1&&(i.city_id={type:"iSelect",label:"REGIÓN DEL EVENTO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},i.province_id={type:"iSelect",label:"PROVINCIA DEL EVENTO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},i.district_id={type:"iSelect",label:"DISTRITO DEL EVENTO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},i.place={type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},i.aliado={type:"iText",label:"ALIADO",name:"aliado",required:!0,message:"Escribir nombre del aliado",disabled:!1,max:255}),e===2&&(i.link={type:"iText",label:"LINK DEL EVENTO",name:"link",required:!0,message:"Ingresar link del evento",disabled:!1,rules:[{required:!0,message:"Ingresar link del evento"},{type:"url",message:"Ingrese un link válido (https://...)",trigger:"blur"}]}),t.value=i},_=async e=>{n.value=!0;try{e&&(a.title=e.title,a.component=e.component,a.capacitador_id=e.capacitador_id,a.dates={start:r(e.startDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),end:r(e.endDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")},a.training_time=e.training_time,a.date=e.date?r(e.date,"YYYY-MM-DD"):null,a.hours=[r(e.hourStart,"HH:mm"),r(e.hourEnd,"HH:mm")],a.modality_id=e.modality_id,Y(e.modality_id),e.modality_id===1&&(a.city_id=e.city_id,await l.fetchProvinces(e.city_id),s.value.province_id=l.provinces,t.value.province_id.disabled=!1,a.province_id=e.province_id,await l.fetchDistricts(e.province_id),s.value.district_id=l.districts,t.value.district_id.disabled=!1,a.district_id=e.district_id,a.place=e.place,a.aliado=e.aliado),e.modality_id===2&&(a.link=e.link))}catch(i){console.error("Error al cargar la información:",i)}finally{n.value=!1}};return x(async()=>{o.info?_(o.info):n.value=!1,await l.fetchCapacitadores(),s.value.capacitador_id=l.capacitadores,await l.fetchCities(),s.value.city_id=l.cities,await l.fetchModalities(),s.value.modality_id=l.modalities,s.value.component=[{label:"GESTIÓN EMPRESARIAL",value:1},{label:"HABILIDADES PERSONALES",value:2}]}),w(()=>o.info,e=>{e?_(e):p()}),y("formState",a),y("loadingState",m),(e,i)=>n.value?(u(),V(P(F),{key:0,style:{color:"#00a6db"}})):(u(),E("div",Z,[b(q,{fields:t.value,options:s.value,btnSaveName:D.value,onHandleInputEvent:T,resetSelect:I.value,onHandleFocusSelect:k,onHandleChangeSelect:A,onHandleChangeClock:N,onOnSubmit:C},{default:U(({field:d})=>[d.name=="iSlotOptions"?(u(),E("div",$,[b(H,{"accept-formats":["image/jpeg","image/png"],maxImages:1,onUploadSuccess:L,imageLoad:O()},null,8,["imageLoad"])])):B("",!0)]),_:1},8,["fields","options","btnSaveName","resetSelect"])]))}};export{ie as _};
