import{c as n,A as ce,x as Z,a as ee,r as k,j as ae,K as oe,b as c,o as s,p as b,w as o,d as y,F,v as te,q as v,i as $,t as w,y as J,m as j,L as H,g as se,e as _,h as U,M as de,H as re,P as ie,a4 as me,a2 as pe,a6 as K,u as _e,I as fe,J as ve}from"./index-5142c48f.js";import"./es-474632a9.js";import{C as ye}from"./CloudUploadOutlined-7ec388c6.js";import{E as be}from"./EnvironmentOutlined-51b0f146.js";import{T as ge}from"./TeamOutlined-272c87b1.js";import{M as he}from"./MoreOutlined-f77f5488.js";var we={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64L128 192v384c0 212.1 171.9 384 384 384s384-171.9 384-384V192L512 64zm312 512c0 172.3-139.7 312-312 312S200 748.3 200 576V246l312-110 312 110v330z"}},{tag:"path",attrs:{d:"M378.4 475.1a35.91 35.91 0 00-50.9 0 35.91 35.91 0 000 50.9l129.4 129.4 2.1 2.1a33.98 33.98 0 0048.1 0L730.6 434a33.98 33.98 0 000-48.1l-2.8-2.8a33.98 33.98 0 00-48.1 0L483 579.7 378.4 475.1z"}}]},name:"safety",theme:"outlined"};const xe=we;function le(S){for(var p=1;p<arguments.length;p++){var m=arguments[p]!=null?Object(arguments[p]):{},D=Object.keys(m);typeof Object.getOwnPropertySymbols=="function"&&(D=D.concat(Object.getOwnPropertySymbols(m).filter(function(g){return Object.getOwnPropertyDescriptor(m,g).enumerable}))),D.forEach(function(g){ke(S,g,m[g])})}return S}function ke(S,p,m){return p in S?Object.defineProperty(S,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):S[p]=m,S}var ne=function(p,m){var D=le({},p,m.attrs);return n(ce,le({},D,{icon:xe}),null)};ne.displayName="SafetyOutlined";ne.inheritAttrs=!1;const Se=ne,Ce={__name:"DrawCompromisos",props:["dataRow"],emits:["closeDraw"],setup(S,{emit:p}){const m=S,D=p,g=Z(),i=ee({title:null,type:null,description:null,meta:null}),L={title:{type:"iText",label:"Título del Compromiso",name:"title",required:!0,message:"Escribir el título",disabled:!0,max:100},type:{type:"iSelect",label:"Tipo compromiso",name:"type",required:!0,message:"Seleccionar una opción",disabled:!0},description:{type:"iTextarea",label:"Descripción del compromiso",name:"description",required:!1,message:"Escribir la descripción",disabled:!1,max:200},meta:{type:"iNumber",label:"Meta",name:"meta",required:!1,message:"Escribir la acción",disabled:!0}},E=k(!1),O=[{label:"Aliado",value:"aliado"},{label:"PNTE",value:"pnte"},{label:"Ambos",value:"ambos"}],a=()=>{i.title=null,i.type=null,i.description=null,i.meta=null},q=async()=>{E.value=!0;const f={title:i.title,type:i.type,description:i.description,meta:i.meta,agreement_id:g.params.id};try{const A=m.dataRow?"PUT":"POST",z=m.dataRow?`agreement/update-commitment/${m.dataRow.id}`:"/agreement/create-commitment",C=await J({url:z,method:A,data:f});C.status==200&&(j.success(C.message),D("closeDraw"),a())}catch{j.error("Se presentó un error, los valores son requeridos")}finally{E.value=!1}},P=f=>{const A=i[f]?i[f].trim():"";i[f]=A};function I(f){i.title=f.title,i.type=f.type,i.description=f.description,i.meta=f.meta}return ae(()=>{m.dataRow&&I(m.dataRow)}),oe(()=>m.dataRow,f=>{f?I(f):a()}),(f,A)=>{const z=c("a-input"),C=c("a-form-item"),h=c("a-select"),d=c("a-textarea"),r=c("a-input-number"),B=c("a-button"),x=c("a-form");return s(),b(x,{layout:"vertical",model:i,name:"basic",autocomplete:"off",onFinish:q},{default:o(()=>[(s(),y(F,null,te(L,(l,e)=>(s(),y(F,{key:e},[l.type==="iText"?(s(),b(C,{key:0,name:l.name,label:l.label,rules:[{required:l.required,message:l.message,max:l.max}]},{default:o(()=>[n(z,{value:i[l.name],"onUpdate:value":u=>i[l.name]=u,maxlength:l.max,onBlur:u=>P(l.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iSelect"?(s(),b(C,{key:1,class:"item-max",name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[l.name=="type"?(s(),b(h,{key:0,value:i[l.name],"onUpdate:value":u=>i[l.name]=u,options:O},null,8,["value","onUpdate:value"])):v("",!0)]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iTextarea"?(s(),b(C,{key:2,name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[n(d,{value:i[l.name],"onUpdate:value":u=>i[l.name]=u,rows:3,maxlength:l.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iNumber"?(s(),b(C,{key:3,class:"item-max",name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[n(r,{value:i[l.name],"onUpdate:value":u=>i[l.name]=u,min:1,max:500,style:{width:"120px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0)],64))),64)),n(C,null,{default:o(()=>[n(B,{type:"primary","html-type":"submit",loading:E.value},{default:o(()=>[$(w(S.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},De={accion:{type:"iText",label:"Nombre de la capacitación",name:"accion",required:!0,message:"Escribir la acción",disabled:!0,max:100,visible:!0},date:{type:"iDate",label:"Fecha",name:"date",required:!0,message:"Seleccionar fecha",disabled:!1},modality:{type:"iSelect",label:"Modalidad",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},address:{type:"iText",label:"Lugar",name:"address",required:!1,message:"Escribir la acción",disabled:!0,max:100,visible:!1},participants:{type:"iNumber",label:"Número de participantes",name:"participants",required:!1,message:"Escribir la acción",disabled:!0},files:{type:"iFile",label:"Archivos (máximo 3 archivos)",name:"files",required:!1,message:"Subir archivos",disabled:!0},details:{type:"iTextarea",label:"Descripción",name:"details",required:!1,message:"Escribir la acción",disabled:!0,max:240,rows:3}};const Oe={class:"form-action"},Re="DD/MM/YYYY",Ue=3,qe=".pdf, .doc, .docx, .xls, .xlsx, .jpeg, .jpg, .png",Ae={__name:"DrawAccionesUgse",props:["dataRow"],emits:["closeDraw"],setup(S,{emit:p}){H.locale("es");const m=S,D=se.get("token"),g="https://apituempresa.soporte-pnte.com/api/",i="http://127.0.0.1:8000/api/",L=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?i:g,E=p,O=k(De),a=ee({}),q=k(!1),P=Z(),I=[{label:"Virtual",value:"v"},{label:"Presencial",value:"p"}],f=e=>{const u=a[e]?a[e].trim():"";a[e]=u},A=()=>{a.accion=null,a.date=null,a.modality=null,a.address=null,a.participants=null,a.file1=null,a.file2=null,a.file3=null,a.details=null,r.value=[]},z=e=>e==="modality"?I:[],C=(e,u)=>{const R=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return u.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(R)},h=e=>{e=="p"?O.value.address.visible=!0:O.value.address.visible=!1,a.address=null},d=async()=>{q.value=!0;const e={accion:a.accion,date:H(a.date).format("YYYY-MM-DD"),modality:a.modality,address:a.address,participants:a.participants,file1:a.file1,file2:a.file2,file3:a.file3,details:a.details,agreement_id:P.params.id,commitment_id:m.dataRow.id};try{const u=await re.post(`${L}agreement/commitments`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${D}`}});u.data.status==200&&(j.success(u.data.message),O.value.address.visible=!1,E("closeDraw"),A())}catch{j.error("Error al subir")}finally{q.value=!1}},r=k([]),B=({onSuccess:e})=>{setTimeout(()=>{e("ok")},0)},x=e=>r.value.length>=Ue?(j.error("Solo puedes cargar un máximo de 3 archivos"),!1):(a.file1?a.file2?a.file3||(a.file3=e):a.file2=e:a.file1=e,r.value.push({uid:e.uid,name:e.name,status:"done"}),!1),l=e=>{const u=r.value.findIndex(R=>R.uid===e.uid);u===0?a.file1=null:u===1?a.file2=null:u===2&&(a.file3=null),r.value.splice(u,1)};return(e,u)=>{const R=c("a-input"),M=c("a-form-item"),Q=c("a-date-picker"),W=c("a-select"),V=c("a-input-number"),T=c("a-textarea"),Y=c("a-button"),X=c("a-upload"),G=c("a-form");return s(),y("section",null,[n(G,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:d},{default:o(()=>[_("div",Oe,[(s(!0),y(F,null,te(O.value,(t,ue)=>(s(),y(F,{key:ue},[t.type==="iText"&&t.visible?(s(),b(M,{key:0,name:t.name,label:t.label,rules:[{required:t.required,message:t.message,max:t.max}]},{default:o(()=>[n(R,{value:a[t.name],"onUpdate:value":N=>a[t.name]=N,maxlength:t.max,onBlur:N=>f(t.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iDate"?(s(),b(M,{key:1,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(Q,{locale:U(de),value:a[t.name],"onUpdate:value":N=>a[t.name]=N,style:{width:"100%"},format:Re,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iSelect"?(s(),b(M,{key:2,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(W,{value:a[t.name],"onUpdate:value":N=>a[t.name]=N,options:z(t.name),"show-search":"","filter-option":C,onChange:h},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iNumber"?(s(),b(M,{key:3,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(V,{value:a[t.name],"onUpdate:value":N=>a[t.name]=N,min:1,max:200},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iTextarea"?(s(),b(M,{key:4,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(T,{value:a[t.name],"onUpdate:value":N=>a[t.name]=N,rows:t.rows,maxlength:t.max},null,8,["value","onUpdate:value","rows","maxlength"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iFile"?(s(),b(M,{key:5,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(X,{"before-upload":x,"custom-request":B,"file-list":r.value,accept:qe,multiple:!0,"on-remove":l,"show-upload-list":""},{default:o(()=>[n(Y,null,{default:o(()=>[n(U(ye)),u[0]||(u[0]=$(" Cargar archivos "))]),_:1})]),_:1},8,["file-list"])]),_:2},1032,["name","label","rules"])):v("",!0)],64))),128))]),n(M,null,{default:o(()=>[n(Y,{type:"primary","html-type":"submit",loading:q.value},{default:o(()=>u[1]||(u[1]=[$("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const $e={class:"convenios-header"},Te={key:0},Ee={key:"comment-nested-reply-to",class:"ico-delete-comp"},Ie={class:"convenios-description"},Me={style:{"white-space":"normal"}},Ne={key:0,class:"conv-part"},Le={key:1,class:"conv-part const-mod"},Pe={class:"conv-files"},ze=["onClick"],Be=["onClick"],Fe=["onClick"],Ye={__name:"DrawAccionesDetalle",props:["dataRow"],setup(S){H.locale("es");const p=S,m=JSON.parse(localStorage.getItem("role")),D=JSON.parse(localStorage.getItem("profile")),g=se.get("token"),i="https://apituempresa.soporte-pnte.com/api/",L="http://127.0.0.1:8000/api/",E=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?L:i;ee({}),k(!1);const O=k(!1),a=Z(),q=k(null),P=k([]),I=ie(me,{style:{fontSize:"18px"},spin:!0}),f=h=>H(h).format("DD/MM/YYYY"),A=async(h,d)=>{q.value=d;try{const r=await re.get(`${E}agreement/commitment-download/${h}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${g}`}}),B=window.URL.createObjectURL(new Blob([r.data])),x=document.createElement("a");x.href=B,x.setAttribute("download",d),document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch(r){console.error("Error al descargar el archivo",r)}finally{q.value=null}},z=async h=>{try{(await J({url:`/agreement/commitment-delete/${h}`,method:"DELETE"})).status==200&&C()}catch(d){console.error("Error de red:",d)}},C=async h=>{try{O.value=!0;const d=a.params.id,r=await J({url:`/agreement/commitments/${h.id}`,method:"GET"});P.value=r.data}catch(d){console.error("Error de red:",d)}finally{O.value=!1}};return k([]),ae(()=>{p.dataRow&&C(p.dataRow)}),oe(()=>p.dataRow,h=>{h&&C(h)}),(h,d)=>{const r=c("a-empty"),B=c("a-avatar"),x=c("a-spin"),l=c("a-comment");return s(),y("section",null,[n(x,{spinning:O.value},{default:o(()=>[P.value.length<1?(s(),b(r,{key:0})):(s(!0),y(F,{key:1},te(P.value,(e,u)=>(s(),b(l,{key:u},{author:o(()=>[_("div",$e,[_("span",null,w(e.profile.name)+" "+w(e.profile.lastname)+" "+w(e.profile.middlename),1),U(D).user_id==e.profile.id||U(m).some(R=>R.id===8)?(s(),y("div",Te,[_("span",Ee,[n(U(pe),{onClick:R=>z(e.id)},null,8,["onClick"])])])):v("",!0)])]),avatar:o(()=>[n(B,null,{default:o(()=>[$(w(e.profile.name.charAt(0)),1)]),_:2},1024)]),content:o(()=>[_("div",Ie,[_("div",null,[_("b",null,w(e.accion),1),_("span",null," - "+w(f(e.date)),1)]),_("p",Me,w(e.details),1),e.address?(s(),y("div",Ne,[n(U(be)),$(" "+w(e.address),1)])):v("",!0),e.participants?(s(),y("div",Le,[_("div",null,[n(U(ge)),$(" "+w(e.participants)+" participantes ",1)]),_("div",null,[n(U(Se)),d[0]||(d[0]=_("span",null," Modalidad: ",-1)),$(w(e.modality=="v"?"Virtual":"Presencial"),1)])])):v("",!0),_("div",Pe,[e.file1_name?(s(),y(F,{key:0},[q.value==e.file1_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>A(e.file1_path,e.file1_name)},[n(U(K)),$(" "+w(e.file1_name),1)],8,ze))],64)):v("",!0),e.file2_name?(s(),y(F,{key:1},[q.value==e.file2_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>A(e.file2_path,e.file2_name)},[n(U(K)),$(" "+w(e.file2_name),1)],8,Be))],64)):v("",!0),e.file3_name?(s(),y(F,{key:2},[q.value==e.file2_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>A(e.file3_path,e.file3_name)},[n(U(K)),$(" "+w(e.file3_name),1)],8,Fe))],64)):v("",!0)])])]),_:2},1024))),128))]),_:1},8,["spinning"])])}}};const Ve={style:{margin:".5rem 0 1rem 0",color:"var(--secondary)"}},je={style:{"text-transform":"uppercase"}},Ge={key:2},Je=["onClick"],He=["onClick"],Ze=["onClick"],Qe=50,na={__name:"PageCompromisosUGSE",setup(S){const p=k(!1),m=k(!1),D=k(!1),g=k(null),i=Z();_e();const L=k(!1),E=k([]),O=k(!1),a=[{title:"#",dataIndex:"idx",align:"center",width:50},{title:"COMPROMISO",dataIndex:"title",width:120},{title:"TIPO",dataIndex:"type",width:100,align:"center"},{title:"META",dataIndex:"meta",width:100,align:"center"},{title:"CATEGORÍA",dataIndex:"description",width:180},{title:"AVANCES",dataIndex:"avances",width:80,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],q=d=>{p.value=!0,g.value=d,m.value=!0},P=d=>{g.value=d,D.value=!0},I=d=>{g.value=d,O.value=!0},f=()=>{h(),m.value=!1,O.value=!1,p.value=!1},A=()=>{p.value=!1,g.value=null,m.value=!0},z=k({page:1}),C=fe(()=>d=>(z.value.page-1)*Qe+d+1),h=async()=>{L.value=!0;try{const d=await J({url:`agreement/all-commitments/${i.params.id}`,method:"GET"});d.status==200&&(E.value=d.data)}catch{}finally{L.value=!1}};return ae(()=>{h()}),(d,r)=>{const B=c("router-link"),x=c("a-breadcrumb-item"),l=c("a-breadcrumb"),e=c("a-button"),u=c("a-tag"),R=c("a-menu-item"),M=c("a-menu"),Q=c("a-dropdown"),W=c("a-table"),V=c("a-drawer");return s(),y("section",null,[n(l,null,{default:o(()=>[n(x,null,{default:o(()=>[n(B,{to:"/admin/convenios/ugse"},{default:o(()=>r[4]||(r[4]=[$("Lista de convenios")])),_:1})]),_:1}),n(x,null,{default:o(()=>r[5]||(r[5]=[_("h4",null,"COMPROMISOS",-1)])),_:1})]),_:1}),_("h3",Ve,w(d.$router.currentRoute.value.params.name),1),n(e,{type:"primary",onClick:A},{default:o(()=>r[6]||(r[6]=[$("NUEVO")])),_:1}),r[7]||(r[7]=_("br",null,null,-1)),r[8]||(r[8]=_("br",null,null,-1)),n(W,{bordered:"",scroll:{x:200},class:"table-compromisos",columns:a,"data-source":E.value,pagination:!1,loading:L.value,size:"small"},{bodyCell:o(({column:T,record:Y,index:X})=>[T.dataIndex=="idx"?(s(),y(F,{key:0},[$(w(C.value(X)),1)],64)):v("",!0),T.dataIndex=="type"?(s(),b(u,{key:1},{default:o(()=>[_("span",je,w(Y.type),1)]),_:2},1024)):v("",!0),T.dataIndex=="avances"?(s(),y("span",Ge,w(Y.commitments.length),1)):v("",!0),T.dataIndex=="actions"?(s(),b(Q,{key:3,trigger:["click"]},{overlay:o(()=>[n(M,null,{default:o(()=>[n(R,null,{default:o(()=>[_("a",{onClick:G=>I(Y)},"Nuevo avance",8,Je)]),_:2},1024),n(R,null,{default:o(()=>[_("a",{onClick:G=>P(Y)},"Ver Avances",8,He)]),_:2},1024),n(R,null,{default:o(()=>[_("a",{onClick:G=>q(Y)},"Editar",8,Ze)]),_:2},1024)]),_:2},1024)]),default:o(()=>[_("a",{class:"ant-dropdown-link",onClick:r[0]||(r[0]=ve(()=>{},["prevent"]))},[n(e,{shape:"circle",icon:ie(U(he))},null,8,["icon"])])]),_:2},1024)):v("",!0)]),_:1},8,["data-source","loading"]),n(V,{open:m.value,"onUpdate:open":r[1]||(r[1]=T=>m.value=T),title:p.value?"Editar compromiso":"Nuevo compromiso",placement:"right",width:"450px"},{default:o(()=>[n(Ce,{onCloseDraw:f,dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open","title"]),n(V,{open:O.value,"onUpdate:open":r[2]||(r[2]=T=>O.value=T),title:"Registrar un Avance",placement:"right",width:"450px"},{default:o(()=>[n(Ae,{onCloseDraw:f,dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open"]),n(V,{open:D.value,"onUpdate:open":r[3]||(r[3]=T=>D.value=T),title:"Detalles",placement:"right",width:"600px"},{default:o(()=>[n(Ye,{dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{na as default};
