import{Y as Q,r as m,g as j,b as X,l as J,d as u,o as r,s as f,w as i,c,f as y,e as U,B as Y,F as x,v as p,i as H,j as T,t as E,h as N,m as R,R as K,E as W,S as Z}from"./index-1d39f797.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{M as ae}from"./MoreOutlined-d1ce404c.js";const te={name:{type:"iText",label:"Nombre notaría",name:"name",required:!0,message:"Ingresa el nombre de la notaría"},department:{type:"iSelect",label:"Departamento",name:"department",required:!0,message:"Seleccionar un tipo"},province:{type:"iSelect",label:"Provincia",name:"province",required:!1,message:"Seleccionar un tipo"},district:{type:"iSelect",label:"Distrito",name:"district",required:!1,message:"Seleccionar un tipo"},address:{type:"iText",label:"Dirección",name:"address",required:!1,message:"Escribe la dirección"},normal_rate:{type:"iNumber",label:"Tarífa",name:"normal_rate",required:!0,message:"Escribe la tarifa"},social_rate:{type:"iNumber",label:"Tarifa social",name:"social_rate",required:!0,message:"Escribe un monto"}};const ne={class:"grid-item"},oe={class:"wrapper-form_btn"},re={__name:"ModalNotarias",props:["isIdUpdate"],emits:["handleCloseModal","refreshTable"],setup(q,{emit:D}){const o=q,M=D,w=JSON.parse(localStorage.getItem("user"));Q(()=>{o.isIdUpdate?(e.name=o.isIdUpdate.name,e.department=o.isIdUpdate.department,e.province=o.isIdUpdate.province,e.district=o.isIdUpdate.district,e.address=o.isIdUpdate.address,e.normal_rate=+o.isIdUpdate.normal_rate,e.social_rate=+o.isIdUpdate.social_rate,$(o.isIdUpdate.department),A(o.isIdUpdate.province)):S()});const k=m([]),g=m([]),h=m([]),O=async()=>{try{const{data:s}=await j({url:"/departaments",method:"GET"});let t=s.map(n=>({label:n.label,value:n.id}));k.value=[...k.value,...t]}catch(s){console.log(s)}},B=(s,t)=>{e.province=null,e.district=null,g.value=[],h.value=[],$(t.value)},$=async s=>{try{const{data:t}=await j({url:`/province/${s}`,method:"GET"});let n=t.map(d=>({label:d.label,value:d.id}));g.value=[...g.value,...n]}catch(t){console.log(t)}},F=(s,t)=>{e.district=null,h.value=[],A(t.value)},A=async s=>{try{const{data:t}=await j({url:`/district/${s}`,method:"GET"});let n=t.map(d=>({label:d.label,value:d.id}));h.value=[...h.value,...n]}catch(t){console.log(t)}},C=m(!0),b=m(!1),e=X({name:null,department:null,province:null,district:null,address:null,normal_rate:null,social_rate:null,created_by:w.id}),l=()=>{M("handleCloseModal",!0),C.value=!1},S=()=>{e.name=null,e.department=null,e.province=null,e.district=null,e.address=null,e.normal_rate=null,e.social_rate=null},P=async()=>{if(e.social_rate>e.normal_rate)return N.warning("La tarifa social no puede ser mayor a la Tarífa original");const s=e;b.value=!0;let t,n;o.isIdUpdate?(t=`/notary/${o.isIdUpdate.id}`,n="PUT"):(t="/notary",n="POST");try{const d=await R({url:t,method:n,data:s});S(),M("refreshTable",!0),N.success(d.message),l()}catch{N.error("No se pudo registrar")}finally{b.value=!1}};return J(()=>{O()}),(s,t)=>{const n=u("a-select"),d=u("a-form-item"),L=u("a-input"),I=u("a-input-number"),v=u("a-button"),z=u("a-form"),G=u("a-modal");return r(),f(G,{open:C.value,"onUpdate:open":t[0]||(t[0]=a=>C.value=a),title:`${q.isIdUpdate?"Actualizar":"Registrar"} notaría`,style:{top:"40px"},footer:"",onCancel:l,width:"700px"},{default:i(()=>[c(z,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:P},{default:i(()=>[y("div",ne,[(r(!0),U(x,null,Y(H(te),(a,V)=>(r(),U(x,{key:V},[a.type==="iSelect"?(r(),f(d,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[a.name=="documentType"?(r(),f(n,{key:0,value:e[a.name],"onUpdate:value":_=>e[a.name]=_,options:s.typeDocuments},null,8,["value","onUpdate:value","options"])):p("",!0),a.name=="department"?(r(),f(n,{key:1,value:e[a.name],"onUpdate:value":_=>e[a.name]=_,options:k.value,onChange:B},null,8,["value","onUpdate:value","options"])):p("",!0),a.name=="province"?(r(),f(n,{key:2,value:e[a.name],"onUpdate:value":_=>e[a.name]=_,options:g.value,onChange:F},null,8,["value","onUpdate:value","options"])):p("",!0),a.name=="district"?(r(),f(n,{key:3,value:e[a.name],"onUpdate:value":_=>e[a.name]=_,options:h.value},null,8,["value","onUpdate:value","options"])):p("",!0)]),_:2},1032,["name","label","rules"])):p("",!0),a.type==="iText"?(r(),f(d,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:i(()=>[c(L,{value:e[a.name],"onUpdate:value":_=>e[a.name]=_},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):p("",!0),a.type==="iNumber"?(r(),f(d,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[c(I,{value:e[a.name],"onUpdate:value":_=>e[a.name]=_},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):p("",!0)],64))),128))]),y("div",oe,[c(v,{type:"primary","html-type":"submit",loading:b.value},{default:i(()=>[T(E(q.isIdUpdate?"Actualizar":"Crear"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["open","title"])}}},le=ee(re,[["__scopeId","data-v-5af148e5"]]);const se=y("h3",null,"NOTARÍAS",-1),ie={class:"filters"},de=["onClick"],ce=y("a",null,"Eliminar",-1),ue={class:"paginator"},ve={__name:"NotariasLista",setup(q){const D=m([]),o=m(!1),M=m(1e3),w=m(!1),k=m(0),g=m(null),h=m({page:1}),O=[{title:"Nombre",dataIndex:"name",fixed:"left",width:220},{title:"Departamento",dataIndex:"departamento",width:140},{title:"Provincia",dataIndex:"provincia",width:140},{title:"Distrito",dataIndex:"distrito",width:140},{title:"Dirección",dataIndex:"address",width:200},{title:"Tarífa Normal",dataIndex:"normal_rate",align:"center",width:120},{title:"Tarífa Social",dataIndex:"social_rate",align:"center",width:120},{title:"Ahorro",dataIndex:"ahorro",align:"center",width:120},{title:"",dataIndex:"actions",align:"center",width:50}],B=e=>{e&&b()},$=e=>{h.value.page=e,b()},F=async e=>{try{const l=await R({url:`/notary/${e.id}`,method:"GET"});g.value=l.data,w.value=!0}catch(l){console.error("Error de red:",l),N.warning("Error de red")}},A=()=>{g.value=null,w.value=!0},C=async e=>{try{const l=await R({url:`/notary-delete/${e.id}`,method:"PUT"});b(),N.success(l.message)}catch(l){console.error("Error de red:",l)}},b=async()=>{try{o.value=!0;const e=await R({url:"/notaries",method:"GET",params:h.value});D.value=e.data,k.value=e.total}catch(e){console.error("Error de red:",e)}finally{o.value=!1}};return J(b),(e,l)=>{const S=u("a-button"),P=u("a-menu-item"),s=u("a-popconfirm"),t=u("a-menu"),n=u("a-dropdown"),d=u("a-table"),L=u("a-pagination");return r(),U(x,null,[y("div",null,[se,y("div",ie,[c(S,{type:"primary",onClick:A},{default:i(()=>[T("AGREGAR")]),_:1})]),c(d,{bordered:"",scroll:{x:M.value},class:"ant-table-striped",columns:O,"data-source":D.value,pagination:!1,loading:o.value,size:"small"},{bodyCell:i(({column:I,record:v})=>{var z,G,a;return[I.dataIndex=="departamento"?(r(),U(x,{key:0},[T(E((z=v.departament)==null?void 0:z.descripcion),1)],64)):p("",!0),I.dataIndex=="provincia"?(r(),U(x,{key:1},[T(E((G=v.province)==null?void 0:G.descripcion),1)],64)):p("",!0),I.dataIndex=="distrito"?(r(),U(x,{key:2},[T(E((a=v.district)==null?void 0:a.descripcion),1)],64)):p("",!0),I.dataIndex=="ahorro"?(r(),U(x,{key:3},[T(E(v.normal_rate-v.social_rate),1)],64)):p("",!0),I.dataIndex=="actions"?(r(),f(n,{key:4,trigger:["click"]},{overlay:i(()=>[c(t,null,{default:i(()=>[c(P,null,{default:i(()=>[y("a",{onClick:V=>F(v)},"Editar",8,de)]),_:2},1024),c(P,null,{default:i(()=>[c(s,{title:"¿Deseas eliminar?",onConfirm:V=>C(v)},{icon:i(()=>[c(H(K),{style:{color:"red"}})]),default:i(()=>[ce]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:i(()=>[y("a",{class:"ant-dropdown-link",onClick:l[0]||(l[0]=W(()=>{},["prevent"]))},[c(S,{shape:"circle",icon:Z(H(ae)),size:"small"},null,8,["icon"])])]),_:2},1024)):p("",!0)]}),_:1},8,["scroll","data-source","loading"])]),y("div",ue,[c(L,{size:"small",total:k.value,pageSize:20,onChange:$,showSizeChanger:!1},null,8,["total"])]),c(le,{open:w.value,onRefreshTable:B,onHandleCloseModal:l[1]||(l[1]=I=>w.value=!1),isIdUpdate:g.value},null,8,["open","isIdUpdate"])],64)}}};export{ve as default};
