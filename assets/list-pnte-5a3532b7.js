import{_ as B}from"./TableComponent-c5a6df1c.js";import{p as C,r as o,a as F,k as H,U as G,X as b,o as U,d as k,c as r,m as M,h as A,b as $,w as u,t as j,z,e as R,i as Q,a2 as X}from"./index-9c3e0987.js";import{_ as J}from"./FormComponent-f7493c4e.js";import{u as K}from"./selectes-3a5ea8f7.js";import"./es-6c78391e.js";import{_ as W,a as Z}from"./AsignarVistas-fe259f6f.js";import"./downloadExcel-8f9017e0.js";import{g as ee}from"./usePermissions-d632a4f7.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-b244af5a.js";import"./MoreOutlined-97be7c4c.js";import"./quill.snow-e524dd0a.js";const ae={class:"usuarios-pnte"},te={__name:"UsuariosPrograma",props:["info"],emits:["closeDraw"],setup(q,{emit:I}){C.locale("es");const y=o({dni:{type:"iInputSearch",label:"DNI",name:"dni",required:!0,message:"Ingrese el DNI",disabled:!1,max:8,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("Escribe número de documento"));const i=String(c).trim();return/^\d{8}$/.test(i)?Promise.resolve():Promise.reject(new Error("DNI incorrecto."))},trigger:["change","blur"]}]},name:{type:"iText",label:"NOMBRE",name:"name",required:!0,message:"Ingrese el nombre",disabled:!1},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Ingrese el apellido paterno",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Ingrese el apellido materno",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("El número es requerido"));const i=c.toString();return i.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):i.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!1,message:"Seleccione la fecha de nacimiento",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccione el género",disabled:!1},office_id:{type:"iSelect",label:"OFICINA",name:"office_id",required:!0,message:"Seleccione la Oficina",disabled:!1},cde_id:{type:"iSelect",label:"CDE",name:"cde_id",required:!0,message:"Seleccione la CDE",disabled:!1}}),N=I,m=q,v=o("GUARDAR"),e=F({}),p=o(!1),l=K(),_=o(null),d=o({gender_id:[],office_id:[],cde_id:[]}),f=a=>{console.log("handleInputEvent",a)},P=async a=>{a=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),y.value.dateTramite.disabled=!1)},w=async a=>{console.log("handleChangeSelect",a)},T=async a=>{a=="gender_id"&&(await l.fetchGenders(),d.value.gender_id=l.genders),a=="office_id"&&(await l.fetchOffices(),d.value.office_id=l.Offices),a=="cde_id"&&(await l.fetchCdes(),d.value.cde_id=l.cdes)},L=async()=>{var c;p.value=!0;const a={dni:e.dni,name:e.name,lastname:e.lastname,middlename:e.middlename,phone:(c=e.phone)==null?void 0:c.toString().trim(),birthday:C(e.birthday).format("YYYY-MM-DD"),gender_id:e.gender_id,office_id:e.office_id,cde_id:e.cde_id};try{let i,g=null;m.info?(i=`user/update-user-pnte/${m.info.id}`,g="PUT"):(i="user/register-user-pnte",g="POST");const x=await M({url:i,method:g,data:a});x.status===200&&(A.success(x.message),O(),N("closeDraw",!0))}catch(i){i.response&&i.response.data&&i.response.data.message?A.error(i.response.data.message):A.error("Ocurrió un error inesperado.");const g=document.getElementsByClassName("ant-drawer-body")[0];g&&(g.scrollTop=0)}finally{p.value=!1}},O=()=>{e.dni=null,e.name=null,e.lastname=null,e.middlename=null,e.phone=null,e.birthday=null,e.gender_id=null,e.office_id=null,e.cde_id=null},D=async a=>{a&&(e.dni=a.dni,e.name=a.name,e.lastname=a.lastname,e.middlename=a.middlename,await l.fetchCdes(),d.value.cde_id=l.cdes,e.cde_id=a.cde_id,await l.fetchOffices(),d.value.office_id=l.Offices,e.office_id=a.office_id,await l.fetchGenders(),d.value.gender_id=l.genders,e.gender_id=a.gender_id,e.phone=a.phone,a.birthday&&(e.birthday=C(a.birthday,"YYYY-MM-DD")))};return H(()=>{m.info&&D(m.info)}),G(()=>m.info,a=>{a?D(a):O()}),b("formState",e),b("loadingState",p),(a,c)=>(U(),k("div",ae,[r(J,{fields:y.value,options:d.value,btnSaveName:v.value,onHandleInputEvent:f,resetSelect:_.value,onHandleChangeSelect:w,onHandleFocusSelect:T,onHandleChangeClock:P,onOnSubmit:L},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const ne={class:"layout-content"},le={key:0},ie=["onClick"],se=["onClick"],oe=["onClick"],ye={__name:"list-pnte",setup(q){const I=o([]),y=o(0),N=o(150),m=o(!1),v=o(!1),e=o({}),p=o(!1),l=o(!1),_=o(null),d=o(!1),f=F({year:C("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),P=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"dni",fixed:"left",width:100,align:"center"},{title:"NOMBRES",dataIndex:"name",width:160},{title:"APELLIDOS",dataIndex:"fullname",width:160},{title:"CORREO PNTE",dataIndex:"email",width:240},{title:"CELULAR",dataIndex:"phone",width:100,align:"center"},{title:"FECHA NACIMIENTO",dataIndex:"birthday",width:100,align:"center"},{title:"OFICINA",dataIndex:"office_name",width:120,align:"center"},{title:"CDE",dataIndex:"cde_name",width:140},{title:"CORREO PERSONAL",dataIndex:"personalemail",width:240},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],w=(t,n)=>{_.value=t,n.value=!0},T=t=>w(t,p),L=t=>w(t,v),O=t=>w(t,m),D=()=>{_.value=null,p.value=!0},a=()=>{E(),p.value=!1},c=async t=>{try{const n=await M({url:`attendance/delete/${t.id}`,method:"DELETE"});n.status==200&&(E(),A.success(n.message))}catch(n){console.error("Error de red:",n)}},i=async()=>{d.value=!0;try{}catch(t){console.error("Error de red:",t)}finally{d.value=!1}},g=async t=>{f.page=t,await E()},x=async t=>{t&&(f.page=1,await E())},E=async()=>{try{l.value=!0;const t={page:f.page};f.year&&(t.year=C(f.year).format("YYYY")),f.name&&(t.name=f.name);const h=await M({url:"users/pnte",method:"GET",params:t});I.value=h.data.data,y.value=h.data.total,N.value=h.data.per_page}catch(t){console.error("Error de red:",t)}finally{l.value=!1}};return H(async()=>{e.value=await ee("usuarios-lista"),await E()}),b("search",f),b("loading",l),b("loadingFile",d),(t,n)=>{const h=$("a-menu-item"),V=$("a-popconfirm"),Y=$("a-drawer");return U(),k("div",ne,[r(B,{title:"LISTA EQUIPO PNTE",nameTotal:"Personal PNTE",titleSearch:"FILTRAR POR NÚMERO DE DNI",placeholderSearch:"Buscar",textNuevo:"NUEVO REGISTRO",new:!0,columns:P,pageSize:N.value,dataSource:I.value,total:y.value,btnUpdate:!0,permisos:e.value,onHandleNew:D,onHandleDownloadExcel:i,onHandleSearch:x,onHandleCallFetchData:E,onHandlePaginator:g},{"data-cell":u(({column:s,record:S})=>[s.dataIndex=="type_activity"?(U(),k("span",le,j(S.pnte),1)):z("",!0)]),"custom-options":u(({record:s})=>[r(h,null,{default:u(()=>[R("a",{onClick:S=>T(s)},"Editar",8,ie)]),_:2},1024),r(h,null,{default:u(()=>[R("a",{onClick:S=>L(s)},"Cambiar de contraseña",8,se)]),_:2},1024),r(h,null,{default:u(()=>[R("a",{onClick:S=>O(s)},"Vistas",8,oe)]),_:2},1024),r(h,null,{default:u(()=>[r(V,{placement:"rightBottom",title:`¿Quieres eliminar ${s.title} ?`,onConfirm:S=>c(s)},{icon:u(()=>[r(Q(X),{style:{color:"red"}})]),default:u(()=>[n[5]||(n[5]=R("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total","permisos"]),r(Y,{open:p.value,"onUpdate:open":n[0]||(n[0]=s=>p.value=s),title:_.value?"EDITAR DATOS":"NUEVO REGISTRO",placement:"right",width:"550"},{default:u(()=>[r(te,{onCloseDraw:a,info:_.value},null,8,["info"])]),_:1},8,["open","title"]),r(Y,{open:v.value,"onUpdate:open":n[2]||(n[2]=s=>v.value=s),title:"CAMBIAR CONTRASEÑA",placement:"right",width:"450"},{default:u(()=>[r(W,{onCloseDraw:n[1]||(n[1]=s=>v.value=!1),info:_.value},null,8,["info"])]),_:1},8,["open"]),r(Y,{open:m.value,"onUpdate:open":n[4]||(n[4]=s=>m.value=s),title:"ASIGNAR VISTAS",placement:"right",width:"1300"},{default:u(()=>[r(Z,{onCloseDraw:n[3]||(n[3]=s=>m.value=!1),info:_.value,typeOffice:"ALL"},null,8,["info"])]),_:1},8,["open"])])}}};export{ye as default};
