import{K as _,y as fe,r as h,u as he,a as ge,k as De,b as y,o,d as R,c as g,w as f,e as C,F as ae,x as qe,q as r,h as T,s as m,L as Ye,t as xe,i as Se,p as Te,j as Ne,m as D,z as I,f as $}from"./index-3279b806.js";import{u as ke}from"./selectes-5291dac0.js";import{d as we}from"./selects-c77e0024.js";import"./es-4daf206b.js";import{_ as Me}from"./_plugin-vue_export-helper-c27b6911.js";const Ue={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},city_id:{type:"iSelect",label:"Departamento residente",name:"city_id",required:!0,message:"Seleccionar departamento",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!0,message:"¿Tiene discapacidad?",disabled:!0}};const te=N=>(Te("data-v-6f7dda31"),N=N(),Ne(),N),Ee={class:"agreement-wrapper"},Fe=te(()=>C("h3",null,"Formulario de registro",-1)),Ie=te(()=>C("br",null,null,-1)),$e={class:"grid-item"},Ce="DD/MM/YYYY",Pe={__name:"NuevaPersona",setup(N){_.locale("es");const q=fe(),l=ke();l.$patch({typeDocuments:l.typeDocuments}),l.$patch({cities:l.cities}),l.$patch({provinces:l.provinces}),l.$patch({districts:l.districts}),l.$patch({genders:l.genders}),l.fetchTypeDocuments(),l.fetchCities(),l.fetchGenders();const P=h(null),G=h(null),ne=he(),A=JSON.parse(localStorage.getItem("profile")),t=h(Ue),Y=h(!0),p=h(null),z=h(!1),ie=h(!0),e=ge({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,lession:null,people_id:A.user_id,from_id:1}),de=async d=>{try{const{data:s}=await $({url:`select/provinces/${d}`,method:"GET"});P.value=s}catch(s){console.error("Error de red:",s)}},le=async d=>{try{const{data:s}=await $({url:`select/districts/${d}`,method:"GET"});G.value=s}catch(s){console.error("Error de red:",s)}},L=(d,s)=>{const u=d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(u)},se=()=>{l.typeDocuments&&(ie.value=!1)},oe=()=>{t.value.lastname.disabled=!1,t.value.middlename.disabled=!1,t.value.name.disabled=!1,t.value.city_id.disabled=!1,t.value.province_id.disabled=!1,t.value.district_id.disabled=!1,t.value.address.disabled=!1,t.value.phone.disabled=!1,t.value.email.disabled=!1,t.value.birthday.disabled=!1,t.value.gender_id.disabled=!1,t.value.lession.disabled=!1},B=d=>{d&&(t.value.documentnumber.disabled=!1,e.documentnumber=null)},V=async d=>{var s,u,b,k,x,w,M,U,E,a,F,i,j,J,K,H,Q,W;if(Y.value=!0,!d)return D.warning("Ingresa un número de documento"),Y.value=!1;try{if(e.typedocument_id==1){const{data:n}=await I({url:`user/api/dni/${e.documentnumber}`,method:"GET"});if(n.body&&(e.lastname=(s=n.body)==null?void 0:s.apePaterno,e.middlename=(u=n.body)==null?void 0:u.apeMaterno,e.name=(b=n.body)==null?void 0:b.preNombres,e.address=(k=n.body)==null?void 0:k.desDireccion,(x=n.body)!=null&&x.feNacimiento&&(e.birthday=_((w=n.body)==null?void 0:w.feNacimiento,"DD/MM/YYYY")),(M=n.body)!=null&&M.feNacimiento&&(p.value=_((U=n.body)==null?void 0:U.feNacimiento,"DD/MM/YYYY")),(E=n.body)!=null&&E.ubigeo)){let c=l.cities.find(S=>{var v;return S.label===((v=n.body.ubigeo)==null?void 0:v.departamento)}),X=await $({url:`select/provinces/${c.value}`,method:"GET"});P.value=X.data;let Z=X.data.find(S=>{var v;return S.label===((v=n.body.ubigeo)==null?void 0:v.provincia)}),ee=await $({url:`select/districts/${Z.value}`,method:"GET"});G.value=ee.data;let ye=ee.data.find(S=>{var v;return S.label===((v=n.body.ubigeo)==null?void 0:v.distrito)});e.city_id=c.value,e.province_id=Z.value,e.district_id=ye.value}}if(e.typedocument_id==2){const{data:n}=await I({url:`user/api/ce/${e.documentnumber}`,method:"GET"});n.body&&(e.lastname=(a=n.body)==null?void 0:a.apellido_paterno,e.middlename=(F=n.body)==null?void 0:F.apellido_materno,e.name=(i=n.body)==null?void 0:i.nombres,e.gender_id=((j=n.body)==null?void 0:j.sexo)=="F"?2:1,(J=n.body)!=null&&J.fecha_nacimiento&&(e.birthday=_((K=n.body)==null?void 0:K.fecha_nacimiento,"DD/MM/YYYY")),(H=n.body)!=null&&H.fecha_nacimiento&&(p.value=_((Q=n.body)==null?void 0:Q.fecha_nacimiento,"DD/MM/YYYY")))}if(e.typedocument_id==3){const{data:n}=await I({url:`user/api/pas/${e.documentnumber}`,method:"GET"}),c=(W=n.body)==null?void 0:W.data[0];e.lastname=c.apellido_paterno,e.middlename=c.apellido_materno,e.name=c.nombres,e.gender_id=c.sexo=="F"?2:1,c.fecha_nacimiento&&(e.birthday=_(c.fecha_nacimiento,"DD/MM/YYYY")),c.fecha_nacimiento&&(p.value=_(c.fecha_nacimiento,"DD/MM/YYYY"))}}catch(n){console.log("err",n)}finally{return oe(),Y.value=!1}},re=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},ue=()=>{e.phone=e.phone.replace(/\D/g,"")},ce=d=>{e.province_id=null,e.district_id=null,de(d)},me=d=>{e.district_id=null,le(d)},pe=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.lession=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=A.id,p.value=null,O()},O=()=>{t.value.documentnumber.disabled=!0,t.value.lastname.disabled=!0,t.value.middlename.disabled=!0,t.value.name.disabled=!0,t.value.city_id.disabled=!0,t.value.city_id.disabled=!0,t.value.province_id.disabled=!0,t.value.address.disabled=!0,t.value.phone.disabled=!0,t.value.email.disabled=!0,t.value.birthday.disabled=!0,t.value.gender_id.disabled=!0,t.value.lession.disabled=!0},be=async()=>{z.value=!0,e.birthday=p.value?_(p.value).format("YYYY-MM-DD"):null;try{const d=await I({url:"person/create",method:"POST",data:e});if(d.status==400)return D.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(d.status==401)return D.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(d.status==200){const s={type:e.typedocument_id,number:e.documentnumber};return ne.push({name:"asesorias-formalizaciones",query:s}),D.success(d.message),pe()}}catch{D.error("No se pudo registrar este usuario")}finally{z.value=!1}},ve=()=>{D.error("Debes de completar todos los espacios requeridos")},_e=async()=>{O(),q.query&&(e.typedocument_id=+q.query.type,B(q.query.type),e.documentnumber=q.query.number,await l.fetchCities(),await V(q.query.number))};return De(()=>{_e()}),(d,s)=>{const u=y("a-select"),b=y("a-form-item"),k=y("a-input-search"),x=y("a-input"),w=y("a-date-picker"),M=y("a-button"),U=y("a-form"),E=y("a-spin");return o(),R("div",Ee,[Fe,Ie,g(E,{spinning:Y.value},{default:f(()=>[g(U,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:be,onFinishFailed:ve},{default:f(()=>[C("div",$e,[(o(!0),R(ae,null,qe(t.value,(a,F)=>(o(),R(ae,{key:F},[a.type==="iSelect"?(o(),r(b,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[a.name=="typedocument_id"?(o(),r(u,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).typeDocuments,disabled:a.disabled,onChange:B},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="city_id"?(o(),r(u,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).cities,"show-search":"","filter-option":L,onChange:ce,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="province_id"?(o(),r(u,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:P.value,"show-search":"","filter-option":L,onChange:me,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(o(),r(u,{key:3,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:G.value,"show-search":"","filter-option":L,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="gender_id"?(o(),r(u,{key:4,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="lession"?(o(),r(u,{key:5,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(we),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(o(),r(b,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[g(k,{loading:Y.value,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,onSearch:V,onInput:re,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(o(),r(b,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:f(()=>[a.name=="phone"?(o(),r(x,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max,onInput:ue},null,8,["value","onUpdate:value","disabled","maxlength"])):(o(),r(x,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(o(),r(b,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[g(w,{locale:T(Ye),value:p.value,"onUpdate:value":s[0]||(s[0]=i=>p.value=i),style:{width:"100%"},format:Ce,placeholder:"día/mes/año",onChange:s[1]||(s[1]=i=>e.birthday=p.value),disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),C("div",null,xe(se()),1),g(b,null,{default:f(()=>[g(M,{class:"btn-produce",type:"primary","html-type":"submit",loading:z.value},{default:f(()=>[Se("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Be=Me(Pe,[["__scopeId","data-v-6f7dda31"]]);export{Be as default};
