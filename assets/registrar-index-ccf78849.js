import{R as re}from"./historialInformationBusinessman.vue_vue_type_style_index_0_scoped_f968e821_lang-805c2460.js";import{E as de}from"./EditarEmpresario-0a941c83.js";import{_ as ue}from"./FormComponent-82105699.js";import{u as Q}from"./selectes-ebde9b56.js";import{r as m,a as Z,k as ce,T as pe,W as F,b as _,o as B,y as me,w as p,e as s,c as r,m as U,h as P,G as V,d as k,F as q,n as x,i as z,Y as ve,j as J,t as N,z as G,_ as H}from"./index-7c6eb53c.js";import{u as W}from"./useHistorialBusinessman-1c46dd26.js";import"./es-54c8f561.js";import"./quill.snow-9071d684.js";import{u as fe}from"./useBusinessman-bb336d68.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{U as ge}from"./UserOutlined-d2cc05b6.js";const ye={class:"ases-draw"},be={__name:"RegistrarAsesoriaComprasPeru",props:{detailRegister:{type:Object,required:!0,default:()=>({})},infoBusinessMan:{type:Object,required:!1,default:()=>({})}},emits:["registered"],setup(L,{emit:h}){const b=L,A=h,o=Q();W();const g=m(!1),w=m(!1),t=Z({}),D=m("REGISTRAR"),c=m({city_id:[],province_id:[],district_id:[],gender_id:[],sick:[]}),S=async(a,d)=>{a=="city_id"&&(await o.fetchProvinces(t.city_id),c.value.province_id=o.provinces,u.value.province_id.disabled=!1),a=="province_id"&&(await o.fetchDistricts(t.province_id),c.value.district_id=o.districts,u.value.district_id.disabled=!1),a=="component_id"&&(await o.fetchCpThemes(t.component_id),c.value.theme_id=o.cpThemes,t.theme_id=null,u.value.theme_id.disabled=!1)},C=async a=>{if(console.log("Blur",a),a.name=="ruc"&&t.ruc&&t.ruc.toString().length==11){g.value=!0;try{const d=await U({url:`api/consult-company-ruc/${a.value}`,method:"POST"});d.status==200&&(t.razonSocial=d.data.socialReason),d.status==404&&(P.warning(d.message),t.ruc_obs=1)}catch(d){console.log("error: ",d)}finally{g.value=!1}}},E=async a=>{a=="city_id"&&(t.province_id=null,t.district_id=null,c.value.province_id=[]),a=="province_id"&&(t.province_id=null,t.district_id=null,c.value.district_id=[])},f=async()=>{w.value=!0;const a={city_id:t.city_id,province_id:t.province_id,district_id:t.district_id,economicsector_id:t.economicsector_id,comercialactivity_id:t.comercialactivity_id,component_id:t.component_id,theme_id:t.theme_id,modality_id:t.modality_id,ruc:t.ruc,razonSocial:t.razonSocial,periodo:t.periodo,cantidad:t.cantidad,ubicacion:t.ubicacion,people_id:b.detailRegister.people_id,ruc_obs:t.ruc_obs,cde_id:b.detailRegister.cde_id};try{const d=await U({url:"purchases-my-peru/store",method:"POST",data:a});if(console.log("response",d),d.status==200){const y={ruc:t.ruc,socialReason:t.razonSocial},O=await U({url:"purchases-my-peru/update-data-mype",method:"PUT",data:y});O.status==200?(A("registered",d.data),I(),P.success(d.message)):P.error(O.message)}}catch{P.error(o.error)}finally{w.value=!1}},I=()=>{for(const a in t)t[a]=null},u=m({economicsector_id:{type:"iSelect",label:"SECTOR PRIORIZADO",name:"economicsector_id",required:!0,message:"Seleccionar el sector económico",disabled:!1},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!1},component_id:{type:"iSelect",label:"COMPONENTE",name:"component_id",required:!0,message:"Seleccionar un componente",disabled:!1},theme_id:{type:"iSelect",label:"TEMA DEL COMPONENTE",name:"theme_id",required:!0,message:"Seleccionar un tema del componente",disabled:!0},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCIÓN",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},ruc:{type:"iNumber",label:"RUC",name:"ruc",message:"Escribir número de RUC",disabled:!1,maxlength:11,rules:[{required:!0,message:"El RUC es obligatorio",trigger:"blur"},{validator:(a,d)=>{if(!d)return Promise.reject(new Error("Es necesario ingresar un RUC"));const y=d.toString();return y.length!==11?Promise.reject(new Error("El número debe tener exactamente 11 dígitos")):["10","15","17","20"].includes(y.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 10, 15, 17 o 20"))},trigger:"change"}]},razonSocial:{type:"iText",label:"RAZÓN SOCIAL",name:"razonSocial",required:!0,message:"Ingresar razón social",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},periodo:{type:"iText",label:"PERIODO PRODUCTOR",name:"periodo",required:!1,message:"Ingresar periodo productor",disabled:!1},cantidad:{type:"iNumber",label:"CANTIDAD DE MAQUINARIA",name:"cantidad",required:!1,message:"Ingresar cantidad de maquinaria",disabled:!1},ubicacion:{type:"iText",label:"UBICACIÓN",name:"ubicacion",required:!1,message:"Ingresar ubicación",disabled:!1}}),n=async a=>{a&&(console.log("info",a),await o.fetchCities(),c.value.city_id=o.cities,t.city_id=a.city_id,await o.fetchProvinces(t.city_id),c.value.province_id=o.provinces,t.province_id=a.province_id,await o.fetchDistricts(t.province_id),c.value.district_id=o.districts,t.district_id=a.district_id)};return ce(async()=>{b.infoBusinessMan&&n(b.infoBusinessMan),await o.fetchSectorPriorizado(),c.value.economicsector_id=o.sectorPriorizado,await o.fetchComercialActivities(),c.value.comercialactivity_id=o.comercialActivities,await o.fetchCpComponents(),c.value.component_id=o.cpComponents,await o.fetchModalities(),c.value.modality_id=o.modalities,await o.fetchCities(),c.value.city_id=o.cities}),pe(()=>b.infoBusinessMan,a=>{a?n(a):I()}),F("formState",t),F("loadingState",w),(a,d)=>{const y=_("a-spin");return B(),me(y,{spinning:g.value,tip:"Validando información"},{default:p(()=>[s("div",ye,[r(ue,{fields:u.value,options:c.value,btnSaveName:D.value,onHandleFocusSelect:E,onHandleChangeSelect:S,onOnSubmit:f,onHandleBlurAction:C},null,8,["fields","options","btnSaveName"])])]),_:1},8,["spinning"])}}};const Se={class:"page"},Ce={class:"hint"},Ee={style:{display:"flex","justify-content":"space-between","align-items":"center","flex-wrap":"wrap",gap:"8px"}},Ie={class:"quick-actions"},Pe={class:"cde-select"},we={class:"user-card"},De={class:"avatar-box"},Ne={class:"user-fields"},Re={class:"field"},he={class:"value"},Ae={class:"field"},Oe={class:"value"},Te={class:"field"},xe={class:"value"},Be={class:"field"},Me={class:"value"},Ue={__name:"registrar-index",setup(L){const h=Q(),b=W(),A=m(!1),o=m(!1),g=m(null),w=JSON.parse(localStorage.getItem("profile")||"{}"),t=m(w.cde_id),D=m(!1),c=m(null),S=m(null),C=m(null),E=m(null),f=m(!1),I=fe(),u=m(null),n=Z({type:"DNI",number:null}),a=m(!1);h.fetchCdes();const d=V(()=>{switch(n.type){case"DNI":return 8;case"CE":return 9;case"PAS":return 12;case"PTP":return 9;default:return 10}}),y=V(()=>{switch(n.type){case"DNI":return"12345678";case"CE":return"001234567";case"PAS":return"Ingrese su pasaporte";case"PTP":return"Ingrese su PTP";default:return"Ingrese documento"}});function O(){const i=String(n.number||"").trim();return i.length?i.length!==d.value?(P.error(`El ${n.type} debe tener ${d.value} dígitos`),!1):["DNI","CE","PTP"].includes(n.type)&&!/^\d+$/.test(i)?(P.error("Solo dígitos"),!1):(u.value=null,!0):(P.warning("Ingrese el número de documento"),!1)}const Y=i=>{f.value=!1,u.value=i},K=i=>{S.value=!1};function T(i){console.log("changeTypeDocument",i),n.type=i,n.number=null,u.value=null}async function $(){if(console.log("Hoooola"),!!O()){a.value=!0;try{b.reloadClear();const i={documentnumber:n.number};if(n.type==="DNI"){const e=await I.get(i);if(E.value={type:1,number:n.number},e.status==200){const{data:l}=e;(l.typedocument_id===1&&l.country_id!==155||l.country_id===null||l.hasSoon===null||l.phone===null||l.email===null)&&(S.value=!0,c.value=l),u.value=l,a.value=!1}else X(i)}else{const e=await I.get(i);if(e.status==200){const{data:l}=e;(l.typedocument_id==2&&l.country_id==155||l.country_id===null||l.hasSoon===null||l.phone===null)&&(S.value=!0,c.value=l),u.value=l,a.value=!1}else E.value={type:n.type==="CE"?2:n.type==="PAS"?3:n.type==="PTP"?4:1,number:String(n.number??"").trim()},C.value={},f.value=!0,a.value=!1}}catch{console.log("Error:",I.error)}}}const X=async i=>{try{const e=await I.reniec(i);e.status==200?(C.value=e.data,f.value=!0):e.status==404&&(H.warning({message:"Aviso",description:"El servicio de consulta RENIEC no está disponible. Por favor, registre los datos manualmente.",duration:2.5}),C.value={reniecError:"no_disponible",numeroDocumento:n.number,name:null,lastname:null,middlename:null},E.value={type:1,number:n.number},setTimeout(()=>{f.value=!0,a.value=!1},3e3)),a.value=!1}catch{H.warning({message:"Aviso",description:"El servicio de consulta RENIEC no está disponible. Por favor, registre los datos manualmente.",duration:2.5}),C.value={reniecError:"no_disponible",numeroDocumento:n.number,name:null,lastname:null,middlename:null},E.value={type:1,number:n.number},setTimeout(()=>{f.value=!0,a.value=!1},3e3)}};function ee(i){const e={dni:u.value.documentnumber,people_id:u.value.id,user_id:w.id,cde_id:t.value};i==="Asesoría"&&(g.value=e,D.value=!0),i==="PPNN"&&(g.value=e,o.value=!0),i==="PPJJ"&&(g.value=e,A.value=!0)}const te=i=>{t.value=i;const e=JSON.parse(localStorage.getItem("profile")||"{}");e.cde_id=i,localStorage.setItem("profile",JSON.stringify(e))},se=(i,e)=>{const l=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)},ae=i=>{i==="ase"?D.value=!1:i==="ppnn"?o.value=!1:i==="ppjj"?A.value=!1:console.log("Error: tipo no reconocido")};return(i,e)=>{const l=_("a-card"),R=_("a-col"),ie=_("a-row"),ne=_("a-input"),j=_("a-button"),oe=_("a-input-group"),le=_("a-select"),M=_("a-drawer");return B(),k(q,null,[s("div",Se,[r(l,{class:"card"},{default:p(()=>[e[25]||(e[25]=s("h1",{class:"title"},"Compras PERÚ",-1)),e[26]||(e[26]=s("p",{class:"subtitle"},"Ingresa los datos del documento para buscar o registrar un usuario",-1)),e[27]||(e[27]=s("div",{class:"section-label"},"Tipo de Documento",-1)),r(ie,{gutter:[16,16]},{default:p(()=>[r(R,{xs:24,sm:12},{default:p(()=>[r(l,{hoverable:"",class:x(["doc-type",{active:n.type==="DNI"}]),onClick:e[0]||(e[0]=v=>T("DNI"))},{default:p(()=>e[11]||(e[11]=[s("div",{class:"doc-type-title"},"DNI",-1),s("div",{class:"doc-type-sub"},"Documento Nacional de Identidad",-1)])),_:1},8,["class"])]),_:1}),r(R,{xs:24,sm:12},{default:p(()=>[r(l,{hoverable:"",class:x(["doc-type",{active:n.type==="CE"}]),onClick:e[1]||(e[1]=v=>T("CE"))},{default:p(()=>e[12]||(e[12]=[s("div",{class:"doc-type-title"},"CE",-1),s("div",{class:"doc-type-sub"},"Carné de Extranjería",-1)])),_:1},8,["class"])]),_:1}),r(R,{xs:24,sm:12},{default:p(()=>[r(l,{hoverable:"",class:x(["doc-type",{active:n.type==="PAS"}]),onClick:e[2]||(e[2]=v=>T("PAS"))},{default:p(()=>e[13]||(e[13]=[s("div",{class:"doc-type-title"},"PAS",-1),s("div",{class:"doc-type-sub"},"Pasaporte",-1)])),_:1},8,["class"])]),_:1}),r(R,{xs:24,sm:12},{default:p(()=>[r(l,{hoverable:"",class:x(["doc-type",{active:n.type==="PTP"}]),onClick:e[3]||(e[3]=v=>T("PTP"))},{default:p(()=>e[14]||(e[14]=[s("div",{class:"doc-type-title"},"PTP",-1),s("div",{class:"doc-type-sub"},"Permiso Temporal de Permanencia",-1)])),_:1},8,["class"])]),_:1})]),_:1}),e[28]||(e[28]=s("div",{class:"section-label mt-20"},"Número de Documento",-1)),r(oe,{compact:"",class:"doc-input-group"},{default:p(()=>[r(ne,{value:n.number,"onUpdate:value":e[4]||(e[4]=v=>n.number=v),maxlength:d.value,placeholder:y.value,class:"doc-input",disabled:a.value,onPressEnter:$},null,8,["value","maxlength","placeholder","disabled"]),r(j,{type:"primary",class:"btn-search",loading:a.value,onClick:$},{icon:p(()=>[r(z(ve))]),default:p(()=>[e[15]||(e[15]=J(" BUSCAR "))]),_:1},8,["loading"])]),_:1}),s("div",Ce,"Debe tener "+N(d.value)+" dígitos",1),u.value?(B(),k(q,{key:0},[e[19]||(e[19]=s("div",{class:"section-label mt-20"},"Accesos rápidos",-1)),s("div",Ee,[s("div",null,[e[17]||(e[17]=s("span",null,null,-1)),s("div",Ie,[r(j,{onClick:e[5]||(e[5]=v=>ee("Asesoría"))},{default:p(()=>e[16]||(e[16]=[J("ASESORÍA")])),_:1})])]),s("div",Pe,[e[18]||(e[18]=s("span",null,"Centro de Desarrollo Empresarial (CDE)",-1)),r(le,{value:t.value,"onUpdate:value":e[6]||(e[6]=v=>t.value=v),options:z(h).cdes,"show-search":"","filter-option":se,onChange:te,class:"custom-select"},null,8,["value","options"])])])],64)):G("",!0),u.value?(B(),k(q,{key:1},[e[24]||(e[24]=s("div",{class:"section-label mt-20"},"Datos del usuario",-1)),s("div",we,[s("div",De,[r(z(ge))]),s("div",Ne,[s("div",Re,[e[20]||(e[20]=s("div",{class:"label"},"Nro. Documento",-1)),s("div",he,N(u.value.documentnumber),1)]),s("div",Ae,[e[21]||(e[21]=s("div",{class:"label"},"Nombres",-1)),s("div",Oe,N(u.value.name),1)]),s("div",Te,[e[22]||(e[22]=s("div",{class:"label"},"Apellidos",-1)),s("div",xe,N(u.value.lastname)+" "+N(u.value.middlename),1)]),s("div",Be,[e[23]||(e[23]=s("div",{class:"label"},"Celular",-1)),s("div",Me,N(u.value.phone),1)])])])],64)):G("",!0)]),_:1})]),r(M,{title:"Registrar Nuevo Empresario",open:f.value,"onUpdate:open":e[7]||(e[7]=v=>f.value=v),placement:"right",width:"500px"},{default:p(()=>[r(re,{infoBusinessMan:C.value,detailDocument:E.value,onRegistered:Y},null,8,["infoBusinessMan","detailDocument"])]),_:1},8,["open"]),r(M,{title:"VALIDAR DATOS DEL EMPRESARIO",open:S.value,"onUpdate:open":e[8]||(e[8]=v=>S.value=v),placement:"right",width:"500px",maskClosable:!1,closable:!1},{default:p(()=>[r(de,{updateInfoBusinessman:c.value,asesor:!0,onRegistered:K},null,8,["updateInfoBusinessman"])]),_:1},8,["open"]),r(M,{title:"ASESORIAS MI PERÚ",placement:"right",width:"750px",open:D.value,"onUpdate:open":e[10]||(e[10]=v=>D.value=v)},{default:p(()=>[r(be,{detailRegister:g.value,onRegistered:e[9]||(e[9]=v=>ae("ase")),infoBusinessMan:u.value},null,8,["detailRegister","infoBusinessMan"])]),_:1},8,["open"])],64)}}},Qe=_e(Ue,[["__scopeId","data-v-85b523d7"]]);export{Qe as default};
