import{p as Z,r,a as W,k as ee,U as fe,X as Y,o as y,y as P,i as M,L as be,d as V,c as n,m as H,E as Ee,g as ye,G as he,a9 as we,b as d,e as u,w as l,j as L,ab as Ce,t as F,F as xe,z as U,a2 as Se,O as Oe,s as Ie,h as Re,K as Ne}from"./index-b1dccea4.js";import{_ as Ae}from"./icoexcel-1b303edf.js";import{_ as De}from"./FormComponent-fab269f4.js";import{u as ke}from"./selectes-ebc4b666.js";import"./es-a55eea19.js";import{g as Te}from"./usePermissions-e57de8ed.js";import{M as Le}from"./MoreOutlined-d9b39cb6.js";import"./quill.snow-a8c3c737.js";const Ue={key:1,class:"f-20"},Pe={__name:"EventosUgoAsistentes",props:["info","typeEvent"],emits:["closeDraw"],setup(Q,{emit:A}){Z.locale("es");const p=ke(),B=JSON.parse(localStorage.getItem("role")),$=A,g=Q;p.fetchCities();const S=r({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!1},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!B.some(a=>a.id==1||a.id==5),rules:[{validator:(a,s)=>{if(!s)return Promise.reject(new Error("Escribe número de documento"));const c=String(s);if(!/^\d+$/.test(c))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(c.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(c.length<3||c.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(a,s)=>{if(!s)return Promise.reject(new Error("El número es requerido"));const c=s.toString();return c.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):c.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(a,s)=>s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!1,message:"Seleccionar"},ruc:{type:"iText",label:"RUC",name:"ruc",required:!1,message:"Escribir nombre",disabled:!1},comercialName:{type:"iText",label:"NOMBRE COMERCIAL",name:"comercialName",required:!1,message:"Escribir nombre",disabled:!1},comercialActivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialActivity",required:!1,message:"Escribir nombre",disabled:!1},...g.typeEvent===3&&{mercado:{type:"iText",label:"MERCADO",name:"mercado",required:!1,message:"Escribir nombre",disabled:!1}}}),v=r(!0),h=r("ACTUALIZAR"),e=W({}),f=r(!1),O=r(null),m=r({typedocument_id:[],gender_id:[],sick:[]}),w=a=>{console.log("handleInputEvent",a)},q=async a=>{a=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),S.value.dateTramite.disabled=!1)},D=async a=>{},I=async a=>{a=="typedocument_id"&&(m.value.typedocument_id=p.typeDocuments),a=="gender_id"&&(m.value.gender_id=p.genders),a=="sick"&&N()},R=a=>{},N=()=>{m.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"}]},z=async()=>{f.value=!0;const a={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,gender_id:e.gender_id,phone:e.phone,email:e.email,ruc:e.ruc,comercialName:e.comercialName,comercialActivity:e.comercialActivity,mercado:e.mercado,sick:e.sick};try{(await H({url:`events-ugo/update-participant-data-ugo-event/${g.info.id}`,method:"PUT",data:a})).status===200&&(b(),$("closeDraw",!0))}catch(s){console.error("Error:",s);const c=document.getElementsByClassName("ant-drawer-body")[0];c&&(c.scrollTop=0)}finally{f.value=!1}},b=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},k=async a=>{v.value=!0;try{a&&(await p.fetchTypeDocuments(),m.value.typedocument_id=p.typeDocuments,e.typedocument_id=a.typedocument_id,e.documentnumber=a.documentnumber,e.lastname=a.lastname,e.middlename=a.middlename,e.name=a.name,e.phone=a.phone,e.email=a.email,await p.fetchGenders(),m.value.gender_id=p.genders,e.gender_id=a.gender_id,N(),e.sick=a.sick,e.ruc=a.ruc,e.comercialName=a.comercialName,e.comercialActivity=a.comercialActivity,e.mercado=a.mercado)}catch(s){console.error("Error al cargar la información:",s)}finally{v.value=!1}};return ee(()=>{g.info&&k(g.info)}),fe(()=>g.info,a=>{a&&k(a)}),Y("formState",e),Y("loadingState",f),(a,s)=>v.value?(y(),P(M(be),{key:0,style:{color:"#00a6db"}})):(y(),V("div",Ue,[n(De,{fields:S.value,options:m.value,btnSaveName:h.value,onHandleInputEvent:w,resetSelect:O.value,onHandleChangeSelect:D,onHandleFocusSelect:I,onHandleBlurSelect:R,onHandleChangeClock:q,onOnSubmit:z},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const Me={class:"layout-content"},Be={class:"title-produce"},$e={style:{color:"var(--secondary)"}},qe=["onClick"],ze={class:"paginator"},Ke={__name:"eventos-inscritos",setup(Q){Z.locale("es");const A=Ee(),p=ye.get("token"),B="https://apituempresa.soporte-pnte.com/api/",$="http://127.0.0.1:8000/api/",g=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?$:B,S=r(""),v=r(null),h=r(!1),e=r(null),f=r(!1),O=r(0),m=r(50),w=r({page:0}),q=r(1200),D=r([]),I=r(!1),R=r({}),N=r(window.innerHeight-100),z=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGISTRADO",dataIndex:"created_at",fixed:"left",width:120,align:"center"},{title:"APELLIDOS",dataIndex:"lastname",fixed:"left",width:160},{title:"NOMBRES ",dataIndex:"name",width:160,fixed:"left"},{title:"TIPO DOCUMENTO",dataIndex:"typedocument_name",width:100,align:"center"},{title:"NÚMERO DE DOCUMENTO",dataIndex:"documentnumber",align:"center",width:140},{title:"CELULAR",dataIndex:"phone",width:150,align:"center"},{title:"CORREO",dataIndex:"email",width:250},{title:"GÉNERO",dataIndex:"gender_name",align:"center",width:100},{title:"RUC",dataIndex:"ruc",align:"center",width:120},{title:"NOMBRE COMERCIAL",dataIndex:"comercialName",align:"center",width:140},{title:"RUBRO / ACTIVIDAD COMERCIAL",dataIndex:"comercialActivity",align:"center",width:200},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],b=W({search:""}),k=()=>{C(),h.value=!1},a=o=>{e.value=o,h.value=!0},s=()=>{let o={search:b.search};C(o)},c=()=>{b.search||C()},te=o=>{w.value.page=o,C()},j=()=>{N.value=window.innerHeight-320},ae=async o=>{try{const t=await H({url:`events-ugo/remove-participant-ugo-event/${o.id}`,method:"DELETE"});t.status==200&&(C(),Re.success(t.message))}catch(t){console.error("Error de red:",t)}},ne=he(()=>o=>w.value.page*m.value+o+1),C=async o=>{try{I.value=!0;let t;t=w.value.page==0?"":w.value,t=o?{...t,...o}:t;const x=A.params.slug,_=await H({url:`attendance/applicants/${x}`,method:"GET",params:t});S.value=_.nameEvent,v.value=_.typeEvent;const i=_.data;D.value=i==null?void 0:i.data,O.value=i.total,m.value=i.per_page}catch(t){console.error("Error de red:",t)}finally{I.value=!1}},oe=async()=>{f.value=!0;try{const o=A.params.slug;let t=null;v.value==3?t=`${g}download/attendance-mercado/${o}`:t=`${g}download/attendance/${o}`;const x=await Ne({url:t,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${p}`}}),_=window.URL.createObjectURL(new Blob([x.data])),i=document.createElement("a"),T=`${o}.xlsx`;i.href=_,i.setAttribute("download",T),document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(_),document.body.removeChild(i)}catch(o){console.error("Error downloading file:",o)}finally{f.value=!1}};return we(()=>{window.removeEventListener("resize",j)}),ee(async()=>{window.addEventListener("resize",j),j(),C(),R.value=await Te("asesor-registro-participantes")}),(o,t)=>{const x=d("a-breadcrumb-item"),_=d("a-breadcrumb"),i=d("a-button"),T=d("a-col"),le=d("a-input"),re=d("a-input-group"),se=d("a-row"),X=d("a-menu-item"),ie=d("a-popconfirm"),de=d("a-menu"),ce=d("a-dropdown"),ue=d("a-table"),me=d("a-tag"),pe=d("a-pagination"),ge=d("a-drawer");return y(),V("div",Me,[u("div",null,[n(_,null,{default:l(()=>[n(x,null,{default:l(()=>[u("a",{onClick:t[0]||(t[0]=E=>o.$router.go(-1))},[n(M(Ce)),t[4]||(t[4]=u("span",{class:"fs-13"},"Atrás",-1))])]),_:1}),n(x,null,{default:l(()=>[u("h3",Be,[t[5]||(t[5]=L(" EVENTOS REGISTRO DE ASISTENCIA - ")),u("span",$e,F(S.value),1)])]),_:1})]),_:1}),n(se,{style:{margin:"1rem 0"}},{default:l(()=>[n(T,{xs:24,md:12,lg:18},{default:l(()=>[t[7]||(t[7]=u("span",null,null,-1)),n(i,{class:"btn-excel",onClick:oe,loading:f.value,type:"primary"},{default:l(()=>t[6]||(t[6]=[u("img",{width:"20",style:{margin:"-2px 0 0 0"},src:Ae},null,-1)])),_:1},8,["loading"])]),_:1}),n(T,{xs:24,md:12,lg:6},{default:l(()=>[n(re,{compact:""},{default:l(()=>[n(le,{onPressEnter:s,value:b.search,"onUpdate:value":t[1]||(t[1]=E=>b.search=E),style:{width:"calc(100% - 80px)"},onInput:c,placeholder:"Buscar por NOMBRE, DNI o RUC"},null,8,["value"]),n(i,{type:"primary",disabled:b.search==="",onClick:s},{default:l(()=>t[8]||(t[8]=[L("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(ue,{bordered:"",scroll:{x:q.value,y:N.value},class:"table-agreements-ugse",columns:z,"data-source":D.value,pagination:!1,loading:I.value,size:"small"},{bodyCell:l(({column:E,record:G,index:_e})=>[E.dataIndex=="idx"?(y(),V(xe,{key:0},[L(F(ne.value(_e)),1)],64)):U("",!0),E.dataIndex=="actions"?(y(),P(ce,{key:1,trigger:["click"]},{overlay:l(()=>[n(de,null,{default:l(()=>{var J,K;return[(J=R.value)!=null&&J.can_update?(y(),P(X,{key:0},{default:l(()=>[u("a",{onClick:ve=>a(G)},"Editar",8,qe)]),_:2},1024)):U("",!0),(K=R.value)!=null&&K.can_delete?(y(),P(X,{key:1},{default:l(()=>[n(ie,{placement:"rightBottom",title:`¿Quieres eliminar ${G.documentnumber} ?`,onConfirm:ve=>ae(G)},{icon:l(()=>[n(M(Se),{style:{color:"red"}})]),default:l(()=>[t[9]||(t[9]=u("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):U("",!0)]}),_:2},1024)]),default:l(()=>[u("a",{class:"ant-dropdown-link",onClick:t[2]||(t[2]=Oe(()=>{},["prevent"]))},[n(i,{shape:"circle",icon:Ie(M(Le)),size:"small"},null,8,["icon"])])]),_:2},1024)):U("",!0)]),_:1},8,["scroll","data-source","loading"])]),u("div",ze,[u("span",null,[n(me,{color:"blue"},{default:l(()=>[u("b",null,F(O.value),1)]),_:1}),t[10]||(t[10]=L("Inscritos"))]),n(pe,{size:"small",total:O.value,pageSize:m.value,onChange:te,showSizeChanger:!1},null,8,["total","pageSize"])]),n(ge,{open:h.value,"onUpdate:open":t[3]||(t[3]=E=>h.value=E),title:"Nueva Feria",placement:"right",width:"650"},{default:l(()=>[n(Pe,{onCloseDraw:k,info:e.value,typeEvent:v.value},null,8,["info","typeEvent"])]),_:1},8,["open"])])}}};export{Ke as default};
