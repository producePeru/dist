import{c as a,A as Le,N as Z,r as c,a as ne,k as ee,M as oe,b as i,o as s,s as O,w as n,e as d,d as g,F as H,y as ce,h as z,v as $,O as fe,B as J,m as N,a3 as Pe,a4 as be,t as B,i as j,a5 as he,g as Ce,R as we,a6 as Me,J as re,a8 as Ne,K as Fe,x as qe,W as Ye,L as Be,p as Ge,j as Ve}from"./index-a3bfdba3.js";import{_ as He}from"./icoexcel-1b303edf.js";import{u as De}from"./selectes-7c18db33.js";import"./es-94cabc52.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";import{S as je}from"./SaveOutlined-5df7e7b8.js";import{C as Je,M as Ke}from"./MessageOutlined-b36e64ce.js";import{M as Ze}from"./MoreOutlined-58ae4639.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 264c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48zm-8 136H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM480 544H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 308H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm356.8-74.4c29-26.3 47.2-64.3 47.2-106.6 0-79.5-64.5-144-144-144s-144 64.5-144 144c0 42.3 18.2 80.3 47.2 106.6-57 32.5-96.2 92.7-99.2 162.1-.2 4.5 3.5 8.3 8 8.3h48.1c4.2 0 7.7-3.3 8-7.6C564 871.2 621.7 816 692 816s128 55.2 131.9 124.4c.2 4.2 3.7 7.6 8 7.6H880c4.6 0 8.2-3.8 8-8.3-2.9-69.5-42.2-129.6-99.2-162.1zM692 591c44.2 0 80 35.8 80 80s-35.8 80-80 80-80-35.8-80-80 35.8-80 80-80z"}}]},name:"solution",theme:"outlined"};const We=Qe;function ge(U){for(var y=1;y<arguments.length;y++){var m=arguments[y]!=null?Object(arguments[y]):{},h=Object.keys(m);typeof Object.getOwnPropertySymbols=="function"&&(h=h.concat(Object.getOwnPropertySymbols(m).filter(function(I){return Object.getOwnPropertyDescriptor(m,I).enumerable}))),h.forEach(function(I){Xe(U,I,m[I])})}return U}function Xe(U,y,m){return y in U?Object.defineProperty(U,y,{value:m,enumerable:!0,configurable:!0,writable:!0}):U[y]=m,U}var me=function(y,m){var h=ge({},y,m.attrs);return a(Le,ge({},h,{icon:We}),null)};me.displayName="SolutionOutlined";me.inheritAttrs=!1;const et=me,tt={city_id:{type:"iSelect",label:"Región",name:"city_id",required:!0,message:"Seleccionar una región",disabled:!0},province_id:{type:"iSelect",label:"Provincia",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},alliedEntity:{type:"iText",label:"Entidad Aliada",name:"alliedEntity",required:!0,message:"Escribir la entidad aliada",disabled:!0,max:100},ruc:{type:"iText",label:"Número de RUC",name:"ruc",required:!0,message:"El RUC debe tener exactamente 11 caracteres.",disabled:!0,min:11,max:11},component:{type:"iSelect",label:"Componente",name:"components",required:!0,message:"Seleccionar una región",disabled:!0},startDate:{type:"iDate",label:"Inicio Convenio Vigente",name:"startDate",required:!0,message:"Seleccionar fecha de convenio vigente",disabled:!0},years:{type:"iSelect",label:"Años del convenio",name:"years",required:!0,message:"Seleccionar años",disabled:!1},aliado:{type:"iText",label:"Representante Legal (Nombres Apellidos)",name:"aliado",required:!0,message:"Escribir la entidad aliada",disabled:!0,max:100},aliadoPhone:{type:"iText",label:"Representante Legal (número telf.)",name:"aliadoPhone",required:!0,message:"Escribir la entidad aliada",disabled:!0,max:11},focal:{type:"iText",label:"PUNTO FOCAL - nombres",name:"focal",required:!0,message:"Escribir datos del punto focal",disabled:!0,max:100},focalCargo:{type:"iText",label:"PUNTO FOCAL - cargo",name:"focalCargo",required:!0,message:"Escribir la entidad aliada",disabled:!0,max:50},focalPhone:{type:"iText",label:"PUNTO FOCAL (número de telf.)",name:"focalPhone",required:!0,message:"Escribir el número de telf.",disabled:!0,max:11},renovacion:{type:"iSwitch",label:"Renovación Automática",name:"renovacion",required:!1,message:"Seleccionar",disabled:!0},observations:{type:"iTextarea",label:"Comentarios",name:"observations",required:!1,message:"Seleccionar",disabled:!1}};const at={class:"grid-convenios"},nt={key:5},ot={key:0},st={key:1},ye="DD/MM/YYYY",it={__name:"DrawConvenioUGSE",props:["idConvenio"],emits:["closeDraw"],setup(U,{emit:y}){Z.locale("es");const m=JSON.parse(localStorage.getItem("profile")),h=De(),I=y,w=U;h.$patch({cities:h.cities}),h.$patch({provinces:h.provinces}),h.$patch({districts:h.districts}),h.fetchCities();const u=c(!1),A=c(!1),e=ne({}),S=[{value:1,label:"1 Año"},{value:2,label:"2 Años"},{value:3,label:"3 Años"},{value:4,label:"4 Años"},{value:5,label:"5 Años"},{value:6,label:"6 Años"},{value:7,label:"7 Años"},{value:8,label:"8 Años"},{value:9,label:"9 Años"},{value:10,label:"10 Años"}],P=[{value:"financiamiento",label:"Acceso en Financiamiento"},{value:"desarrollo",label:"Desarrollo Productivo"},{value:"digitalizacion",label:"Digitalización"},{value:"formalizacion",label:"Formalización"},{value:"gestion",label:"Gestión Empresarial"}],G=t=>{const l=Z(e.startDate).add(1,"day").startOf("day");return Z(t).startOf("day").isBefore(l,"day")},F=t=>{e.province_id=null,e.district_id=null,h.fetchProvinces(t)},R=t=>{e.district_id=null,h.fetchDistricts(t)},D=(t,l)=>{const x=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(x)},_=()=>{["city_id","province_id","district_id","alliedEntity","ruc","components","startDate","years","aliado","focal","focalCargo","endDate","observations"].forEach(l=>{e[l]=null}),e.created_id=m.user_id},q=async()=>{u.value=!0;const t={city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,alliedEntity:e.alliedEntity,ruc:e.ruc,components:e.components,startDate:Z(e.startDate).format("YYYY-MM-DD"),years:e.years,aliado:e.aliado,focal:e.focal,focalCargo:e.focalCargo,endDate:Z(e.startDate).add(e.years,"year").format("YYYY-MM-DD"),observations:e.observations,created_id:m.user_id,entity:"ugse"};try{const l=w.idConvenio?"PUT":"POST",x=w.idConvenio?`agreement/update-values/${w.idConvenio.id}`:"agreement/create-ugse",k=await J({url:x,method:l,data:t});k.status==200&&(N.success(k.message),I("closeDraw",!0),_())}catch(l){N.error("Se originó un error: "+l.message)}finally{u.value=!1}},p=()=>{N.error("Por favor corrige los valores con errores")},f=async t=>{console.log("uauauauau",t),t.id&&(e.city_id=t.city_id,F(t.city_id),e.province_id=t.province_id,R(t.province_id),e.district_id=t.district_id,e.ruc=t.ruc,e.components=t.components,e.startDate=Z(t.startDate,"YYYY-MM-DD"),e.years=t.years,e.aliado=t.aliado,e.focal=t.focal,e.focalCargo=t.focalCargo,e.observations=t.observations,e.alliedEntity=t.entity)};return ee(()=>{w.idConvenio&&f(w.idConvenio)}),oe(()=>w.idConvenio,t=>{t?f(t):_()}),(t,l)=>{const x=i("a-input"),k=i("a-form-item"),V=i("a-select"),M=i("a-date-picker"),b=i("a-switch"),Y=i("a-textarea"),K=i("a-button"),W=i("a-form"),de=i("a-spin");return s(),O(de,{spinning:A.value},{default:n(()=>[a(W,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:q,onFinishFailed:p},{default:n(()=>[d("div",at,[(s(!0),g(H,null,ce(z(tt),(o,te)=>(s(),g(H,{key:te},[o.type==="iText"?(s(),O(k,{key:0,name:o.name,label:o.label,rules:[{required:o.required,message:o.message,max:o.max},...o.name==="ruc"?[{type:"string",len:11,message:o.message},{pattern:/^\d{11}$/,message:"El RUC debe ser numérico."}]:[]]},{default:n(()=>[a(x,{value:e[o.name],"onUpdate:value":T=>e[o.name]=T,maxlength:o.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):$("",!0),o.type==="iSelect"?(s(),O(k,{key:1,class:"item-max",name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:n(()=>[o.name=="city_id"?(s(),O(V,{key:0,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,options:z(h).cities,"show-search":"","filter-option":D,onChange:F},null,8,["value","onUpdate:value","options"])):$("",!0),o.name=="province_id"?(s(),O(V,{key:1,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,options:z(h).provinces,"show-search":"","filter-option":D,onChange:R,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):$("",!0),o.name=="district_id"?(s(),O(V,{key:2,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,options:z(h).districts,"show-search":"","filter-option":D,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):$("",!0),o.name=="years"?(s(),O(V,{key:3,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,options:S,"show-search":"","filter-option":D},null,8,["value","onUpdate:value"])):$("",!0),o.name=="components"?(s(),O(V,{key:4,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,options:P,"show-search":"","filter-option":D},null,8,["value","onUpdate:value"])):$("",!0)]),_:2},1032,["name","label","rules"])):$("",!0),o.type==="iDate"?(s(),O(k,{key:2,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:n(()=>[o.name=="endDate"?(s(),O(M,{key:0,"disabled-date":G,locale:z(fe),disabled:!e.startDate,value:e[o.name],"onUpdate:value":T=>e[o.name]=T,style:{width:"100%"},format:ye,placeholder:"día/mes/año"},null,8,["locale","disabled","value","onUpdate:value"])):(s(),O(M,{key:1,locale:z(fe),value:e[o.name],"onUpdate:value":T=>e[o.name]=T,style:{width:"100%"},format:ye,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"]))]),_:2},1032,["name","label","rules"])):$("",!0),o.type==="iSwitch"?(s(),O(k,{key:3,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:n(()=>[a(b,{checked:e[o.name],"onUpdate:checked":T=>e[o.name]=T,"checked-children":"si","un-checked-children":"",checkedValue:1,unCheckedValue:0},null,8,["checked","onUpdate:checked"])]),_:2},1032,["name","label","rules"])):$("",!0),o.type==="iTextarea"?(s(),O(k,{key:4,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:n(()=>[a(Y,{value:e[o.name],"onUpdate:value":T=>e[o.name]=T,rows:3},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):$("",!0),o.type==="iSpace"?(s(),g("span",nt)):$("",!0)],64))),128))]),a(k,null,{default:n(()=>[a(K,{type:"primary","html-type":"submit",loading:u.value},{default:n(()=>[U.idConvenio?(s(),g("span",ot,"ACTUALIZAR")):(s(),g("span",st,"GUARDAR"))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])}}},lt=xe(it,[["__scopeId","data-v-90777ec0"]]);const rt={class:"accion-icons"},ct={key:0},dt={key:1},ut={__name:"DrawAcciones",props:["idConvenio"],emits:["refreshTable"],setup(U,{emit:y}){const m=U,h=y,I=c([]),w=c(!0),u=c(null),A=c(""),e=c(!1);c(null);const S=ne({description:null});ee(()=>{m.idConvenio&&_(m.idConvenio)}),oe(()=>m.idConvenio,p=>{p&&_()});function P(p){u.value=p.id,A.value=p.description,he(()=>{q()})}function G(p){const f=I.value.findIndex(t=>t.id===p.id);f!==-1&&(I.value[f].description=A.value),u.value=null,R(p.id)}const F=async p=>{try{const f=await J({url:`agreement/delete-acction/${p.id}`,method:"DELETE"});f.status==200&&(_(),N.success(f.message),h("refreshTable",!0))}catch(f){console.error("Error de red:",f)}},R=async p=>{try{const f={description:A.value},t=await J({url:`agreement/update/${p}`,method:"PUT",data:f});t.status==200&&(N.success(t.message),_())}catch(f){console.error("Error de red:",f)}},D=async()=>{try{const p={description:S.description,agreements_id:m.idConvenio},f=await J({url:"agreement/create-acction",method:"POST",data:p});f.status==200&&(N.success(f.message),h("refreshTable",!0),_(),S.description=null)}catch(p){console.error("Error de red:",p)}},_=async()=>{w.value=!0;try{const p=await J({url:`agreement/list/${m.idConvenio}`,method:"GET"});p.status==200&&(I.value=p.data)}catch{}finally{w.value=!1}},q=()=>{he(()=>{const p=document.getElementById("auto-resize");p.style.height="auto",p.style.height=p.scrollHeight+"px"})};return(p,f)=>{const t=i("a-textarea"),l=i("a-spin"),x=i("a-form-item"),k=i("a-button"),V=i("a-form");return s(),g("div",null,[a(l,{spinning:w.value},{default:n(()=>[(s(!0),g(H,null,ce(I.value,(M,b)=>(s(),g("div",{class:"acciones",key:b},[d("div",rt,[a(z(Pe),{class:"pointer ico-acc",onClick:Y=>P(M)},null,8,["onClick"]),u.value===M.id?(s(),O(z(je),{key:0,class:"pointer ico-save",onClick:Y=>G(M)},null,8,["onClick"])):$("",!0),a(z(be),{class:"pointer ico-acc",onClick:Y=>F(M)},null,8,["onClick"])]),u.value===M.id?(s(),g("div",ct,[a(t,{value:A.value,"onUpdate:value":f[0]||(f[0]=Y=>A.value=Y),onInput:q,id:"auto-resize"},null,8,["value"])])):(s(),g("p",dt,B(M.description),1))]))),128))]),_:1},8,["spinning"]),a(V,{layout:"vertical",model:S,name:"basic",autocomplete:"off",onFinish:D},{default:n(()=>[a(x,{name:"description",label:"Registra una acción",rules:[{required:!0,message:"Escribir la descripción"}]},{default:n(()=>[a(t,{value:S.description,"onUpdate:value":f[1]||(f[1]=M=>S.description=M),maxlength:250,rows:4},null,8,["value"])]),_:1}),a(x,null,{default:n(()=>[a(k,{type:"primary","html-type":"submit",loading:e.value},{default:n(()=>[j("CREAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const mt={__name:"DrawObservations",props:["idConvenio"],emits:["refreshTable"],setup(U,{emit:y}){const m=U,h=y;c([]);const I=c(!0);c(null),c("");const w=c(!1);c(null);const u=ne({description:null});ee(()=>{m.idConvenio&&e(m.idConvenio)}),oe(()=>m.idConvenio,S=>{S&&e()});const A=async()=>{w.value=!0;try{const S={observations:u.description},P=await J({url:`agreement/update-values/${m.idConvenio.id}`,method:"PUT",data:S});P.status==200&&(N.success(P.message),h("refreshTable",!0))}catch(S){console.error("Error de red:",S)}finally{w.value=!1}},e=async()=>{u.description=m.idConvenio.observations,u.description!=null&&(I.value=!1)};return(S,P)=>{const G=i("a-textarea"),F=i("a-form-item"),R=i("a-button"),D=i("a-form"),_=i("a-spin");return s(),g("div",null,[a(_,{spinning:I.value},{default:n(()=>[a(D,{layout:"vertical",model:u,name:"basic",autocomplete:"off",onFinish:A},{default:n(()=>[a(F,{name:"description",label:"Orbservaciones",rules:[{required:!0,message:"Escribir la descripción"}]},{default:n(()=>[a(G,{value:u.description,"onUpdate:value":P[0]||(P[0]=q=>u.description=q),rows:6},null,8,["value"])]),_:1}),a(F,null,{default:n(()=>[a(R,{type:"primary","html-type":"submit",loading:w.value},{default:n(()=>[j("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}};const pt=d("div",{class:"agreements-file"},[d("b",null,"Formatos a subir"),d("span",null,"pdf, doc, docx, xls, xlsx, ppt, pptx"),d("span",null,"*(Máximo 20MB)")],-1),vt={class:"file-options"},_t={style:{"line-height":"1.3"}},ft=["onClick"],ht=["onClick"],gt={__name:"DrawFiles",props:["idConvenio"],setup(U){Z.locale("es");const y=Ce.get("token"),m=U,h="https://apituempresa.soporte-pnte.com/api/",I="http://127.0.0.1:8000/api/",w=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?I:h,u=c(!1),A=c([]),e=c(null),S=c(null),P=c(!1),G=we(Me,{style:{fontSize:"20px"},spin:!0});ee(()=>{m.idConvenio&&f(m.idConvenio)}),oe(()=>m.idConvenio,t=>{t&&f(t)});const F=t=>Z(t).format("DD-MM-YYYY HH:mm"),R=t=>(D(t),!1),D=async t=>{const l=new FormData;l.append("file",t),l.append("agreements_id",m.idConvenio),u.value=!0;try{const{data:x}=await re.post(`${w}agreement/file`,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y}`}});x.status==200&&(N.success(x.message),f(m.idConvenio))}catch{N.error("Error al subir este tipo de archivo")}finally{u.value=!1}},_=async t=>{e.value=t.uid;try{const l=await re({url:`${w}agreement/file-download/${t.uid}`,method:"POST",responseType:"blob",headers:{Authorization:`Bearer ${y}`}}),x=window.URL.createObjectURL(new Blob([l.data])),k=document.createElement("a");k.href=x,k.setAttribute("download",t.name),document.body.appendChild(k),k.click(),window.URL.revokeObjectURL(x),document.body.removeChild(k)}catch(l){console.error("Error downloading file:",l)}finally{e.value=null}},q=t=>{t.file.status!=="uploading"&&console.log(t.file,t.fileList),t.file.status==="done"?(N.success(`${t.file.name} file uploaded successfully`),A.value=t.fileList.filter(l=>l.status!=="error")):t.file.status==="error"&&(N.error(`${t.file.name} file upload failed.`),A.value=t.fileList.filter(l=>l.uid!==t.file.uid))},p=async t=>{S.value=t.uid;try{const l=await J({url:`agreement/delete/file/${t.uid}`,method:"DELETE"});l.status==200&&(f(m.idConvenio),N.success(l.message))}catch(l){console.error("Error de red:",l)}finally{S.value=null}},f=async t=>{P.value=!0;try{const{data:l}=await re.get(`${w}agreement/list-files/${t}`,{headers:{Authorization:`Bearer ${y}`}});l.status===200&&(A.value=l.data.map(x=>({uid:x.id,name:x.name,status:"done",url:x.path,date:x.created_at})))}catch(l){console.error("Error fetching files:",l)}finally{P.value=!1}};return(t,l)=>{const x=i("a-button"),k=i("a-spin"),V=i("a-space"),M=i("a-upload");return s(),O(k,{spinning:P.value},{default:n(()=>[pt,a(M,{"file-list":A.value,name:"file",onChange:q,"custom-request":D,"before-upload":R},{itemRender:n(({file:b,actions:Y})=>[a(V,{style:{margin:"0rem 0","font-size":"13px",width:"100%"}},{default:n(()=>[d("div",vt,[d("span",_t,B(b.name),1),d("span",null,B(F(b.date)),1),e.value!=b.uid?(s(),g("a",{key:0,onClick:K=>_(b)},"Descargar",8,ft)):(s(),O(k,{key:1,indicator:z(G)},null,8,["indicator"])),S.value==b.uid?(s(),O(k,{key:2,indicator:z(G)},null,8,["indicator"])):(s(),g("a",{key:3,onClick:K=>p(b),style:{color:"var(--error)"}},[a(z(be))],8,ht))])]),_:2},1024)]),default:n(()=>[a(x,{style:{"margin-bottom":".6rem"},loading:u.value},{default:n(()=>[a(z(Je)),j(" SUBIR ARCHIVO ")]),_:1},8,["loading"])]),_:1},8,["file-list"])]),_:1},8,["spinning"])}}};const yt=d("span",{style:{"font-size":"13px"}}," TU EMPRESA ",-1),bt={key:0},Ct=d("div",{class:"compromiso compromiso-head"},[d("span",null,"#"),d("span",null,"COMPROMISOS"),d("span",{style:{"text-align":"center"}},"¿CUMPLIÓ?")],-1),wt={class:"compromiso-number"},Dt={class:"compromiso-check"},xt={style:{"font-size":"13px"}},kt={key:0},Et=d("div",{class:"compromiso compromiso-head"},[d("span",null,"#"),d("span",null,"COMPROMISOS"),d("span",{style:{"text-align":"center"}},"¿CUMPLIÓ?")],-1),St={class:"compromiso-number"},Ut={class:"compromiso-check"},Ot={class:"convenios-form"},$t=d("h4",null,"Regitsrar nuevo compromiso - TU EMPRESA",-1),It={__name:"DrawCompromisosUGSE",props:["convenio"],setup(U){const y=U,m=Ne.PRESENTED_IMAGE_SIMPLE,h=c("1");c(!1);const I=c(!1),w=c(!1),u=c([]),A=c(null),e=ne({commitment:null}),S=D=>{R()},P=async()=>{const D={commitment:e.commitment,fulfilled:0,type:h.value=="1"?"tuempresa":"aliado",id_agreement:y.convenio.id};I.value=!0;try{(await J({url:"/commitments/create",method:"POST",data:D})).status==200&&(N.success("Compromiso agregado"),e.commitment=null,R())}catch{N.error("Se presentó un error en el servidor")}finally{I.value=!1}},G=D=>{console.log("Failed:",D)},F=async D=>{try{const _=await J({url:`/commitments/fulfilled/${D}`,method:"PUT"});_.status==200&&N.success(_.message)}catch{N.error("Se presentó un error en el servidor")}},R=async D=>{w.value=!0;try{const _=await J({url:`commitments/list/${y.convenio.id}/${h.value=="1"?"tuempresa":"aliado"}`,method:"GET"});u.value=_.data,A.value=_.data}catch(_){console.error("Error de red:",_)}finally{w.value=!1}};return ee(()=>{y.convenio&&R(y.convenio)}),oe(()=>y.convenio,D=>{D?R():console.log("Fetching data........")}),(D,_)=>{const q=i("a-checkbox"),p=i("a-empty"),f=i("a-spin"),t=i("a-tab-pane"),l=i("a-tabs"),x=i("a-textarea"),k=i("a-form-item"),V=i("a-button"),M=i("a-form");return s(),g("section",null,[a(l,{activeKey:h.value,"onUpdate:activeKey":_[0]||(_[0]=b=>h.value=b),onChange:S},{default:n(()=>[a(t,{key:"1"},{tab:n(()=>[yt]),default:n(()=>[a(f,{spinning:w.value},{default:n(()=>[u.value.length>=1?(s(),g("div",bt,[Ct,(s(!0),g(H,null,ce(u.value,(b,Y)=>(s(),g("div",{class:"compromiso compromiso-body",key:Y},[d("span",wt,B(Y+1),1),d("p",null,B(b.commitment),1),d("span",Dt,[a(q,{checked:b.fulfilled,"onUpdate:checked":K=>b.fulfilled=K,onChange:K=>F(b.id)},null,8,["checked","onUpdate:checked","onChange"])])]))),128))])):(s(),O(p,{key:1,image:z(m)},null,8,["image"]))]),_:1},8,["spinning"])]),_:1}),a(t,{key:"2"},{tab:n(()=>[d("span",xt,[a(z(et)),j(" ALIADO ")])]),default:n(()=>[a(f,{spinning:w.value},{default:n(()=>[u.value.length>=1?(s(),g("div",kt,[Et,(s(!0),g(H,null,ce(A.value,(b,Y)=>(s(),g("div",{class:"compromiso compromiso-body",key:Y},[d("span",St,B(Y+1),1),d("p",null,B(b.commitment),1),d("span",Ut,[a(q,{checked:b.fulfilled,"onUpdate:checked":K=>b.fulfilled=K,onChange:K=>F(b.id)},null,8,["checked","onUpdate:checked","onChange"])])]))),128))])):(s(),O(p,{key:1,image:z(m)},null,8,["image"]))]),_:1},8,["spinning"])]),_:1})]),_:1},8,["activeKey"]),d("div",Ot,[$t,a(M,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:P,onFinishFailed:G},{default:n(()=>[a(k,{label:"Descripción:",name:"commitment",rules:[{required:!0,message:"Por favor menciona el compromiso"}]},{default:n(()=>[a(x,{value:e.commitment,"onUpdate:value":_[1]||(_[1]=b=>e.commitment=b),rows:4},null,8,["value"])]),_:1}),a(k,null,{default:n(()=>[a(V,{type:"primary","html-type":"submit",loading:I.value},{default:n(()=>[j("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}};const pe=U=>(Ge("data-v-5982c910"),U=U(),Ve(),U),At=pe(()=>d("h3",{class:"title-produce"},"CONVENIOS UGSE",-1)),Tt=pe(()=>d("img",{width:"20",style:{margin:"-2px 0 0 0"},src:He},null,-1)),Rt={key:0,class:"list-days"},zt={key:1,class:"list-days"},Lt=["onClick"],Pt=["onClick"],Mt=["onClick"],Nt=pe(()=>d("a",null,"Eliminar",-1)),Ft={class:"paginator"},qt={__name:"ConvenioEstado",props:["idConvenio"],setup(U){Z.locale("es"),JSON.parse(localStorage.getItem("profile")),De();const y=Ce.get("token"),m="https://apituempresa.soporte-pnte.com/api/",h="http://127.0.0.1:8000/api/",I=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?h:m;c(null),c(null);const w=c(!1),u=c(null),A=c(0),e=c(50),S=c({page:0}),P=c(1200),G=c([]),F=c(!1),R=c(!1),D=c(!1),_=c(!1),q=c(!1),p=c(!1);c(null),c(null);const f=c(window.innerHeight-100),t=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGIÓN",dataIndex:"city",fixed:"left",width:120},{title:"PROVINCIA",dataIndex:"province",fixed:"left",width:120},{title:"DISTRITO",dataIndex:"district",fixed:"left",width:140},{title:"ENTIDAD ALIADA",dataIndex:"entity",width:220},{title:"INICIO DE CONVENIO VIGENTE",dataIndex:"startDate",align:"center",width:180},{title:"N° DE AÑOS VIGENTE",dataIndex:"years",width:120,align:"center"},{title:"FIN DEL CONVENIO",dataIndex:"endDate",align:"center",width:180},{title:"ESTADO",dataIndex:"status",align:"center",width:150},{title:"FECHA RESTANTE",dataIndex:"numbrestantes",align:"center",width:140},{title:"OBSERVACIONES",dataIndex:"observations",align:"center",width:140},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],l=ne({search:""}),x=()=>{let v={search:l.search};Q(v)},k=()=>{l.search||Q()},V=v=>{u.value=v,R.value=!0},M=v=>{u.value=v,_.value=!0},b=v=>Z(v).format("DD/MM/YYYY"),Y=v=>{u.value=v.id,q.value=!0},K=v=>{u.value=v,p.value=!0},W=(v,r)=>{const L=new Date(v),X=new Date,ue=L.getTime()-X.getTime();return Math.floor(ue/(1e3*3600*24))+1},de=v=>v<=0||v<20?"red":v<40?"#f9e717":"#11d811",o=v=>{S.value.page=v,Q()},te=()=>{f.value=window.innerHeight-320},T=()=>{u.value=null,R.value=!0},se=v=>{Q(),v==1&&(R.value=!1,u.value=null),v==2&&(D.value=!1),v==4&&(_.value=!1),u.value=null},ke=async v=>{try{const r=await J({url:`agreement/delete/${v.id}`,method:"DELETE"});r.status==200&&(Q(),N.success(r.message))}catch(r){console.error("Error de red:",r)}},Ee=Fe(()=>v=>S.value.page*e.value+v+1),Q=async v=>{try{F.value=!0;let r;r=S.value.page==0?"":S.value,r=v?{...r,...v}:r;const{data:L}=await J({url:"agreement/list/ugse",method:"GET",params:r});G.value=L==null?void 0:L.data,A.value=L.total,e.value=L.per_page}catch(r){console.error("Error de red:",r)}finally{F.value=!1}},Se=async()=>{w.value=!0;try{const v=await re({url:`${I}agreement/download`,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${y}`}}),r=window.URL.createObjectURL(new Blob([v.data])),L=document.createElement("a"),X="convenios.xlsx";L.href=r,L.setAttribute("download",X),document.body.appendChild(L),L.click(),window.URL.revokeObjectURL(r),document.body.removeChild(L)}catch(v){console.error("Error downloading file:",v)}finally{w.value=!1}};return qe(()=>{window.removeEventListener("resize",te)}),ee(()=>{window.addEventListener("resize",te),te(),Q()}),(v,r)=>{const L=i("a-button"),X=i("a-col"),ue=i("a-input"),ve=i("a-input-group"),Ue=i("a-row"),_e=i("a-tag"),Oe=i("a-progress"),ie=i("a-menu-item"),$e=i("a-popconfirm"),Ie=i("a-menu"),Ae=i("a-dropdown"),Te=i("a-table"),Re=i("a-pagination"),ae=i("a-drawer");return s(),g(H,null,[d("div",null,[At,a(Ue,{style:{margin:"1rem 0"}},{default:n(()=>[a(X,{xs:24,md:12,lg:18},{default:n(()=>[a(L,{type:"primary",onClick:T,style:{"margin-right":".5rem"}},{default:n(()=>[j("NUEVO")]),_:1}),a(L,{class:"btn-excel",onClick:Se,loading:w.value,type:"primary"},{default:n(()=>[Tt]),_:1},8,["loading"])]),_:1}),a(X,{xs:24,md:12,lg:6},{default:n(()=>[a(ve,{compact:""},{default:n(()=>[a(ue,{value:l.search,"onUpdate:value":r[0]||(r[0]=C=>l.search=C),style:{width:"calc(100% - 80px)"},onInput:k},null,8,["value"]),a(L,{type:"primary",disabled:l.search==="",onClick:x},{default:n(()=>[j("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(Te,{bordered:"",scroll:{x:P.value,y:f.value},class:"table-agreements",columns:t,"data-source":G.value,pagination:!1,loading:F.value,size:"small"},{headerCell:n(({column:C})=>[]),bodyCell:n(({column:C,record:E,index:ze})=>[C.dataIndex=="idx"?(s(),g(H,{key:0},[j(B(Ee.value(ze)),1)],64)):$("",!0),C.dataIndex=="externo"?(s(),g(H,{key:1},[E.external==1?(s(),O(_e,{key:0,color:"cyan"},{default:n(()=>[j("Externo")]),_:1})):$("",!0)],64)):$("",!0),C.dataIndex=="startOperations"?(s(),g(H,{key:2},[j(B(b(E.startOperations)),1)],64)):$("",!0),C.dataIndex=="startDate"?(s(),g(H,{key:3},[j(B(b(E==null?void 0:E.startDate)),1)],64)):$("",!0),C.dataIndex=="endDate"?(s(),g(H,{key:4},[j(B(b(E==null?void 0:E.endDate)),1)],64)):$("",!0),C.dataIndex=="numbrestantes"?(s(),g(H,{key:5},[W(E.endDate,E.startDate)>=1?(s(),g("p",Rt,B(W(E.endDate,E.startDate))+" días faltantes",1)):(s(),g("p",zt,B(W(E.endDate,E.startDate))+" días vencidos",1))],64)):$("",!0),C.dataIndex=="status"?(s(),O(Oe,{key:6,style:{margin:"0"},percent:W(E.endDate,E.startDate),size:4,showInfo:!1,strokeColor:de(W(E.endDate,E.startDate))},null,8,["percent","strokeColor"])):$("",!0),C.dataIndex=="observations"?(s(),g(H,{key:7},[E!=null&&E.observations?(s(),O(z(Ke),{key:0,class:"observation-icon",onClick:le=>M(E)},null,8,["onClick"])):$("",!0)],64)):$("",!0),C.dataIndex=="actions"?(s(),O(Ae,{key:8,trigger:["click"]},{overlay:n(()=>[a(Ie,null,{default:n(()=>[a(ie,null,{default:n(()=>[d("a",{onClick:le=>Y(E)},"Archivos",8,Lt)]),_:2},1024),a(ie,null,{default:n(()=>[d("a",{onClick:le=>K(E)},"Compromisos",8,Pt)]),_:2},1024),a(ie,null,{default:n(()=>[d("a",{onClick:le=>V(E)},"Editar",8,Mt)]),_:2},1024),a(ie,null,{default:n(()=>[a($e,{title:"¿Seguro de eliminar?",onConfirm:le=>ke(E)},{icon:n(()=>[a(z(Ye),{style:{color:"red"}})]),default:n(()=>[Nt]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:n(()=>[d("a",{class:"ant-dropdown-link",onClick:r[1]||(r[1]=Be(()=>{},["prevent"]))},[a(L,{shape:"circle",icon:we(z(Ze)),size:"small"},null,8,["icon"])])]),_:2},1024)):$("",!0)]),_:1},8,["scroll","data-source","loading"])]),d("div",Ft,[d("span",null,[a(_e,{color:"blue"},{default:n(()=>[d("b",null,B(A.value),1)]),_:1}),j("Convenios")]),a(Re,{size:"small",total:A.value,pageSize:e.value,onChange:o,showSizeChanger:!1},null,8,["total","pageSize"])]),a(ae,{open:R.value,"onUpdate:open":r[3]||(r[3]=C=>R.value=C),"root-class-name":"root-class-name",title:"Convenios",placement:"right",width:"650"},{default:n(()=>[a(lt,{idConvenio:u.value,onCloseDraw:r[2]||(r[2]=C=>se(1))},null,8,["idConvenio"])]),_:1},8,["open"]),a(ae,{open:D.value,"onUpdate:open":r[6]||(r[6]=C=>D.value=C),title:"Acciones",placement:"right",width:"550"},{default:n(()=>[a(ut,{idConvenio:u.value,onCloseDraw:r[4]||(r[4]=C=>se(2)),onRefreshTable:r[5]||(r[5]=C=>Q())},null,8,["idConvenio"])]),_:1},8,["open"]),a(ae,{open:q.value,"onUpdate:open":r[8]||(r[8]=C=>q.value=C),title:"Cargar Archivos",placement:"right",width:"550"},{default:n(()=>[a(gt,{idConvenio:u.value,onCloseDraw:r[7]||(r[7]=C=>se(3))},null,8,["idConvenio"])]),_:1},8,["open"]),a(ae,{open:_.value,"onUpdate:open":r[11]||(r[11]=C=>_.value=C),title:"Observaciones",placement:"right",width:"550"},{default:n(()=>[a(mt,{idConvenio:u.value,onCloseDraw:r[9]||(r[9]=C=>se(4)),onRefreshTable:r[10]||(r[10]=C=>Q())},null,8,["idConvenio"])]),_:1},8,["open"]),a(ae,{open:p.value,"onUpdate:open":r[12]||(r[12]=C=>p.value=C),title:"Compromisos",placement:"right",width:"850"},{default:n(()=>[a(It,{convenio:u.value},null,8,["convenio"])]),_:1},8,["open"])],64)}}},Zt=xe(qt,[["__scopeId","data-v-5982c910"]]);export{Zt as default};
