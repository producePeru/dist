import{_ as ee}from"./TableComponent-dcafddd3.js";import{p as S,r as s,a as j,k as Z,T as ae,W as q,b as M,o as d,y as W,i as O,L as te,d as u,c as r,w as k,e as n,F as Q,v as K,j as L,$ as ne,z as I,h as V,m as X,u as oe,t as v,n as se}from"./index-617fe921.js";import{_ as le}from"./FormComponent-75459822.js";import{u as ie}from"./selectes-25eab61a.js";import{U as re}from"./UpImage-f0616125.js";import"./es-aae8217e.js";import{u as de,t as ce}from"./timezone-c197f371.js";import"./downloadExcel-0e384af5.js";import{G as ue}from"./GlobalOutlined-83bc005e.js";import{U as me}from"./UserOutlined-8b19323a.js";import{M as pe}from"./MailOutlined-d76e1cbc.js";import{P as fe}from"./PhoneOutlined-757eaed4.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-d7cd5980.js";import"./MoreOutlined-5f968098.js";import"./quill.snow-52b1dbfa.js";import"./_plugin-vue_export-helper-c27b6911.js";const _e={key:1,class:"mp-asesoria"},he={key:0},ge={class:"as-personalizada"},ve={__name:"DrawMPAsesorias",props:["info"],emits:["closeDraw"],setup(J,{emit:P}){S.locale("es"),S.extend(de),S.extend(ce);const H=s({title:{type:"iText",label:"NOMBRE DEL EVENTO",name:"title",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},description:{type:"iTextArea",label:"DESCRIPCIÓN DEL EVENTO",name:"description",required:!0,message:"Escribir nombre del evento",disabled:!1,rows:6,max:250},requirements:{type:"iQuillEditor",label:"MENSAJE DE LOS REQUISITOS",name:"requirements",required:!0,message:"Escribir los requisitos",disabled:!1,class:"quill-height-200"},capacitador_id:{type:"iSelect",label:"ASESOR DE LA ASESORÍA",name:"capacitador_id",required:!0,message:"Seleccionar capacitador",disabled:!1},imgBanner:{type:"iSlot",name:"iSlotOptions"}}),C=ie(),y=P,l=J,p=s(!0),z=s("GUARDAR"),a=j({}),N=s(!1),R=s(null),B=s(null),U=s({city_id:[],fairtype_id:[],modality_id:[],capacitador_id:[]}),f=j({schedules:[{date:null,startTime:null}]}),$=()=>{f.schedules.push({date:""})},F=e=>{f.schedules.splice(e,1)},Y=()=>l.info?{name:l.info.image_name,url:l.info.image_url}:null,E=e=>{e=="modality_id"&&console.log("a9a9a9a99a9a9")},o=async e=>{e=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),H.value.dateTramite.disabled=!1)},m=async e=>{R.value=e.id},A=async e=>{e=="city_id"&&(a.city_id=null),e=="capacitador_id"&&(U.value.capacitadores=C.capacitadores)},G=async(e,t)=>{},_=async()=>{var t,x;const e=R.value??((x=(t=l.info)==null?void 0:t.image)==null?void 0:x.id);if(!f.schedules.length){V.error("Debe agregar al menos una fecha y horario.");return}for(const c of f.schedules)if(!c.date||!c.startTime||c.startTime.length!==2){V.error("Todas las fechas deben tener rango de horario válido.");return}N.value=!0;try{const c={title:a.title,description:a.description,requirements:a.requirements,capacitador_id:a.capacitador_id,image_id:e,link:a.link,schedules:f.schedules.map(b=>({date:S(b.date).format("YYYY-MM-DD"),startTime:S(b.startTime[0]).format("HH:mm"),endTime:S(b.startTime[1]).format("HH:mm")}))},h=l.info?`mp/update-event/${l.info.id}`:"mp/create-personalized-advice",D=l.info?"PUT":"POST",T=await X({url:h,method:D,data:c});T.status===200&&(V.success(T.message),g(),y("closeDraw",!0))}catch(c){console.error("Error:",c);const h=document.getElementsByClassName("ant-drawer-body")[0];h&&(h.scrollTop=0)}finally{N.value=!1}},g=()=>{for(const e in a)delete a[e];f.schedules=[{date:null,startTime:null}],R.value=null},i=async e=>{p.value=!0;try{e&&(console.log("infoooo",e),a.title=e.title,a.description=e.description,a.requirements=e.requirements)}catch(t){console.error("Error al cargar la información:",t)}finally{p.value=!1}};return Z(async()=>{l.info?i(l.info):p.value=!1,await C.fetchCapacitadores(),U.value.capacitador_id=C.capacitadores}),ae(()=>l.info,e=>{e?i(e):g()}),q("formState",a),q("loadingState",N),(e,t)=>{const x=M("a-date-picker"),c=M("a-time-range-picker"),h=M("a-button");return p.value?(d(),W(O(te),{key:0,style:{color:"#00a6db"}})):(d(),u("div",_e,[r(le,{fields:H.value,options:U.value,btnSaveName:z.value,onHandleInputEvent:E,resetSelect:B.value,onHandleFocusSelect:A,onHandleChangeSelect:G,onHandleChangeClock:o,onOnSubmit:_},{default:k(({field:D})=>[D.name=="iSlotOptions"?(d(),u("div",he,[n("div",null,[(d(!0),u(Q,null,K(f.schedules,(T,b)=>(d(),u("div",{class:"as-dates",key:b},[n("label",null,[t[0]||(t[0]=L(" FECHA DE LA ASESORÍA ")),r(x,{value:T.date,"onUpdate:value":w=>T.date=w,style:{width:"100%","margin-bottom":"8px"},format:"DD/MM/YYYY",placeholder:"Seleccionar fecha","disabled-date":w=>w&&w<O(S)().startOf("day")},null,8,["value","onUpdate:value","disabled-date"])]),n("label",null,[t[1]||(t[1]=L(" HORARIO DE LA ASESORÍA ")),r(c,{value:T.startTime,"onUpdate:value":w=>T.startTime=w,style:{width:"100%","margin-bottom":"8px"},format:"HH:mm",minuteStep:30},null,8,["value","onUpdate:value"])]),b!=0?(d(),W(O(ne),{key:0,class:"as-date-delete",onClick:w=>F(b)},null,8,["onClick"])):I("",!0)]))),128)),r(h,{type:"dashed",block:"",onClick:$,style:{"margin-bottom":"2rem"}},{default:k(()=>t[2]||(t[2]=[L(" + Agregar fecha y horario ")])),_:1})]),n("div",ge,[t[3]||(t[3]=n("label",null,"CARGAR IMAGEN",-1)),r(re,{"accept-formats":["image/jpeg","image/png"],maxImages:1,nameType:"mp",onUploadSuccess:m,imageLoad:Y()},null,8,["imageLoad"])])])):I("",!0)]),_:1},8,["fields","options","btnSaveName","resetSelect"])]))}}};const Se={class:"layout-content"},ye=["href"],Ee={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={key:0},xe={style:{"font-weight":"500"}},Te={style:{"font-size":"13px"}},be={style:{"font-size":"13px"}},we=["innerHTML"],ke=["onClick"],Ge={__name:"mp-asesorias",setup(J){JSON.parse(localStorage.getItem("role"));const P=s([]),H=s(0),C=s(150),y=s(!1);s(!1),oe();const l=s(!1),p=s(null),z=s(!1),a=j({page:1}),N=[{title:"#",dataIndex:"idx",align:"center",width:50,fixed:"left"},{title:"TEMA",dataIndex:"title",width:140},{title:"DESCRIPCIÓN",dataIndex:"description",width:200},{title:"HORARIO",dataIndex:"hours",width:220},{title:"REQUISITOS",dataIndex:"requirements",width:160},{title:"CAPACITADOR",dataIndex:"capacitador_name",width:160},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],R=o=>o?S(o,["HH:mm:ss","HH:mm"]).format("hh:mm A"):null,B=o=>{p.value=o,y.value=!0},U=()=>{E(),y.value=!1},f=()=>{p.value=null,y.value=!0},$=async()=>{},F=async o=>{a.page=o,await E()},Y=async o=>{o&&(a.page=1,await E())},E=async()=>{try{l.value=!0;const o={page:a.page},m=await X({url:"mp/mp-index-advice",method:"GET",params:o}),{data:A}=m;P.value=A.data,H.value=A.total,C.value=A.per_page}catch(o){console.error("Error de red:",o)}finally{l.value=!1}};return Z(async()=>{await E()}),q("search",a),q("loading",l),q("loadingFile",z),(o,m)=>{const A=M("a-menu-item"),G=M("a-drawer");return d(),u("div",Se,[r(ee,{title:"ASESORÍAS PERSONALIZADAS",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",columns:N,titleSearch:"BUSCAR POR EVENTO",pageSize:C.value,nameTotal:"Capacitaciones",dataSource:P.value,total:H.value,btnUpdate:!0,onHandleNew:f,onHandleCallFetchData:E,onHandleDownloadExcel:$,onHandleSearch:Y,onHandlePaginator:F},{header:k(()=>m[1]||(m[1]=[])),"data-cell":k(({column:_,record:g})=>[_.dataIndex=="link"?(d(),u(Q,{key:0},[g.link?(d(),u("a",{key:0,target:"'_blank'",href:g.link,style:{color:"#7d4fc6","font-size":"16px","margin-top":"-2px"}},[r(O(ue))],8,ye)):I("",!0)],64)):I("",!0),_.dataIndex=="hours"?(d(!0),u(Q,{key:1},K(g.schedules,(i,e)=>{var t,x,c,h,D;return d(),u("div",{class:"hour-participant",key:e},[n("div",{class:se(i.participant?"hour-participant-detail":"hour-participant-no-detail")},[n("span",null,v(i.date_format),1),m[2]||(m[2]=L(" | ")),n("span",null,v(R(i.startTime))+" - "+v(R(i.endTime)),1),n("div",Ee,[i.participant?(d(),u("div",Ae,[n("div",null,[n("span",xe,[r(O(me)),L(" "+v((t=i.participant)==null?void 0:t.names)+" "+v((x=i.participant)==null?void 0:x.last_name)+" "+v((c=i.participant)==null?void 0:c.middle_name),1)])]),n("div",null,[r(O(pe),{style:{"padding-right":"5px"}}),n("span",Te,v((h=i.participant)==null?void 0:h.email),1)]),n("div",null,[r(O(fe),{style:{"padding-right":"5px"}}),n("span",be,v((D=i.participant)==null?void 0:D.phone),1)])])):I("",!0)])],2)])}),128)):I("",!0),_.dataIndex=="requirements"?(d(),u("div",{key:2,innerHTML:g.requirements},null,8,we)):I("",!0)]),"custom-options":k(({record:_})=>[r(A,null,{default:k(()=>[n("a",{onClick:g=>B(_)},"Editar",8,ke)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),r(G,{open:y.value,"onUpdate:open":m[0]||(m[0]=_=>y.value=_),title:p.value?"EDITAR ASESORÍA":"REGISTRAR UNA ASESORÍA",placement:"right",width:"550"},{default:k(()=>[r(ve,{onCloseDraw:U,info:p.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{Ge as default};
