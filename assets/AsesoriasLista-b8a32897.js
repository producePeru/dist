import{_ as ge}from"./icoexcel-a1d0882d.js";import{K as p,g as we,r as u,v as fe,H as be,k as Se,b as g,o,d as s,e as c,n as M,c as I,w as f,h as ae,s as n,i,t,F as l,G as ke,m as Ce,y as Ae,q as De,p as Re,j as Ye}from"./index-e385c1d5.js";import"./es-57404d49.js";import{u as ze}from"./selectes-2f3518f0.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";const U=b=>(Re("data-v-b08355ab"),b=b(),Ye(),b),Ne={class:"header-rep"},Me={class:"filters-dig"},Ue=U(()=>c("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:ge},null,-1)),Fe={class:"filters"},Le={class:"rango"},Pe=U(()=>c("label",null,"Por rango de fechas",-1)),Be={key:0,class:"asesor"},Te=U(()=>c("label",null,"Por asesores",-1)),$e={class:"paginator-asesories"},te=20,Oe={__name:"AsesoriasLista",setup(b){p.locale("es");const ie=JSON.parse(localStorage.getItem("role")),oe=we.get("token"),se="https://apituempresa.soporte-pnte.com/api/",ne="http://127.0.0.1:8000/api/",le=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?ne:se,S=ze(),F=u([]),D=u(!1),R=u(!1),Y=u(0),h=u({page:0}),m=u("asesorias"),de=u(1200),L=u(window.innerHeight-100),k=u("historial/advisories/filters"),C=u([]),v=u(null);S.$patch({asesores:S.asesores}),S.fetchAsesores();const re=u([{label:"Últimos 7 días",value:[p().add(-7,"d"),p()]},{label:"Últimos 14 días",value:[p().add(-14,"d"),p()]},{label:"Último mes",value:[p().add(-30,"d"),p()]},{label:"Último 3 meses",value:[p().add(-90,"d"),p()]}]),z=()=>{L.value=window.innerHeight-320};fe(()=>{window.removeEventListener("resize",z)});const w=u([]),P=u([{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"Fecha",dataIndex:"ase_fecha",fixed:"left",align:"center",width:130},{title:"Solicitante Apellidos",dataIndex:"sol_apellidos",width:180},{title:"Solicitante Nombres",dataIndex:"sol_nombres",width:180},{title:"S. Tipo Documento",dataIndex:"sol_tipo_doc",width:160},{title:"S. Núm. Documento",dataIndex:"sol_num_doc",width:150},{title:"S. Email",dataIndex:"sol_email",width:200},{title:"S. Celular",dataIndex:"sol_phone",width:110,align:"center"},{title:"Asesorado por",dataIndex:"asesor",width:200},{title:"Supervisor",dataIndex:"misupervisor",width:200},{title:"Región",dataIndex:"mype_region",width:140},{title:"Provincia",dataIndex:"mype_provincia",width:160},{title:"Distrito",dataIndex:"mype_distrito",width:160},{title:"Componente",dataIndex:"componente",width:180},{title:"Tema",dataIndex:"tema_componente",width:180},{title:"Modalidad",dataIndex:"modality",width:120,align:"center"}]),ue=u([{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"Fecha",dataIndex:"ase_fecha",fixed:"left",align:"center",width:130},{title:"Solicitante Apellidos",dataIndex:"sol_apellidos",width:180},{title:"Solicitante Nombres",dataIndex:"sol_nombres",width:180},{title:"S. Tipo Documento",dataIndex:"sol_tipo_doc",width:160},{title:"S. Núm. Documento",dataIndex:"sol_num_doc",width:150},{title:"S. Email",dataIndex:"sol_email",width:200},{title:"S. Celular",dataIndex:"sol_phone",width:110,align:"center"},{title:"Asesorado por",dataIndex:"asesor",width:200},{title:"Supervisor",dataIndex:"misupervisor",width:200},{title:"Región",dataIndex:"mype_region",width:140},{title:"Provincia",dataIndex:"mype_provincia",width:160},{title:"Distrito",dataIndex:"mype_distrito",width:160},{title:"Detalle del trámite",dataIndex:"detalle_tramite",width:180},{title:"Sector económico",dataIndex:"sector_economico",width:180},{title:"Actividad comercial",dataIndex:"atividad_comercial",width:180},{title:"Modalidad",dataIndex:"modality",width:120,align:"center"}]),ce=u([{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"Fecha",dataIndex:"ase_fecha",fixed:"left",align:"center",width:130},{title:"Solicitante Apellidos",dataIndex:"sol_apellidos",width:180},{title:"Solicitante Nombres",dataIndex:"sol_nombres",width:180},{title:"S. Tipo Documento",dataIndex:"sol_tipo_doc",width:160},{title:"S. Núm. Documento",dataIndex:"sol_num_doc",width:150},{title:"S. Email",dataIndex:"sol_email",width:200},{title:"S. Celular",dataIndex:"sol_phone",width:110,align:"center"},{title:"Asesorado por",dataIndex:"asesor",width:200},{title:"Supervisor",dataIndex:"misupervisor",width:200},{title:"Región",dataIndex:"mype_region",width:140},{title:"Provincia",dataIndex:"mype_provincia",width:160},{title:"Distrito",dataIndex:"mype_distrito",width:160},{title:"Dirección",dataIndex:"mype_direccion",width:230},{title:"Nombre empresa",dataIndex:"mype_nombre",width:180},{title:"Régimen",dataIndex:"tipo_regimen",width:80,align:"center"},{title:"Número de notaría",dataIndex:"numero_envio_notaria",width:140},{title:"Notaría",dataIndex:"notaria",width:150},{title:"Modalidad",dataIndex:"modality",width:120,align:"center"},{title:"RUC",dataIndex:"ruc",width:120,align:"center"}]),pe=async()=>{y(m.value)},me=r=>{h.value.page=r,y()},_e=r=>p(r).format("DD-MM-YYYY HH:mm"),ve=r=>({asesorias:"Asesorías",ruc10:"Formalizaciones RUC 10",ruc20:"Formalizaciones RUC 20"})[r],he=async()=>{R.value=!0;let r="",d="";m.value=="asesorias"&&(r="download/asesories",d="asesorias.xlsx"),m.value=="ruc10"&&(r="download/formalizations-ruc10",d="formalizacionesRUC10.xlsx"),m.value=="ruc20"&&(r="download/formalizations-ruc20",d="formalizacionesRUC20.xlsx");try{const _={};v.value&&(_.dateStart=p(v.value[0]).format("YYYY-MM-DD"),_.dateEnd=p(v.value[1]).format("YYYY-MM-DD"));const{data:E}=await ke.get(`${le}${r}`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${oe}`},params:_,responseType:"blob"}),N=new Blob([E]),A=window.URL.createObjectURL(N),x=document.createElement("a");x.href=A,x.download=d,document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch{Ce.error("Error")}finally{R.value=!1}},y=async r=>{try{D.value=!0;const d={...C.value.length>=1&&{user_id:C.value.toString()},...v.value&&{dateStart:p(v.value[0]).format("YYYY-MM-DD")},...v.value&&{dateEnd:p(v.value[1]).format("YYYY-MM-DD")},...h.value.page!=0&&{page:h.value.page}};m.value=="asesorias"&&(w.value=P.value),r=="asesorias"&&(h.value.page=0,m.value=r,w.value=P.value,k.value="historial/advisories/filters"),r=="ruc10"&&(h.value.page=0,m.value=r,w.value=ue.value,k.value="historial/formalizations-10/filters"),r=="ruc20"&&(h.value.page=0,m.value=r,w.value=ce.value,k.value="historial/formalizations-20/filters");const _=await Ae({url:k.value,method:"GET",params:d});F.value=_.data,Y.value=_.total}catch(d){console.error("Error de red:",d)}finally{D.value=!1}},xe=be(()=>r=>((h.value.page==0?1:h.value.page)-1)*te+r+1);return Se(()=>{y(),window.addEventListener("resize",z),z()}),(r,d)=>{const _=g("a-button"),E=g("a-range-picker"),N=g("a-select"),A=g("a-tag"),x=g("a-table"),Ie=g("a-pagination");return o(),s(l,null,[c("div",null,[c("div",Ne,[c("h3",{class:M({hdactive:m.value=="asesorias"}),onClick:d[0]||(d[0]=a=>y("asesorias"))},"ASESORÍAS",2),c("h3",{class:M({hdactive:m.value=="ruc10"}),onClick:d[1]||(d[1]=a=>y("ruc10"))},"FORMALIZACIONES RUC 10",2),c("h3",{class:M({hdactive:m.value=="ruc20"}),onClick:d[2]||(d[2]=a=>y("ruc20"))},"FORMALIZACIONES RUC 20",2)]),c("div",Me,[c("div",null,[c("div",null,[I(_,{onClick:he,loading:R.value},{default:f(()=>[Ue,i(" DESCARGAR ")]),_:1},8,["loading"])])]),c("div",Fe,[c("div",Le,[Pe,I(E,{value:v.value,"onUpdate:value":d[3]||(d[3]=a=>v.value=a),presets:re.value},null,8,["value","presets"])]),ae(ie)[0].id==1?(o(),s("div",Be,[Te,I(N,{value:C.value,"onUpdate:value":d[4]||(d[4]=a=>C.value=a),mode:"multiple",placeholder:"Selecciona asesores","max-tag-count":"responsive",options:ae(S).asesores},null,8,["value","options"])])):n("",!0),I(_,{type:"primary",class:"btn-produce",onClick:pe},{default:f(()=>[i("BUSCAR")]),_:1})])]),I(x,{bordered:"",scroll:{x:de.value,y:L.value},class:"table-historial",columns:w.value,"data-source":F.value,pagination:!1,loading:D.value,size:"small"},{bodyCell:f(({column:a,record:e,index:ye})=>{var B,T,$,O,H,V,j,G,q,Z,J,K,X,Q,W,ee;return[a.dataIndex=="idx"?(o(),s(l,{key:0},[i(t(xe.value(ye)),1)],64)):n("",!0),a.dataIndex=="ase_fecha"?(o(),s(l,{key:1},[i(t(_e(e.created_at)),1)],64)):n("",!0),a.dataIndex=="sol_apellidos"?(o(),s(l,{key:2},[i(t(e.people.lastname)+" "+t(e.people.middlename),1)],64)):n("",!0),a.dataIndex=="sol_nombres"?(o(),s(l,{key:3},[i(t(e.people.name),1)],64)):n("",!0),a.dataIndex=="sol_tipo_doc"?(o(),s(l,{key:4},[i(t(e.people.typedocument.name),1)],64)):n("",!0),a.dataIndex=="sol_num_doc"?(o(),s(l,{key:5},[i(t(e.people.documentnumber),1)],64)):n("",!0),a.dataIndex=="sol_email"?(o(),s(l,{key:6},[i(t(e.people.email),1)],64)):n("",!0),a.dataIndex=="sol_phone"?(o(),s(l,{key:7},[i(t(e.people.phone),1)],64)):n("",!0),a.dataIndex=="asesor"?(o(),s(l,{key:8},[i(t((B=e.user)==null?void 0:B.profile.name)+" "+t((T=e.user)==null?void 0:T.profile.lastname)+" "+t(($=e.user)==null?void 0:$.profile.middlename)+" ",1)],64)):n("",!0),a.dataIndex=="misupervisor"?(o(),s(l,{key:9},[i(t((O=e.supervisor)==null?void 0:O.supervisor_user.profile.name)+" "+t((H=e.supervisor)==null?void 0:H.supervisor_user.profile.lastname)+" "+t((V=e.supervisor)==null?void 0:V.supervisor_user.profile.middlename),1)],64)):n("",!0),a.dataIndex=="mype_region"?(o(),s(l,{key:10},[i(t(e.city.name),1)],64)):n("",!0),a.dataIndex=="mype_provincia"?(o(),s(l,{key:11},[i(t(e.province.name),1)],64)):n("",!0),a.dataIndex=="mype_distrito"?(o(),s(l,{key:12},[i(t(e.district.name),1)],64)):n("",!0),a.dataIndex=="componente"?(o(),s(l,{key:13},[i(t((j=e.component)==null?void 0:j.name),1)],64)):n("",!0),a.dataIndex=="tema_componente"?(o(),s(l,{key:14},[i(t((G=e.theme)==null?void 0:G.name),1)],64)):n("",!0),a.dataIndex=="detalle_tramite"?(o(),s(l,{key:15},[i(t((q=e.detailprocedure)==null?void 0:q.name),1)],64)):n("",!0),a.dataIndex=="sector_economico"?(o(),s(l,{key:16},[i(t((Z=e.economicsector)==null?void 0:Z.name),1)],64)):n("",!0),a.dataIndex=="atividad_comercial"?(o(),s(l,{key:17},[i(t((J=e.comercialactivity)==null?void 0:J.name),1)],64)):n("",!0),a.dataIndex=="mype_direccion"?(o(),s(l,{key:18},[i(t(e==null?void 0:e.address),1)],64)):n("",!0),a.dataIndex=="mype_nombre"?(o(),s(l,{key:19},[i(t((K=e.mype)==null?void 0:K.name),1)],64)):n("",!0),a.dataIndex=="tipo_regimen"?(o(),s(l,{key:20},[i(t((X=e.regime)==null?void 0:X.name),1)],64)):n("",!0),a.dataIndex=="numero_envio_notaria"?(o(),s(l,{key:21},[i(t(e.numbernotary),1)],64)):n("",!0),a.dataIndex=="notaria"?(o(),s(l,{key:22},[i(t((Q=e.notary)==null?void 0:Q.name),1)],64)):n("",!0),a.dataIndex=="codesunarp"?(o(),s(l,{key:23},[i(t(e.codesunarp),1)],64)):n("",!0),a.dataIndex==="modality"?(o(),De(A,{key:24,color:e.modality.name=="Presencial"?"green":"orange"},{default:f(()=>[i(t(e.modality.name),1)]),_:2},1032,["color"])):n("",!0),a.dataIndex=="ruc"?(o(),s(l,{key:25},[i(t((W=e.mype)!=null&&W.ruc?`20${(ee=e.mype)==null?void 0:ee.ruc}`:""),1)],64)):n("",!0)]}),_:1},8,["scroll","columns","data-source","loading"])]),c("div",$e,[c("span",null,[I(A,{color:"blue"},{default:f(()=>[c("b",null,t(Y.value),1)]),_:1}),i(t(ve(m.value)),1)]),I(Ie,{size:"small",total:Y.value,pageSize:te,onChange:me,showSizeChanger:!1,defaultCurrent:2},null,8,["total"])])],64)}}},Ze=Ee(Oe,[["__scopeId","data-v-b08355ab"]]);export{Ze as default};
