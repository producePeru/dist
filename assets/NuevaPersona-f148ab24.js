import{K as y,y as fe,r as h,u as he,a as ge,k as De,b as _,o as r,d as R,c as D,w as f,e as P,F as ae,x as qe,q as u,h as T,s as m,L as Ye,t as xe,i as Se,p as Te,j as Ne,m as q,z as N,f as I}from"./index-65e669a4.js";import{u as we}from"./selectes-f74fa27c.js";import{d as ke}from"./selects-c77e0024.js";import"./es-207283b4.js";import{_ as Me}from"./_plugin-vue_export-helper-c27b6911.js";const Ee={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},city_id:{type:"iSelect",label:"Departamento residente",name:"city_id",required:!0,message:"Seleccionar departamento",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!0,message:"¿Tiene discapacidad?",disabled:!0}};const te=w=>(Te("data-v-7676d54a"),w=w(),Ne(),w),Ue={class:"agreement-wrapper"},$e=te(()=>P("h3",null,"Formulario de registro",-1)),Fe=te(()=>P("br",null,null,-1)),Ie={class:"grid-item"},Pe="DD/MM/YYYY",Ce={__name:"NuevaPersona",setup(w){y.locale("es");const Y=fe(),l=we();l.$patch({typeDocuments:l.typeDocuments}),l.$patch({cities:l.cities}),l.$patch({provinces:l.provinces}),l.$patch({districts:l.districts}),l.$patch({genders:l.genders}),l.fetchTypeDocuments(),l.fetchCities(),l.fetchGenders();const C=h(null),G=h(null),ne=he(),A=JSON.parse(localStorage.getItem("profile")),n=h(Ee),g=h(!0),p=h(null),z=h(!1),ie=h(!0),e=ge({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,lession:null,people_id:A.user_id,from_id:1}),de=async d=>{try{const{data:o}=await I({url:`select/provinces/${d}`,method:"GET"});C.value=o}catch(o){console.error("Error de red:",o)}},le=async d=>{try{const{data:o}=await I({url:`select/districts/${d}`,method:"GET"});G.value=o}catch(o){console.error("Error de red:",o)}},L=(d,o)=>{const c=d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(c)},oe=()=>{l.typeDocuments&&(ie.value=!1)},se=()=>{n.value.lastname.disabled=!1,n.value.middlename.disabled=!1,n.value.name.disabled=!1,n.value.city_id.disabled=!1,n.value.province_id.disabled=!1,n.value.district_id.disabled=!1,n.value.address.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthday.disabled=!1,n.value.gender_id.disabled=!1,n.value.lession.disabled=!1},B=d=>{d&&(n.value.documentnumber.disabled=!1,e.documentnumber=null)},V=async d=>{var o,c,b,k,x,M,E,U,$,a,F,i,j,J,K,H,Q,W;if(g.value=!0,!d)return q.warning("Ingresa un número de documento"),g.value=!1;try{if(e.typedocument_id==1){const{data:t}=await N({url:`user/api/dni/${e.documentnumber}`,method:"GET"});if(!t||!t.body||!t.body.apePaterno){const s=await N({url:`user/only-dni/${e.documentnumber}`,method:"GET"});return e.lastname=s.data.apellidoPaterno,e.middlename=s.data.apellidoMaterno,e.name=s.data.nombres,g.value=!1}if(t.body&&(e.lastname=(o=t.body)==null?void 0:o.apePaterno,e.middlename=(c=t.body)==null?void 0:c.apeMaterno,e.name=(b=t.body)==null?void 0:b.preNombres,e.address=(k=t.body)==null?void 0:k.desDireccion,(x=t.body)!=null&&x.feNacimiento&&(e.birthday=y((M=t.body)==null?void 0:M.feNacimiento,"DD/MM/YYYY")),(E=t.body)!=null&&E.feNacimiento&&(p.value=y((U=t.body)==null?void 0:U.feNacimiento,"DD/MM/YYYY")),($=t.body)!=null&&$.ubigeo)){let s=l.cities.find(S=>{var v;return S.label===((v=t.body.ubigeo)==null?void 0:v.departamento)}),X=await I({url:`select/provinces/${s.value}`,method:"GET"});C.value=X.data;let Z=X.data.find(S=>{var v;return S.label===((v=t.body.ubigeo)==null?void 0:v.provincia)}),ee=await I({url:`select/districts/${Z.value}`,method:"GET"});G.value=ee.data;let _e=ee.data.find(S=>{var v;return S.label===((v=t.body.ubigeo)==null?void 0:v.distrito)});e.city_id=s.value,e.province_id=Z.value,e.district_id=_e.value}}if(e.typedocument_id==2){const{data:t}=await N({url:`user/api/ce/${e.documentnumber}`,method:"GET"});t.body&&(e.lastname=(a=t.body)==null?void 0:a.apellido_paterno,e.middlename=(F=t.body)==null?void 0:F.apellido_materno,e.name=(i=t.body)==null?void 0:i.nombres,e.gender_id=((j=t.body)==null?void 0:j.sexo)=="F"?2:1,(J=t.body)!=null&&J.fecha_nacimiento&&(e.birthday=y((K=t.body)==null?void 0:K.fecha_nacimiento,"DD/MM/YYYY")),(H=t.body)!=null&&H.fecha_nacimiento&&(p.value=y((Q=t.body)==null?void 0:Q.fecha_nacimiento,"DD/MM/YYYY")))}if(e.typedocument_id==3){const{data:t}=await N({url:`user/api/pas/${e.documentnumber}`,method:"GET"}),s=(W=t.body)==null?void 0:W.data[0];e.lastname=s.apellido_paterno,e.middlename=s.apellido_materno,e.name=s.nombres,e.gender_id=s.sexo=="F"?2:1,s.fecha_nacimiento&&(e.birthday=y(s.fecha_nacimiento,"DD/MM/YYYY")),s.fecha_nacimiento&&(p.value=y(s.fecha_nacimiento,"DD/MM/YYYY"))}}catch(t){console.log("err",t)}finally{return se(),g.value=!1}},re=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},ue=()=>{e.phone=e.phone.replace(/\D/g,"")},ce=d=>{e.province_id=null,e.district_id=null,de(d)},me=d=>{e.district_id=null,le(d)},pe=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.lession=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=A.id,p.value=null,O()},O=()=>{n.value.documentnumber.disabled=!0,n.value.lastname.disabled=!0,n.value.middlename.disabled=!0,n.value.name.disabled=!0,n.value.city_id.disabled=!0,n.value.city_id.disabled=!0,n.value.province_id.disabled=!0,n.value.address.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthday.disabled=!0,n.value.gender_id.disabled=!0,n.value.lession.disabled=!0},be=async()=>{z.value=!0,e.birthday=p.value?y(p.value).format("YYYY-MM-DD"):null;try{const d=await N({url:"person/create",method:"POST",data:e});if(d.status==400)return q.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(d.status==401)return q.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(d.status==200){const o={type:e.typedocument_id,number:e.documentnumber};return ne.push({name:"asesorias-formalizaciones",query:o}),q.success(d.message),pe()}}catch{q.error("No se pudo registrar este usuario")}finally{z.value=!1}},ve=()=>{q.error("Debes de completar todos los espacios requeridos")},ye=async()=>{O(),Y.query&&(e.typedocument_id=+Y.query.type,B(Y.query.type),e.documentnumber=Y.query.number,await l.fetchCities(),await V(Y.query.number))};return De(()=>{ye()}),(d,o)=>{const c=_("a-select"),b=_("a-form-item"),k=_("a-input-search"),x=_("a-input"),M=_("a-date-picker"),E=_("a-button"),U=_("a-form"),$=_("a-spin");return r(),R("div",Ue,[$e,Fe,D($,{spinning:g.value},{default:f(()=>[D(U,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:be,onFinishFailed:ve},{default:f(()=>[P("div",Ie,[(r(!0),R(ae,null,qe(n.value,(a,F)=>(r(),R(ae,{key:F},[a.type==="iSelect"?(r(),u(b,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[a.name=="typedocument_id"?(r(),u(c,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).typeDocuments,disabled:a.disabled,onChange:B},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="city_id"?(r(),u(c,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).cities,"show-search":"","filter-option":L,onChange:ce,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="province_id"?(r(),u(c,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:C.value,"show-search":"","filter-option":L,onChange:me,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(r(),u(c,{key:3,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:G.value,"show-search":"","filter-option":L,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="gender_id"?(r(),u(c,{key:4,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(l).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="lession"?(r(),u(c,{key:5,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(ke),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(r(),u(b,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[D(k,{loading:g.value,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,onSearch:V,onInput:re,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(r(),u(b,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:f(()=>[a.name=="phone"?(r(),u(x,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max,onInput:ue},null,8,["value","onUpdate:value","disabled","maxlength"])):(r(),u(x,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(r(),u(b,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[D(M,{locale:T(Ye),value:p.value,"onUpdate:value":o[0]||(o[0]=i=>p.value=i),style:{width:"100%"},format:Pe,placeholder:"día/mes/año",onChange:o[1]||(o[1]=i=>e.birthday=p.value),disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),P("div",null,xe(oe()),1),D(b,null,{default:f(()=>[D(E,{class:"btn-produce",type:"primary","html-type":"submit",loading:z.value},{default:f(()=>[Se("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Be=Me(Ce,[["__scopeId","data-v-7676d54a"]]);export{Be as default};
