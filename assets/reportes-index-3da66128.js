import{r as s,a as V,k as H,U as Z,X as L,o as R,y as Y,i as q,L as W,d as j,c,m as z,h as N,p as x,f as te,b as T,w as g,e as w,j as U,t as X,G as be,s as Ee,z as B,O as Ce,n as Ie}from"./index-e34d0eae.js";import{_ as Se}from"./TableComponent-d1d938dd.js";import{d as he}from"./downloadExcel-b3c585e4.js";import{_ as K}from"./FormComponent-535f805c.js";import{u as Q}from"./selectes-4a24a0f3.js";import{u as we}from"./useHistorialBusinessman-dbd883b1.js";import"./es-3d01e08a.js";import{g as De}from"./publicInscripcion-ebc9ecb9.js";import{_ as Oe}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Ae}from"./MailOutlined-ebb348ab.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-dfcabdb5.js";import"./MoreOutlined-aae1fe0f.js";import"./quill.snow-1a10294f.js";const Ne={key:1,class:"ases-draw"},Te={__name:"EditarAsesoria",props:{info:{type:Object,required:!0,default:()=>({})}},emits:["closeDraw"],setup(M,{emit:u}){const p=M,f=u,i=Q(),b=s(!0),E=s(!1),e=V({}),m=s("ACTUALIZAR"),a=s({city_id:[],province_id:[],district_id:[],gender_id:[],sick:[]}),h=async(o,n)=>{if(o=="city_id"&&(await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,d.value.province_id.disabled=!1),o=="province_id"&&(await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,d.value.district_id.disabled=!1),o=="component_id"&&(await i.fetchComponentThemes(e.component_id),a.value.theme_id=i.componentThemes,e.theme_id=null,d.value.theme_id.disabled=!1),o==="theme_id")if(n==17)d.value={...d.value,observations:{type:"iNumber",label:"N칔MERO DE RESERVA (Z- 7 d칤gitos)",name:"observations",required:!0,message:"Ingresar n칰mero de reserva",disabled:!1,prefix:"Z -",maxlength:7,rules:[{validator:(y,t)=>{if(!t)return Promise.reject(new Error("Ingresar n칰mero de reserva"));const S=String(t).length;return S<7?Promise.reject(new Error("El n칰mero debe tener al menos 7 cifras")):S>7?Promise.reject(new Error("El n칰mero no puede superar las 7 cifras")):Promise.resolve()},trigger:"change"}]}};else{e.observations=null;const{observations:y,...t}=d.value;d.value=t}},C=async o=>{o=="city_id"&&(e.province_id=null,e.district_id=null,a.value.province_id=[],a.value.city_id=i.cities),o=="province_id"&&(e.province_id=null,e.district_id=null,a.value.district_id=[])},_=async()=>{E.value=!0;const o={economicsector_id:e.economicsector_id,comercialactivity_id:e.comercialactivity_id,component_id:e.component_id,theme_id:e.theme_id,modality_id:e.modality_id,ruc:e.ruc,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,...e.observations&&{observations:e.observations}};try{const n=await z({url:`advisory/update-values-advisory/${p.info.id}`,method:"PUT",data:o});n.status==200&&(N.success(n.message),f("closeDraw",!0),D())}catch{const y=document.getElementsByClassName("ant-drawer-body")[0];y&&(y.scrollTop=0)}finally{E.value=!1}},D=()=>{e.economicsector_id=null,e.comercialactivity_id=null,e.component_id=null,e.theme_id=null,e.theme_id=null,e.modality_id=null,e.ruc=null,e.city_id=null,e.province_id=null,e.district_id=null,e.observations=null;const{observations:o,...n}=d.value;d.value=n},d=s({economicsector_id:{type:"iSelect",label:"SECTOR ECON칍MICO",name:"economicsector_id",required:!0,message:"Seleccionar el sector econ칩mico",disabled:!1},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!1},component_id:{type:"iSelect",label:"COMPONENTE",name:"component_id",required:!0,message:"Seleccionar un componente",disabled:!1},theme_id:{type:"iSelect",label:"TEMA DEL COMPONENTE",name:"theme_id",required:!0,message:"Seleccionar un tema del componente",disabled:!0},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCI칍N",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},ruc:{type:"iNumber",label:"RUC",name:"ruc",message:"Escribir n칰mero de RUC",disabled:!1,maxlength:11,rules:[{validator:(o,n)=>{if(!n)return Promise.resolve();const y=n.toString();return y.length!==11?Promise.reject(new Error("El n칰mero debe tener exactamente 11 d칤gitos")):["10","15","17","20"].includes(y.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 10, 15, 17 o 20"))},trigger:"change"}]},city_id:{type:"iSelect",label:"REGI칍N DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar regi칩n",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0}}),I=async o=>{b.value=!0;try{if(o){if(e.economicsector_id=o.econimic_sector_id,e.comercialactivity_id=o.activity_comercial_id,e.city_id=o.city_id,await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,e.province_id=o.province_id,await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,e.district_id=o.district_id,e.modality_id=o.modality_id,e.ruc=o.ruc,e.component_id=o.component_id,d.value.theme_id.disabled=!1,e.component_id=o.component_id,await i.fetchComponentThemes(e.component_id),a.value.theme_id=i.componentThemes,e.theme_id=o.theme_id,o.theme_id==17)d.value={...d.value,observations:{type:"iNumber",label:"N칔MERO DE RESERVA (7 d칤gitos)",name:"observations",required:!0,message:"Ingresar n칰mero de reserva",disabled:!1,prefix:"Z -",maxlength:7,rules:[{validator:(n,y)=>{if(!y)return Promise.reject(new Error("Ingresar n칰mero de reserva"));const t=String(y).length;return t<7?Promise.reject(new Error("El n칰mero debe tener al menos 7 cifras")):t>7?Promise.reject(new Error("El n칰mero no puede superar las 7 cifras")):Promise.resolve()},trigger:"change"}]}};else{e.observations=null;const{observations:n,...y}=d.value;d.value=y}e.observations=o.observations}}catch(n){console.error("Error al cargar la informaci칩n:",n)}finally{b.value=!1}};return H(async()=>{p.info&&I(p.info),await i.fetchEconomicSectors(),a.value.economicsector_id=i.economicSectors,await i.fetchComercialActivities(),a.value.comercialactivity_id=i.comercialActivities,await i.fetchCities(),a.value.city_id=i.cities,await i.fetchModalities(),a.value.modality_id=i.modalities,await i.fetchComponents(),a.value.component_id=i.components,b.value=!1}),Z(()=>p.info,o=>{o?I(o):D()}),L("formState",e),L("loadingState",E),(o,n)=>b.value?(R(),Y(q(W),{key:0,style:{color:"#00a6db"}})):(R(),j("div",Ne,[c(K,{fields:d.value,options:a.value,btnSaveName:m.value,onHandleFocusSelect:C,onHandleChangeSelect:h,onOnSubmit:_},null,8,["fields","options","btnSaveName"])]))}};const Re={key:1,class:"ppnn-draw"},xe={__name:"EditarPPNN",props:{info:{type:Object,required:!0,default:()=>({})}},emits:["closeDraw"],setup(M,{emit:u}){const p=M,f=u,i=Q(),b=s(!0),E=s(!1),e=V({}),m=s("ACTUALIZAR"),a=s({city_id:[],province_id:[],district_id:[],economicsector_id:[]}),h=async o=>{o=="city_id"&&(await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,d.value.province_id.disabled=!1),o=="province_id"&&(await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,d.value.district_id.disabled=!1),o=="component_id"&&(await i.fetchComponentThemes(e.component_id),a.value.theme_id=i.componentThemes,e.theme_id=null,d.value.theme_id.disabled=!1)},C=async o=>{o=="city_id"&&(await i.fetchCities(),e.district_id=null,a.value.province_id=[],a.value.city_id=i.cities),o=="province_id"&&(e.province_id=null,e.district_id=null,a.value.district_id=[])},_=async()=>{E.value=!0;const o={economicsector_id:e.economicsector_id,comercialactivity_id:e.comercialactivity_id,detailprocedure_id:e.detailprocedure_id,modality_id:e.modality_id,ruc:e.ruc,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address};try{const n=await z({url:`formalization/update-values-ruc-10/${p.info.id}`,method:"PUT",data:o});n.status==200&&(N.success(n.message),f("closeDraw",!0),D())}catch{N.error(i.error)}finally{E.value=!1}},D=()=>{e.economicsector_id=null,e.comercialactivity_id=null,e.detailprocedure_id=null,e.modality_id=null,e.ruc=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null},d=s({economicsector_id:{type:"iSelect",label:"SECTOR ECON칍MICO",name:"economicsector_id",required:!0,message:"Seleccionar el sector econ칩mico",disabled:!1},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!1},detailprocedure_id:{type:"iSelect",label:"DETALLE DEL TR츼MITE",name:"detailprocedure_id",required:!0,message:"Seleccionar detalle del tr치mite",disabled:!1},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCI칍N",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},ruc:{type:"iNumber",label:"N칔MERO DE RUC",name:"ruc",message:"Escribir n칰mero de RUC",disabled:!1,maxlength:11,required:!0,rules:[{validator:(o,n)=>{if(!n)return Promise.reject(new Error("El N칰mero de RUC es obligatorio"));const y=n.toString();return y.length!==11?Promise.reject(new Error("El n칰mero debe tener exactamente 11 d칤gitos")):["10","15","17"].includes(y.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 10, 15 o 17"))},trigger:"change"}]},city_id:{type:"iSelect",label:"REGI칍N DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar regi칩n",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCI칍N DEL NEGOCIO",name:"address",required:!0,message:"Escribir la direccion del Negocio",disabled:!1}}),I=async o=>{b.value=!0;try{o&&(e.economicsector_id=o.econimic_sector_id,e.comercialactivity_id=o.activity_comercial_id,e.detailprocedure_id=o.detailprocedure_id,e.modality_id=o.modality_id,e.ruc=o.ruc,e.city_id=o.city_id,await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,e.province_id=o.province_id,await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,e.district_id=o.district_id,e.address=o.address)}catch(n){N.error(n.message)}finally{b.value=!1}};return H(async()=>{p.info&&I(p.info),await i.fetchEconomicSectors(),a.value.economicsector_id=i.economicSectors,await i.fetchComercialActivities(),a.value.comercialactivity_id=i.comercialActivities,await i.fetchDetailProcedures(),a.value.detailprocedure_id=i.detailProcedures,await i.fetchModalities(),a.value.modality_id=i.modalities,await i.fetchCities(),a.value.city_id=i.cities,await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,b.value=!1}),Z(()=>p.info,o=>{o?I(o):D()}),L("formState",e),L("loadingState",E),(o,n)=>b.value?(R(),Y(q(W),{key:0,style:{color:"#00a6db"}})):(R(),j("div",Re,[c(K,{fields:d.value,options:a.value,btnSaveName:m.value,onHandleFocusSelect:C,onHandleChangeSelect:h,onOnSubmit:_,mayus:!0},null,8,["fields","options","btnSaveName"])]))}};const Me={key:1,class:"ppjj-draw"},Pe={__name:"EditarPPJJ",props:{info:{type:Object,required:!0,default:()=>({})}},emits:["closeDraw"],setup(M,{emit:u}){x.locale("es");const p=M,f=u,i=Q();we();const b=s(!0),E=s(!1),e=V({}),m=s("ACTUALIZAR"),a=s({city_id:[],province_id:[],district_id:[],modality_id:[],comercialactivity_id:[],isbic:[],typecapital_id:[]}),h=async t=>{t=="city_id"&&(await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,n.value.province_id.disabled=!1),t=="province_id"&&(await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,n.value.district_id.disabled=!1)},C=async t=>{t=="city_id"&&(await i.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,a.value.province_id=[],a.value.city_id=i.cities),t=="province_id"&&(e.province_id=null,e.district_id=null,a.value.district_id=[]),t=="modality_id"&&(await i.fetchModalities(),a.value.modality_id=i.modalities),t=="regime_id"&&(await i.fetchRegimes(),a.value.regime_id=i.regimes),t=="economicsector_id"&&(await i.fetchEconomicSectors(),a.value.economicsector_id=i.economicSectors),t=="comercialactivity_id"&&(await i.fetchComercialActivities(),a.value.comercialactivity_id=i.comercialActivities),t=="notary_id"&&I(),t=="isbic"&&_(),t=="typecapital_id"&&(await i.fetchTypeCapital(),a.value.typecapital_id=i.typeCapital)},_=()=>{a.value.isbic=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}]},D=async()=>{E.value=!0;const t={ruc:e.ruc,regime_id:e.regime_id,nameMype:e.nameMype,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,modality_id:e.modality_id,economicsector_id:e.economicsector_id,comercialactivity_id:e.comercialactivity_id,numbernotary:e.numbernotary,notary_id:e.notary_id,dateReception:e.dateReception?x(e.dateReception).format("YYYY-MM-DD"):null,dateTramite:e.dateTramite?x(e.dateTramite).format("YYYY-MM-DD"):null,isbic:e.isbic,montocapital:e.montocapital,typecapital_id:e.typecapital_id};try{const S=await z({url:`formalization/update-values-ruc-20/${p.info.id}`,method:"PUT",data:t});S.status==200&&(N.success(S.message),f("closeDraw",!0),o())}catch{N.error(i.error)}finally{E.value=!1}},d=async t=>{t=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),n.value.dateTramite.disabled=!1)},I=async()=>{try{const{data:t}=await te({url:"public/notaries-filters",method:"GET"}),S=t.map(O=>({value:O.id,name:O.name,city:O.city.name,province:O.province.name,district:O.district.name,address:O.address}));a.value.notary_id=S}catch(t){console.error("Error de red:",t)}},o=()=>{Object.keys(e).forEach(t=>{["city_id","province_id","district_id","address"].includes(t)||(e[t]=null)}),n.value.province_id.disabled=!0,n.value.district_id.disabled=!0,n.value.dateTramite.disabled=!0},n=s({ruc:{type:"iNumber",label:"N칔MERO DE RUC",name:"ruc",message:"Escribir n칰mero de RUC",disabled:!1,maxlength:11,required:!1,rules:[{validator:(t,S)=>{if(!S)return Promise.resolve();const O=S.toString();return O.length!==11?Promise.reject(new Error("El n칰mero debe tener exactamente 11 d칤gitos")):["20"].includes(O.substring(0,2))?Promise.resolve():Promise.reject(new Error("El RUC debe empezar con 20"))},trigger:"change"}]},regime_id:{type:"iSelect",label:"TIPO DE R칄GIMEN SOCIETARIO",name:"regime_id",required:!0,message:"Seleccionar el r칠gimen societario",disabled:!1},nameMype:{type:"iText",label:"NOMBRE EMPRESA",name:"nameMype",required:!0,message:"Escribir nombre de la empresa",disabled:!1},city_id:{type:"iSelect",label:"REGI칍N DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar regi칩n",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCI칍N DEL NEGOCIO",name:"address",required:!0,message:"Escribir la direccion del Negocio",disabled:!1},modality_id:{type:"iSelect",label:"MODALIDAD DE ATENCI칍N",name:"modality_id",required:!0,message:"Seleccionar modalidad",disabled:!1},economicsector_id:{type:"iSelect",label:"SECTOR ECON칍MICO",name:"economicsector_id",required:!0,message:"Seleccionar el sector econ칩mico",disabled:!1},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!1},numbernotary:{type:"iText",label:"N칔MERO SOLICITUD CONSTANCIA",name:"numbernotary",required:!0,message:"Escribir el n칰mero de solicitud",disabled:!1,maxlength:8,rules:[{validator:(t,S)=>{if(!S)return Promise.reject(new Error("El n칰mero de notar칤a es requerido"));const O=S.toString();return/^\d{8}$/.test(O)?Promise.resolve():Promise.reject(new Error("El n칰mero debe tener exactamente 8 d칤gitos num칠ricos"))},trigger:"change"}]},notary_id:{type:"iSelectNotary",label:"NOTAR칈A",name:"notary_id",required:!0,message:"Seleccionar una notar칤a",disabled:!1},dateReception:{type:"iDate",label:"FECHA DE RECEPCION PNTE",name:"dateReception",required:!0,disabled:!1,disabledDate:t=>!1},dateTramite:{type:"iDate",label:"FECHA TR츼MITE SID SUNARP-SUNAT",name:"dateTramite",required:!0,disabled:!0,disabledDate:t=>e.dateReception&&t&&x(t).isBefore(x(e.dateReception))},isbic:{type:"iSelect",label:"쮼S UNA SOCIEDAD BIC?",name:"isbic",required:!0,message:"Seleccionar si es BIC",disabled:!1},montocapital:{type:"iMoney",label:"MONTO DE CAPITAL SOCIAL",name:"montocapital",required:!0,message:"Escribir el Monto de capital social",disabled:!1},typecapital_id:{type:"iSelect",label:"TIPO DE APORTE DE CAPITAL",name:"typecapital_id",required:!0,message:"Seleccionar tipo de aporte",disabled:!1}}),y=async t=>{try{t&&(e.ruc=t.ruc,e.nameMype=t.name_mype,e.city_id=t.city_id,n.value.province_id.disabled=!1,e.province_id=t.province_id,n.value.district_id.disabled=!1,e.district_id=t.district_id,e.address=t.address,e.modality_id=t.modality_id,e.regime_id=t.regime_id,e.economicsector_id=t.econimic_sector_id,e.numbernotary=t.num_solicitud,e.comercialactivity_id=t.activity_comercial_id,e.notary_id=t.notary_id,n.value.dateTramite.disabled=!1,e.dateReception=t.date_reception?x(t.date_reception,"DD/MM/YYYY"):null,e.dateTramite=t.date_tramite?x(t.date_tramite,"DD/MM/YYYY"):null,e.isbic=t.bic,e.montocapital=t.monto_capital,e.typecapital_id=t.typecapital_id)}catch(S){N.error(S.message)}};return H(async()=>{p.info&&y(p.info),await i.fetchCities(),a.value.city_id=i.cities,await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,await i.fetchModalities(),a.value.modality_id=i.modalities,await i.fetchRegimes(),a.value.regime_id=i.regimes,await i.fetchEconomicSectors(),a.value.economicsector_id=i.economicSectors,await i.fetchComercialActivities(),a.value.comercialactivity_id=i.comercialActivities,I(),await i.fetchTypeCapital(),a.value.typecapital_id=i.typeCapital,b.value=!1}),Z(()=>p.info,t=>{t?y(t):o()}),L("formState",e),L("loadingState",E),(t,S)=>b.value?(R(),Y(q(W),{key:0,style:{color:"#00a6db"}})):(R(),j("div",Me,[c(K,{fields:n.value,options:a.value,btnSaveName:m.value,onHandleFocusSelect:C,onHandleChangeSelect:h,onHandleChangeClock:d,onOnSubmit:D,mayus:!0},null,8,["fields","options","btnSaveName"])]))}};const Le={class:"flex justify-between mt-4"},Ue={__name:"DescribeMotive",props:["loadingDescribeMotive"],emits:["closeModal","goToFunction"],setup(M,{emit:u}){const p=M,f=u,i=s(!0),b=s(null),E=s({comentario:""}),e={comentario:[{validator:(h,C)=>C?C.trim().split(/\s+/).length<4?Promise.reject("Debe contener al menos 4 palabras"):Promise.resolve():Promise.reject("El comentario es obligatorio"),trigger:"blur"}]},m=()=>{i.value=!1,b.value.resetFields(),f("closeModal")},a=()=>{b.value.validate().then(()=>{f("goToFunction",E.value.comentario)}).catch(()=>{N.error("Corrige los errores antes de continuar")})};return(h,C)=>{const _=T("a-textarea"),D=T("a-form-item"),d=T("a-button"),I=T("a-form");return R(),Y(I,{model:E.value,rules:e,ref_key:"formRef",ref:b,layout:"vertical"},{default:g(()=>[c(D,{name:"comentario"},{default:g(()=>[c(_,{value:E.value.comentario,"onUpdate:value":C[0]||(C[0]=o=>E.value.comentario=o),placeholder:"Escribe tu comentario (m칤nimo 4 palabras)...",rows:4},null,8,["value"])]),_:1}),w("div",Le,[c(d,{onClick:m,class:"w-1/2 mr-2"},{default:g(()=>C[1]||(C[1]=[U("Cancelar")])),_:1}),c(d,{type:"primary",class:"w-1/2 ml-2",onClick:a,loading:p.loadingDescribeMotive},{default:g(()=>[U(X(p.loadingDescribeMotive?"":"Aceptar"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])}}},Fe=Oe(Ue,[["__scopeId","data-v-19c517c6"]]),G=2*60*1e3,qe={__name:"ExportFormalizaciones",setup(M){const u=s("asesorias"),p=V({email:""}),f=s(!1),i=be(()=>f.value?"Espera a que la tarea pendiente culmine...":"ENVIAR"),b=async()=>{try{const e=Date.now(),m=localStorage.getItem("lastExportRequest");if(m&&e-m<G){const _=Math.ceil((G-(e-m))/1e3);N.warning(`Debes esperar ${_} segundos antes de volver a enviar.`);return}const a={email:p.email,year:2025};let h=null;if(u.value==="asesorias")h="formalization/export-asesories";else if(u.value==="f10")h="formalization/export-formalizations-ppnn";else if(u.value==="f20")h="formalization/export-formalizations-ppjj";else return N.error("La opci칩n no es v치lida");f.value=!0,(await z({url:h,method:"POST",data:a})).status===200?(N.success("Solicitud enviada correctamente."),localStorage.setItem("lastExportRequest",e),setTimeout(()=>{f.value=!1},G)):(N.error("Ocurri칩 un problema al procesar la solicitud."),f.value=!1)}catch(e){console.error("Error al enviar:",e),N.error("No se pudo enviar la solicitud."),f.value=!1}},E=e=>{console.log("Validaci칩n fallida:",e)};return H(()=>{const e=localStorage.getItem("lastExportRequest");if(e&&Date.now()-e<G){f.value=!0;const m=G-(Date.now()-e);setTimeout(()=>{f.value=!1},m)}}),(e,m)=>{const a=T("a-radio-button"),h=T("a-radio-group"),C=T("a-input"),_=T("a-form-item"),D=T("a-button"),d=T("a-form");return R(),Y(d,{layout:"vertical",model:p,name:"basic",autocomplete:"off",onFinish:b,onFinishFailed:E},{default:g(()=>[c(h,{value:u.value,"onUpdate:value":m[0]||(m[0]=I=>u.value=I),"button-style":"solid",style:{"margin-bottom":"1.5rem"}},{default:g(()=>[c(a,{value:"asesorias"},{default:g(()=>m[2]||(m[2]=[U("ASESORIAS")])),_:1}),c(a,{value:"f10"},{default:g(()=>m[3]||(m[3]=[U("RUC 10")])),_:1}),c(a,{value:"f20"},{default:g(()=>m[4]||(m[4]=[U("RUC 20")])),_:1})]),_:1},8,["value"]),c(_,{label:"Correo electr칩nico",name:"email",rules:[{required:!0,message:"Ingrese un correo electr칩nico"},{type:"email",message:"Ingrese un correo v치lido"}]},{default:g(()=>[c(C,{value:p.email,"onUpdate:value":m[1]||(m[1]=I=>p.email=I)},null,8,["value"])]),_:1}),c(D,{type:"primary","html-type":"submit",block:"",disabled:f.value,style:{"margin-top":"1rem"}},{default:g(()=>[U(X(i.value),1)]),_:1},8,["disabled"])]),_:1},8,["model"])}}};const ze={class:"layout-content"},Ye={class:"advisory-table"},ke={class:"filter-type"},je={key:1,class:"filter-type"},$e={key:2,class:"filter-asesor"},Ge=["onClick"],Ve=["onClick"],lt={__name:"reportes-index",setup(M){const u=JSON.parse(localStorage.getItem("profile"))||{},p=s(!1),f=s(null),i=s(!1),b=s([{label:"ASESOR칈AS",value:1},{label:"F. RUC 10",value:2},{label:"F. RUC 20",value:3}]),E=s([{label:"CDE",value:1},{label:"CDEAI INSTITUCIONES",value:2},{label:"CDEAN NOTAR칈AS",value:3}]),e=s([]),m=s(0),a=s(90),h=s(!1),C=s(!1),_=s("Asesor칤as"),D=s(!1),d=s(!1),I=s(!1),o=s(!1),n=s(null),y=s(!1),t=V({year:x("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null}),S=s([]),O=s([]);function ie(){return["41113887","88888888","99999999"].includes(u.dni)}const ae=(l,r)=>{const A=l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(A)},J=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:80},{title:"FECHA",fixed:"left",dataIndex:"date",width:100,align:"center"},...u.rol!=2?[{title:"ASESOR",dataIndex:"asesor",width:200,customCell:()=>({style:{backgroundColor:"#f0f5ff"}})}]:[],...u.rol!=2?[{title:"ASESOR CDE",dataIndex:"asesor_cde",width:160,customCell:()=>({style:{backgroundColor:"#f0f5ff"}})}]:[],{title:"TIPO DOCUMENTO",dataIndex:"emp_document_type",width:100,align:"center"},{title:"N칔MERO DE DOCUMENTO",dataIndex:"emp_document_number",align:"center",width:140},{title:"SOLICITANTE APELLIDO PATERNO",dataIndex:"emp_lastname",width:150},{title:"SOLICITANTE APELLIDO MATERNO",dataIndex:"emp_middlename",width:150},{title:"SOLICITANTE NONBRE",dataIndex:"emp_name",width:150},{title:"PA칈S",dataIndex:"emp_country",align:"center",width:120},{title:"FEC. NAC",dataIndex:"emp_birth",align:"center",width:120},{title:"EDAD",dataIndex:"emp_age",align:"center",width:80},{title:"G칄NERO",dataIndex:"emp_gender",width:80,align:"center"},{title:"DISCAPACIDAD",dataIndex:"emp_discapabilities",width:120,align:"center"},{title:"HIJOS",dataIndex:"emp_soons",width:80,align:"center"},{title:"CELULAR",dataIndex:"emp_phone",width:120,align:"center"},{title:"EMAIL",dataIndex:"emp_email",width:200},{title:"CIUDAD",dataIndex:"city",width:120,align:"center"},{title:"PROVINCIA",dataIndex:"province",width:140,align:"center"},{title:"DISTRITO",dataIndex:"district",width:140,align:"center"},{title:"RUC",dataIndex:"ruc",width:120,align:"center"}],re=[{title:"SECTOR ECON칍MICO",dataIndex:"econimic_service",width:120,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"activity_comercial",width:200},{title:"COMPONENTE",dataIndex:"component",width:140,align:"center"},{title:"TEMA",dataIndex:"theme",width:200},{title:"NODALIDAD",dataIndex:"modality",width:100,align:"center"},{title:"CODIGO SID SUNARP",align:"center",dataIndex:"observations",width:140},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],oe=[{title:"SECTOR ECON칍MICO",dataIndex:"econimic_sector",width:120,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"activity_comercial",width:200},{title:"DETALLE DEL TR츼MITE",dataIndex:"detail_tramit",width:180},{title:"NODALIDAD",dataIndex:"modality",width:100,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],le=[{title:"NOMBRE DE LA EMPRESA",dataIndex:"nameMype",width:200},{title:"SECTOR ECON칍MICO",dataIndex:"econimic_sector",width:120,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"activity_comercial",width:200},{title:"FECHA DE RECEPCI칍N",dataIndex:"date_reception",width:160,align:"center"},{title:"FECHA DE TR츼MITE",dataIndex:"date_tramite",width:160,align:"center"},{title:"TIPO DE R칄GIMEN",dataIndex:"type_regimen",width:150,align:"center"},{title:"BIC",dataIndex:"bic",width:50,align:"center"},{title:"N칔MERO DE SOLICITUD",dataIndex:"num_solicitud",width:160,align:"center"},{title:"NOTAR칈A",dataIndex:"notaria",width:200},{title:"TIPO DE APORTE",dataIndex:"type_aporte",width:160,align:"center"},{title:"MONTO CAPITAL",dataIndex:"monto_capital",width:160,align:"center"},{title:"NODALIDAD",dataIndex:"modality",width:100,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}];function ne(){if(u.user_id){const l={user:u.user_id,name:u.name,lastname:u.lastname,middlename:u.middlename};if(u.user_id){const r=btoa(JSON.stringify(l)),A=`${De()}/preguntas-formalizaciones?data=${r}`;window.open(A,"_blank")}}}const se=()=>{console.log("handleNew...")},de=l=>({Asesorias:"ases","Formalizaciones RUC 10":"f10","Formalizaciones RUC 20":"f20"})[l],ce=async l=>{p.value=!0;try{const A={table_name:{Asesorias:"asesoria","Formalizaciones RUC 10":"f10","Formalizaciones RUC 20":"f20"}[_.value]||_.value,row_id:f.value.id,description:l,action:"d"};if((await z({url:"token/indicate-reason-action",method:"POST",data:A})).status==200)try{let P=null;_.value==="Asesorias"&&(P=`advisory/delete/${f.value.id}`),_.value==="Formalizaciones RUC 10"&&(P=`formalization/delete-ruc-10/${f.value.id}`),_.value==="Formalizaciones RUC 20"&&(P=`formalization/delete-ruc-20/${f.value.id}`);const k=await z({url:P,method:"DELETE"});F(),N.success(k.message),i.value=!1}catch(P){console.error("Error al eliminar registro:",P),N.error("No se pudo eliminar el registro.")}}catch(r){console.error("Error al registrar motivo:",r),N.error("No se pudo registrar el motivo de la acci칩n.")}finally{p.value=!1}},ue=l=>{f.value=l,i.value=!0},me=async()=>{C.value=!0;try{const l={};t.year&&(l.year=x(t.year).format("YYYY")),t.range&&(l.dateStart=t.range[0].format("YYYY/MM/DD"),l.dateEnd=t.range[1].format("YYYY/MM/DD")),t.asesor&&(l.asesor=t.asesor),t.name&&(l.name=t.name),t.typeCdes&&(l.typeCdes=t.typeCdes);let r=null,A=null;t.type==1&&(r="download/asesories",A="Asesor칤as"),t.type==2&&(r="download/formalizations-ruc10",A="Formalizaciones 10"),t.type==3&&(r="download/formalizations-ruc20",A="Formalizaciones 20"),await he(r,A,l)}catch(l){console.error("Error de red:",l)}finally{C.value=!1}},pe=async l=>{t.page=l,await F()},_e=async l=>{l&&(t.page=1,await F())},ve=l=>{n.value=l,t.type==1&&(D.value=!0),t.type==2&&(d.value=!0),t.type==3&&(I.value=!0)},fe=()=>{t.type==1&&(O.value=[...J,...re],_.value="Asesorias"),t.type==2&&(O.value=[...J,...oe],_.value="Formalizaciones RUC 10"),t.type==3&&(O.value=[...J,...le],_.value="Formalizaciones RUC 20")},F=async()=>{h.value=!0,fe();try{const l={page:t.page};t.year&&(l.year=x(t.year).format("YYYY")),t.range&&(l.dateStart=t.range[0].format("YYYY/MM/DD"),l.dateEnd=t.range[1].format("YYYY/MM/DD")),t.asesor&&(l.asesor=t.asesor),t.name&&(l.name=t.name),t.typeCdes&&(l.typeCdes=t.typeCdes);let r=null;t.type==1&&(r="historial/advisories/filters"),t.type==2&&(r="historial/formalizations-10/filters"),t.type==3&&(r="historial/formalizations-20/filters");const A=await z({url:r,method:"GET",params:l});e.value=A.data.data,m.value=A.data.total,a.value=A.data.per_page,u.rol!=2&&await ye()}catch(l){console.error("Error de red:",l)}finally{h.value=!1}},ye=async()=>{try{const l=await te({url:"select/asesores-report",method:"GET"});l.status==200&&(S.value=l.data)}catch{console.log("Failed to delete")}};return H(async()=>{await F()}),L("search",t),L("loading",h),L("loadingFile",C),(l,r)=>{const A=T("a-button"),$=T("a-select"),P=T("a-menu-item"),k=T("a-drawer"),ee=T("a-modal");return R(),j("div",ze,[w("div",Ye,[c(Se,{title:`REPORTE GENERAL - ${_.value}`,new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:O.value,downloadExcel:!0,titleSearch:"N칔MERO DE DOCUMENTO",pageSize:a.value,nameTotal:_.value,dataSource:e.value,total:m.value,onHandleNew:se,onHandleDownloadExcel:me,onHandleSearch:_e,onHandlePaginator:pe},{header:g(()=>[ie()?(R(),Y(A,{key:0,icon:Ee(q(Ae)),onClick:r[0]||(r[0]=v=>o.value=!0)},null,8,["icon"])):B("",!0),w("div",ke,[r[14]||(r[14]=w("small",null,"TIPO",-1)),c($,{value:t.type,"onUpdate:value":r[1]||(r[1]=v=>t.type=v),options:b.value},null,8,["value","options"])]),q(u).rol!=2?(R(),j("div",je,[r[15]||(r[15]=w("small",null,"TIPO CDE",-1)),c($,{allowClear:!0,value:t.typeCdes,"onUpdate:value":r[2]||(r[2]=v=>t.typeCdes=v),options:E.value},null,8,["value","options"])])):B("",!0),q(u).rol!=2?(R(),j("div",$e,[r[16]||(r[16]=w("small",null,"POR ASESOR",-1)),c($,{allowClear:!0,value:t.asesor,"onUpdate:value":r[3]||(r[3]=v=>t.asesor=v),placeholder:"Selecciona Asesor","show-search":"",options:S.value,"filter-option":ae},null,8,["value","options"])])):B("",!0)]),"custom-options":g(({record:v})=>[c(P,null,{default:g(()=>[w("a",{onClick:ge=>ve(v)},"Editar",8,Ge)]),_:2},1024),q(u).rol==1?(R(),Y(P,{key:0},{default:g(()=>[w("a",{onClick:ge=>ue(v),style:{color:"#ff4d4f"}},"Eliminar",8,Ve)]),_:2},1024)):B("",!0)]),_:1},8,["title","columns","pageSize","nameTotal","dataSource","total"]),c(k,{width:"600",title:"EDITAR ASESOR칈A",open:D.value,"onUpdate:open":r[5]||(r[5]=v=>D.value=v),placement:"right"},{default:g(()=>[c(Te,{info:n.value,onCloseDraw:r[4]||(r[4]=v=>(D.value=!1,F()))},null,8,["info"])]),_:1},8,["open"]),c(k,{width:"600",title:"EDITAR PPNN",open:d.value,"onUpdate:open":r[7]||(r[7]=v=>d.value=v),placement:"right"},{default:g(()=>[c(xe,{info:n.value,onCloseDraw:r[6]||(r[6]=v=>(d.value=!1,F()))},null,8,["info"])]),_:1},8,["open"]),c(k,{width:"600",title:"Editar Formalizaci칩n RUC 20",open:I.value,"onUpdate:open":r[9]||(r[9]=v=>I.value=v),placement:"right"},{default:g(()=>[c(Pe,{info:n.value,onCloseDraw:r[8]||(r[8]=v=>(I.value=!1,F()))},null,8,["info"])]),_:1},8,["open"]),c(k,{width:"400",title:"DESCARGAR REPORTE 2025",open:o.value,"onUpdate:open":r[10]||(r[10]=v=>o.value=v),placement:"right"},{default:g(()=>[c(qe)]),_:1},8,["open"]),c(ee,{open:y.value,"onUpdate:open":r[11]||(r[11]=v=>y.value=v),title:"游늷 쮸칰n no llenaste el formulario?",width:"420px",footer:null,maskClosable:!1,closable:!1},{default:g(()=>[r[17]||(r[17]=w("p",null,"춰Hola! 游녦",-1)),r[18]||(r[18]=w("p",null,"Notamos que a칰n no has completado el formulario con preguntas frecuentes sobre formalizaci칩n.",-1)),r[19]||(r[19]=w("p",null,"T칩mate un momento para completarlo cuando puedas. 춰Tu experiencia es importante para nosotros!",-1)),r[20]||(r[20]=w("br",null,null,-1)),w("a",{href:"#",onClick:Ce(ne,["prevent"]),class:"btn-complete-modal"}," IR AL FORMULARIO "),r[21]||(r[21]=w("br",null,null,-1)),r[22]||(r[22]=w("p",{style:{color:"#ff4d4f","text-align":"center"}},[U("Completado el formulario regresa a esta p치gina y "),w("b",null,"actualiza"),U(" para que este mensaje desaparezca. ")],-1))]),_:1},8,["open"]),c(ee,{open:i.value,"onUpdate:open":r[13]||(r[13]=v=>i.value=v),title:"DESCRIBE MOTIVO",footer:null,width:"450px"},{default:g(()=>[w("span",{class:Ie(["tag-formalizations",de(_.value)])},X(_.value),3),c(Fe,{onCloseModal:r[12]||(r[12]=v=>i.value=!1),onGoToFunction:ce,loadingDescribeMotive:p.value},null,8,["loadingDescribeMotive"])]),_:1},8,["open"])])])}}};export{lt as default};
