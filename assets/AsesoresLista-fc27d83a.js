import{E as J,r as p,a as j,b as d,o as r,v as m,w as o,c as s,e as k,d as A,F,z as te,h as x,q as c,G as ne,t as B,i as U,N as X,m as G,M as fe,I as H,U as ve,j as ge,J as be,K as ye}from"./index-b5ab390b.js";import{u as le}from"./selectes-82904492.js";import"./es-3cc9689e.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import{f as he}from"./nuevoUsuario-39eedf3b.js";import{M as we}from"./MoreOutlined-7f5904ad.js";const xe={email:{type:"iText",label:"Correo",name:"email",required:!1,email:"email",message:"Escribe el correo del usuario",disabled:!0},documentnumber:{type:"iText",label:"Número de DNI",name:"documentnumber",required:!0,message:"Número de DNI",max:8,disabled:!1},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribe el apellido paterno"},lastname:{type:"iText",label:"Apellido paterno",name:"lastname",required:!0,message:"Escribe el apellido paterno"},middlename:{type:"iText",label:"Apellido materno",name:"middlename",required:!0,message:"Escribe el apellido paterno"},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!1,message:"año-mes-día",placeholder:"año-mes-día"},phone:{type:"iText",label:"Ingresar número celular",name:"phone",required:!0,message:"Escribe número de documento",disabled:!1,max:9},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},cde_id:{type:"iSelect",label:"CDE",name:"cde_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},office_id:{type:"iSelect",label:"Oficina",name:"office_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0}};const Se={class:"grid-profile"},De="DD/MM/YYYY",Ue={__name:"DrawerEditarDatosAsesor",props:["record"],emits:["closeDraw"],setup(Q,{emit:$}){J.locale("es");const l=le(),_=JSON.parse(localStorage.getItem("profile")),S=$;l.$patch({genders:l.genders}),l.$patch({cdes:l.cdes}),l.$patch({Offices:l.Offices}),l.$patch({roles:l.roles}),l.$patch({supervisores:l.supervisores}),l.fetchGenders(),l.fetchCdes(),l.fetchOffices(),l.fetchRoles();const D=Q,M=p(!0),T=p(!1),I=p(xe),e=j({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:_.id}),E=f=>{var y;f&&(e.name=f.profile_name,e.lastname=f.profile_lastname,e.middlename=f.profile_middlename,e.documentnumber=f.profile_documentnumber,e.phone=f.profile_phone,e.gender_id=f.gender_id,e.cde_id=f.cde_id,e.office_id=f.office_id,e.email=f.email,f.profile_birthday&&(e.birthday=J(f.profile_birthday,"YYYY-MM-DD"))),(y=l.genders)!=null&&y.length&&(M.value=!1)},q=f=>{const y={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(f===2)l.fetchSupervisores(),I.value={...I.value,supervisor_id:y};else{const{supervisor_id:C,...R}=I.value;I.value=R}},L=async()=>{T.value=!0;const f={name:e.name,lastname:e.lastname,middlename:e.middlename,birthday:e.birthday?J(e.birthday).format("YYYY-MM-DD"):null,sick:e.sick,phone:e.phone,gender_id:e.gender_id,cde_id:e.cde_id,office_id:e.office_id,user_id:_.id};try{const y=await X({url:`user/update/${D.record._id}`,method:"PUT",data:f});G.success(y.message),S("closeDraw")}catch(y){console.log("NOOo",y)}finally{T.value=!1}},z=()=>{G.error("Debes de completar todos los espacios requeridos")};return(f,y)=>{const C=d("a-select"),R=d("a-form-item"),b=d("a-input"),v=d("a-date-picker"),g=d("a-button"),w=d("a-form"),O=d("a-spin");return r(),m(O,{spinning:M.value},{default:o(()=>[s(w,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:L,onFinishFailed:z},{default:o(()=>[k("div",Se,[(r(!0),A(F,null,te(I.value,(n,N)=>(r(),A(F,{key:N},[n.type==="iSelect"?(r(),m(R,{key:0,class:"item-max",name:n.name,label:n.label,rules:[{required:n.required,message:n.message}]},{default:o(()=>[n.name=="gender_id"?(r(),m(C,{key:0,value:e[n.name],"onUpdate:value":u=>e[n.name]=u,options:x(l).genders},null,8,["value","onUpdate:value","options"])):c("",!0),n.name=="cde_id"?(r(),m(C,{key:1,value:e[n.name],"onUpdate:value":u=>e[n.name]=u,options:x(l).cdes},null,8,["value","onUpdate:value","options"])):c("",!0),n.name=="office_id"?(r(),m(C,{key:2,value:e[n.name],"onUpdate:value":u=>e[n.name]=u,options:x(l).Offices},null,8,["value","onUpdate:value","options"])):c("",!0),n.name=="role_id"?(r(),m(C,{key:3,value:e[n.name],"onUpdate:value":u=>e[n.name]=u,options:x(l).roles,onChange:q},null,8,["value","onUpdate:value","options"])):c("",!0),n.name=="supervisor_id"?(r(),m(C,{key:4,value:e[n.name],"onUpdate:value":u=>e[n.name]=u,options:x(l).supervisores},null,8,["value","onUpdate:value","options"])):c("",!0)]),_:2},1032,["name","label","rules"])):c("",!0),n.type==="iText"?(r(),m(R,{key:1,name:n.name,label:n.label,rules:[{required:n.required,message:n.message,type:n.email}]},{default:o(()=>[s(b,{value:e[n.name],"onUpdate:value":u=>e[n.name]=u,maxlength:n.max,disabled:n.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):c("",!0),n.type==="iDate"?(r(),m(R,{key:2,name:n.name,label:n.label,rules:[{required:n.required,message:n.message}]},{default:o(()=>[s(v,{locale:x(ne),value:e[n.name],"onUpdate:value":u=>e[n.name]=u,style:{width:"100%"},format:De,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):c("",!0)],64))),128))]),k("div",null,B(E(D.record)),1),s(R,null,{default:o(()=>[s(g,{class:"btn-produce",type:"primary","html-type":"submit",loading:T.value},{default:o(()=>y[0]||(y[0]=[U("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])}}},ke=oe(Ue,[["__scopeId","data-v-f5cfd002"]]);const Ie={class:"grid-item"},Ce="DD/MM/YYYY",Re={__name:"DrawerRegistrarAsesor",setup(Q){J.locale("es");const $=JSON.parse(localStorage.getItem("profile")),l=le();l.$patch({genders:l.genders}),l.$patch({cdes:l.cdes}),l.$patch({Offices:l.Offices}),l.$patch({roles:l.roles}),l.$patch({supervisores:l.supervisores}),l.fetchGenders(),l.fetchCdes(),l.fetchOffices(),l.fetchRoles();const _=p(he),S=p(null),D=p(!1),M=p(!1),T=p(!1);p(!1),p(null);const I=[{label:"SUPERVISOR",value:1},{label:"ASESOR",value:2}],e=j({name:null,lastname:null,middlename:null,documentnumber:null,birthday:null,sick:2,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:$.user_id,email:null,password:null}),E=()=>{e.name=null,e.lastname=null,e.middlename=null,e.documentnumber=null,S.value=null,e.phone=null,e.gender_id=null,e.cde_id=null,e.office_id=null,e.email=null,e.password=null,e.role_id=null},q=b=>{e[b]=e[b].replace(/\D/g,"")},L=(b,v)=>{const g=b.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return v.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(g)},z=b=>{const v={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},g={type:"iText",label:"Ciudad de la notaría",name:"city",required:!0,message:"Ciudad de la notaría",disabled:!1},w={type:"iText",label:"Provincia de la de la notaría",name:"province",required:!0,message:"Provincia de la de la notaría",disabled:!1},O={type:"iText",label:"Distrito de la notaría",name:"district",required:!0,message:"Distrito de la notaría",disabled:!1},n={type:"iText",label:"Dirección de la notaría",name:"address",required:!1,message:"Dirección de la notaría",disabled:!1};if(b===2){l.fetchSupervisores(),_.value={..._.value,supervisor_id:v};const{city:N,province:u,district:V,address:a,...t}=_.value;_.value=t}else if(b===7){_.value={..._.value,city:g,province:w,district:O,address:n};const{supervisor_id:N,...u}=_.value;_.value=u,_.value.cde_id.required=!1}else{let{city:N,province:u,district:V,address:a,supervisor_id:t,...i}=_.value;_.value=i}},f=async()=>{D.value=!0,e.email=e.name.replace(/\s/g,"").toLowerCase()+e.lastname.replace(/\s/g,"").toLowerCase()+"@pnte.com",e.password=e.documentnumber,e.birthday=S.value?J(S.value).format("YYYY-MM-DD"):null;try{const b=await X({url:"user/create",method:"POST",data:e});fe.success({title:"La cuenta ha sido registrada",content:H("div",{},[H("br"),H("p",`Correo: ${e.email}`),H("p","Contraseña es el número de DNI ingresado")]),onOk(){E(),G.success(b.message);const{supervisor_id:v,...g}=_.value;_.value=g}})}catch{G.error("No se pudo registrar este usuario")}finally{D.value=!1}},y=()=>{G.error("Debes de completar todos los espacios requeridos")},C=async b=>{console.log("Hello",b)},R=()=>{e.document_number=e.document_number.replace(/\D/g,"")};return(b,v)=>{const g=d("a-select"),w=d("a-form-item"),O=d("a-input-search"),n=d("a-input"),N=d("a-date-picker"),u=d("a-button"),V=d("a-form");return r(),A("div",null,[s(V,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:f,onFinishFailed:y},{default:o(()=>[k("div",Ie,[(r(!0),A(F,null,te(_.value,(a,t)=>(r(),A(F,{key:t},[a.type==="iSelect"?(r(),m(w,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[a.name=="gender_id"?(r(),m(g,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:x(l).genders},null,8,["value","onUpdate:value","options"])):c("",!0),a.name=="cde_id"?(r(),m(g,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:x(l).cdes},null,8,["value","onUpdate:value","options"])):c("",!0),a.name=="role_id"?(r(),m(g,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:I,onChange:z},null,8,["value","onUpdate:value"])):c("",!0),a.name=="supervisor_id"?(r(),m(g,{key:3,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:x(l).supervisores},null,8,["value","onUpdate:value","options"])):c("",!0),a.name=="office_id"?(r(),m(g,{key:4,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,"show-search":"",options:x(l).Offices,"filter-option":L},null,8,["value","onUpdate:value","options"])):c("",!0)]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iSearch"?(r(),m(w,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:o(()=>[s(O,{maxlength:15,loading:M.value,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,onSearch:C,onInput:R,disabled:T.value},null,8,["loading","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iText"?(r(),m(w,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:o(()=>[a.name=="documentnumber"?(r(),m(n,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,maxlength:a.max,onInput:v[0]||(v[0]=i=>q("documentnumber"))},null,8,["value","onUpdate:value","maxlength"])):a.name=="phone"?(r(),m(n,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,maxlength:a.max,onInput:v[1]||(v[1]=i=>q("phone"))},null,8,["value","onUpdate:value","maxlength"])):(r(),m(n,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"]))]),_:2},1032,["name","label","rules"])):c("",!0),a.type==="iDate"?(r(),m(w,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:o(()=>[s(N,{locale:x(ne),value:S.value,"onUpdate:value":v[2]||(v[2]=i=>S.value=i),style:{width:"100%"},format:Ce},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):c("",!0)],64))),128))]),s(w,null,{default:o(()=>[s(u,{class:"btn-produce",type:"primary","html-type":"submit",loading:D.value},{default:o(()=>v[3]||(v[3]=[U("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},qe=oe(Re,[["__scopeId","data-v-1f072082"]]);const Ae=["onClick"],Ee=["onClick"],Oe={class:"paginator"},Le={__name:"AsesoresLista",setup(Q){const $=p(50),l=p([]),_=p(!1),S=p(0),D=p({page:1}),M=p("user/list-asesories"),T=p(1200),I=p(window.innerHeight-100),e=p(!1),E=p(!1),q=p(!1),L=p(null),z=p(null),f=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"NOMBRES",dataIndex:"profile_name",width:160},{title:"APELLIDOS",dataIndex:"lastname",width:160},{title:"DNI",dataIndex:"profile_documentnumber",width:100,align:"center"},{title:"CELULAR",dataIndex:"profile_phone",width:100,align:"center"},{title:"CDE",dataIndex:"cde_name",width:160},{title:"FECHA NAC.",dataIndex:"profile_birthday",width:100,align:"center"},{title:"GÉNERO",dataIndex:"gender",width:120,align:"center"},{title:"OFICINA",dataIndex:"office_name",width:100,align:"center"},{title:"ROL",dataIndex:"role",width:140,align:"center"},{title:"CUENTA",dataIndex:"email",width:180},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],y=()=>{I.value=window.innerHeight-300},C=a=>{e.value=!0,L.value=a},R=a=>{E.value=!0,z.value=a},b=()=>{e.value=!1,u()},v=j({search:""}),g=j({password:""}),w=async()=>{const a={id:z.value.user_id,password:g.password};try{const t=await X({url:"user/update-password",method:"POST",data:a});t.status===200&&(G.success(t.message),g.password=null,E.value=!1)}catch(t){console.error("Failed to update record",t)}},O=()=>{u({search:v.search})},n=()=>{v.search||u()},N=a=>{D.value.page=a,u()},u=async a=>{try{_.value=!0;const t=D.value.page===1?"":D.value,i=a?{...t,...a}:t,P=await X({url:M.value,method:"GET",params:i});l.value=P.data,S.value=P.total,$.value=P.per_page}catch(t){console.error("Error de red:",t)}finally{_.value=!1}},V=ve(()=>a=>(D.value.page-1)*$.value+a+1);return ge(()=>{u(),window.addEventListener("resize",y),y()}),(a,t)=>{const i=d("a-button"),P=d("a-col"),Z=d("a-input"),se=d("a-input-group"),re=d("a-row"),K=d("a-tag"),ee=d("a-menu-item"),ie=d("a-menu"),de=d("a-dropdown"),ue=d("a-table"),me=d("a-pagination"),W=d("a-drawer"),ae=d("a-form-item"),ce=d("a-form");return r(),A(F,null,[k("div",null,[t[13]||(t[13]=k("h3",{class:"title-produce"},"LISTA DE USUARIOS - UGO",-1)),s(re,{style:{margin:"1rem 0"}},{default:o(()=>[s(P,{xs:24,md:12,lg:18},{default:o(()=>[s(i,{type:"primary",onClick:t[0]||(t[0]=h=>q.value=!0)},{default:o(()=>t[8]||(t[8]=[U("REGISTRAR ASESOR")])),_:1})]),_:1}),s(P,{xs:24,md:12,lg:6},{default:o(()=>[s(se,{compact:""},{default:o(()=>[s(Z,{value:v.search,"onUpdate:value":t[1]||(t[1]=h=>v.search=h),style:{width:"calc(100% - 80px)"},onInput:n,onKeyup:be(O,["enter"])},null,8,["value"]),s(i,{type:"primary",disabled:v.search==="",onClick:O},{default:o(()=>t[9]||(t[9]=[U("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),s(ue,{bordered:"",scroll:{x:T.value,y:I.value},class:"table-users",columns:f,"data-source":l.value,pagination:!1,loading:_.value,size:"small"},{bodyCell:o(({column:h,record:Y,index:pe})=>[h.dataIndex==="idx"?(r(),A(F,{key:0},[U(B(V.value(pe)),1)],64)):c("",!0),h.dataIndex==="lastname"?(r(),A(F,{key:1},[U(B(Y.profile_lastname)+" "+B(Y.profile_middlename),1)],64)):c("",!0),h.dataIndex==="role"?(r(),A(F,{key:2},[Y.role_user==1?(r(),m(K,{key:0,color:"blue"},{default:o(()=>t[10]||(t[10]=[U("SUPERVISOR")])),_:1})):c("",!0),Y.role_user==2?(r(),m(K,{key:1,color:"red"},{default:o(()=>t[11]||(t[11]=[U("ASESOR PNTE")])),_:1})):c("",!0),Y.role_user==7?(r(),m(K,{key:2,color:"purple"},{default:o(()=>t[12]||(t[12]=[U("ASESOR - NOTARÍA")])),_:1})):c("",!0)],64)):c("",!0),h.dataIndex=="actions"?(r(),m(de,{key:3,trigger:["click"]},{overlay:o(()=>[s(ie,null,{default:o(()=>[s(ee,null,{default:o(()=>[k("a",{onClick:_e=>C(Y)},"Editar datos",8,Ae)]),_:2},1024),s(ee,null,{default:o(()=>[k("a",{onClick:_e=>R(Y)},"Resetear contraseña",8,Ee)]),_:2},1024)]),_:2},1024)]),default:o(()=>[k("a",{class:"ant-dropdown-link",onClick:t[2]||(t[2]=ye(()=>{},["prevent"]))},[s(i,{shape:"circle",icon:H(x(we)),size:"small"},null,8,["icon"])])]),_:2},1024)):c("",!0)]),_:1},8,["scroll","data-source","loading"])]),k("div",Oe,[k("span",null,[s(K,{color:"blue"},{default:o(()=>[k("b",null,B(S.value),1)]),_:1}),t[14]||(t[14]=U("Usuarios"))]),s(me,{size:"small",total:S.value,pageSize:$.value,onChange:N,showSizeChanger:!1},null,8,["total","pageSize"])]),s(W,{width:"550",open:e.value,"onUpdate:open":t[3]||(t[3]=h=>e.value=h),class:"draw",title:"Editar datos del asesor",placement:"right"},{default:o(()=>[s(ke,{onCloseDraw:b,record:L.value},null,8,["record"])]),_:1},8,["open"]),s(W,{width:"550",open:q.value,"onUpdate:open":t[5]||(t[5]=h=>q.value=h),class:"draw",title:"REGISTRAR UN ASESOR",placement:"right"},{default:o(()=>[s(qe,{onCloseDraw:t[4]||(t[4]=h=>q.value=!1)})]),_:1},8,["open"]),s(W,{width:"350",open:E.value,"onUpdate:open":t[7]||(t[7]=h=>E.value=h),class:"draw",title:"Cambiar contraseña",placement:"right"},{default:o(()=>[s(ce,{layout:"vertical",model:g,name:"basic",autocomplete:"off",onFinish:w,onFinishFailed:a.onFinishFailed},{default:o(()=>[s(ae,{label:"Contraseña",name:"password",rules:[{required:!0,message:"Escribir contraseña"}]},{default:o(()=>[s(Z,{value:g.password,"onUpdate:value":t[6]||(t[6]=h=>g.password=h)},null,8,["value"])]),_:1}),s(ae,null,{default:o(()=>[s(i,{type:"primary","html-type":"submit"},{default:o(()=>t[15]||(t[15]=[U("CAMBIAR")])),_:1})]),_:1})]),_:1},8,["model","onFinishFailed"])]),_:1},8,["open"])],64)}}};export{Le as default};
