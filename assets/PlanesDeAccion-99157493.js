import{L as F,r as v,a as ae,k as te,K as _e,b as d,o as l,d as B,c as i,w as s,e as S,F as Q,x as ve,q as m,s as p,h as E,M as ge,i as M,t as ee,m as T,z as q,g as he,H as fe,I as be,P as ye,J as we}from"./index-a89c85d3.js";import{_ as De}from"./icoexcel-1b303edf.js";import{u as ne}from"./selectes-f79054a0.js";import"./es-abd47609.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import{M as xe}from"./MoreOutlined-5b727beb.js";const Ee={numberDocument:{type:"iSearch",label:"Número de documento",name:"numberDocument",required:!0,message:"Ingresar Número de documento",disabled:!1},namePerson:{type:"iText",label:"Nombre",name:"namePerson",required:!0,message:"Escribe nombre",disabled:!0},city_id:{type:"iSelectWrite",label:"Región del negocio",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelectWrite",label:"Provincia del negocio",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelectWrite",label:"Distrito del negocio",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar género",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"Seleccionar estado",disabled:!0},ruc:{type:"iSearch",label:"Número de RUC",name:"ruc",required:!0,message:"Escribe el número de RUC",disabled:!1},divider:{type:"iDivider"},component_1:{type:"iSelectWrite",is:"component",label:"Componente 1",name:"component_1",required:!0,message:"Seleccionar componente 1",disabled:!1},component_2:{type:"iSelectWrite",is:"component",label:"Componente 2",name:"component_2",required:!1,message:"Seleccionar componente 2",disabled:!1},component_3:{type:"iSelectWrite",is:"component",label:"Componente 3",name:"component_3",required:!1,message:"Seleccionar componente 3",disabled:!1},startDate:{type:"iDate",label:"Día Inicio",name:"startDate",required:!0,message:"Seleccionar fecha de inicio",placeholder:"año-mes-día"},endDate:{type:"iDate",label:"Día Fin",name:"endDate",required:!0,message:"Seleccionar fecha de fin",placeholder:"año-mes-día"}};const Ie={class:"grid-planes"},Se="DD/MM/YYYY",Ue={__name:"NuevoPlanAccion",props:["info"],emits:["closeDraw"],setup(L,{emit:U}){F.locale("es");const b=JSON.parse(localStorage.getItem("profile")),r=ne(),w=U,D=L;r.$patch({cities:r.cities}),r.$patch({genders:r.genders}),r.$patch({components:r.components}),r.fetchCities(),r.fetchGenders(),r.fetchComponents();const P=v(Ee),N=v(!1),C=v(null),R=[{value:1,label:"DNI"},{value:2,label:"RUC"}],j=[{label:"Si",value:"yes"},{label:"No",value:"no"}],a=ae({numberDocument:null,component_1:null,component_2:null,component_3:null}),G=n=>n&&n>F().endOf("day"),k=n=>{a[n]=a[n].replace(/\D/g,"")},O=(n,o)=>{const h=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(h)},W=async n=>{if(!a.numberDocument)return T.warning("Ingrese un número a buscar...");try{if(n=="numberDocument"){C.value=n;const o=await q({url:`person/data/${a.numberDocument}`,method:"GET"});if(o.status==404)return C.value=null,a.numberDocument=null,T.warning("Este usuario no fue registrado");o.status==200&&(a.idPerson=o.data.id,a.namePerson=o.data.namePerson,a.city_id=o.data.city_id,V(o.data.city_id),a.province_id=o.data.province_id,H(o.data.province_id),a.district_id=o.data.district_id,a.gender_id=o.data.gender_id,a.sick=o.data.sick)}if(n=="ruc"){C.value=n;const o=await q({url:`plans-action/components/${a.ruc}`,method:"GET"});if(o.status==200){const h=o.data;h.component_1&&(a.component_1=h.component_1),h.component_2&&(a.component_2=h.component_2),h.component_3&&(a.component_3=h.component_3),h.endDate&&(a.endDate=F(h.endDate,"YYYY-MM-DD"))}else return C.value=null,a.ruc=null,T.warning("No se han registrado datos con ese número de RUC")}}catch{console.log("Failed to update record")}finally{C.value=null}},V=n=>{a.province_id=null,a.district_id=null,r.fetchProvinces(n)},H=n=>{a.district_id=null,r.fetchDistricts(n)},J=(n,o)=>{Object.keys(a).filter(_=>_!==o&&_.startsWith("component_")).some(_=>a[_]===n)?(a[o]=null,console.error("Opción ya seleccionada en otro campo")):a[o]=n},Y=async()=>{N.value=!0;const n={people_id:a.idPerson,cde_id:b.cde_id,component_1:a.component_1,component_2:a.component_2,component_3:a.component_3,ruc:a.ruc,startDate:F(a.startDate).format("YYYY-MM-DD"),endDate:F(a.endDate).format("YYYY-MM-DD")};try{const o=await q({url:"plans-action/create",method:"POST",data:n});o.status==200&&(T.success(o.message),w("closeDraw")),o.status==400&&T.warning(o.message)}catch{console.log("Failed to update record")}finally{N.value=!1}};function z(n){console.log("tuuuuu",n)}return te(()=>{D.info&&z(D.info)}),_e(()=>D.info,n=>{n&&z(n)}),(n,o)=>{const h=d("a-input"),_=d("a-form-item"),I=d("a-select"),K=d("a-input-search"),X=d("a-divider"),x=d("a-date-picker"),Z=d("a-button"),c=d("a-form");return l(),B("div",null,[i(c,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:Y},{default:s(()=>[S("div",Ie,[(l(!0),B(Q,null,ve(P.value,(e,f)=>(l(),B(Q,{key:f},[e.type==="iText"?(l(),m(_,{key:0,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:s(()=>[i(h,{value:a[e.name],"onUpdate:value":t=>a[e.name]=t,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSelect"?(l(),m(_,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[e.name=="typeDocument"?(l(),m(I,{key:0,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:R},null,8,["value","onUpdate:value"])):p("",!0),e.name=="gender_id"?(l(),m(I,{key:1,disabled:e.disabled,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:E(r).genders},null,8,["disabled","value","onUpdate:value","options"])):p("",!0),e.name=="sick"?(l(),m(I,{key:2,disabled:e.disabled,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:j},null,8,["disabled","value","onUpdate:value"])):p("",!0)]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSearch"?(l(),m(_,{key:2,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[i(K,{loading:C.value==e.name,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,onSearch:t=>W(e.name),onInput:t=>k(e.name),onEnterButton:t=>W(e.name),maxlength:11},null,8,["loading","value","onUpdate:value","onSearch","onInput","onEnterButton"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iDivider"?(l(),m(X,{key:3,dashed:"",style:{"grid-column":"1/3",margin:".5rem 0 1rem 0"}})):p("",!0),e.type==="iSelectWrite"?(l(),m(_,{key:4,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[e.name=="city_id"?(l(),m(I,{key:0,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(r).cities,"filter-option":O,onChange:V},null,8,["value","onUpdate:value","options"])):p("",!0),e.name=="province_id"?(l(),m(I,{key:1,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(r).provinces,"filter-option":O,onChange:H,disabled:!a.city_id},null,8,["value","onUpdate:value","options","disabled"])):p("",!0),e.name=="district_id"?(l(),m(I,{key:2,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(r).districts,"filter-option":O,disabled:!a.province_id},null,8,["value","onUpdate:value","options","disabled"])):p("",!0),e.is=="component"?(l(),m(I,{key:3,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(r).components,"filter-option":O,onChange:t=>J(t,e.name)},null,8,["value","onUpdate:value","options","onChange"])):p("",!0)]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iDate"?(l(),m(_,{key:5,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[i(x,{"disabled-date":G,locale:E(ge),value:a[e.name],"onUpdate:value":t=>a[e.name]=t,style:{width:"100%"},format:Se,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):p("",!0)],64))),128))]),i(_,null,{default:s(()=>[i(Z,{class:"btn-produce",type:"primary","html-type":"submit",loading:N.value},{default:s(()=>[M("GUARDAR")]),_:1},8,["loading"])]),_:1}),S("pre",null,ee(L.info),1)]),_:1},8,["model"])])}}},Ne=Ce(Ue,[["__scopeId","data-v-0ade12bd"]]),ke=he.get("token"),Oe="https://apituempresa.soporte-pnte.com/api/",Pe="http://127.0.0.1:8000/api/",Re=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?Pe:Oe;async function Ae(L,U){try{U(!0);const b=await fe({url:`${Re}${L}`,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${ke}`},method:"GET",responseType:"blob"}),r=window.URL.createObjectURL(new Blob([b.data])),w=document.createElement("a");w.href=r;const D=b.headers["content-disposition"],P=D?D.split("filename=")[1].split(";")[0]:"reporte.xlsx";w.setAttribute("download",P),document.body.appendChild(w),w.click(),document.body.removeChild(w)}catch(b){console.error("Error al descargar el archivo:",b)}finally{U(!1)}}const Me=S("h3",{class:"title-produce"},"PLANES DE ACCIÓN",-1),Te=S("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:De},null,-1),qe=["onClick"],Le={class:"paginator"},We={__name:"PlanesDeAccion",setup(L){const U=JSON.parse(localStorage.getItem("role")),b=ne();b.$patch({components:b.components}),b.fetchComponents();const r=v(null);v(null);const w=v(!1);v();const D=v(50),P=v([]),N=v(!1),C=v(0),R=v({page:1}),j=v("plans-action/list"),a=v(1200),G=v(window.innerHeight-100),k=v(!1);v(null);const O=v([{value:"si",label:"SI"},{value:"no",label:"NO"}]),W=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},...U[0].id!=2?[{title:"CENTRO TU EMPRESA",dataIndex:"centro_empresa",fixed:"left",width:150}]:[],...U[0].id!=2?[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180}]:[],{title:"RUC",dataIndex:"ruc",width:100,fixed:"left",align:"center"},{title:"NOMBRE DEL EMPRENDEDOR O MYPE",fixed:"left",dataIndex:"emprendedor_nombres",width:170},{title:"REGIÓN DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_region",width:170},{title:"PROVINCIA DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_provincia",width:170},{title:"DISTRITO DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_distrito",width:170},{title:"Genero",dataIndex:"genero",width:60,align:"center"},{title:"Tiene alguna Discapacidad ? (SI / NO)",dataIndex:"discapacidad",width:110,align:"center"},{title:"COMPONENTE 1",dataIndex:"component1",width:190,align:"center"},{title:"COMPONENTE 2",dataIndex:"component2",width:190,align:"center"},{title:"COMPONENTE 3",dataIndex:"component3",width:190,align:"center"},{title:"NÚMERO DE SESIONES",dataIndex:"numberSessions",width:100,align:"center"},{title:"DÍA INICIO",dataIndex:"startDate",width:100,align:"center"},{title:"DÍA FIN",dataIndex:"endDate",width:100,align:"center"},{title:"TOTAL DE DÍAS",dataIndex:"totalDate",width:100,align:"center"},{title:"ACTA DE COMPROMISO",dataIndex:"acta",width:160,align:"center"},{title:"CULMINÓ EL PLAN Y ENVIÓ CORREO",dataIndex:"envioCorreo",width:160,align:"center"},{title:"FECHA ACTUALIZACIÓN",dataIndex:"updated_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],V=c=>{r.value=c,k.value=!0},H=c=>{w.value=c},J=async()=>{Ae("download/actions-plans",H)},Y=async(c,e,f)=>{const t={idPlan:e.id,nameComponent:f,valueComponent:c},A=await q({url:"plans-action/edit-component",method:"PUT",data:t});A.status==200&&x(),A.status==400&&(T.warning(A.message),x())},z=async(c,e,f)=>{const t={idPlan:e.id,type:f,value:c};(await q({url:"plans-action/edit-yes-no",method:"PUT",data:t})).status==200&&x()},n=(c,e)=>{const f=c.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(f)},o=()=>{G.value=window.innerHeight-315},h=()=>{k.value=!1,x()},_=ae({search:""}),I=()=>{x({search:_.search})},K=()=>{_.search||x()},X=c=>{R.value.page=c,x()},x=async c=>{try{N.value=!0;const e=R.value.page===1?"":R.value,f=c?{...e,...c}:e,t=await q({url:j.value,method:"GET",params:f});P.value=t.data,C.value=t.pagination.total,D.value=t.pagination.per_page}catch(e){console.error("Error de red:",e)}finally{N.value=!1}},Z=be(()=>c=>(R.value.page-1)*D.value+c+1);return te(()=>{x(),window.addEventListener("resize",o),o()}),(c,e)=>{const f=d("a-button"),t=d("a-col"),A=d("a-input"),oe=d("a-input-group"),le=d("a-row"),$=d("a-select"),ie=d("a-menu-item"),se=d("a-menu"),re=d("a-dropdown"),de=d("a-table"),ce=d("a-tag"),ue=d("a-pagination"),pe=d("a-drawer");return l(),B("div",null,[Me,i(le,{style:{margin:"1rem 0"}},{default:s(()=>[i(t,{xs:24,md:12,lg:18},{default:s(()=>[i(f,{onClick:e[0]||(e[0]=y=>k.value=!0),type:"primary"},{default:s(()=>[M("NUEVO")]),_:1}),i(f,{class:"btn-excel",loading:w.value,type:"primary",style:{"margin-left":".6rem"},onClick:J},{default:s(()=>[Te,M(" DESCARGAR ")]),_:1},8,["loading"])]),_:1}),i(t,{xs:24,md:12,lg:6},{default:s(()=>[i(oe,{compact:""},{default:s(()=>[i(A,{value:_.search,"onUpdate:value":e[1]||(e[1]=y=>_.search=y),style:{width:"calc(100% - 80px)"},onInput:K},null,8,["value"]),i(f,{type:"primary",disabled:_.search==="",onClick:I},{default:s(()=>[M("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(de,{bordered:"",scroll:{x:a.value,y:G.value},class:"table-users",columns:W,"data-source":P.value,pagination:!1,loading:N.value,size:"small"},{bodyCell:s(({column:y,record:g,index:me})=>[y.dataIndex==="idx"?(l(),B(Q,{key:0},[M(ee(Z.value(me)),1)],64)):p("",!0),y.dataIndex==="component1"?(l(),m($,{key:1,style:{width:"170px"},value:g.component_1,"onUpdate:value":u=>g.component_1=u,options:E(b).components,"filter-option":n,onChange:u=>Y(u,g,"component_1")},null,8,["value","onUpdate:value","options","onChange"])):p("",!0),y.dataIndex==="component2"?(l(),m($,{key:2,style:{width:"170px"},value:g.component_2,"onUpdate:value":u=>g.component_2=u,options:E(b).components,"filter-option":n,onChange:u=>Y(u,g,"component_2")},null,8,["value","onUpdate:value","options","onChange"])):p("",!0),y.dataIndex==="component3"?(l(),m($,{key:3,style:{width:"170px"},value:g.component_3,"onUpdate:value":u=>g.component_3=u,options:E(b).components,"filter-option":n,onChange:u=>Y(u,g,"component_3")},null,8,["value","onUpdate:value","options","onChange"])):p("",!0),y.dataIndex==="acta"?(l(),m($,{key:4,value:g.actaCompromiso,"onUpdate:value":u=>g.actaCompromiso=u,style:{width:"70%"},options:O.value,onChange:u=>z(u,g,"actaCompromiso")},null,8,["value","onUpdate:value","options","onChange"])):p("",!0),y.dataIndex==="envioCorreo"?(l(),m($,{key:5,value:g.envioCorreo,"onUpdate:value":u=>g.envioCorreo=u,style:{width:"70%"},options:O.value,onChange:u=>z(u,g,"envioCorreo")},null,8,["value","onUpdate:value","options","onChange"])):p("",!0),y.dataIndex=="actions"?(l(),m(re,{key:6,trigger:["click"]},{overlay:s(()=>[i(se,null,{default:s(()=>[i(ie,null,{default:s(()=>[S("a",{onClick:u=>V(g)},"Editar",8,qe)]),_:2},1024)]),_:2},1024)]),default:s(()=>[S("a",{class:"ant-dropdown-link",onClick:e[2]||(e[2]=we(()=>{},["prevent"]))},[i(f,{shape:"circle",icon:ye(E(xe)),size:"small"},null,8,["icon"])])]),_:2},1024)):p("",!0)]),_:1},8,["scroll","data-source","loading"]),S("div",Le,[S("span",null,[i(ce,{color:"blue"},{default:s(()=>[S("b",null,ee(C.value),1)]),_:1}),M("Registros")]),i(ue,{size:"small",total:C.value,pageSize:D.value,onChange:X,showSizeChanger:!1},null,8,["total","pageSize"])]),i(pe,{open:k.value,"onUpdate:open":e[3]||(e[3]=y=>k.value=y),title:"Agregar un nuevo Plan de Acción",placement:"right",width:"650"},{default:s(()=>[i(Ne,{onCloseDraw:h,info:r.value},null,8,["info"])]),_:1},8,["open"])])}}};export{We as default};
