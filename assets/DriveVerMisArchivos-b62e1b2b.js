import{g as G,r as n,x as j,k as P,b as i,o as k,d as E,e as d,O as J,P as Q,c,w as m,i as B,F as K,z,t as I,s as N,q as W,h as X,Q as Z,H as ee,R as ae}from"./index-9e23a720.js";const te=d("h3",null,"ARCHIVOS",-1),oe={class:"w-search"},ne={key:0},le={class:"paginator-drive"},ce={__name:"DriveVerMisArchivos",setup(re){const v=JSON.parse(localStorage.getItem("user")),F="https://apituempresa.soporte-pnte.com/api/",L="http://127.0.0.1:8000/api/",U=window.location.hostname=="127.0.0.1"?L:F,$=G.get("token"),u=n({}),p=n([]),l=n(!1),M=n(0),g=n(0),C=n([]),D=n(""),_=n(!1),H=async a=>{try{if(a===0)return h();l.value=!0;const e=`/drive/author/${a}`,t=await z({url:e,method:"GET",params:w.value});p.value=t}catch(e){console.error("Error de red:",e)}finally{l.value=!1}},O=async a=>{try{if(_.value=!0,!a)return g.value=0,h();const e=`/drive/search-file/${a}/${v.id}`,{data:t}=await z({url:e,method:"GET"});p.value=t.data}catch(e){console.error("Error de red:",e)}finally{_.value=!1}},T=async a=>{u.value={...u.value,[a]:!0};try{const e=await ee.get(`${U}/drive/download/${a}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${$}`}}),t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download",a),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Error al descargar el archivo",e)}finally{u.value={...u.value,[a]:!1}}},V=(a,e)=>{const t=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)},R=a=>ae(a).format("DD/MM/YYYY HH:mm A"),S=n(window.innerHeight-100),f=()=>{S.value=window.innerHeight-300};j(()=>{window.removeEventListener("resize",f)});const w=n({page:1}),Y=[{title:"Autor",dataIndex:"user",fixed:"left",width:180},{title:"Nombre archivo",dataIndex:"filename",width:140},{title:"Fecha de carga",dataIndex:"date",width:120,align:"center"},{title:"",dataIndex:"actions",width:120,align:"center"}],q=a=>{w.value.page=a,h()},h=async()=>{let a=null;v.role=="100"||v.role=="10"?a="/drive/files/admin":a=`/drive/files/${v.id}`;try{l.value=!0;const{data:e}=await z({url:a,method:"GET",params:w.value});p.value=e;const t=new Map(e.map(r=>[r.idUser,r.user])),o=Array.from(t.entries()).map(([r,b])=>({value:r,label:b})),y={value:[{value:0,label:"Todos"},...o]};C.value=y.value}catch(e){console.error("Error de red:",e)}finally{l.value=!1}};return P(()=>{h(),window.addEventListener("resize",f),f()}),(a,e)=>{const t=i("a-input-search"),o=i("a-select"),A=i("a-button"),y=i("a-table"),r=i("a-tag"),b=i("a-pagination");return k(),E(K,null,[d("div",null,[te,J(d("div",oe,[c(t,{value:D.value,"onUpdate:value":e[0]||(e[0]=s=>D.value=s),placeholder:"Buscar por nombre del archivo",style:{width:"250px"},loading:_.value,onSearch:O},null,8,["value","loading"]),c(o,{value:g.value,"onUpdate:value":e[1]||(e[1]=s=>g.value=s),"show-search":"",placeholder:"Buscar",style:{width:"220px"},options:C.value,"filter-option":V,onChange:H},null,8,["value","options"])],512),[[Q,!l.value]]),c(y,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:S.value},columns:Y,"data-source":p.value,pagination:!1,loading:l.value,size:"small"},{bodyCell:m(({column:s,record:x})=>[s.dataIndex=="date"?(k(),E("div",ne,I(R(x.created_at)),1)):N("",!0),s.dataIndex=="actions"?(k(),W(A,{key:1,size:"small",onClick:se=>T(x.path),type:"primary",ghost:"",loading:u.value[x.path]},{icon:m(()=>[c(X(Z))]),default:m(()=>[B(" Descargar ")]),_:2},1032,["onClick","loading"])):N("",!0)]),_:1},8,["scroll","data-source","loading"])]),d("div",le,[d("span",null,[c(r,{color:"blue"},{default:m(()=>[d("b",null,I(p.value.length),1)]),_:1}),B(" Archivos Subidos")]),c(b,{size:"small",pageSize:50,total:M.value,onChange:q,showSizeChanger:!1},null,8,["total"])])],64)}}};export{ce as default};
