import{c as a,A as re,g as ie,r as l,x as ce,k as ne,b as v,o as _,d as y,e as d,i as M,t as w,w as s,v as F,s as Z,h as z,V as de,W as ue,L as le,R as pe,F as J,B as x,m as Q,J as me,X as ve,a as _e,y as ee,Y as te,Z as fe,P as he,_ as ge,p as ye,j as we}from"./index-b7e174ec.js";import{D as be}from"./DrawDriveUsers.component-2b2891da.js";import{M as Ce}from"./MoreOutlined-94b0205d.js";import{_ as Fe}from"./_plugin-vue_export-helper-c27b6911.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32z"}}]},name:"folder",theme:"filled"};const xe=ke;function ae(p){for(var u=1;u<arguments.length;u++){var n=arguments[u]!=null?Object(arguments[u]):{},m=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(m=m.concat(Object.getOwnPropertySymbols(n).filter(function(h){return Object.getOwnPropertyDescriptor(n,h).enumerable}))),m.forEach(function(h){Ee(p,h,n[h])})}return p}function Ee(p,u,n){return u in p?Object.defineProperty(p,u,{value:n,enumerable:!0,configurable:!0,writable:!0}):p[u]=n,p}var W=function(u,n){var m=ae({},u,n.attrs);return a(re,ae({},m,{icon:xe}),null)};W.displayName="FolderFilled";W.inheritAttrs=!1;const De=W;const Se={style:{color:"#959595","font-weight":"300"}},Ae=d("br",null,null,-1),Oe={key:0},$e={key:1,class:"uppercase"},Ie=["onClick"],Ue=d("a",null,"Eliminar",-1),Te={class:"paginator-drive"},Re={__name:"ArchivosFolder.component",props:["idFile"],emits:["handleDeleteItem"],setup(p,{emit:u}){const n=p,m=u,h="https://apituempresa.soporte-pnte.com/api/",b="http://127.0.0.1:8000/api/",A=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?b:h,H=ie.get("token"),E=l(!1),k=l([]),O=l(null),$=l(null),r=l({}),D=l([]),I=l(!1),S=l(0),N=[{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],P=async t=>{var c;O.value=t.id;try{const f=await x({url:`drive/users-selected/${t.id}`,method:"GET"});f.data[0]&&($.value=(c=f.data[0])==null?void 0:c.user_ids)}catch(f){console.error("Error de red:",f)}E.value=!0},j=()=>{n.idFile&&(D.value=n.idFile.dataSource,S.value=n.idFile.total)},Y=async t=>{try{const c=await x({url:`drive/delete-file/${t.id}`,method:"DELETE"});Q.success(c.message);const f={id:n.idFile.id,name:n.idFile.nameFolder};m("handleDeleteItem",f)}catch(c){console.error("Error de red:",c)}},U=async t=>{r.value={...r.value,[t]:!0};try{const c=await me.get(`${A}drive/download/${t}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${H}`}}),f=window.URL.createObjectURL(new Blob([c.data])),g=document.createElement("a");g.href=f,g.setAttribute("download",t),document.body.appendChild(g),g.click(),document.body.removeChild(g)}catch(c){console.error("Error al descargar el archivo",c)}finally{r.value={...r.value,[t]:!1}}},G=t=>ve(t).format("DD/MM/YYYY HH:mm A"),V=l(window.innerHeight-100),T=()=>{V.value=window.innerHeight-300};ce(()=>{window.removeEventListener("resize",T)});const B=l({page:1}),e=t=>{B.value.page=t,o()},o=async()=>{try{I.value=!0;const{data:t}=await x({url:`drive/data-files/${n.idFile}`,method:"GET"});D.value=t.data,S.value=t.total}catch(t){console.error("Error de red:",t)}finally{I.value=!1}};return ne(()=>{window.addEventListener("resize",T),T()}),(t,c)=>{const f=v("a-button"),g=v("a-menu-item"),q=v("a-popconfirm"),X=v("a-menu"),i=v("a-dropdown"),R=v("a-table"),oe=v("a-tag"),se=v("a-pagination");return _(),y(J,null,[d("div",null,[d("h3",null,[M("ARCHIVOS "),d("span",Se,"/ "+w(n.idFile.nameFolder),1)]),Ae,a(R,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:V.value},columns:N,"data-source":D.value,pagination:!1,loading:I.value,size:"small"},{bodyCell:s(({column:L,record:C})=>[L.dataIndex=="date"?(_(),y("div",Oe,w(G(C.created_at)),1)):F("",!0),L.dataIndex=="user"?(_(),y("div",$e,w(C.profile.name)+" "+w(C.profile.lastname)+" "+w(C.profile.middlename),1)):F("",!0),L.dataIndex=="download"?(_(),Z(f,{key:2,size:"small",onClick:K=>U(C.path),type:"primary",ghost:"",loading:r.value[C.path]},{icon:s(()=>[a(z(de))]),default:s(()=>[M(" Descargar ")]),_:2},1032,["onClick","loading"])):F("",!0),L.dataIndex=="actions"?(_(),Z(i,{key:3,trigger:["click"]},{overlay:s(()=>[a(X,null,{default:s(()=>[a(g,null,{default:s(()=>[d("a",{onClick:K=>P(C)},"Visible para",8,Ie)]),_:2},1024),a(g,null,{default:s(()=>[a(q,{title:"Â¿Seguro de eliminar?",onConfirm:K=>Y(C)},{icon:s(()=>[a(z(ue),{style:{color:"red"}})]),default:s(()=>[Ue]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:s(()=>[d("a",{class:"ant-dropdown-link",onClick:c[0]||(c[0]=le(()=>{},["prevent"]))},[a(f,{shape:"circle",icon:pe(z(Ce))},null,8,["icon"])])]),_:2},1024)):F("",!0)]),_:1},8,["scroll","data-source","loading"])]),d("div",null,w(j()),1),d("div",Te,[d("span",null,[a(oe,{color:"blue"},{default:s(()=>[d("b",null,w(D.value.length),1)]),_:1}),M(" Archivos Subidos")]),a(se,{size:"small",pageSize:20,total:S.value,onChange:e,showSizeChanger:!1},null,8,["total"])]),E.value?(_(),Z(be,{key:0,plainOptions:k.value,idFile:O.value,selectedUsers:$.value,onHandleCloseDrawer:c[1]||(c[1]=L=>E.value=!1)},null,8,["plainOptions","idFile","selectedUsers"])):F("",!0)],64)}}};const Le=p=>(ye("data-v-50e0977c"),p=p(),we(),p),Me={key:0},ze=Le(()=>d("h3",null,"MIS CARPETAS",-1)),He={class:"file-wrapper"},Ve=["onContextmenu"],Be={class:"text"},Ne={key:0,class:"section-table"},Pe=["onClick"],je={__name:"DriveCarpetas",setup(p){const u=l(!1),n=l(null),m=l(null),h=l("files"),b=l(!1),A=l(!1),H=l(null),E=l(null),k=l(null),O=l(0),$=l(0),r=_e({name:"",color:"#000000"}),D={customMenu:{items:[{label:"Abrir"},{label:"Editar"},{label:"Eliminar"}]}},I=(e,o,t)=>{o.preventDefault(),k.value=D[e],O.value=o.clientX,$.value=o.clientY,window.addEventListener("click",S),n.value=t},S=e=>{e.target.closest(".context-menu")||(k.value=null,window.removeEventListener("click",S))},N=e=>{k.value=null,e.label=="Abrir"&&U(n.value),e.label=="Editar"&&G(n.value)},P=()=>{b.value=!1,r.name="",r.color="#000000",m.value=null},j=()=>{b.value=!0},Y=e=>{U(e)},U=async e=>{u.value=!0,h.value=null;try{const{data:o}=await x({url:`drive/data-files/${e.id}`,method:"GET"}),t={id:e.id,dataSource:o.data,total:o.total,nameFolder:e.name};E.value=t,h.value="table"}catch(o){console.error("Error de red:",o)}finally{u.value=!1}},G=e=>{r.name=e.name,r.color=e.color,b.value=!0,m.value=e.id},V=async()=>{A.value=!0;try{let e;m.value?e=await x({url:`drive/update-file/${m.value}`,method:"PUT",data:r}):e=await x({url:"drive/create-file",method:"POST",data:r}),e.status==200&&(r.name=null,b.value=!1,Q.success(e.message),B(),m.value=null)}catch{Q.error("No tienes permisos")}finally{A.value=!1}},T=()=>{console.log("Failed:")},B=async()=>{try{const{data:e}=await x({url:"drive/files",method:"GET"});H.value=e}catch(e){console.error("Error de red:",e)}};return ne(()=>{B()}),(e,o)=>{const t=v("a-button"),c=v("a-spin"),f=v("a-input"),g=v("a-form-item"),q=v("a-form"),X=v("a-drawer");return _(),y("div",null,[h.value=="files"?(_(),y("section",Me,[ze,a(t,{style:{margin:"1rem 0 1.5rem 0"},class:"btn-produce",type:"primary",onClick:j},{default:s(()=>[M("NUEVO")]),_:1}),d("div",He,[(_(!0),y(J,null,ee(H.value,i=>(_(),y("div",{key:i.id},[d("div",{class:"file",onContextmenu:le(R=>I("customMenu",R,i),["prevent"])},[a(z(De),{class:"ico",style:te({color:i.color}),onClick:R=>U(i)},null,8,["style","onClick"]),d("span",Be,w(i.name),1)],40,Ve)]))),128))])])):F("",!0),a(c,{spinning:u.value},{default:s(()=>[h.value=="table"?(_(),y("section",Ne,[a(z(fe),{class:"close",onClick:o[0]||(o[0]=i=>h.value="files")}),a(Re,{idFile:E.value,onHandleDeleteItem:Y},null,8,["idFile"])])):F("",!0)]),_:1},8,["spinning"]),k.value?(_(),y("div",{key:1,class:"context-menu",style:te({top:$.value+"px",left:O.value+"px"})},[d("ul",null,[(_(!0),y(J,null,ee(k.value.items,i=>(_(),y("li",{key:i.label,onClick:R=>N(i)},w(i.label),9,Pe))),128))])],4)):F("",!0),a(X,{open:b.value,"onUpdate:open":o[3]||(o[3]=i=>b.value=i),title:"Nueva carpeta",placement:"right",onClose:P},{default:s(()=>[a(q,{layout:"vertical",model:r,name:"basic",onFinish:V,onFinishFailed:T},{default:s(()=>[a(g,{label:"Nombre de la carpeta",name:"name",rules:[{required:!0,message:"Escribe un nombre del archivo"}]},{default:s(()=>[a(f,{value:r.name,"onUpdate:value":o[1]||(o[1]=i=>r.name=i)},null,8,["value"])]),_:1}),a(g,{label:"Color de la carpeta",name:"color"},{default:s(()=>[he(d("input",{type:"color","onUpdate:modelValue":o[2]||(o[2]=i=>r.color=i)},null,512),[[ge,r.color]])]),_:1}),a(g,null,{default:s(()=>[a(t,{class:"btn-produce",type:"primary","html-type":"submit",loading:A.value},{default:s(()=>[M(w(m.value?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Ze=Fe(je,[["__scopeId","data-v-50e0977c"]]);export{Ze as default};
