import{z as O,r as m,D as de,a as J,T as j,j as K,b as i,o as s,p as _,w as l,e as h,d as R,F as N,v as ue,c as o,q as p,h as A,B as ce,i as I,t as z,I as X,m as Z,u as me,g as pe,S as _e,s as fe,H as ve,E as ye}from"./index-08d187e2.js";import{u as Q}from"./selectes-c8cb3b68.js";import"./es-91d4c0fb.js";import{C as ge}from"./CloudOutlined-a71f35e5.js";import{M as De}from"./MoreOutlined-42b858e3.js";const be={class:"form-fair"},we="DD/MM/YYYY",he={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup(M,{emit:V}){O.locale("es");const f=Q();f.$patch({cities:f.cities}),f.$patch({provinces:f.provinces}),f.$patch({districts:f.districts}),f.fetchCities();const b=m(!1),g=M,U=V;de();const a=J({}),k={title:{type:"iText",label:"NOMBRE EVENTO",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA FIN",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1},modality:{type:"iSelect",label:"MODALIDAD",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0,max:100}},Y=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}],q=n=>u=>{const y=new Date().setHours(0,0,0,0);if(n==="startDate")return u&&u.valueOf()<y;if(n==="endDate"){const r=a.startDate?new Date(a.startDate).setHours(0,0,0,0):null;return u&&(u.valueOf()<y||r&&u.valueOf()<r)}return u&&u.valueOf()<y};j(()=>a.startDate,n=>{a.endDate&&new Date(n)>new Date(a.endDate)&&(a.endDate=null)}),j(()=>a.endDate,n=>{a.startDate&&new Date(n)<new Date(a.startDate)&&(a.startDate=null)});const x=(n,u)=>{const y=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return u.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(y)},F=n=>{if(n=="modality")return Y;if(n=="powerBy")return pertenece;if(n=="fairtype_id")return typeFair},B=n=>{a.province_id=null,a.district_id=null,f.fetchProvinces(n)},S=n=>{a.district_id=null,f.fetchDistricts(n)},T=()=>{a.title=null,a.startDate=null,a.endDate=null,a.modality=null,a.city_id=null,a.province_id=null,a.district_id=null,a.address=null},P=async()=>{b.value=!0;const n={title:a.title,startDate:O(a.startDate).format("YYYY-MM-DD"),endDate:O(a.endDate).format("YYYY-MM-DD"),modality:a.modality,city_id:a.city_id,province_id:a.province_id,district_id:a.district_id,address:a.address};try{const u=g.dataRow?"PUT":"POST",y=g.dataRow?`attendance/update/${g.dataRow.id}`:"attendance/create",r=await X({url:y,method:u,data:n});r.status==200&&(Z.success(r.message),U("closeDraw"),T()),r.status==500&&(Z.error(r.message),T())}catch{Z.error("Se presentó un error, los valores son requeridos")}finally{b.value=!1}},$=n=>{const u=a[n]?a[n].trim():"";a[n]=u};function H(n){}return K(()=>{g.dataRow&&(g.dataRow,void 0)}),j(()=>g.dataRow,n=>{n||T()}),(n,u)=>{const y=i("a-input"),r=i("a-form-item"),w=i("a-select"),G=i("a-textarea"),C=i("a-input-number"),c=i("a-date-picker"),t=i("a-button"),v=i("a-form");return s(),_(v,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:P},{default:l(()=>[h("div",be,[(s(),R(N,null,ue(k,(e,W)=>(s(),R(N,{key:W},[e.type==="iText"?(s(),_(r,{key:0,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,max:e.max}]},{default:l(()=>[o(y,{value:a[e.name],"onUpdate:value":d=>a[e.name]=d,maxlength:e.max,onBlur:d=>$(e.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSelect"?(s(),_(r,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[o(w,{value:a[e.name],"onUpdate:value":d=>a[e.name]=d,options:F(e.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iTextarea"?(s(),_(r,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[o(G,{value:a[e.name],"onUpdate:value":d=>a[e.name]=d,rows:3,maxlength:e.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iNumber"?(s(),_(r,{key:3,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[o(C,{value:a[e.name],"onUpdate:value":d=>a[e.name]=d,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iDate"?(s(),_(r,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[o(c,{locale:A(ce),value:a[e.name],"onUpdate:value":d=>a[e.name]=d,style:{width:"100%"},format:we,placeholder:"día/mes/año","disabled-date":q(e.name)},null,8,["locale","value","onUpdate:value","disabled-date"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSelectWrite"?(s(),_(r,{key:5,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[e.name=="city_id"?(s(),_(w,{key:0,value:a[e.name],"onUpdate:value":d=>a[e.name]=d,options:A(f).cities,"show-search":"","filter-option":x,onChange:B},null,8,["value","onUpdate:value","options"])):p("",!0),e.name=="province_id"?(s(),_(w,{key:1,value:a[e.name],"onUpdate:value":d=>a[e.name]=d,options:A(f).provinces,"show-search":"","filter-option":x,onChange:S,disabled:!a.city_id},null,8,["value","onUpdate:value","options","disabled"])):p("",!0),e.name=="district_id"?(s(),_(w,{key:2,value:a[e.name],"onUpdate:value":d=>a[e.name]=d,options:A(f).districts,"show-search":"","filter-option":x,disabled:!a.province_id},null,8,["value","onUpdate:value","options","disabled"])):p("",!0)]),_:2},1032,["name","label","rules"])):p("",!0)],64))),64))]),o(r,null,{default:l(()=>[o(t,{type:"primary","html-type":"submit",loading:b.value},{default:l(()=>[I(z(M.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const Ie={key:1},xe=["onClick"],Se={class:"paginator"},Oe={__name:"IndexAsistencia",props:["idConvenio"],setup(M){O.locale("es");const V=me(),f=JSON.parse(localStorage.getItem("role"))||[];Q(),pe.get("token");const b=m(!1),g=m(null);m(!1),m(null);const U=m(0),a=m(50),k=m({page:0}),Y=m(1200),q=m([]),x=m(!1);m(!1),m(!1),m(!1),m(!1),m(null);const F=m(window.innerHeight-100),B=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"NOMBRE EVENTO",fixed:"left",dataIndex:"title",width:220},{title:"LINK",dataIndex:"slug",width:100,align:"center"},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:120,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"DÍAS RESTANTES",dataIndex:"dateDiff",align:"center",width:140},{title:"MODALIDAD",dataIndex:"modality",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"CREADO POR",dataIndex:"profile",width:170},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],S=J({search:""}),T=c=>f.some(t=>c.includes(t.id)),P=()=>{C(),b.value=!1},$=()=>{g.value=null,b.value=!0},H=c=>{const t=O().startOf("day"),e=O(c).startOf("day").diff(t,"days");return e<=-1?e:e===0?1:e},n=()=>{let c={search:S.search};C(c)},u=()=>{S.search||C()},y=c=>{V.push(`/admin/asistencia/inscritos/${c.slug}`)},r=c=>{k.value.page=c,C()},w=()=>{F.value=window.innerHeight-320},G=_e(()=>c=>k.value.page*a.value+c+1),C=async c=>{try{x.value=!0;let t;t=k.value.page==0?"":k.value,t=c?{...t,...c}:t;const{data:v}=await X({url:"attendance/list",method:"GET",params:t});q.value=v==null?void 0:v.data,U.value=v.total,a.value=v.per_page}catch(t){console.error("Error de red:",t)}finally{x.value=!1}};return fe(()=>{window.removeEventListener("resize",w)}),K(()=>{window.addEventListener("resize",w),w(),C()}),(c,t)=>{const v=i("a-button"),e=i("a-col"),W=i("a-input"),d=i("a-input-group"),ee=i("a-row"),ae=i("router-link"),L=i("a-tag"),te=i("a-menu-item"),ne=i("a-menu"),le=i("a-dropdown"),se=i("a-table"),oe=i("a-pagination"),ie=i("a-drawer");return s(),R(N,null,[h("div",null,[t[8]||(t[8]=h("h3",{class:"title-produce"},"LISTA EVENTOS UGO",-1)),o(ee,{style:{margin:"1rem 0"}},{default:l(()=>[o(e,{xs:24,md:12,lg:18},{default:l(()=>[T([5,10,11])?(s(),_(v,{key:0,type:"primary",onClick:$,style:{"margin-right":".5rem"}},{default:l(()=>t[3]||(t[3]=[I("NUEVO EVENTO")])),_:1})):p("",!0)]),_:1}),o(e,{xs:24,md:12,lg:6},{default:l(()=>[o(d,{compact:""},{default:l(()=>[o(W,{value:S.search,"onUpdate:value":t[0]||(t[0]=D=>S.search=D),style:{width:"calc(100% - 80px)"},onInput:u},null,8,["value"]),o(v,{type:"primary",disabled:S.search==="",onClick:n},{default:l(()=>t[4]||(t[4]=[I("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(se,{bordered:"",scroll:{x:Y.value,y:F.value},class:"table-fairs",columns:B,"data-source":q.value,pagination:!1,loading:x.value,size:"small"},{bodyCell:l(({column:D,record:E,index:re})=>[D.dataIndex=="idx"?(s(),R(N,{key:0},[I(z(G.value(re)),1)],64)):p("",!0),D.dataIndex=="slug"?(s(),_(ae,{key:1,to:`/asistencias/${E.slug}`,target:"_blank"},{default:l(()=>[o(A(ge),{class:"fair-link"})]),_:2},1032,["to"])):p("",!0),D.dataIndex=="modality"?(s(),R(N,{key:2},[E.modality=="p"?(s(),_(L,{key:0,color:"blue"},{default:l(()=>t[5]||(t[5]=[I("PRESENCIAL")])),_:1})):p("",!0),E.modality=="v"?(s(),_(L,{key:1,color:"orange"},{default:l(()=>t[6]||(t[6]=[I("VIRTUAL")])),_:1})):p("",!0)],64)):p("",!0),D.dataIndex=="dateDiff"?(s(),R(N,{key:3},[H(E.endDate2)<0?(s(),_(L,{key:0,color:"red"},{default:l(()=>t[7]||(t[7]=[I(" FINALIZADO ")])),_:1})):(s(),R("span",Ie,z(H(E.endDate2)),1))],64)):p("",!0),D.dataIndex=="actions"?(s(),_(le,{key:4,trigger:["click"]},{overlay:l(()=>[o(ne,null,{default:l(()=>[o(te,null,{default:l(()=>[h("a",{onClick:Ce=>y(E)},"Inscritos",8,xe)]),_:2},1024)]),_:2},1024)]),default:l(()=>[h("a",{class:"ant-dropdown-link",onClick:t[1]||(t[1]=ve(()=>{},["prevent"]))},[o(v,{shape:"circle",icon:ye(A(De)),size:"small"},null,8,["icon"])])]),_:2},1024)):p("",!0)]),_:1},8,["scroll","data-source","loading"])]),h("div",Se,[h("span",null,[o(L,{color:"blue"},{default:l(()=>[h("b",null,z(U.value),1)]),_:1}),t[9]||(t[9]=I("Eventos creados"))]),o(oe,{size:"small",total:U.value,pageSize:a.value,onChange:r,showSizeChanger:!1},null,8,["total","pageSize"])]),o(ie,{open:b.value,"onUpdate:open":t[2]||(t[2]=D=>b.value=D),title:g.value?"Editar Registro":"Nueva Registro",placement:"right",width:"550"},{default:l(()=>[o(he,{onCloseDraw:P,dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open","title"])],64)}}};export{Oe as default};
