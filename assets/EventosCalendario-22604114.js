import{r as f,a as G,l as E,j as Q,T as W,b as r,o as i,d as m,c as n,w as o,e as c,F as M,s as ee,x as P,q as R,h as $,i as O,t as D,m as V,K as J,E as pe,X as _e,p as Z,y as fe,J as ve}from"./index-feb1daca.js";import{u as te}from"./selectes-d611cfc2.js";import{Q as ae}from"./quill.snow-55c69184.js";import"./es-94f680dc.js";import{M as ge}from"./MoreOutlined-7d689162.js";const ye={class:"grid-events"},be={style:{display:"flex",margin:"1rem 0 .5rem"}},he={key:3,class:"grid-events-hour"},we={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup(F,{emit:I}){const y=te();y.$patch({officesPnte:y.officesPnte}),y.fetchOfficesPnte();const k=I,p=F,S=f(!1),U={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=f([{dates:new Date}]),_=f({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),e=G({allDay:1}),z=f([{start:null,end:E().subtract(0,"day").format("YYYY-MM-DD")}]),w=s=>s==="id_pnte"?y.officesPnte:[],u={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},H=s=>{if(s==2||s==7){const l=Object.entries(_.value),g=l.findIndex(([C])=>C==="title"),v=[...l.slice(0,g+1),...Object.entries(u),...l.slice(g+1)];_.value=Object.fromEntries(v)}else{const l={..._.value};delete l.organiza,delete l.numMypes,_.value=l}},L=(s,l)=>{const g=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(g)},Y=async()=>{if(!e.date)return V.warning("Debes de seleccionar una fecha del calendario");if(!e.hours)return V.warning("Debes de seleccionar una hora");const s={id_pnte:e.id_pnte,title:e.title,...e.organiza&&{organiza:e.organiza},...e.numMypes&&{numMypes:e.numMypes},dateStart:E(e.date.start).format("YYYY-MM-DD"),dateEnd:E(e.date.end).format("YYYY-MM-DD"),start:E(e.hours[0]).format("HH:mm"),end:E(e.hours[1]).format("HH:mm"),description:e.description,nameUser:e.nameUser,link:e.link};S.value=!0;try{const l=p.dataRow?`event/update/${p.dataRow.id}`:"event/create",g=p.dataRow?"PUT":"POST",v=await J({url:l,method:g,data:s});v.status===200&&(V.success(v.message),e.title="",e.hours=[],e.organiza="",e.numMypes="",e.description="</p>",e.nameUser="",e.link="",e.date=null,k("closeDraw"))}catch(l){V.error(l.message)}finally{S.value=!1}},T=()=>{e.id_pnte=null,e.numMypes="",e.organiza="",e.title="",e.description="</p>",e.nameUser="",e.link="",e.date=null},N=s=>{if(s){if(e.id_pnte=s.id_pnte,s.id_pnte==2||s.id_pnte==7){const l=Object.entries(_.value),g=l.findIndex(([C])=>C==="title"),v=[...l.slice(0,g+1),...Object.entries(u),...l.slice(g+1)];_.value=Object.fromEntries(v)}e.numMypes=s.numMypes,e.organiza=s.organiza,e.title=s.title,e.description=s.description,e.nameUser=s.nameUser,e.link=s.link,e.date={start:E(s.dateStart).toISOString(),end:E(s.dateEnd).toISOString()},e.hours=[E(s.start,"HH:mm"),E(s.end,"HH:mm")]}};return Q(()=>{p.dataRow&&N(p.dataRow)}),W(()=>p.dataRow,s=>{s?N(s):T()}),(s,l)=>{const g=r("a-select"),v=r("a-form-item"),C=r("a-input"),j=r("VDatePicker"),A=r("a-time-range-picker"),d=r("a-button"),a=r("a-form");return i(),m("div",null,[n(a,{class:"form-events",layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Y},{default:o(()=>[c("div",ye,[(i(!0),m(M,null,ee(_.value,(t,B)=>(i(),m(M,{key:B},[t.type==="iSelect"?(i(),P(v,{key:0,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(g,{value:e[t.name],"onUpdate:value":x=>e[t.name]=x,options:w(t.name),"show-search":"","filter-option":L,onChange:H},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):R("",!0),t.type==="iText"?(i(),P(v,{key:1,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(C,{value:e[t.name],"onUpdate:value":x=>e[t.name]=x,maxlength:t.max,disabled:t.disabled,placeholder:t.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):R("",!0),t.type==="iDate"?(i(),P(v,{key:2,name:t.name,label:t.label},{default:o(()=>[n(j,{modelValue:e[t.name],"onUpdate:modelValue":x=>e[t.name]=x,modelModifiers:{range:!0},mode:"date",attributes:q.value,"disabled-dates":z.value},null,8,["modelValue","onUpdate:modelValue","attributes","disabled-dates"]),c("div",be,[c("div",null,[l[1]||(l[1]=c("label",{style:{display:"block"},for:""},"HORARIO",-1)),n(A,{minuteStep:30,value:e.hours,"onUpdate:value":l[0]||(l[0]=x=>e.hours=x),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):R("",!0),t.type==="iSwitch"?(i(),m("div",he)):R("",!0),t.type==="iTextArea"?(i(),P(v,{key:4,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n($(ae),{class:"quill-editor",content:e[t.name],"onUpdate:content":x=>e[t.name]=x,options:U,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):R("",!0)],64))),128))]),n(v,null,{default:o(()=>[n(d,{type:"primary","html-type":"submit",loading:S.value,style:{"margin-top":"1rem"}},{default:o(()=>[O(D(p.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const xe={class:"grid-event-resultado"},Ee={__name:"DrawResultados",props:["dataRow"],emits:["closeDraw"],setup(F,{emit:I}){const y=te();y.$patch({officesPnte:y.officesPnte}),y.fetchOfficesPnte();const k=I,p=F,S=f(!1),U={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=f({resultados:{type:"iTextArea",label:"DESCRIBIR RESULTADOS",name:"resultados",required:!1,message:"Escribe los resultados de los evento",max:500}}),_=G({resultado:null}),e=async()=>{const w={resultado:_.resultado};S.value=!0;try{const u=await J({url:`event/update/${p.dataRow.id}`,method:"PUT",data:w});u.status===200&&(V.success(u.message),k("closeDraw"))}catch(u){console.error("Failed to update record",u)}finally{S.value=!1}},z=w=>{console.log("Setting info",w),_.resultado=w.resultado};return Q(()=>{p.dataRow&&z(p.dataRow)}),W(()=>p.dataRow,w=>{w&&z(w)}),(w,u)=>{const H=r("a-form-item"),L=r("a-button"),Y=r("a-form");return i(),m("div",null,[n(Y,{class:"form-events",layout:"vertical",model:_,name:"basic",autocomplete:"off",onFinish:e},{default:o(()=>[c("div",xe,[(i(!0),m(M,null,ee(q.value,(T,N)=>(i(),m(M,{key:N},[T.type==="iTextArea"?(i(),P(H,{key:0,name:T.name,label:T.label,rules:[{required:T.required,message:T.message}]},{default:o(()=>[n($(ae),{class:"quill-editor",content:_.resultado,"onUpdate:content":u[0]||(u[0]=s=>_.resultado=s),options:U,contentType:"html"},null,8,["content"])]),_:2},1032,["name","label","rules"])):R("",!0)],64))),128))]),n(H,null,{default:o(()=>[n(L,{type:"primary","html-type":"submit",loading:S.value,style:{"margin-top":"1rem"}},{default:o(()=>u[1]||(u[1]=[O("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Re={key:0},Se={key:1},ke={key:2,class:"office-pnte"},De={key:0},Ie={key:1},Te=["innerHTML"],Ce=["onClick"],Oe=["onClick"],Ue={class:"paginator"},Pe={__name:"EventosCalendario",setup(F){E.locale("es"),JSON.parse(localStorage.getItem("role"));const I=f(!1),y=f(!1),k=f(null),p=f(0),S=f(50),U=f({page:0}),q=f(1200),_=f([]),e=f(!1),z=f(window.innerHeight-100),w=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"ÁREA",fixed:"left",dataIndex:"office",width:140,align:"center"},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"results",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],u=G({search:""}),H=()=>{A(),I.value=!1},L=d=>{k.value=d,y.value=!0},Y=d=>{k.value=d,I.value=!0},T=()=>{k.value=null,console.log("Nueva Feria"),I.value=!0},N=()=>{let d={search:u.search};A(d)},s=()=>{u.search||A()},l=d=>E(d).format("DD/MM/YYYY"),g=d=>E(d,"HH:mm:ss").format("HH:mm"),v=d=>{U.value.page=d,A()},C=()=>{z.value=window.innerHeight-330},j=pe(()=>d=>U.value.page*S.value+d+1),A=async d=>{try{e.value=!0;let a;a=U.value.page==0?"":U.value,a=d?{...a,...d}:a;const{data:t}=await J({url:"event/list",method:"GET",params:a});_.value=t==null?void 0:t.data,p.value=t.total,S.value=t.per_page}catch(a){console.error("Error de red:",a)}finally{e.value=!1}};return _e(()=>{window.removeEventListener("resize",C)}),Q(()=>{window.addEventListener("resize",C),C(),A()}),(d,a)=>{const t=r("a-button"),B=r("router-link"),x=r("a-col"),ne=r("a-input"),se=r("a-input-group"),oe=r("a-row"),K=r("a-menu-item"),le=r("a-menu"),re=r("a-dropdown"),ie=r("a-table"),de=r("a-tag"),ue=r("a-pagination"),X=r("a-drawer");return i(),m(M,null,[c("div",null,[a[10]||(a[10]=c("h3",{class:"title-produce"},"EVENTOS PNTE 2025",-1)),n(oe,{style:{margin:"1rem 0"}},{default:o(()=>[n(x,{xs:24,md:12,lg:18},{default:o(()=>[n(t,{type:"primary",onClick:T,class:"box-btn-add"},{default:o(()=>a[5]||(a[5]=[O(" NUEVO EVENTO ")])),_:1}),n(B,{to:"/eventos",target:"_blank",style:{"margin-left":"1rem"}},{default:o(()=>[n(t,{type:"dashed",icon:Z($(fe))},{default:o(()=>a[6]||(a[6]=[O("Ver Calendario")])),_:1},8,["icon"])]),_:1})]),_:1}),n(x,{xs:24,md:12,lg:6},{default:o(()=>[n(se,{compact:""},{default:o(()=>[n(ne,{value:u.search,"onUpdate:value":a[0]||(a[0]=b=>u.search=b),style:{width:"calc(100% - 80px)"},onInput:s},null,8,["value"]),n(t,{type:"primary",disabled:u.search==="",onClick:N},{default:o(()=>a[7]||(a[7]=[O("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(ie,{bordered:"",scroll:{x:q.value,y:z.value},class:"table-events-google",columns:w,"data-source":_.value,pagination:!1,loading:e.value,size:"small"},{bodyCell:o(({column:b,record:h,index:ce})=>[b.dataIndex=="idx"?(i(),m(M,{key:0},[O(D(j.value(ce)),1)],64)):R("",!0),b.dataIndex=="date"?(i(),m(M,{key:1},[h.dateStart!=h.dateEnd?(i(),m("span",Re,[a[8]||(a[8]=c("b",null,"Desde:",-1)),O(" "+D(l(h.dateStart))+" ",1),a[9]||(a[9]=c("b",null,"Hasta:",-1)),O(" "+D(l(h.dateEnd)),1)])):(i(),m("span",Se,D(l(h.dateStart)),1))],64)):R("",!0),b.dataIndex=="office"?(i(),m("div",ke,[c("p",null,D(h.office_pnte.name),1),c("h5",null,D(h.office_pnte.office),1)])):R("",!0),b.dataIndex=="hours"?(i(),m(M,{key:3},[h.start?(i(),m("span",Ie,D(g(h.start))+" - "+D(g(h.end)),1)):(i(),m("span",De,"Todo el día"))],64)):R("",!0),b.dataIndex=="results"?(i(),m("div",{key:4,class:"html-format",innerHTML:h.resultado},null,8,Te)):R("",!0),b.dataIndex=="actions"?(i(),P(re,{key:5,trigger:["click"]},{overlay:o(()=>[n(le,null,{default:o(()=>[n(K,null,{default:o(()=>[c("a",{onClick:me=>L(h)},"Resultados",8,Ce)]),_:2},1024),n(K,null,{default:o(()=>[c("a",{onClick:me=>Y(h)},"Editar",8,Oe)]),_:2},1024)]),_:2},1024)]),default:o(()=>[c("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=ve(()=>{},["prevent"]))},[n(t,{shape:"circle",icon:Z($(ge)),size:"small"},null,8,["icon"])])]),_:2},1024)):R("",!0)]),_:1},8,["scroll","data-source","loading"])]),c("div",Ue,[c("span",null,[n(de,{color:"blue"},{default:o(()=>[c("b",null,D(p.value),1)]),_:1}),a[11]||(a[11]=O("Eventos creados"))]),n(ue,{size:"small",total:p.value,pageSize:S.value,onChange:v,showSizeChanger:!1},null,8,["total","pageSize"])]),n(X,{open:I.value,"onUpdate:open":a[2]||(a[2]=b=>I.value=b),title:k.value?"EDITAR EVENTO":"NUEVO EVENTO",placement:"right",width:"450"},{default:o(()=>[n(we,{onCloseDraw:H,dataRow:k.value},null,8,["dataRow"])]),_:1},8,["open","title"]),n(X,{open:y.value,"onUpdate:open":a[4]||(a[4]=b=>y.value=b),title:"RESULTADOS",placement:"right",width:"550"},{default:o(()=>[n(Ee,{dataRow:k.value,onCloseDraw:a[3]||(a[3]=b=>{y.value=!1,A()})},null,8,["dataRow"])]),_:1},8,["open"])],64)}}};export{Pe as default};
