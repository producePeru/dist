import{_ as X}from"./TableComponent-9e35c3c9.js";import{p,r as o,a as $,k as B,U as J,X as T,o as m,y as w,i as V,L as K,d as C,c as u,m as P,h as q,b,w as s,e as S,t as N,z as x,F as L,x as Q,j as y}from"./index-d32b4ca9.js";import{_ as W}from"./FormComponent-8e386b1a.js";import{u as Z}from"./selectes-2e8a433c.js";import"./es-c1ba93d8.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-b5963e98.js";import"./quill.snow-5c3683df.js";const ee={key:1,class:"register-training"},ae={__name:"RegistroCapacitaciones",props:["info"],emits:["closeDraw"],setup(U,{emit:h}){p.locale("es");const D=h,f=U,E=o(!0),I=o("REGISTRAR"),a=$({}),_=o(!1),t=Z(),R=o(null),d=o({meta_id:[],especialista_id:[],dimension_id:[],modalidad:[{label:"PRESECIAL",value:1},{label:"VIRTUAL",value:2},{label:"MIXTO",value:3}]}),k=e=>{console.log("handleInputEvent",e)},A=async e=>{e=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),i.value.dateTramite.disabled=!1)},H=async(e,n)=>{if(e==="meta_id"){i.value.fecha.allowedMonth=null,a.fecha=null;let l=d.value.meta_id.find(g=>g.value==n);console.log("meta",l),i.value.fecha.allowedMonth=l.label}},O=async e=>{e=="meta_id"&&(d.value.meta_id=t.trainingMetas),e=="especialista_id"&&(d.value.especialista_id=t.trainingSpecialist),e=="dimension_id"&&(d.value.dimension_id=t.trainingDimensions)},F=async()=>{_.value=!0;const e={meta_id:a.meta_id,especialista_id:a.especialista_id,fecha:p(a.fecha).format("YYYY-MM-DD"),horaInicio:p(a.horaInicio).format("HH:mm"),horaFin:p(a.horaFin).format("HH:mm"),dimension_id:a.dimension_id,modalidad:a.modalidad,tema:a.tema,lugar:a.lugar,participantes:a.participantes,empresas:a.empresas,coordinador:a.coordinador,observaciones:a.observaciones,estado:1};try{let n,l=null;f.info?(n=`training/update-training/${f.info.id}`,l="PUT"):(n="training/register-training",l="POST");const g=await P({url:n,method:l,data:e});g.status===200&&(q.success(g.message),M(),D("closeDraw",!0))}catch(n){n.response&&n.response.data&&n.response.data.message?q.error(n.response.data.message):q.error("Ocurrió un error inesperado.");const l=document.getElementsByClassName("ant-drawer-body")[0];l&&(l.scrollTop=0)}finally{_.value=!1}},M=()=>{a.meta_id=null,a.especialista_id=null,a.fecha=null,a.horaInicio=null,a.horaFin=null,a.dimension_id=null,a.modalidad=null,a.tema=null,a.lugar=null,a.participantes=null,a.empresas=null,a.coordinador=null,a.observaciones=null},v=async e=>{e&&(a.meta_id=e.meta_id,a.especialista_id=e.especialista_id,a.dimension_id=e.dimension_id,a.modalidad=e.modalidad,a.tema=e.tema,a.lugar=e.lugar,a.participantes=e.participantes,a.empresas=e.empresas,a.coordinador=e.coordinador,a.observaciones=e.observaciones,a.fecha=p(e.fecha,"YYYY-MM-DD"),a.horaInicio=p(e.horaInicio,"HH:mm"),a.horaFin=p(e.horaFin,"HH:mm"))},i=o({meta_id:{type:"iSelect",label:"META",name:"meta_id",required:!0,message:"Seleccionar meta",disabled:!1},especialista_id:{type:"iSelect",label:"ESPECIALISTA",name:"especialista_id",required:!0,message:"Seleccionar especialista",disabled:!1},fecha:{type:"iDateRangeDisabled",label:"FECHA",name:"fecha",required:!0,message:"Seleccionar fecha",disabled:!1,allowedMonth:null},horaInicio:{type:"iHourOne",label:"HORA INICIO",name:"horaInicio",required:!0,message:"Seleccionar hora inicio",disabled:!1},horaFin:{type:"iHourOne",label:"HORA FIN",name:"horaFin",required:!0,message:"Seleccionar hora fin",disabled:!1},dimension_id:{type:"iSelect",label:"DIMENSIÓN",name:"dimension_id",required:!0,message:"Seleccionar dimensión",disabled:!1},modalidad:{type:"iSelect",label:"MODALIDAD",name:"modalidad",required:!0,message:"Seleccionar modalidad",disabled:!1},tema:{type:"iText",label:"TEMA",name:"tema",required:!0,message:"Escribir tema",disabled:!1},lugar:{type:"iText",label:"LUGAR",name:"lugar",required:!0,message:"Escribir tema",disabled:!1},participantes:{type:"iNumber",label:"PARTICIPANTES",name:"participantes",required:!0,message:"Escribir participantes",disabled:!1,maxlength:5},empresas:{type:"iNumber",label:"EMPRESAS",name:"empresas",required:!0,message:"Escribir empresas",disabled:!1,maxlength:5},coordinador:{type:"iText",label:"NOMBRE DEL COORDINADOR",name:"coordinador",required:!0,message:"Mencionar al coordinador",disabled:!1},observaciones:{type:"iTextArea",label:"OBSERVACIONES",name:"observaciones",required:!1,message:"Escribir observaciones",disabled:!1}});return B(async()=>{f.info&&v(f.info),await t.fetchTrainingMetas(),await t.fetchTrainingSpecialist(),await t.fetchTrainingDimensions(),d.value.meta_id=t.trainingMetas,d.value.especialista_id=t.trainingSpecialist,d.value.dimension_id=t.trainingDimensions,E.value=!1}),J(()=>f.info,e=>{e?v(e):M()}),T("formState",a),T("loadingState",_),(e,n)=>E.value?(m(),w(V(K),{key:0,style:{color:"#00a6db"}})):(m(),C("div",ee,[u(W,{fields:i.value,options:d.value,btnSaveName:I.value,onHandleInputEvent:k,resetSelect:R.value,onHandleChangeSelect:H,onHandleFocusSelect:O,onHandleChangeClock:A,onOnSubmit:F,mayus:!0},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const te={class:"layout-content"},ie={key:0,style:{display:"flex","flex-direction":"column"}},ne=["onClick"],pe={__name:"capacitaciones-index",setup(U){const h=o(!1),D=o([]),f=o(0),E=o(100),I=o(!1),a=o(!1),_=o(null),t=$({asesor:null,month:p(),page:1}),R=[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:70},{title:"Fecha/Hora",fixed:"left",dataIndex:"horario",align:"center",width:120},{title:"Especialista",dataIndex:"especialista",width:160},{title:"Tema",dataIndex:"tema",width:170},{title:"Modalidad",dataIndex:"modalidadText",width:120,align:"center"},{title:"Participantes",dataIndex:"participantes",align:"center",width:140},{title:"Estado",dataIndex:"estado",align:"center",width:140},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],d=()=>{_.value=null,h.value=!0},k=async()=>{_.value=null,h.value=!1,await v()},A=async()=>{a.value=!0},H=async i=>{t.page=i,await v()},O=async i=>{i&&(t.page=1,await v())},F=i=>{_.value=i,h.value=!0},M=async(i,e)=>{try{const n={estado:e},l=await P({url:`training/update-training-status/${i}`,method:"PUT",data:n});console.log("response",l)}catch(n){console.error("Error de red:",n)}},v=async()=>{I.value=!0;try{const i={page:t.page};t.year&&(i.year=p(t.year).format("YYYY")),t.asesor&&(i.asesor=t.asesor),t.name&&(i.name=t.name);const e=await P({url:"training/list-trainings",method:"GET"});e.status==200&&(D.value=e.data.data,f.value=e.data.total,E.value=e.data.per_page)}catch(i){console.error("Error de red:",i)}finally{I.value=!1}};return B(async()=>{await v()}),T("search",t),T("loading",I),T("loadingFile",a),(i,e)=>{const n=b("a-date-picker"),l=b("a-tag"),g=b("a-select-option"),z=b("a-select"),G=b("a-menu-item"),j=b("a-drawer");return m(),C("div",te,[u(X,{title:"CAPACITACIONES UGSE",new:!0,textNuevo:"NUEVO",columns:R,titleSearch:"NÚMERO DE DOCUMENTO",pageSize:E.value,nameTotal:"Capacitaciones",dataSource:D.value,total:f.value,onHandleNew:d,onHandleDownloadExcel:A,onHandleSearch:O,onHandlePaginator:H},{header:s(()=>[S("div",null,[u(n,{value:t.month,"onUpdate:value":e[0]||(e[0]=c=>t.month=c),picker:"month"},null,8,["value"])])]),"data-cell":s(({column:c,record:r})=>[c.dataIndex=="horario"?(m(),C("div",ie,[S("b",null,N(V(p)(r.fecha).format("DD/MM/YYYY")),1),S("span",null,N(r.horaInicio)+" - "+N(r.horaFin),1)])):x("",!0),c.dataIndex=="especialista"?(m(),C(L,{key:1},[S("span",{class:"dot-specialist",style:Q(`background-color: ${r.colorEspecialista};`)},null,4),S("span",null,N(r.especialista),1)],64)):x("",!0),c.dataIndex=="modalidadText"?(m(),C(L,{key:2},[r.modalidad==1?(m(),w(l,{key:0,color:"blue"},{default:s(()=>e[2]||(e[2]=[y(" Presencial ")])),_:1})):r.modalidad==2?(m(),w(l,{key:1,color:"green"},{default:s(()=>e[3]||(e[3]=[y(" Virtual ")])),_:1})):r.modalidad==3?(m(),w(l,{key:2,color:"orange"},{default:s(()=>e[4]||(e[4]=[y(" Mixto ")])),_:1})):x("",!0)],64)):x("",!0),c.dataIndex=="estado"?(m(),w(z,{key:3,value:r.estado,"onUpdate:value":Y=>r.estado=Y,style:{width:"150px"},placeholder:"Seleccione estado",onChange:Y=>M(r.id,Y)},{default:s(()=>[u(g,{value:1},{default:s(()=>e[5]||(e[5]=[y("📅 Programada")])),_:1}),u(g,{value:2},{default:s(()=>e[6]||(e[6]=[y("⏳ En curso")])),_:1}),u(g,{value:3},{default:s(()=>e[7]||(e[7]=[y("✅ Completado")])),_:1}),u(g,{value:4},{default:s(()=>e[8]||(e[8]=[y("❌ Cancelado")])),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])):x("",!0)]),"custom-options":s(({record:c})=>[u(G,null,{default:s(()=>[S("a",{onClick:r=>F(c)},"Editar",8,ne)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),u(j,{width:"500",title:"Registro de Capacitaciones",open:h.value,"onUpdate:open":e[1]||(e[1]=c=>h.value=c),placement:"right"},{default:s(()=>[u(ae,{info:_.value,onCloseDraw:k},null,8,["info"])]),_:1},8,["open"])])}}};export{pe as default};
