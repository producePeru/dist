import{_ as ee}from"./TableComponent-b5cbeca6.js";import{p as m,r as o,a as j,k as Z,T as ae,W as q,b as M,o as d,y as W,i as O,L as te,d as p,c as r,w as k,e as n,F as Q,v as K,j as L,$ as ne,z as I,h as V,m as X,u as se,t as S,n as oe}from"./index-8b7de5e5.js";import{_ as le}from"./FormComponent-664846ca.js";import{u as ie}from"./selectes-a44a465a.js";import{U as re}from"./UpImage-e83b87a0.js";import"./es-ba278c5d.js";import{u as de,t as ce}from"./timezone-e417d3ea.js";import"./downloadExcel-2c3741b1.js";import{G as ue}from"./GlobalOutlined-a43cbd0e.js";import{U as me}from"./UserOutlined-ab5b6ab7.js";import{M as pe}from"./MailOutlined-259f3b8a.js";import{P as fe}from"./PhoneOutlined-27321346.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-9f56b45d.js";import"./MoreOutlined-12d7cc76.js";import"./quill.snow-8f5c0c2a.js";import"./_plugin-vue_export-helper-c27b6911.js";const _e={key:1,class:"mp-asesoria"},he={key:0},ge={class:"as-personalizada"},ve={__name:"DrawMPAsesorias",props:["info"],emits:["closeDraw"],setup(J,{emit:P}){m.locale("es"),m.extend(de),m.extend(ce);const H=o({title:{type:"iText",label:"NOMBRE DEL EVENTO",name:"title",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},description:{type:"iTextArea",label:"DESCRIPCIÓN DEL EVENTO",name:"description",required:!0,message:"Escribir nombre del evento",disabled:!1,rows:6,max:250},requirements:{type:"iQuillEditor",label:"MENSAJE DE LOS REQUISITOS",name:"requirements",required:!0,message:"Escribir los requisitos",disabled:!1,class:"quill-height-200"},capacitador_id:{type:"iSelect",label:"ASESOR DE LA ASESORÍA",name:"capacitador_id",required:!0,message:"Seleccionar capacitador",disabled:!1},imgBanner:{type:"iSlot",name:"iSlotOptions"}}),C=ie(),y=P,l=J,_=o(!0),z=o("GUARDAR"),t=j({}),N=o(!1),R=o(null),B=o(null),U=o({city_id:[],fairtype_id:[],modality_id:[],capacitador_id:[]}),u=j({schedules:[{date:null,startTime:null}]}),$=()=>{u.schedules.push({date:""})},F=e=>{u.schedules.splice(e,1)},Y=()=>l.info?{name:l.info.image_name,url:l.info.image_url}:null,E=e=>{e=="modality_id"&&console.log("a9a9a9a99a9a9")},s=async e=>{e=="dateReception"&&(t.dateTramite&&(t.dateTramite=null),H.value.dateTramite.disabled=!1)},f=async e=>{R.value=e.id},A=async e=>{e=="city_id"&&(t.city_id=null),e=="capacitador_id"&&(U.value.capacitadores=C.capacitadores)},G=async(e,a)=>{},h=async()=>{var a,T;const e=R.value??((T=(a=l.info)==null?void 0:a.image)==null?void 0:T.id);if(!u.schedules.length){V.error("Debe agregar al menos una fecha y horario.");return}for(const c of u.schedules)if(!c.date||!c.startTime||c.startTime.length!==2){V.error("Todas las fechas deben tener rango de horario válido.");return}N.value=!0;try{const c={title:t.title,description:t.description,requirements:t.requirements,capacitador_id:t.capacitador_id,image_id:e,link:t.link,schedules:u.schedules.map(b=>({date:m(b.date).format("YYYY-MM-DD"),startTime:m(b.startTime[0]).format("HH:mm"),endTime:m(b.startTime[1]).format("HH:mm")}))},g=l.info?`mp/update-personalized-advice/${l.info.id}`:"mp/create-personalized-advice",D=l.info?"PUT":"POST",x=await X({url:g,method:D,data:c});x.status===200&&(V.success(x.message),v(),y("closeDraw",!0))}catch(c){console.error("Error:",c);const g=document.getElementsByClassName("ant-drawer-body")[0];g&&(g.scrollTop=0)}finally{N.value=!1}},v=()=>{for(const e in t)delete t[e];u.schedules=[{date:null,startTime:null}],R.value=null},i=async e=>{_.value=!0;try{e&&(t.title=e.title,t.description=e.description,t.requirements=e.requirements,t.capacitador_id=e.capacitador_id,u.schedules=[],e.schedules&&e.schedules.length>0&&(u.schedules=e.schedules.map(a=>({date:m(a.date),startTime:[m(a.startTime,"HH:mm"),m(a.endTime,"HH:mm")]}))))}catch(a){console.error("Error al cargar la información:",a)}finally{_.value=!1}};return Z(async()=>{l.info?i(l.info):_.value=!1,await C.fetchCapacitadores(),U.value.capacitador_id=C.capacitadores}),ae(()=>l.info,e=>{e?i(e):v()}),q("formState",t),q("loadingState",N),(e,a)=>{const T=M("a-date-picker"),c=M("a-time-range-picker"),g=M("a-button");return _.value?(d(),W(O(te),{key:0,style:{color:"#00a6db"}})):(d(),p("div",_e,[r(le,{fields:H.value,options:U.value,btnSaveName:z.value,onHandleInputEvent:E,resetSelect:B.value,onHandleFocusSelect:A,onHandleChangeSelect:G,onHandleChangeClock:s,onOnSubmit:h},{default:k(({field:D})=>[D.name=="iSlotOptions"?(d(),p("div",he,[n("div",null,[(d(!0),p(Q,null,K(u.schedules,(x,b)=>(d(),p("div",{class:"as-dates",key:b},[n("label",null,[a[0]||(a[0]=L(" FECHA DE LA ASESORÍA ")),r(T,{value:x.date,"onUpdate:value":w=>x.date=w,style:{width:"100%","margin-bottom":"8px"},format:"DD/MM/YYYY",placeholder:"Seleccionar fecha","disabled-date":w=>w&&w<O(m)().startOf("day")},null,8,["value","onUpdate:value","disabled-date"])]),n("label",null,[a[1]||(a[1]=L(" HORARIO DE LA ASESORÍA ")),r(c,{value:x.startTime,"onUpdate:value":w=>x.startTime=w,style:{width:"100%","margin-bottom":"8px"},format:"HH:mm"},null,8,["value","onUpdate:value"])]),b!=0?(d(),W(O(ne),{key:0,class:"as-date-delete",onClick:w=>F(b)},null,8,["onClick"])):I("",!0)]))),128)),r(g,{type:"dashed",block:"",onClick:$,style:{"margin-bottom":"2rem"}},{default:k(()=>a[2]||(a[2]=[L(" + Agregar fecha y horario ")])),_:1})]),n("div",ge,[a[3]||(a[3]=n("label",null,"CARGAR IMAGEN",-1)),r(re,{"accept-formats":["image/jpeg","image/png"],maxImages:1,nameType:"mp",onUploadSuccess:f,imageLoad:Y()},null,8,["imageLoad"])])])):I("",!0)]),_:1},8,["fields","options","btnSaveName","resetSelect"])]))}}};const Se={class:"layout-content"},ye=["href"],Ee={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={key:0},Te={style:{"font-weight":"500"}},xe={style:{"font-size":"13px"}},be={style:{"font-size":"13px"}},we=["innerHTML"],ke=["onClick"],Ge={__name:"mp-asesorias",setup(J){JSON.parse(localStorage.getItem("role"));const P=o([]),H=o(0),C=o(150),y=o(!1);o(!1),se();const l=o(!1),_=o(null),z=o(!1),t=j({page:1}),N=[{title:"#",dataIndex:"idx",align:"center",width:50,fixed:"left"},{title:"TEMA",dataIndex:"title",width:140},{title:"DESCRIPCIÓN",dataIndex:"description",width:200},{title:"HORARIO",dataIndex:"hours",width:220},{title:"REQUISITOS",dataIndex:"requirements",width:160},{title:"CAPACITADOR",dataIndex:"capacitador_name",width:160},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],R=s=>s?m(s,["HH:mm:ss","HH:mm"]).format("hh:mm A"):null,B=s=>{_.value=s,y.value=!0},U=()=>{E(),y.value=!1},u=()=>{_.value=null,y.value=!0},$=async()=>{},F=async s=>{t.page=s,await E()},Y=async s=>{s&&(t.page=1,await E())},E=async()=>{try{l.value=!0;const s={page:t.page},f=await X({url:"mp/mp-index-advice",method:"GET",params:s}),{data:A}=f;P.value=A.data,H.value=A.total,C.value=A.per_page}catch(s){console.error("Error de red:",s)}finally{l.value=!1}};return Z(async()=>{await E()}),q("search",t),q("loading",l),q("loadingFile",z),(s,f)=>{const A=M("a-menu-item"),G=M("a-drawer");return d(),p("div",Se,[r(ee,{title:"ASESORÍAS PERSONALIZADAS",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",columns:N,titleSearch:"BUSCAR POR EVENTO",pageSize:C.value,nameTotal:"Capacitaciones",dataSource:P.value,total:H.value,btnUpdate:!0,onHandleNew:u,onHandleCallFetchData:E,onHandleDownloadExcel:$,onHandleSearch:Y,onHandlePaginator:F},{header:k(()=>f[1]||(f[1]=[])),"data-cell":k(({column:h,record:v})=>[h.dataIndex=="link"?(d(),p(Q,{key:0},[v.link?(d(),p("a",{key:0,target:"'_blank'",href:v.link,style:{color:"#7d4fc6","font-size":"16px","margin-top":"-2px"}},[r(O(ue))],8,ye)):I("",!0)],64)):I("",!0),h.dataIndex=="hours"?(d(!0),p(Q,{key:1},K(v.schedules,(i,e)=>{var a,T,c,g,D;return d(),p("div",{class:"hour-participant",key:e},[n("div",{class:oe(i.participant?"hour-participant-detail":"hour-participant-no-detail")},[n("span",null,S(i.date_format),1),f[2]||(f[2]=L(" | ")),n("span",null,S(R(i.startTime))+" - "+S(R(i.endTime)),1),n("div",Ee,[i.participant?(d(),p("div",Ae,[n("div",null,[n("span",Te,[r(O(me)),L(" "+S((a=i.participant)==null?void 0:a.names)+" "+S((T=i.participant)==null?void 0:T.last_name)+" "+S((c=i.participant)==null?void 0:c.middle_name),1)])]),n("div",null,[r(O(pe),{style:{"padding-right":"5px"}}),n("span",xe,S((g=i.participant)==null?void 0:g.email),1)]),n("div",null,[r(O(fe),{style:{"padding-right":"5px"}}),n("span",be,S((D=i.participant)==null?void 0:D.phone),1)])])):I("",!0)])],2)])}),128)):I("",!0),h.dataIndex=="requirements"?(d(),p("div",{key:2,innerHTML:v.requirements},null,8,we)):I("",!0)]),"custom-options":k(({record:h})=>[r(A,null,{default:k(()=>[n("a",{onClick:v=>B(h)},"Editar",8,ke)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),r(G,{open:y.value,"onUpdate:open":f[0]||(f[0]=h=>y.value=h),title:_.value?"EDITAR ASESORÍA":"REGISTRAR UNA ASESORÍA",placement:"right",width:"550"},{default:k(()=>[r(ve,{onCloseDraw:U,info:_.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{Ge as default};
