import{g as B,C as I,r as n,I as K,n as P,b as c,o as v,d as U,e as m,K as Q,L as W,c as h,i as L,B as N,s as C,w as x,F as X,h as k,t as Z,M as ee,j as ae,J as te,y as oe}from"./index-ed35c821.js";const ne=m("h3",null,"ARCHIVOS",-1),re={class:"w-search"},le={key:0},se={class:"paginator"},ue={__name:"DriveVerMisArchivos",setup(ie){const S=B.get("usuario"),F=JSON.parse(localStorage.getItem("user")).rol,d=I.AES.decrypt(F,"rol").toString(I.enc.Utf8),M="https://apituempresa.soporte-pnte.com/api/v1",$="http://127.0.0.1:8000/api/v1",T=window.location.hostname=="127.0.0.1"?$:M,V=B.get("token"),i=n({}),u=n([]),l=n(!1),H=n(0),g=n(0),z=n([]),D=n(""),f=n(!1),O=async a=>{try{if(a===0)return p();l.value=!0;const e=`/drive/author/${a}`,t=await k({url:e,method:"GET",params:w.value});u.value=t}catch(e){console.error("Error de red:",e)}finally{l.value=!1}},R=async a=>{try{if(f.value=!0,!a)return g.value=0,p();const e=`/drive/search-file/${a}/${S}`,{data:t}=await k({url:e,method:"GET"});u.value=t.data}catch(e){console.error("Error de red:",e)}finally{f.value=!1}},Y=async a=>{i.value={...i.value,[a]:!0};try{const e=await te.get(`${T}/drive/download/${a}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${V}`}}),t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download",a),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Error al descargar el archivo",e)}finally{i.value={...i.value,[a]:!1}}},j=(a,e)=>{const t=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)},G=a=>oe(a).format("DD/MM/YYYY HH:mm A"),E=n(window.innerHeight-100),_=()=>{E.value=window.innerHeight-300};K(()=>{window.removeEventListener("resize",_)});const w=n({page:1}),J=[{title:"Autor",dataIndex:"user",fixed:"left",width:180},{title:"Nombre archivo",dataIndex:"filename",width:140},{title:"Fecha de carga",dataIndex:"date",width:120,align:"center"},{title:"",dataIndex:"actions",width:120,align:"center"}],q=a=>{w.value.page=a,p()},p=async()=>{let a=null;console.log("rol",d),d=="administrador"||d=="super"?a="/drive/files/admin":a=`/drive/files/${S}`;try{l.value=!0;const{data:e}=await k({url:a,method:"GET",params:w.value});u.value=e;const t=new Map(e.map(s=>[s.idUser,s.user])),o=Array.from(t.entries()).map(([s,r])=>({value:s,label:r})),y={value:[{value:0,label:"Todos"},...o]};z.value=y.value}catch(e){console.error("Error de red:",e)}finally{l.value=!1}};return P(()=>{p(),window.addEventListener("resize",_),_()}),(a,e)=>{const t=c("a-input-search"),o=c("a-select"),A=c("a-button"),y=c("a-table"),s=c("a-pagination");return v(),U(X,null,[m("div",null,[ne,Q(m("div",re,[h(t,{value:D.value,"onUpdate:value":e[0]||(e[0]=r=>D.value=r),placeholder:"Buscar por nombre del archivo",style:{width:"250px"},loading:f.value,onSearch:R},null,8,["value","loading"]),L(d)!="usuario"?(v(),N(o,{key:0,value:g.value,"onUpdate:value":e[1]||(e[1]=r=>g.value=r),"show-search":"",placeholder:"Buscar",style:{width:"220px"},options:z.value,"filter-option":j,onChange:O},null,8,["value","options"])):C("",!0)],512),[[W,!l.value]]),h(y,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:E.value},columns:J,"data-source":u.value,pagination:!1,loading:l.value,size:"small"},{bodyCell:x(({column:r,record:b})=>[r.dataIndex=="date"?(v(),U("div",le,Z(G(b.created_at)),1)):C("",!0),r.dataIndex=="actions"?(v(),N(A,{key:1,size:"small",onClick:ce=>Y(b.path),type:"primary",ghost:"",loading:i.value[b.path]},{icon:x(()=>[h(L(ee))]),default:x(()=>[ae(" Descargar ")]),_:2},1032,["onClick","loading"])):C("",!0)]),_:1},8,["scroll","data-source","loading"])]),m("div",se,[h(s,{size:"small",pageSize:50,total:H.value,onChange:q,showSizeChanger:!1},null,8,["total"])])],64)}}};export{ue as default};
