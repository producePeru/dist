import{_ as Z}from"./TableComponent-195dad6b.js";import{l as S,r as i,a as q,j as z,U as K,a6 as b,o as d,d as T,c,N as O,m as B,u as W,b as D,w as o,F as G,x as g,i as N,y as m,e as R,h as X,a1 as ee}from"./index-cb6764a1.js";import{_ as te}from"./FormComponent-6abcd37c.js";import{u as ae}from"./selectes-b5f0d88a.js";import"./es-e3519bfa.js";import{d as ne}from"./downloadExcel-b9cd1e32.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-b537f00b.js";import"./quill.snow-acfc7959.js";const le={class:"f-20"},oe={__name:"DrawerPP03",props:["info","idCde"],emits:["closeDraw"],setup(U,{emit:k}){S.locale("es");const f=i({nameEvent:{type:"iText",label:"NOMBRE DEL EVENTO",name:"nameEvent",required:!0,message:"Escribir nombre del evento",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:""},modality_id:{type:"iSelect",label:"MODALIDAD",name:"modality_id",required:!0,message:"Seleccionar la modalidad",disabled:!1},dates:{type:"iDatePicker",label:"FECHA DEL EVENTO",name:"dates",required:!0,message:"Seleccionar fecha",disabled:!1},hours:{type:"iText",label:"HORARIO",name:"hours",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"08"},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!0,message:"Escribir el detalle",disabled:!1,rows:5}});JSON.parse(localStorage.getItem("profile"));const C=k,E=U,p=i("GUARDAR"),a=q({}),_=i(!1),r=ae(),I=i(null),t=i({city_id:[],province_id:[],district_id:[],modality_id:[]}),A=l=>{console.log("handleInputEvent",l)},P=async l=>{l=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),f.value.dateTramite.disabled=!1)},M=async l=>{l=="city_id"&&(await r.fetchProvinces(a.city_id),t.value.province_id=r.provinces,f.value.province_id.disabled=!1),l=="province_id"&&(await r.fetchDistricts(a.province_id),t.value.district_id=r.districts,f.value.district_id.disabled=!1)},F=async l=>{console.log("handleFocusSelect",l),l=="city_id"&&(await r.fetchCities(),a.city_id=null,a.province_id=null,a.district_id=null,t.value.province_id=[],t.value.city_id=r.cities),l=="province_id"&&(a.province_id=null,a.district_id=null,t.value.district_id=[]),l=="modality_id"&&(await r.fetchModalities(),t.value.modality_id=r.modalities)},L=l=>{},V=async()=>{_.value=!0;const l={nameEvent:a.nameEvent,city_id:a.city_id,place:a.place,modality_id:a.modality_id,dateStart:S(a.dates[0]).format("YYYY-MM-DD"),dateEnd:S(a.dates[1]).format("YYYY-MM-DD"),hours:a.hours,description:a.description};try{const y=await O({url:"pp03/store",method:"POST",data:l});y.status===200&&(B.success(y.message),H(),C("closeDraw",!0))}catch(y){console.error("Error:",y);const x=document.getElementsByClassName("ant-drawer-body")[0];x&&(x.scrollTop=0)}finally{_.value=!1}},H=()=>{a.nameEvent=null,a.city_id=null,a.place=null,a.modality_id=null,a.dates=null,a.hours=null,a.description=null},Y=async l=>{};return z(()=>{E.info&&Y(E.info)}),K(()=>E.info,l=>{l&&Y()}),b("formState",a),b("loadingState",_),(l,y)=>(d(),T("div",le,[c(te,{fields:f.value,options:t.value,btnSaveName:p.value,onHandleInputEvent:A,resetSelect:I.value,onHandleChangeSelect:M,onHandleFocusSelect:F,onHandleBlurSelect:L,onHandleChangeClock:P,onOnSubmit:V},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const ie={class:"advisory-table"},re=["onClick"],se=["onClick"],de=["onClick"],he={__name:"Pp03Index",setup(U){const k=JSON.parse(localStorage.getItem("role"))||[],f=i([]),C=i(0),E=i(150),p=i(!1),a=W(),_=i(!1),r=i(null),I=i(!1);i([]);const t=q({year:S("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),A=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:140,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],P=i([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),M=e=>{a.push(`/admin/asistencia/inscritos/${e.slug}`)},F=e=>{r.value=e,p.value=!0},L=()=>{h(),p.value=!1},V=()=>{r.value=null,p.value=!0},H=async e=>{try{const n=await O({url:`attendance/delete/${e.id}`,method:"DELETE"});n.status==200&&(h(),B.success(n.message))}catch(n){console.error("Error de red:",n)}},Y=async e=>{try{const n=await O({url:`attendance/event-finally/${e.id}`,method:"PUT"});n.status==200&&(h(),B.success(n.message))}catch(n){console.error("Error de red:",n)}},l=async()=>{I.value=!0;try{const e={};t.year&&(e.year=S(t.year).format("YYYY")),t.range&&(e.dateStart=t.range[0].format("YYYY/MM/DD"),e.dateEnd=t.range[1].format("YYYY/MM/DD")),t.name&&(e.name=t.name),t.orderby&&(e.orderby=t.orderby),t.asesor&&(e.asesor=t.asesor),await ne("download/attendance-ugo","eventos-ugo",e)}catch(e){console.error("Error de red:",e)}finally{I.value=!1}},y=async e=>{t.page=e,await h()},x=async e=>{e&&(t.page=1,await h())},$=e=>k.some(n=>e.includes(n.id)),h=async()=>{try{_.value=!0;const e={page:t.page};t.year&&(e.year=S(t.year).format("YYYY")),t.range&&(e.dateStart=t.range[0].format("YYYY/MM/DD"),e.dateEnd=t.range[1].format("YYYY/MM/DD")),t.name&&(e.name=t.name),t.orderby&&(e.orderby=t.orderby);const u=await O({url:"pp03/list",method:"GET",params:e});f.value=u.data.data,C.value=u.data.total,E.value=u.data.per_page}catch(e){console.error("Error de red:",e)}finally{_.value=!1}};return z(async()=>{await h()}),b("search",t),b("loading",_),b("loadingFile",I),(e,n)=>{const u=D("a-tag"),j=D("router-link"),w=D("a-menu-item"),J=D("a-popconfirm"),Q=D("a-drawer");return d(),T("div",ie,[c(Z,{title:"LISTA EVENTOS PP03",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:A,othersList:P.value,titleSearch:"BUSCAR POR EVENTO",pageSize:E.value,nameTotal:"Eventos PP03",dataSource:f.value,total:C.value,onHandleNew:V,onHandleDownloadExcel:l,onHandleSearch:x,onHandlePaginator:y},{"data-cell":o(({column:s,record:v})=>[s.dataIndex=="modality"?(d(),T(G,{key:0},[v.modality=="p"?(d(),g(u,{key:0,color:"blue"},{default:o(()=>n[1]||(n[1]=[N("PRESENCIAL")])),_:1})):m("",!0),v.modality=="v"?(d(),g(u,{key:1,color:"orange"},{default:o(()=>n[2]||(n[2]=[N("VIRTUAL")])),_:1})):m("",!0)],64)):m("",!0),s.dataIndex=="dateDiff"?(d(),T(G,{key:1},[v.finally?(d(),g(u,{key:0,color:"red"},{default:o(()=>n[3]||(n[3]=[N(" FINALIZADO ")])),_:1})):m("",!0)],64)):m("",!0)]),"custom-options":o(({record:s})=>[c(w,null,{default:o(()=>[c(j,{to:`/asistencias/${s.slug}`,target:"_blank"},{default:o(()=>n[4]||(n[4]=[N(" Ver Link ")])),_:2},1032,["to"])]),_:2},1024),c(w,null,{default:o(()=>[R("a",{onClick:v=>M(s)},"Inscritos",8,re)]),_:2},1024),$([1,5])?(d(),g(w,{key:0},{default:o(()=>[R("a",{onClick:v=>F(s)},"Editar",8,se)]),_:2},1024)):m("",!0),$([1,5])?(d(),g(w,{key:1},{default:o(()=>[R("span",{style:{color:"#ff4d4f"},onClick:v=>Y(s)},"Finalizar",8,de)]),_:2},1024)):m("",!0),$([1,5])?(d(),g(w,{key:2},{default:o(()=>[c(J,{placement:"rightBottom",title:`¿Quieres eliminar ${s.title} ?`,onConfirm:v=>H(s)},{icon:o(()=>[c(X(ee),{style:{color:"red"}})]),default:o(()=>[n[5]||(n[5]=R("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):m("",!0)]),_:1},8,["othersList","pageSize","dataSource","total"]),c(Q,{open:p.value,"onUpdate:open":n[0]||(n[0]=s=>p.value=s),title:r.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:o(()=>[c(oe,{onCloseDraw:L,dataRow:r.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{he as default};
