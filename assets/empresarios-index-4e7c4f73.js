import{_ as G}from"./TableComponent-7264aa46.js";import{r as o,a as H,G as Y,k as j,X as h,b as c,o as u,d as O,c as r,w as s,p as q,m as J,f as $,i as X,e as C,z as g,y,j as D,t as R}from"./index-8024af36.js";import{E as K}from"./EditarEmpresario-bb977e4f.js";import{g as Q}from"./usePermissions-fa1210d5.js";import"./es-16dda8b6.js";import"./icoexcel-1b303edf.js";import"./selectes-7123eeb1.js";import"./SyncOutlined-4f542d5a.js";import"./MoreOutlined-a1cd216b.js";import"./FormComponent-617a4206.js";import"./quill.snow-15212175.js";import"./useBusinessman-f5a124d6.js";import"./_plugin-vue_export-helper-c27b6911.js";const W={class:"layout-content"},Z={key:0,class:"filter-asesor"},ee=["onClick"],he={__name:"empresarios-index",setup(ae){const w=JSON.parse(localStorage.getItem("profile"))||{},I=o([]),S=o(0),v=o(100),p=o(!1),E=o(!1),i=o(!1),_=o(null),k=o(!1),x=o([]),N=o({}),t=H({asesor:null,name:null,page:1}),A=Y(()=>[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:70},{title:"TIPO DOCUMENTO",fixed:"left",dataIndex:"typedocument",align:"center",width:120},{title:"NUM. DOC",dataIndex:"documentnumber",fixed:"left",width:120,align:"center"},{title:"NOMBRES",dataIndex:"name",width:170},{title:"APELLIDOS",dataIndex:"last_name",width:180},{title:"REGIÓN",dataIndex:"city",align:"center",width:140},{title:"PROVINCIA",dataIndex:"province",align:"center",width:140},{title:"DISTRITO",dataIndex:"district",align:"center",width:150},{title:"CELULAR",dataIndex:"phone",align:"center",width:100},{title:"GÉNERO",dataIndex:"gender",align:"center",width:100},{title:"DISCAPACIDAD",dataIndex:"sick",align:"center",width:120},{title:"HIJOS",dataIndex:"hasSoon",align:"center",width:120},{title:"EMAIL",dataIndex:"email",width:240},...w.rol!=2?[{title:"REGISTRADO POR",dataIndex:"registered",width:200,customCell:()=>({style:{backgroundColor:"#f0f5ff"}})}]:[],...N.value.can_update?[{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}]:[]]),L=()=>{console.log("handleNew...")},T=async()=>{i.value=!1,await d()},P=(e,a)=>{const m=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(m)},z=async()=>{E.value=!0},U=async e=>{t.page=e,await d()},B=async e=>{e&&(t.page=1,await d())},M=e=>{_.value=e,i.value=!0},d=async()=>{p.value=!0;try{const e={page:t.page};t.year&&(e.year=q(t.year).format("YYYY")),t.asesor&&(e.asesor=t.asesor),t.name&&(e.name=t.name);const a=await J({url:"businessman/list",method:"GET",params:e});a.status==200&&(I.value=a.data.data,S.value=a.data.total,v.value=a.data.per_page,k.value=a.rol,a.rol!=2&&await b())}catch(e){console.error("Error de red:",e)}finally{p.value=!1}},b=async()=>{try{const e=await $({url:"select/asesores-report",method:"GET"});e.status==200&&(x.value=e.data)}catch{console.log("Failed to delete")}};return j(async()=>{N.value=await Q("empresarios-ugo"),await d()}),h("search",t),h("loading",p),h("loadingFile",E),(e,a)=>{const m=c("a-select"),f=c("a-tag"),F=c("a-menu-item"),V=c("a-drawer");return u(),O("div",W,[r(G,{title:"EMPRESARIOS",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar por nombres apellidos DNI",columns:A.value,titleSearch:"NÚMERO DE DOCUMENTO",pageSize:v.value,nameTotal:"Solicitantes",dataSource:I.value,total:S.value,onHandleNew:L,onHandleDownloadExcel:z,onHandleSearch:B,onHandlePaginator:U},{header:s(()=>[X(w).rol!=2?(u(),O("div",Z,[a[2]||(a[2]=C("small",null,"POR ASESOR",-1)),r(m,{allowClear:!0,value:t.asesor,"onUpdate:value":a[0]||(a[0]=n=>t.asesor=n),placeholder:"Selecciona Asesor","show-search":"",options:x.value,"filter-option":P},null,8,["value","options"])])):g("",!0)]),"data-cell":s(({column:n,record:l})=>[n.dataIndex=="sick"?(u(),y(f,{key:0},{default:s(()=>[D(R((l.sick||"").toLowerCase()==="si"?"SI":(l.sick||"").toLowerCase()==="no"?"NO":"NO ESPECIFICÓ"),1)]),_:2},1024)):g("",!0),n.dataIndex=="hasSoon"?(u(),y(f,{key:1},{default:s(()=>[D(R((l.hasSoon||"").toLowerCase()==="si"?"SI":(l.hasSoon||"").toLowerCase()==="no"?"NO":"NO ESPECIFICÓ"),1)]),_:2},1024)):g("",!0)]),"custom-options":s(({record:n})=>[r(F,null,{default:s(()=>[C("a",{onClick:l=>M(n)},"Editar",8,ee)]),_:2},1024)]),_:1},8,["columns","pageSize","dataSource","total"]),r(V,{width:"500",title:"Actualizar datos del empresario",open:i.value,"onUpdate:open":a[1]||(a[1]=n=>i.value=n),placement:"right"},{default:s(()=>[r(K,{updateInfoBusinessman:_.value,onRegistered:T},null,8,["updateInfoBusinessman"])]),_:1},8,["open"])])}}};export{he as default};
