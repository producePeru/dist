import{r,a as M,j as P,T as Z,b as l,o as y,d as C,c as n,w as o,e as p,F as D,q as ee,h as ae,v as L,x as q,i as w,K as z,m as B,E as te,t as $,V as ne,W as oe}from"./index-8174b8f9.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const se={ruc:{type:"iText",label:"Número de RUC",name:"ruc",required:!0,message:"Escribe el número de RUC",max:11,disabled:!1},razonSocial:{type:"iText",label:"Razón Social",name:"razonSocial",required:!0,message:"Escribe la razón Social",disabled:!1},actividadEconomica:{type:"iText",label:"Actividad Económica",name:"actividadEconomica",required:!0,message:"Escribe la Actividad Económica"},departamento:{type:"iText",label:"Departamento",name:"departamento",required:!0,message:"Escribe el departamento"},provincia:{type:"iText",label:"Provincia",name:"provincia",required:!0,message:"Escribe la provincia"},distrito:{type:"iText",label:"Distrito",name:"distrito",required:!0,message:"Escribe el distrito"},direccion:{type:"iText",label:"Direccion",name:"direccion",required:!0,message:"Escribe la dirección",disabled:!1}};const le={class:"grid-mype"},re={__name:"DrawerMypeInfo",props:{info:{type:Object,required:!0}},emits:["closeDraw"],setup(R,{emit:x}){const c=R,I=x,v=r(!1),a=M({});function f(t){a.ruc=t.ruc,a.razonSocial=t.razonSocial,a.actividadEconomica=t.actividadEconomica,a.departamento=t.departamento,a.provincia=t.provincia,a.distrito=t.distrito,a.direccion=t.direccion}const h=async()=>{v.value=!0;const t={ruc:a.ruc,razonSocial:a.razonSocial,actividadEconomica:a.actividadEconomica,departamento:a.departamento,provincia:a.provincia,distrito:a.distrito,direccion:a.direccion};try{const m=await z({url:`mype/update-by-ruc/${c.info.id}`,method:"PUT",data:t});m.status==200&&(B.success(m.message),I("closeDraw"))}catch{console.log("Failed to update record")}finally{v.value=!1}};return P(()=>{c.info&&f(c.info)}),Z(()=>c.info,t=>{t&&f(t)}),(t,m)=>{const U=l("a-input"),E=l("a-form-item"),T=l("a-button"),S=l("a-form");return y(),C("div",null,[n(S,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:h},{default:o(()=>[p("div",le,[(y(!0),C(D,null,ee(ae(se),(s,_)=>(y(),C(D,{key:_},[s.type==="iText"?(y(),L(E,{key:0,name:s.name,label:s.label,rules:[{required:s.required,message:s.message,type:s.email}]},{default:o(()=>[n(U,{value:a[s.name],"onUpdate:value":k=>a[s.name]=k,maxlength:s.max,disabled:s.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):q("",!0)],64))),128))]),n(E,null,{default:o(()=>[n(T,{class:"btn-produce",type:"primary","html-type":"submit",loading:v.value},{default:o(()=>m[0]||(m[0]=[w("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},ce=ie(re,[["__scopeId","data-v-54e69984"]]);const de={class:"paginator"},ve={__name:"MypesList",setup(R){const x=r(null),c=r(!1),I=r(null),v=r(100),a=r([]),f=r(!1),h=r(0),t=r({page:1}),m=r("mype/list"),U=r(1200),E=r(window.innerHeight-100),T=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"RUC",dataIndex:"ruc",fixed:"left",width:80},{title:"Razón Social",dataIndex:"razonSocial",fixed:"left",width:150},{title:"Actividad Economica",dataIndex:"actividadEconomica",width:180},{title:"Departamento",dataIndex:"departamento",width:100,align:"center"},{title:"Provincia",dataIndex:"provincia",width:100,align:"center"},{title:"Distrito",dataIndex:"distrito",width:100,align:"center"},{title:"Dirección",dataIndex:"direccion",width:100,align:"center"},{title:"Actualizar",dataIndex:"update",width:100,align:"center"}],S=async i=>{f.value=!0,(await z({url:`formalization/${i}`,method:"PUT"})).status==200&&g()},s=()=>{E.value=window.innerHeight-302},_=M({search:""}),k=()=>{let i={search:_.search};g(i)},F=()=>{_.search||g()},N=()=>{g(),c.value=!1},V=i=>{t.value.page=i,g()},G=async i=>{x.value=i.ruc;try{if((await z({url:`mype/update/${i.ruc}`,method:"PUT"})).status==200)g(),B.success("¡Actualización exitosa!");else{const d=await z({url:`mype/get-by-ruc/${i.ruc}`,method:"GET"});I.value=d.data,c.value=!0}}catch{console.log("Failed to update")}finally{x.value=null}},g=async i=>{try{f.value=!0;const e=t.value.page===1?"":t.value,d=i?{...e,...i}:e,{data:b}=await z({url:m.value,method:"GET",params:d});a.value=b.data,h.value=b.total,v.value=b.per_page}catch(e){console.error("Error de red:",e)}finally{f.value=!1}},Y=te(()=>i=>(t.value.page-1)*v.value+i+1);return P(()=>{g(),window.addEventListener("resize",s),s()}),(i,e)=>{const d=l("a-button"),b=l("a-col"),j=l("a-input"),H=l("a-input-group"),K=l("a-row"),O=l("a-table"),W=l("a-tag"),X=l("a-pagination"),J=l("a-drawer");return y(),C(D,null,[p("div",null,[e[10]||(e[10]=p("h3",{class:"title-produce"},"LISTA DE MYPES",-1)),n(K,{style:{margin:"1rem 0"}},{default:o(()=>[n(b,{xs:24,md:12,lg:18},{default:o(()=>[e[8]||(e[8]=p("span",{class:"fs-13"},"Actualizar lista con: ",-1)),n(d,{class:"fs-13",onClick:e[0]||(e[0]=u=>S("set-ruc-advisories")),type:"text"},{default:o(()=>e[5]||(e[5]=[w("Asesorías")])),_:1}),n(d,{class:"fs-13",onClick:e[1]||(e[1]=u=>S("set-ruc-ruc-10")),type:"text"},{default:o(()=>e[6]||(e[6]=[w("RUC 10")])),_:1}),n(d,{class:"fs-13",onClick:e[2]||(e[2]=u=>S("set-ruc-ruc-20")),type:"text"},{default:o(()=>e[7]||(e[7]=[w("RUC 20")])),_:1})]),_:1}),n(b,{xs:24,md:12,lg:6},{default:o(()=>[n(H,{compact:""},{default:o(()=>[n(j,{value:_.search,"onUpdate:value":e[3]||(e[3]=u=>_.search=u),style:{width:"calc(100% - 80px)"},onInput:F},null,8,["value"]),n(d,{type:"primary",disabled:_.search==="",onClick:k},{default:o(()=>e[9]||(e[9]=[w("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(O,{bordered:"",scroll:{x:U.value,y:E.value},class:"table-users",columns:T,"data-source":a.value,pagination:!1,loading:f.value,size:"small"},{bodyCell:o(({column:u,record:A,index:Q})=>[u.dataIndex==="idx"?(y(),C(D,{key:0},[w($(Y.value(Q)),1)],64)):q("",!0),u.dataIndex=="update"?(y(),L(d,{key:1,type:"text",class:"fs-13 color-primary",onClick:ue=>G(A),loading:x.value==A.ruc},{default:o(()=>[ne(p("span",null,"Actualizar",512),[[oe,x.value!=A.ruc]])]),_:2},1032,["onClick","loading"])):q("",!0)]),_:1},8,["scroll","data-source","loading"])]),p("div",de,[p("span",null,[n(W,{color:"blue"},{default:o(()=>[p("b",null,$(h.value),1)]),_:1}),e[11]||(e[11]=p("span",{class:"fs-13"},"mypes registradas",-1))]),n(X,{size:"small",total:h.value,pageSize:v.value,onChange:V,showSizeChanger:!1},null,8,["total","pageSize"])]),n(J,{width:"550",open:c.value,"onUpdate:open":e[4]||(e[4]=u=>c.value=u),class:"draw",title:"Editar datos de MYPE",placement:"right"},{default:o(()=>[n(ce,{onCloseDraw:N,info:I.value},null,8,["info"])]),_:1},8,["open"])],64)}}};export{ve as default};
