import{l as w,r as p,E as he,a as re,U as le,j as de,b as r,o as i,x as c,w as l,e as y,d as k,F as q,s as Ie,c as o,y as d,h as S,I as we,i as x,t as Y,N as W,m as V,u as Ee,g as xe,G as Se,Y as Ce,ad as ke,v as ie,ae as Re,a1 as Ae,K as Ne,q as Te}from"./index-cc9eac84.js";import{_ as Oe}from"./icoexcel-1b303edf.js";import{u as ue}from"./selectes-75823ef3.js";import"./es-e5d57d23.js";import{d as Ue}from"./downloadExcel-c9e4b1b0.js";import{C as Ye}from"./CloudOutlined-16e93f29.js";import{M as qe}from"./MoreOutlined-71e56f85.js";const Fe={class:"form-attendance"},Le="DD/MM/YYYY",Me={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup(j,{emit:g}){w.locale("es");const m=ue();m.$patch({cities:m.cities}),m.$patch({provinces:m.provinces}),m.$patch({districts:m.districts}),m.fetchCities(),m.fetchAsesores();const F=p(!1),D=j,N=g;he();const e=re({}),L={eventsoffice_id:{type:"iSelect",label:"TIPO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA FIN",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1},modality:{type:"iSelect",label:"MODALIDAD",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0,max:100},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}},M=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}];le(()=>e.startDate,n=>{e.endDate&&new Date(n)>new Date(e.endDate)&&(e.endDate=null)}),le(()=>e.endDate,n=>{e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=null)});const b=(n,E)=>{const A=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return E.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(A)},Q=n=>{if(n=="modality")return M;if(n=="powerBy")return pertenece;if(n=="fairtype_id")return typeFair;if(n=="eventsoffice_id")return B()},B=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],T=n=>{e.province_id=null,e.district_id=null,m.fetchProvinces(n)},$=n=>{e.district_id=null,m.fetchDistricts(n)},I=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null},Z=async()=>{F.value=!0;const n={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:w(e.startDate).format("YYYY-MM-DD"),endDate:w(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,people_id:e.people_id,description:e.description};try{const E=D.dataRow?"PUT":"POST",A=D.dataRow?`attendance/update/${D.dataRow.id}`:"attendance/create",_=await W({url:A,method:E,data:n});_.status==200&&(V.success(_.message),N("closeDraw"),I()),_.status==500&&(V.error(_.message),I())}catch(E){V.error("Se presentó un error, los valores son requeridos",E)}finally{F.value=!1}},G=n=>{const E=e[n]?e[n].trim():"";e[n]=E};function h(n){e.eventsoffice_id=n.id_pnte,e.title=n.title,e.startDate=n.startDate?w(n.startDate,"DD/MM/YYYY"):null,e.endDate=n.endDate?w(n.endDate,"DD/MM/YYYY"):null,e.modality=n.modality,e.city_id=n.city_id,T(n.city_id),e.province_id=n.province_id,$(n.province_id),e.district_id=n.district_id,e.address=n.address,e.people_id=n.people_id,e.description=n.description}return de(()=>{D.dataRow&&h(D.dataRow)}),le(()=>D.dataRow,n=>{n?h(n):I()}),(n,E)=>{const A=r("a-input"),_=r("a-form-item"),R=r("a-select"),J=r("a-textarea"),K=r("a-input-number"),X=r("a-date-picker"),ee=r("a-button"),z=r("a-form");return i(),c(z,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Z},{default:l(()=>[y("div",Fe,[(i(),k(q,null,Ie(L,(a,ae)=>(i(),k(q,{key:ae},[a.type==="iText"?(i(),c(_,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:l(()=>[o(A,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,maxlength:a.max,onBlur:u=>G(a.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelect"?(i(),c(_,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[o(R,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:Q(a.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iTextarea"?(i(),c(_,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[o(J,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iNumber"?(i(),c(_,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[o(K,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iDate"?(i(),c(_,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[o(X,{locale:S(we),value:e[a.name],"onUpdate:value":u=>e[a.name]=u,style:{width:"100%"},format:Le,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelectWrite"?(i(),c(_,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[a.name=="city_id"?(i(),c(R,{key:0,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(m).cities,"show-search":"","filter-option":b,onChange:T},null,8,["value","onUpdate:value","options"])):d("",!0),a.name=="province_id"?(i(),c(R,{key:1,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(m).provinces,"show-search":"","filter-option":b,onChange:$,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="district_id"?(i(),c(R,{key:2,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(m).districts,"show-search":"","filter-option":b,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="people_id"?(i(),c(R,{key:3,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(m).asesores,"show-search":"","filter-option":b},null,8,["value","onUpdate:value","options"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0)],64))),64))]),o(_,null,{default:l(()=>[o(ee,{type:"primary","html-type":"submit",loading:F.value},{default:l(()=>[x(Y(j.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const $e={key:0,class:"ant-table-cell"},ze={class:"table-order"},Pe={key:1},Ve={key:1},Be=["onClick"],Ge=["onClick"],He=["onClick"],We={class:"paginator"},aa={__name:"IndexAsistencia",props:["idConvenio"],setup(j){w.locale("es");const g=p(w("2025","YYYY")),m=Ee(),F=JSON.parse(localStorage.getItem("role"))||[];ue(),xe.get("token");const D=p(!1),N=p(null),e=p(!1);p(null);const L=p(0),M=p(50),b=p({page:1}),Q=p(1200),B=p([]),T=p(!1);p(!1),p(!1),p(!1),p(!1),p(null);const $=p(window.innerHeight-100),I=p(""),Z=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:140,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"DÍAS RESTANTES",dataIndex:"dateDiff",align:"center",width:140},{title:"MODALIDAD",dataIndex:"modality",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],G=s=>{I.value=s,C()},h=re({search:""}),n=s=>F.some(t=>s.includes(t.id)),E=()=>{C(),D.value=!1},A=s=>{N.value=s,D.value=!0},_=()=>{N.value=null,D.value=!0},R=s=>{const t=w().startOf("day"),U=w(s).startOf("day").diff(t,"days");return U<=-1?U:U===0?1:U},J=()=>{b.value.page=1,h.search,C()},K=()=>{h.search||C()},X=s=>{m.push(`/admin/asistencia/inscritos/${s.slug}`)},ee=s=>{b.value.page=s,C()},z=()=>{$.value=window.innerHeight-320},a=async s=>{try{const t=await W({url:`attendance/delete/${s.id}`,method:"DELETE"});t.status==200&&(C(),V.success(t.message))}catch(t){console.error("Error de red:",t)}},ae=async s=>{try{const t=await W({url:`attendance/event-finally/${s.id}`,method:"PUT"});t.status==200&&(C(),V.success(t.message))}catch(t){console.error("Error de red:",t)}},u=Se(()=>s=>(b.value.page-1)*M.value+s+1),C=async()=>{try{T.value=!0;const s={};g!=null&&g.value&&(s.year=w(g.value).format("YYYY")),h.search&&(s.search=h.search),b.value.page&&(s.page=b.value.page),I.value&&(s.order_by=I.value);const{data:t}=await W({url:"attendance/list",method:"GET",params:s});B.value=t==null?void 0:t.data,L.value=t.total,M.value=t.per_page}catch(s){console.error("Error de red:",s)}finally{T.value=!1}},ce=async()=>{try{e.value=!0;const s={};g!=null&&g.value&&(s.year=w(g.value).format("YYYY")),h.search&&(s.search=h.search),b.value.page&&(s.page=b.value.page),I.value&&(s.order_by=I.value),await Ue("download/attendance-ugo","eventos-ugo",s)}catch(s){console.error("Error de red:",s)}finally{e.value=!1}};return Ce(()=>{window.removeEventListener("resize",z)}),de(()=>{window.addEventListener("resize",z),z(),C()}),(s,t)=>{const O=r("a-button"),U=r("a-date-picker"),se=r("a-col"),pe=r("a-input"),me=r("a-input-group"),_e=r("a-row"),oe=r("router-link"),H=r("a-tag"),P=r("a-menu-item"),ve=r("a-popconfirm"),fe=r("a-menu"),ye=r("a-dropdown"),ge=r("a-table"),De=r("a-pagination"),be=r("a-drawer");return i(),k(q,null,[y("div",null,[t[15]||(t[15]=y("h3",{class:"title-produce"},"LISTA EVENTOS UGO",-1)),o(_e,{style:{margin:"1rem 0"}},{default:l(()=>[o(se,{xs:24,md:12,lg:18},{default:l(()=>[n([1,2,5])?(i(),c(O,{key:0,type:"primary",onClick:_},{default:l(()=>t[6]||(t[6]=[x("NUEVO EVENTO")])),_:1})):d("",!0),o(O,{class:"btn-excel",onClick:ce,loading:e.value,type:"primary",style:{"margin-left":".6rem"}},{default:l(()=>t[7]||(t[7]=[y("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Oe},null,-1)])),_:1},8,["loading"]),o(U,{allowClear:!1,value:g.value,"onUpdate:value":t[0]||(t[0]=v=>g.value=v),picker:"year",placeholder:"Seleccionar año",onChange:C,style:{width:"80px",margin:"0 0 0 8px"}},null,8,["value"])]),_:1}),o(se,{xs:24,md:12,lg:6},{default:l(()=>[o(me,{compact:""},{default:l(()=>[o(pe,{value:h.search,"onUpdate:value":t[1]||(t[1]=v=>h.search=v),style:{width:"calc(100% - 80px)"},onInput:K,placeholder:"Buscar por Nombre Evento"},null,8,["value"]),o(O,{type:"primary",disabled:h.search==="",onClick:J},{default:l(()=>t[8]||(t[8]=[x("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(ge,{bordered:"",scroll:{x:Q.value,y:$.value},class:"table-fairs",columns:Z,"data-source":B.value,pagination:!1,loading:T.value,size:"small"},{headerCell:l(({column:v,text:f})=>[v.dataIndex==="attendance_list_count"?(i(),k("span",$e,[t[9]||(t[9]=x(" INSCRITOS ")),y("span",ze,[o(S(ke),{onClick:t[2]||(t[2]=te=>G("desc")),style:ie({color:I.value==="desc"?"#e91e63":""})},null,8,["style"]),o(S(Re),{onClick:t[3]||(t[3]=te=>G("asc")),style:ie({color:I.value==="asc"?"#e91e63":""})},null,8,["style"])])])):d("",!0)]),bodyCell:l(({column:v,record:f,index:te})=>[v.dataIndex=="idx"?(i(),k(q,{key:0},[x(Y(u.value(te)),1)],64)):d("",!0),v.dataIndex=="title"?(i(),k("span",Pe,Y(f.pnte)+" - "+Y(f.title),1)):d("",!0),v.dataIndex=="slug"?(i(),c(oe,{key:2,to:`/asistencias/${f.slug}`,target:"_blank"},{default:l(()=>[o(S(Ye),{class:"fair-link"})]),_:2},1032,["to"])):d("",!0),v.dataIndex=="modality"?(i(),k(q,{key:3},[f.modality=="p"?(i(),c(H,{key:0,color:"blue"},{default:l(()=>t[10]||(t[10]=[x("PRESENCIAL")])),_:1})):d("",!0),f.modality=="v"?(i(),c(H,{key:1,color:"orange"},{default:l(()=>t[11]||(t[11]=[x("VIRTUAL")])),_:1})):d("",!0)],64)):d("",!0),v.dataIndex=="dateDiff"?(i(),k(q,{key:4},[R(f.endDate2)<0?(i(),c(H,{key:0,color:"red"},{default:l(()=>t[12]||(t[12]=[x(" FINALIZADO ")])),_:1})):(i(),k("span",Ve,Y(R(f.endDate2)),1))],64)):d("",!0),v.dataIndex=="actions"?(i(),c(ye,{key:5,trigger:["click"]},{overlay:l(()=>[o(fe,null,{default:l(()=>[o(P,null,{default:l(()=>[o(oe,{to:`/asistencias/${f.slug}`,target:"_blank"},{default:l(()=>t[13]||(t[13]=[x(" Ver Link ")])),_:2},1032,["to"])]),_:2},1024),o(P,null,{default:l(()=>[y("a",{onClick:ne=>X(f)},"Inscritos",8,Be)]),_:2},1024),n([1,5])?(i(),c(P,{key:0},{default:l(()=>[y("a",{onClick:ne=>A(f)},"Editar",8,Ge)]),_:2},1024)):d("",!0),n([1,5])?(i(),c(P,{key:1},{default:l(()=>[y("span",{style:{color:"#ff4d4f"},onClick:ne=>ae(f)},"Finalizar",8,He)]),_:2},1024)):d("",!0),n([1,5])?(i(),c(P,{key:2},{default:l(()=>[o(ve,{placement:"rightBottom",title:`¿Quieres eliminar ${f.title} ?`,onConfirm:ne=>a(f)},{icon:l(()=>[o(S(Ae),{style:{color:"red"}})]),default:l(()=>[t[14]||(t[14]=y("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):d("",!0)]),_:2},1024)]),default:l(()=>[y("a",{class:"ant-dropdown-link",onClick:t[4]||(t[4]=Ne(()=>{},["prevent"]))},[o(O,{shape:"circle",icon:Te(S(qe)),size:"small"},null,8,["icon"])])]),_:2},1024)):d("",!0)]),_:1},8,["scroll","data-source","loading"])]),y("div",We,[y("span",null,[o(H,{color:"blue"},{default:l(()=>[y("b",null,Y(L.value),1)]),_:1}),t[16]||(t[16]=x("Eventos creados"))]),o(De,{size:"small",total:L.value,pageSize:M.value,onChange:ee,showSizeChanger:!1},null,8,["total","pageSize"])]),o(be,{open:D.value,"onUpdate:open":t[5]||(t[5]=v=>D.value=v),title:N.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:l(()=>[o(Me,{onCloseDraw:E,dataRow:N.value},null,8,["dataRow"])]),_:1},8,["open","title"])],64)}}};export{aa as default};
