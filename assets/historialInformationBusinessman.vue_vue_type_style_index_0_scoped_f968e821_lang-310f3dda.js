import{_ as w}from"./FormComponent-9eec914e.js";import{u as x}from"./selectes-d8dee7d1.js";import{r as _,a as M,k as q,U as k,X as v,o as g,d as E,e as o,t as f,z as T,c as j,h as y,p as d}from"./index-de9d4c9c.js";import{u as L}from"./useBusinessman-921d82c7.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const V={key:0},z={class:"description-document"},G={class:"description-document"},H={class:"description-document"},Y={class:"description-document"},J={__name:"RegistraEmpresario",props:{infoBusinessMan:{type:Object,required:!0,default:()=>({})},detailDocument:{type:Object,default:()=>({})}},emits:["registered"],setup(c,{emit:S}){const t=c,I=S,r=x(),D=L(),m=_(!1),e=M({}),h=_("REGISTRAR"),a=_({city_id:[],province_id:[],district_id:[],gender_id:[],sick:[]}),N=async n=>{n=="city_id"&&(await r.fetchProvinces(e.city_id),a.value.province_id=r.provinces,u.value.province_id.disabled=!1),n=="province_id"&&(await r.fetchDistricts(e.province_id),a.value.district_id=r.districts,u.value.district_id.disabled=!1)},R=async n=>{n=="id_pnte"&&(await r.fetchOfficesPnte(),a.value.id_pnte=r.officesPnte),n==="country_id"&&(t.detailDocument.type==1?(u.value.country_id.disabled=!0,e.country_id=155,a.value.country_id=r.countries):a.value.country_id=r.countries.filter(i=>i.value!==155)),n=="city_id"&&(e.city_id=null,e.province_id=null,e.district_id=null,a.value.province_id=[],a.value.city_id=r.cities),n=="province_id"&&(e.province_id=null,e.district_id=null,a.value.district_id=[]),n=="sick"&&A(),n=="gender_id"&&(a.value.gender_id=r.genders),n=="hasSoon"&&P()},A=()=>{a.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},P=()=>{a.value.hasSoon=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},O=async()=>{if(m.value=!0,(t.detailDocument.type==2||t.detailDocument.type==3||t.detailDocument.type==4)&&e.country_id==155)return e.country_id=null,y.warn("No se puede registrar un empresario en PERÚ"),m.value=!1;const n={typedocument_id:t.detailDocument.type,documentnumber:t.detailDocument.number,lastname:e.lastname?e.lastname:t.infoBusinessMan.lastname,middlename:e.middlename?e.middlename:t.infoBusinessMan.middlename,name:e.name?e.name:t.infoBusinessMan.name,country_id:e.country_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,birthday:d(e.birthday).format("YYYY-MM-DD"),phone:e.phone,email:e.email,gender_id:e.gender_id,sick:e.sick,hasSoon:e.hasSoon};try{const i=await D.create(n);i.status==200&&(y.success(i.message),I("registered",i.data),C())}catch{y.error(r.error)}finally{m.value=!1}},C=()=>{e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},u=_({}),b=()=>{const n={...(t.detailDocument.type!=1||t.infoBusinessMan.reniecError=="no_disponible")&&{lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1}},country_id:{type:"iSelect",label:"NACIONALIDAD - PAÍS",name:"country_id",required:!0,message:"Seleccionar país"},city_id:{type:"iSelect",label:"REGIÓN RESIDENCIA",name:"city_id",required:!0,message:"Seleccionar región"},province_id:{type:"iSelect",label:"PROVINCIA RESIDENCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO RESIDENCIA",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCIÓN RESIDENCIA",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"FECHA NACIMIENTO",name:"birthday",required:!0,message:"Seleccionar fecha de nacimiento",disabledDate:i=>{if(!i)return!1;const s=d(),l=s.subtract(100,"year").endOf("day"),p=s.subtract(18,"year").endOf("day");return i.isAfter(p)||i.isBefore(l)},defaultPickerValue:d().subtract(18,"year"),rules:[{validator:(i,s)=>{if(!s)return Promise.reject(new Error("Seleccionar fecha de nacimiento"));const l=d(),p=l.subtract(100,"year").endOf("day"),B=l.subtract(18,"year").endOf("day");return d(s).isAfter(B)?Promise.reject(new Error("Debe tener 18 años o más")):d(s).isBefore(p)?Promise.reject(new Error("La edad no puede superar los 100 años")):Promise.resolve()},trigger:"change"}]},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(i,s)=>{if(!s)return Promise.reject(new Error("El número es requerido"));const l=s.toString();return l.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):l.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!0,disabled:!1,rules:[{validator:(i,s)=>!s||s.trim()===""?Promise.reject(new Error("El correo electrónico es obligatorio")):/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s)?Promise.resolve():Promise.reject(new Error("Debe ingresar un correo electrónico válido")),trigger:["blur","change"]}]},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"Seleccionar opción"},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS?",name:"hasSoon",required:!0,message:"Seleccionar opción"}};u.value=n,t.detailDocument.type==1?e.country_id=155:e.country_id=null};return q(async()=>{t.detailDocument&&b(t.detailDocument),await r.fetchCountries(),await r.fetchCities(),await r.fetchGenders(),a.value.country_id=r.countries}),k(()=>t.detailDocument,n=>{n&&b()}),v("formState",e),v("loadingState",m),(n,i)=>(g(),E("div",null,[t.detailDocument.type==1&&t.infoBusinessMan.name?(g(),E("div",V,[o("div",z,[i[0]||(i[0]=o("span",null,"Documento:",-1)),o("b",null,"DNI: "+f(c.infoBusinessMan.numeroDocumento),1)]),o("div",G,[i[1]||(i[1]=o("span",null,"Apellido Paterno:",-1)),o("b",null,f(c.infoBusinessMan.lastname),1)]),o("div",H,[i[2]||(i[2]=o("span",null,"Apellido Materno:",-1)),o("b",null,f(c.infoBusinessMan.middlename),1)]),o("div",Y,[i[3]||(i[3]=o("span",null,"Nombres:",-1)),o("b",null,f(c.infoBusinessMan.name),1)])])):T("",!0),j(w,{fields:u.value,options:a.value,btnSaveName:h.value,onHandleFocusSelect:R,onHandleChangeSelect:N,onOnSubmit:O,mayus:!0},null,8,["fields","options","btnSaveName"])]))}},Q=F(J,[["__scopeId","data-v-379ea49f"]]);export{Q as R};
