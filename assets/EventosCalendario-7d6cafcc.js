import{r as c,a as B,l as A,b as s,o as l,d as p,c as n,w as o,e as h,F as I,s as X,x as N,q as b,h as H,i as S,m as G,K as j,j as Z,T as pe,E as fe,X as _e,p as K,y as ve,t as M,J as ge}from"./index-61e3a352.js";import{u as W}from"./selectes-1c4d74af.js";import{Q as ee}from"./quill.snow-ce94cba2.js";import"./es-ae8d7cd7.js";import{M as ye}from"./MoreOutlined-bb011813.js";const be={class:"grid-events"},he={style:{display:"flex",margin:"1rem 0 .5rem"}},we={key:3,class:"grid-events-hour"},xe={__name:"DrawEventosCalendario",props:["type"],emits:["closeDraw"],setup(V,{emit:P}){const f=W();f.$patch({officesPnte:f.officesPnte}),f.fetchOfficesPnte();const E=c(!1),w={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},k=c([{dates:new Date}]),x=c({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:150},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),t=B({allDay:1}),D=c([{start:null,end:A().subtract(0,"day").format("YYYY-MM-DD")}]),q=d=>d==="id_pnte"?f.officesPnte:[],T=d=>{const r={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!0,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!0,message:"",disabled:!1,max:10}};if(d==2){const m=Object.entries(x.value),u=m.findIndex(([C])=>C==="title"),U=[...m.slice(0,u+1),...Object.entries(r),...m.slice(u+1)];x.value=Object.fromEntries(U)}else{const m={...x.value};delete m.organiza,delete m.numMypes,x.value=m}},_=(d,r)=>{const m=d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(m)},v=async()=>{if(!t.date)return G.error("Debes de seleccionar una fecha");const d={id_pnte:t.id_pnte,title:t.title,...t.organiza&&{organiza:t.organiza},...t.numMypes&&{numMypes:t.numMypes},date:A(t.date).format("YYYY-MM-DD"),start:A(t.hours[0]).format("HH:mm"),end:A(t.hours[1]).format("HH:mm"),description:t.description,nameUser:t.nameUser,link:t.link};E.value=!0;try{const r=await j({url:"event/create",method:"POST",data:d});r.status===200&&(G.success(r.message),t.title="")}catch(r){console.error("Failed to update record",r)}finally{E.value=!1}};return(d,r)=>{const m=s("a-select"),u=s("a-form-item"),U=s("a-input"),C=s("VDatePicker"),F=s("a-time-range-picker"),Y=s("a-button"),L=s("a-form");return l(),p("div",null,[n(L,{class:"form-events",layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:v},{default:o(()=>[h("div",be,[(l(!0),p(I,null,X(x.value,(e,$)=>(l(),p(I,{key:$},[e.type==="iSelect"?(l(),N(u,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(m,{value:t[e.name],"onUpdate:value":g=>t[e.name]=g,options:q(e.name),"show-search":"","filter-option":_,onChange:T},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):b("",!0),e.type==="iText"?(l(),N(u,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(U,{value:t[e.name],"onUpdate:value":g=>t[e.name]=g,maxlength:e.max,disabled:e.disabled,placeholder:e.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):b("",!0),e.type==="iDate"?(l(),N(u,{key:2,name:e.name,label:e.label},{default:o(()=>[n(C,{modelValue:t[e.name],"onUpdate:modelValue":g=>t[e.name]=g,mode:"date",attributes:k.value,"disabled-dates":D.value},null,8,["modelValue","onUpdate:modelValue","attributes","disabled-dates"]),h("div",he,[h("div",null,[r[1]||(r[1]=h("label",{style:{display:"block"},for:""},"HORARIO",-1)),n(F,{"use12-hours":"",value:t.hours,"onUpdate:value":r[0]||(r[0]=g=>t.hours=g),format:"h:mm a"},null,8,["value"])])])]),_:2},1032,["name","label"])):b("",!0),e.type==="iSwitch"?(l(),p("div",we)):b("",!0),e.type==="iTextArea"?(l(),N(u,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:o(()=>[n(H(ee),{class:"quill-editor",content:t[e.name],"onUpdate:content":g=>t[e.name]=g,options:w,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):b("",!0)],64))),128))]),n(u,null,{default:o(()=>[n(Y,{type:"primary","html-type":"submit",loading:E.value,style:{"margin-top":"1rem"}},{default:o(()=>r[2]||(r[2]=[S("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Ee={class:"grid-event-resultado"},Re={__name:"DrawResultados",props:["dataRow"],emits:["closeDraw"],setup(V,{emit:P}){const f=W();f.$patch({officesPnte:f.officesPnte}),f.fetchOfficesPnte();const E=P,w=V,k=c(!1),x={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},t=c({resultados:{type:"iTextArea",label:"DESCRIBIR RESULTADOS",name:"resultados",required:!1,message:"Escribe los resultados de los evento",max:500}}),D=B({resultado:null}),q=async()=>{const _={resultado:D.resultado};k.value=!0;try{const v=await j({url:`event/update/${w.dataRow.id}`,method:"PUT",data:_});v.status===200&&(G.success(v.message),E("closeDraw"))}catch(v){console.error("Failed to update record",v)}finally{k.value=!1}},T=_=>{console.log("Setting info",_),D.resultado=_.resultado};return Z(()=>{w.dataRow&&T(w.dataRow)}),pe(()=>w.dataRow,_=>{_&&T(_)}),(_,v)=>{const d=s("a-form-item"),r=s("a-button"),m=s("a-form");return l(),p("div",null,[n(m,{class:"form-events",layout:"vertical",model:D,name:"basic",autocomplete:"off",onFinish:q},{default:o(()=>[h("div",Ee,[(l(!0),p(I,null,X(t.value,(u,U)=>(l(),p(I,{key:U},[u.type==="iTextArea"?(l(),N(d,{key:0,name:u.name,label:u.label,rules:[{required:u.required,message:u.message}]},{default:o(()=>[n(H(ee),{class:"quill-editor",content:D.resultado,"onUpdate:content":v[0]||(v[0]=C=>D.resultado=C),options:x,contentType:"html"},null,8,["content"])]),_:2},1032,["name","label","rules"])):b("",!0)],64))),128))]),n(d,null,{default:o(()=>[n(r,{type:"primary","html-type":"submit",loading:k.value,style:{"margin-top":"1rem"}},{default:o(()=>v[1]||(v[1]=[S("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const ke={key:0},De={key:1},Se=["innerHTML"],Ie=["onClick"],Te={class:"paginator"},ze={__name:"EventosCalendario",setup(V){A.locale("es");const P=JSON.parse(localStorage.getItem("role"))||[],f=c(!1),E=c(!1),w=c(null),k=c(0),x=c(50),t=c({page:0}),D=c(1200),q=c([]),T=c(!1),_=c(window.innerHeight-100),v=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"ÁREA",fixed:"left",dataIndex:"office",width:100},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"results",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],d=B({search:""}),r=i=>P.some(a=>i.includes(a.id)),m=()=>{z(),f.value=!1},u=i=>{w.value=i,E.value=!0},U=()=>{f.value=!0},C=()=>{let i={search:d.search};z(i)},F=()=>{d.search||z()},Y=i=>A(i).format("DD/MM/YYYY"),L=i=>A(i,"HH:mm:ss").format("HH:mm"),e=i=>({ferias:"FERIAS",rd:"RUTA DIGITAL",ugse:"UGSE",uger:"UGGER",ugo:"UGO"})[i],$=i=>{t.value.page=i,z()},g=()=>{_.value=window.innerHeight-330},te=fe(()=>i=>t.value.page*x.value+i+1),z=async i=>{try{T.value=!0;let a;a=t.value.page==0?"":t.value,a=i?{...a,...i}:a;const{data:R}=await j({url:"event/list",method:"GET",params:a});q.value=R==null?void 0:R.data,k.value=R.total,x.value=R.per_page}catch(a){console.error("Error de red:",a)}finally{T.value=!1}};return _e(()=>{window.removeEventListener("resize",g)}),Z(()=>{window.addEventListener("resize",g),g(),z()}),(i,a)=>{const R=s("a-button"),ae=s("router-link"),Q=s("a-col"),ne=s("a-input"),oe=s("a-input-group"),se=s("a-row"),le=s("a-menu-item"),re=s("a-menu"),ie=s("a-dropdown"),de=s("a-table"),ue=s("a-tag"),ce=s("a-pagination"),J=s("a-drawer");return l(),p(I,null,[h("div",null,[a[8]||(a[8]=h("h3",{class:"title-produce"},"EVENTOS PNTE 2025",-1)),n(se,{style:{margin:"1rem 0"}},{default:o(()=>[n(Q,{xs:24,md:12,lg:18},{default:o(()=>[n(R,{type:"primary",onClick:U,class:"box-btn-add"},{default:o(()=>a[5]||(a[5]=[S(" NUEVO EVENTO ")])),_:1}),n(ae,{to:"/calendario/eventos",target:"_blank",style:{"margin-left":"1rem"}},{default:o(()=>[n(R,{type:"dashed",icon:K(H(ve))},{default:o(()=>a[6]||(a[6]=[S("Ver Calendario")])),_:1},8,["icon"])]),_:1})]),_:1}),n(Q,{xs:24,md:12,lg:6},{default:o(()=>[n(oe,{compact:""},{default:o(()=>[n(ne,{value:d.search,"onUpdate:value":a[0]||(a[0]=y=>d.search=y),style:{width:"calc(100% - 80px)"},onInput:F},null,8,["value"]),n(R,{type:"primary",disabled:d.search==="",onClick:C},{default:o(()=>a[7]||(a[7]=[S("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(de,{bordered:"",scroll:{x:D.value,y:_.value},class:"table-events-google",columns:v,"data-source":q.value,pagination:!1,loading:T.value,size:"small"},{bodyCell:o(({column:y,record:O,index:me})=>[y.dataIndex=="idx"?(l(),p(I,{key:0},[S(M(te.value(me)),1)],64)):b("",!0),y.dataIndex=="date"?(l(),p(I,{key:1},[S(M(Y(O.date)),1)],64)):b("",!0),y.dataIndex=="office"?(l(),p(I,{key:2},[S(M(e(O.office)),1)],64)):b("",!0),y.dataIndex=="hours"?(l(),p(I,{key:3},[O.allDay==1?(l(),p("span",ke,"Todo el día")):(l(),p("span",De,M(L(O.start))+" - "+M(L(O.end)),1))],64)):b("",!0),y.dataIndex=="results"?(l(),p("div",{key:4,class:"html-format",innerHTML:O.resultado},null,8,Se)):b("",!0),y.dataIndex=="actions"?(l(),N(ie,{key:5,trigger:["click"]},{overlay:o(()=>[n(re,null,{default:o(()=>[r([5,10,11])?(l(),N(le,{key:0},{default:o(()=>[h("a",{onClick:Ue=>u(O)},"Resultados",8,Ie)]),_:2},1024)):b("",!0)]),_:2},1024)]),default:o(()=>[h("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=ge(()=>{},["prevent"]))},[n(R,{shape:"circle",icon:K(H(ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):b("",!0)]),_:1},8,["scroll","data-source","loading"])]),h("div",Te,[h("span",null,[n(ue,{color:"blue"},{default:o(()=>[h("b",null,M(k.value),1)]),_:1}),a[9]||(a[9]=S("Eventos creados"))]),n(ce,{size:"small",total:k.value,pageSize:x.value,onChange:$,showSizeChanger:!1},null,8,["total","pageSize"])]),n(J,{open:f.value,"onUpdate:open":a[2]||(a[2]=y=>f.value=y),title:w.value?"Editar Evento":"NUEVO EVENTO",placement:"right",width:"450"},{default:o(()=>[n(xe,{onCloseDraw:m,dataRow:w.value,type:"events"},null,8,["dataRow"])]),_:1},8,["open","title"]),n(J,{open:E.value,"onUpdate:open":a[4]||(a[4]=y=>E.value=y),title:"RESULTADOS",placement:"right",width:"550"},{default:o(()=>[n(Re,{dataRow:w.value,onCloseDraw:a[3]||(a[3]=y=>{E.value=!1,z()})},null,8,["dataRow"])]),_:1},8,["open"])],64)}}};export{ze as default};
