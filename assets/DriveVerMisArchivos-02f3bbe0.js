import{g as F,r as t,v as G,k as j,b as s,o as c,d as w,e as l,T as q,V as P,c as n,w as o,i as C,F as Q,y as x,t as u,s as h,q as D,h as y,N as J,Q as W,I as K,O as X,W as Z,m as ee,G as ae,P as te}from"./index-9deaae49.js";import{M as oe}from"./MoreOutlined-bbfb4929.js";const ne=l("h3",null,"MIS ARCHIVOS",-1),se={class:"w-search"},le={key:0},ie={key:1},re=l("a",null,"Eliminar",-1),de={class:"paginator-drive"},pe={__name:"DriveVerMisArchivos",setup(ce){JSON.parse(localStorage.getItem("profile"));const E="https://apituempresa.soporte-pnte.com/api/",A="http://127.0.0.1:8000/api/",I=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?A:E,S=F.get("token"),d=t({}),v=t([]),m=t(!1),k=t(0);t(0),t([]),t(""),t(!1);const M=[{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],O=async e=>{try{const a=await x({url:`drive/delete-file/${e.id}`,method:"DELETE"});a.status==500?Z.warning({title:"Aviso",content:a.message}):(f(),ee.success(a.message))}catch(a){console.error("Error de red:",a)}},z=async e=>{d.value={...d.value,[e]:!0};try{const a=await ae.get(`${I}drive/download/${e}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${S}`}}),p=window.URL.createObjectURL(new Blob([a.data])),i=document.createElement("a");i.href=p,i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(a){console.error("Error al descargar el archivo",a)}finally{d.value={...d.value,[e]:!1}}},R=e=>te(e).format("DD/MM/YYYY HH:mm A"),b=t(window.innerHeight-100),g=()=>{b.value=window.innerHeight-300};G(()=>{window.removeEventListener("resize",g)});const V=t({page:1}),B=e=>{V.value.page=e,f()},f=async()=>{try{m.value=!0;const{data:e}=await x({url:"drive/list-files",method:"GET"});v.value=e.data,k.value=e.total}catch(e){console.error("Error de red:",e)}finally{m.value=!1}};return j(()=>{f(),window.addEventListener("resize",g),g()}),(e,a)=>{const p=s("a-button"),i=s("a-popconfirm"),H=s("a-menu-item"),N=s("a-menu"),L=s("a-dropdown"),T=s("a-table"),$=s("a-tag"),U=s("a-pagination");return c(),w(Q,null,[l("div",null,[ne,q(l("div",se,null,512),[[P,!m.value]]),n(T,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:b.value},columns:M,"data-source":v.value,pagination:!1,loading:m.value,size:"small"},{bodyCell:o(({column:_,record:r})=>[_.dataIndex=="date"?(c(),w("div",le,u(R(r.created_at)),1)):h("",!0),_.dataIndex=="user"?(c(),w("div",ie,u(r.profile.name)+" "+u(r.profile.lastname)+" "+u(r.profile.middlename),1)):h("",!0),_.dataIndex=="download"?(c(),D(p,{key:2,size:"small",onClick:Y=>z(r.path),type:"primary",ghost:"",loading:d.value[r.path]},{icon:o(()=>[n(y(J))]),default:o(()=>[C(" Descargar ")]),_:2},1032,["onClick","loading"])):h("",!0),_.dataIndex=="actions"?(c(),D(L,{key:3,trigger:["click"]},{overlay:o(()=>[n(N,null,{default:o(()=>[n(H,null,{default:o(()=>[n(i,{title:"Â¿Seguro de eliminar?",onConfirm:Y=>O(r)},{icon:o(()=>[n(y(W),{style:{color:"red"}})]),default:o(()=>[re]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[l("a",{class:"ant-dropdown-link",onClick:a[0]||(a[0]=K(()=>{},["prevent"]))},[n(p,{shape:"circle",icon:X(y(oe))},null,8,["icon"])])]),_:2},1024)):h("",!0)]),_:1},8,["scroll","data-source","loading"])]),l("div",de,[l("span",null,[n($,{color:"blue"},{default:o(()=>[l("b",null,u(v.value.length),1)]),_:1}),C(" Archivos Subidos")]),n(U,{size:"small",pageSize:20,total:k.value,onChange:B,showSizeChanger:!1},null,8,["total"])])],64)}}};export{pe as default};
