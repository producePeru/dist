import{N as q,r as _,a as se,k as de,M as he,b as c,o as n,d as y,c as o,w as d,e as U,F as M,y as ye,s as b,v as m,h as k,O as be,i as T,m as N,B as R,g as De,J as we,K as xe,t as F,R as ie,W as Ee,L as Ce}from"./index-a63373d2.js";import{_ as Ie}from"./icoexcel-1b303edf.js";import{u as re}from"./selectes-627391e1.js";import"./es-aa02affb.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";import{S as Ne}from"./SaveOutlined-eb097a10.js";import{M as ke}from"./MoreOutlined-ea85abb3.js";const Oe={numberDocument:{type:"iSearch",label:"Número de documento",name:"numberDocument",required:!0,message:"Ingresar Número de documento",disabled:!1,max:11},namePerson:{type:"iText",label:"Nombre",name:"namePerson",required:!0,message:"Escribe nombre",disabled:!0},city_id:{type:"iSelectWrite",label:"Región del negocio",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelectWrite",label:"Provincia del negocio",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelectWrite",label:"Distrito del negocio",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"Seleccionar estado",disabled:!0},divider:{type:"iDivider"},ruc:{type:"iSearch",label:"Número de RUC",name:"ruc",required:!1,message:"Escribe el número de RUC",disabled:!1,max:11},component_1:{type:"iSelectWrite",is:"component",label:"Componente 1",name:"component_1",required:!0,message:"Seleccionar componente 1",disabled:!1},component_2:{type:"iSelectWrite",is:"component",label:"Componente 2",name:"component_2",required:!0,message:"Seleccionar componente 2",disabled:!1},component_3:{type:"iSelectWrite",is:"component",label:"Componente 3",name:"component_3",required:!1,message:"Seleccionar componente 3",disabled:!1},startDate:{type:"iDate",label:"Día Inicio",name:"startDate",required:!0,message:"Seleccionar fecha de inicio",placeholder:"año-mes-día"},endDate:{type:"iDate",label:"Día Fin",name:"endDate",required:!0,message:"Seleccionar fecha de fin",placeholder:"año-mes-día"}};const Ue={class:"grid-planes"},Ae="DD/MM/YYYY",Re={__name:"NuevoPlanAccion",props:["info"],emits:["closeDraw"],setup(z,{emit:w}){q.locale("es");const O=JSON.parse(localStorage.getItem("profile")),D=re(),I=w,E=z;D.$patch({cities:D.cities}),D.fetchCities();const P=_(Oe),A=_(!1),S=_(null),H=[{label:"DESARROLLO PRODUCTIVO",value:1},{label:"DIGITALIZACIÓN",value:2},{label:"FINANZAS",value:3},{label:"FORMALIZACION",value:4},{label:"GESTIÓN EMPRESARIAL",value:5}],J=[{value:1,label:"DNI"},{value:2,label:"RUC"}],B=[{label:"Si",value:"yes"},{label:"No",value:"no"}],e=se({numberDocument:null,component_1:null,component_2:null,component_3:null,ruc:null}),Y=()=>{e.numberDocument=null,e.component_1=null,e.component_2=null,e.component_3=null,e.ruc=null,e.idPerson=null,e.namePerson=null,e.city_id=null,e.province_id=null,e.district_id=null,e.gender_id=null,e.sick=null,e.startDate=null,e.endDate=null},K=t=>{const l=Object.keys(e).reduce((r,v)=>(v!==t&&e[v]!==null&&r.push(e[v]),r),[]);return H.filter(r=>!l.includes(r.value))},Q=()=>{const t=e.ruc;return t&&!/^\d{11}$/.test(t)?(N.error("El número de RUC debe contener exactamente 11 dígitos numéricos."),{valid:!1}):t&&!/^(10|15|20)/.test(t)?(N.error("El número de RUC debe comenzar con 10, 15 o 20."),{valid:!1}):{valid:!0}},X=t=>{if(!t)return!1;const l=e.startDate?q(e.startDate):null;return l&&t.isBefore(l,"day")||t.isAfter(q().endOf("day"),"day")},ee=t=>{e[t]=e[t].replace(/\D/g,"")},L=(t,l)=>{const r=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(r)},$=async t=>{if(!e.numberDocument)return N.warning("Ingrese un número a buscar...");try{if(t=="numberDocument"){S.value=t;const l=await R({url:`person/data/${e.numberDocument}`,method:"GET"});if(l.status==404)return S.value=null,e.numberDocument=null,N.warning("Este usuario no fue registrado");l.status==200&&(e.idPerson=l.data.id,e.namePerson=l.data.namePerson,e.city_id=l.data.city_id,G(l.data.city_id),e.province_id=l.data.province_id,V(l.data.province_id),e.district_id=l.data.district_id,console.log("FormState",l.data.gender_id),e.sick=l.data.sick)}if(t=="ruc"){S.value=t;const l=await R({url:`plans-action/components/${e.ruc}`,method:"GET"});if(l.status==200){const r=l.data;r.component_1&&(e.component_1=r.component_1),r.component_2&&(e.component_2=r.component_2),r.component_3&&(e.component_3=r.component_3),r.endDate&&(e.endDate=q(r.endDate,"YYYY-MM-DD"))}else return S.value=null,e.ruc=null,N.warning("No se han registrado datos con ese número de RUC")}}catch{console.log("Failed to update record")}finally{S.value=null}},G=t=>{e.province_id=null,e.district_id=null,D.fetchProvinces(t)},V=t=>{e.district_id=null,D.fetchDistricts(t)},W=(t,l)=>{},Z=async()=>{A.value=!0;const t=Q();if(e.ruc&&t.valid===!1){A.value=!1;return}const l={people_id:e.idPerson,cde_id:O.cde_id,component_1:e.component_1,component_2:e.component_2,component_3:e.component_3,ruc:e.ruc,startDate:q(e.startDate).format("YYYY-MM-DD"),endDate:q(e.endDate).format("YYYY-MM-DD"),...E.info&&{idItem:E.info.id}};let r=null;E.info?r="plans-action/update":r="plans-action/create";try{const v=await R({url:`${r}`,method:"POST",data:l});v.status==200&&(N.success(v.message),Y(),I("closeDraw")),v.status==400&&N.warning(v.message)}catch{console.log("Failed to update record")}finally{A.value=!1}};function j(t){t?(e.numberDocument=t.emprendedor_dni,$("numberDocument"),e.ruc=t.ruc,e.component_1=t.component_1_id,e.component_2=t.component_2_id,e.component_3=t.component_3_id):Y()}return de(()=>{E.info&&j(E.info)}),he(()=>E.info,t=>{t&&j(t)}),(t,l)=>{const r=c("a-input"),v=c("a-form-item"),g=c("a-select"),ae=c("a-input-search"),u=c("a-divider"),i=c("a-date-picker"),f=c("a-button"),x=c("a-form");return n(),y("div",null,[o(x,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Z},{default:d(()=>[U("div",Ue,[(n(!0),y(M,null,ye(P.value,(a,te)=>(n(),y(M,{key:te},[a.type==="iText"?(n(),b(v,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:d(()=>[o(r,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSelect"?(n(),b(v,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[a.name=="typeDocument"?(n(),b(g,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:J},null,8,["value","onUpdate:value"])):m("",!0),a.name=="gender_id"?(n(),b(g,{key:1,disabled:a.disabled,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:k(D).genders},null,8,["disabled","value","onUpdate:value","options"])):m("",!0),a.name=="sick"?(n(),b(g,{key:2,disabled:a.disabled,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:B},null,8,["disabled","value","onUpdate:value"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(n(),b(v,{key:2,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[o(ae,{loading:S.value==a.name,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,onSearch:s=>$(a.name),onInput:s=>ee(a.name),onEnterButton:s=>$(a.name),maxlength:a.max},null,8,["loading","value","onUpdate:value","onSearch","onInput","onEnterButton","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDivider"?(n(),b(u,{key:3,dashed:"",style:{"grid-column":"1/3",margin:".5rem 0 1rem 0"}})):m("",!0),a.type==="iSelectWrite"?(n(),b(v,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[a.name=="city_id"?(n(),b(g,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).cities,"filter-option":L,onChange:G},null,8,["value","onUpdate:value","options"])):m("",!0),a.name=="province_id"?(n(),b(g,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).provinces,"filter-option":L,onChange:V,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(n(),b(g,{key:2,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).districts,"filter-option":L,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.is=="component"?(n(),b(g,{key:3,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:K(a.name),"filter-option":L,onChange:s=>W(s,a.name)},null,8,["value","onUpdate:value","options","onChange"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(n(),b(v,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[o(i,{"disabled-date":X,locale:k(be),value:e[a.name],"onUpdate:value":s=>e[a.name]=s,style:{width:"100%"},format:Ae,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),o(v,null,{default:d(()=>[o(f,{class:"btn-produce",type:"primary","html-type":"submit",loading:A.value},{default:d(()=>[T("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},Pe=Se(Re,[["__scopeId","data-v-1459e60a"]]),Te=De.get("token"),Me="https://apituempresa.soporte-pnte.com/api/",Le="http://127.0.0.1:8000/api/",qe=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?Le:Me;async function Ye(z,w){try{w(!0);const O=await we({url:`${qe}${z}`,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Te}`},method:"GET",responseType:"blob"}),D=window.URL.createObjectURL(new Blob([O.data])),I=document.createElement("a");I.href=D;const E=O.headers["content-disposition"],P=E?E.split("filename=")[1].split(";")[0]:"reporte.xlsx";I.setAttribute("download",P),document.body.appendChild(I),I.click(),document.body.removeChild(I)}catch(O){console.error("Error al descargar el archivo:",O)}finally{w(!1)}}const $e=U("h3",{class:"title-produce"},"PLANES DE ACCIÓN",-1),Fe=U("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Ie},null,-1),ze={key:0},Be={key:1,style:{color:"#1677ff"}},Ge={key:0},Ve={key:1},We={key:0,class:"details-plans"},Ze={key:1},je={key:0},He=["onClick"],Je=U("a",null,"Eliminar",-1),Ke={class:"paginator"},la={__name:"PlanesDeAccion",setup(z){const w=JSON.parse(localStorage.getItem("role"));re(),_(null);const O=_(null);_(null);const D=_(!1);_();const I=_(50),E=_([]),P=_(!1),A=_(0),S=_({page:1}),H=_("plans-action/list"),J=_(1200),B=_(window.innerHeight-100),e=_(!1);_(null);const Y=_([{value:"si",label:"SI"},{value:"no",label:"NO"}]),K=_([{value:"aprobado",label:"Aprobado ✔"},{value:"observado",label:"Observado ⚠"}]),Q=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},...w[0].id!=2?[{title:"CENTRO TU EMPRESA",dataIndex:"centro_empresa",fixed:"left",width:150}]:[],...w[0].id!=2?[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180}]:[],...w[0].id!=2?[{title:"DNI ASESOR",dataIndex:"asesor_dni",fixed:"left",width:100,align:"center"}]:[],{title:"RUC",dataIndex:"ruc",width:100,fixed:"left",align:"center"},{title:"NOMBRE DEL EMPRENDEDOR O MYPE",fixed:"left",dataIndex:"emprendedor_nombres",width:170},{title:"REGIÓN DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_region",width:170},{title:"PROVINCIA DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_provincia",width:170},{title:"DISTRITO DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_distrito",width:170},{title:"Genero",dataIndex:"genero",width:60,align:"center"},{title:"Tiene alguna Discapacidad ? (SI / NO)",dataIndex:"discapacidad",width:110,align:"center"},{title:"COMPONENTE 1",dataIndex:"component_1",width:190,align:"center"},{title:"COMPONENTE 2",dataIndex:"component_2",width:190,align:"center"},{title:"COMPONENTE 3",dataIndex:"component_3",width:190,align:"center"},{title:"NÚMERO DE SESIONES",dataIndex:"numberSessions",width:100,align:"center"},{title:"DÍA INICIO",dataIndex:"startDate",width:100,align:"center"},{title:"DÍA FIN",dataIndex:"endDate",width:100,align:"center"},{title:"TOTAL DE DÍAS",dataIndex:"totalDate",width:100,align:"center"},...w[0].id!=2?[{title:"ACTA DE COMPROMISO",dataIndex:"acta",width:160,align:"center"}]:[],...w[0].id!=2?[{title:"CULMINÓ EL PLAN Y ENVIÓ CORREO",dataIndex:"envioCorreo",width:160,align:"center"}]:[],{title:"FECHA ACTUALIZACIÓN",dataIndex:"updated_at",width:140,align:"center"},{title:"ESTADO",dataIndex:"status",width:160,align:"center"},{title:"DETALLES",dataIndex:"detalle",width:220,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],X=async(u,i)=>{try{const f={id:i.id,details:i.details},x=await R({url:"plans-action/details",method:"PUT",data:f});x.status==200&&(N.success(x.message),g())}catch{console.log("Failed to delete")}},ee=async(u,i)=>{try{const f=await R({url:`plans-action/status/${i.id}/${u}`,method:"PUT"});f.status==200&&(N.success(f.message),g())}catch{console.log("Failed to delete")}},L=async u=>{try{const i=await R({url:`plans-action/delete/${u.id}`,method:"DELETE"});i.status==200&&(N.success(i.message),g())}catch{console.log("Failed to delete")}},$=u=>{O.value=u,e.value=!0},G=u=>{D.value=u},V=async()=>{Ye("download/actions-plans",G)},W=async(u,i,f)=>{const x={idPlan:i.id,type:f,value:u},a=await R({url:"plans-action/edit-yes-no",method:"PUT",data:x});a.status==200&&g(),a.status==400&&(N.warning(a.message),g())},Z=()=>{B.value=window.innerHeight-315},j=()=>{O.value=null,e.value=!1,g()},t=se({search:""}),l=()=>{g({search:t.search})},r=()=>{t.search||g()},v=u=>{S.value.page=u,g()},g=async u=>{try{P.value=!0;const i=S.value.page===1?"":S.value,f=u?{...i,...u}:i,{data:x}=await R({url:H.value,method:"GET",params:f});E.value=x.data,A.value=x.total,I.value=x.per_page}catch(i){console.error("Error de red:",i)}finally{P.value=!1}},ae=xe(()=>u=>(S.value.page-1)*I.value+u+1);return de(()=>{g(),window.addEventListener("resize",Z),Z()}),(u,i)=>{const f=c("a-button"),x=c("a-col"),a=c("a-input"),te=c("a-input-group"),s=c("a-row"),ne=c("a-select"),oe=c("a-tag"),ce=c("a-textarea"),le=c("a-menu-item"),ue=c("a-popconfirm"),me=c("a-menu"),pe=c("a-dropdown"),_e=c("a-table"),ve=c("a-pagination"),ge=c("a-drawer");return n(),y("div",null,[$e,o(s,{style:{margin:"1rem 0"}},{default:d(()=>[o(x,{xs:24,md:12,lg:18},{default:d(()=>[o(f,{onClick:i[0]||(i[0]=C=>e.value=!0),type:"primary"},{default:d(()=>[T("NUEVO")]),_:1}),o(f,{class:"btn-excel",loading:D.value,type:"primary",style:{"margin-left":".6rem"},onClick:V},{default:d(()=>[Fe,T(" DESCARGAR ")]),_:1},8,["loading"])]),_:1}),o(x,{xs:24,md:12,lg:6},{default:d(()=>[o(te,{compact:""},{default:d(()=>[o(a,{value:t.search,"onUpdate:value":i[1]||(i[1]=C=>t.search=C),style:{width:"calc(100% - 80px)"},onInput:r},null,8,["value"]),o(f,{type:"primary",disabled:t.search==="",onClick:l},{default:d(()=>[T("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(_e,{bordered:"",scroll:{x:J.value,y:B.value},class:"table-actions",columns:Q,"data-source":E.value,pagination:!1,loading:P.value,size:"small"},{bodyCell:d(({column:C,record:p,index:fe})=>[C.dataIndex==="idx"?(n(),y(M,{key:0},[T(F(ae.value(fe)),1)],64)):m("",!0),C.dataIndex==="ruc"?(n(),y(M,{key:1},[p.ruc?(n(),y("span",ze,F(p.ruc),1)):(n(),y("span",Be,"En trámite"))],64)):m("",!0),C.dataIndex==="acta"?(n(),b(ne,{key:2,value:p.actaCompromiso,"onUpdate:value":h=>p.actaCompromiso=h,style:{width:"70%"},options:Y.value,onChange:h=>W(h,p,"actaCompromiso")},null,8,["value","onUpdate:value","options","onChange"])):m("",!0),C.dataIndex==="envioCorreo"?(n(),b(ne,{key:3,value:p.envioCorreo,"onUpdate:value":h=>p.envioCorreo=h,style:{width:"70%"},options:Y.value,onChange:h=>W(h,p,"envioCorreo")},null,8,["value","onUpdate:value","options","onChange"])):m("",!0),C.dataIndex==="status"?(n(),y(M,{key:4},[k(w)[0].id!=2?(n(),y("div",Ge,[o(ne,{value:p.status,"onUpdate:value":h=>p.status=h,options:K.value,style:{width:"90%"},onChange:h=>ee(h,p)},null,8,["value","onUpdate:value","options","onChange"])])):(n(),y("div",Ve,[o(oe,{color:p.status=="observado"?"orange":"green"},{default:d(()=>[T(F(p.status),1)]),_:2},1032,["color"])]))],64)):m("",!0),C.dataIndex==="detalle"?(n(),y(M,{key:5},[k(w)[0].id!=2?(n(),y("div",We,[o(ce,{value:p.details,"onUpdate:value":h=>p.details=h,rows:1,maxlength:"255"},null,8,["value","onUpdate:value"]),o(f,{class:"details-plans-btn",type:"text",icon:ie(k(Ne)),onClick:h=>X(h,p)},null,8,["icon","onClick"])])):(n(),y("div",Ze,[U("p",null,F(p.details),1)]))],64)):m("",!0),C.dataIndex=="actions"?(n(),y(M,{key:6},[p.status=="observado"||k(w)[0].id!=2?(n(),y("div",je,[o(pe,{trigger:["click"]},{overlay:d(()=>[o(me,null,{default:d(()=>[o(le,null,{default:d(()=>[U("a",{onClick:h=>$(p)},"Editar",8,He)]),_:2},1024),o(le,null,{default:d(()=>[o(ue,{title:"¿Seguro de eliminar?",onConfirm:h=>L(p)},{icon:d(()=>[o(k(Ee),{style:{color:"red"}})]),default:d(()=>[Je]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:d(()=>[U("a",{class:"ant-dropdown-link",onClick:i[2]||(i[2]=Ce(()=>{},["prevent"]))},[o(f,{shape:"circle",icon:ie(k(ke)),size:"small"},null,8,["icon"])])]),_:2},1024)])):m("",!0)],64)):m("",!0)]),_:1},8,["scroll","data-source","loading"]),U("div",Ke,[U("span",null,[o(oe,{color:"blue"},{default:d(()=>[U("b",null,F(A.value),1)]),_:1}),T("Registros")]),o(ve,{size:"small",total:A.value,pageSize:I.value,onChange:v,showSizeChanger:!1},null,8,["total","pageSize"])]),o(ge,{open:e.value,"onUpdate:open":i[3]||(i[3]=C=>e.value=C),title:"Agregar Plan de Acción",placement:"right",width:"650"},{default:d(()=>[o(Pe,{onCloseDraw:j,info:O.value},null,8,["info"])]),_:1},8,["open"])])}}};export{la as default};
