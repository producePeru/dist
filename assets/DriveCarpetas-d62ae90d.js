import{c as a,A as K,g as ee,r as v,x as te,k as V,b as m,o as f,d as w,e as r,i as A,t as g,w as l,s as E,q as B,h as I,N as ae,Q as oe,I as ne,O as le,F as j,z as D,m as M,G as se,P as re,a as ie,v as ce,R as de,S as ue,T as me,U as pe,p as _e,j as ve}from"./index-409cdec1.js";import{M as fe}from"./MoreOutlined-162b6630.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32z"}}]},name:"folder",theme:"filled"};const ye=ge;function L(c){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?Object(arguments[o]):{},d=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(t).filter(function(p){return Object.getOwnPropertyDescriptor(t,p).enumerable}))),d.forEach(function(p){we(c,p,t[p])})}return c}function we(c,o,t){return o in c?Object.defineProperty(c,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):c[o]=t,c}var P=function(o,t){var d=L({},o,t.attrs);return a(K,L({},d,{icon:ye}),null)};P.displayName="FolderFilled";P.inheritAttrs=!1;const be=P;const Fe={style:{color:"#959595","font-weight":"300"}},Ce=r("br",null,null,-1),ke={key:0},Ee={key:1},De=r("a",null,"Eliminar",-1),Se={class:"paginator-drive"},xe={__name:"ArchivosFolder.component",props:["idFile"],emits:["handleDeleteItem"],setup(c,{emit:o}){const t=c,d=o,p="https://apituempresa.soporte-pnte.com/api/",O="http://127.0.0.1:8000/api/",$=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?O:p,u=ee.get("token"),b=v({}),C=v([]),S=v(!1),k=v(0),U=[{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],q=()=>{t.idFile&&(C.value=t.idFile.dataSource,k.value=t.idFile.total)},z=async s=>{try{const _=await D({url:`drive/delete-file/${s.id}`,method:"DELETE"});M.success(_.message);const n={id:t.idFile.id,name:t.idFile.nameFolder};d("handleDeleteItem",n)}catch(_){console.error("Error de red:",_)}},R=async s=>{b.value={...b.value,[s]:!0};try{const _=await se.get(`${$}drive/download/${s}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${u}`}}),n=window.URL.createObjectURL(new Blob([_.data])),h=document.createElement("a");h.href=n,h.setAttribute("download",s),document.body.appendChild(h),h.click(),document.body.removeChild(h)}catch(_){console.error("Error al descargar el archivo",_)}finally{b.value={...b.value,[s]:!1}}},e=s=>re(s).format("DD/MM/YYYY HH:mm A"),i=v(window.innerHeight-100),y=()=>{i.value=window.innerHeight-300};te(()=>{window.removeEventListener("resize",y)});const N=v({page:1}),H=s=>{N.value.page=s,x()},x=async()=>{try{S.value=!0;const{data:s}=await D({url:`drive/data-files/${t.idFile}`,method:"GET"});C.value=s.data,k.value=s.total}catch(s){console.error("Error de red:",s)}finally{S.value=!1}};return V(()=>{window.addEventListener("resize",y),y()}),(s,_)=>{const n=m("a-button"),h=m("a-popconfirm"),G=m("a-menu-item"),Y=m("a-menu"),Q=m("a-dropdown"),Z=m("a-table"),J=m("a-tag"),W=m("a-pagination");return f(),w(j,null,[r("div",null,[r("h3",null,[A("ARCHIVOS "),r("span",Fe,"/ "+g(t.idFile.nameFolder),1)]),Ce,a(Z,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:i.value},columns:U,"data-source":C.value,pagination:!1,loading:S.value,size:"small"},{bodyCell:l(({column:T,record:F})=>[T.dataIndex=="date"?(f(),w("div",ke,g(e(F.created_at)),1)):E("",!0),T.dataIndex=="user"?(f(),w("div",Ee,g(F.profile.name)+" "+g(F.profile.lastname)+" "+g(F.profile.middlename),1)):E("",!0),T.dataIndex=="download"?(f(),B(n,{key:2,size:"small",onClick:X=>R(F.path),type:"primary",ghost:"",loading:b.value[F.path]},{icon:l(()=>[a(I(ae))]),default:l(()=>[A(" Descargar ")]),_:2},1032,["onClick","loading"])):E("",!0),T.dataIndex=="actions"?(f(),B(Q,{key:3,trigger:["click"]},{overlay:l(()=>[a(Y,null,{default:l(()=>[a(G,null,{default:l(()=>[a(h,{title:"Â¿Seguro de eliminar?",onConfirm:X=>z(F)},{icon:l(()=>[a(I(oe),{style:{color:"red"}})]),default:l(()=>[De]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:l(()=>[r("a",{class:"ant-dropdown-link",onClick:_[0]||(_[0]=ne(()=>{},["prevent"]))},[a(n,{shape:"circle",icon:le(I(fe))},null,8,["icon"])])]),_:2},1024)):E("",!0)]),_:1},8,["scroll","data-source","loading"])]),r("div",null,g(q()),1),r("div",Se,[r("span",null,[a(J,{color:"blue"},{default:l(()=>[r("b",null,g(C.value.length),1)]),_:1}),A(" Archivos Subidos")]),a(W,{size:"small",pageSize:20,total:k.value,onChange:H,showSizeChanger:!1},null,8,["total"])])],64)}}};const Ae=c=>(_e("data-v-00ce7403"),c=c(),ve(),c),Ie={key:0},Oe=Ae(()=>r("h3",null,"MIS CARPETAS",-1)),$e={class:"file-wrapper"},Re={class:"file-options"},Te=["onClick"],Ue=["onClick"],qe={class:"text"},ze={key:1,class:"section-table"},Ne={__name:"DriveCarpetas",setup(c){const o=v(null),t=v("files"),d=v(!1),p=v(!1),O=v(null),$=v(null),u=ie({name:"",color:"#000000"}),b=()=>{d.value=!1,u.name="",u.color="#000000",o.value=null},C=()=>{d.value=!0},S=e=>{k(e)},k=async e=>{console.log("qqqqqqqqq",e);try{p.value=!0;const{data:i}=await D({url:`drive/data-files/${e.id}`,method:"GET"}),y={id:e.id,dataSource:i.data,total:i.total,nameFolder:e.name};$.value=y,t.value="table"}catch(i){console.error("Error de red:",i)}finally{p.value=!1}},U=e=>{u.name=e.name,u.color=e.color,d.value=!0,o.value=e.id},q=async()=>{p.value=!0;try{let e;o.value?e=await D({url:`drive/update-file/${o.value}`,method:"PUT",data:u}):e=await D({url:"drive/create-file",method:"POST",data:u}),e.status==200&&(u.name=null,d.value=!1,M.success(e.message),R(),o.value=null)}catch{M.error("No tienes permisos")}finally{p.value=!1}},z=()=>{console.log("Failed:")},R=async()=>{try{const{data:e}=await D({url:"drive/files",method:"GET"});O.value=e}catch(e){console.error("Error de red:",e)}};return V(()=>{R()}),(e,i)=>{const y=m("a-button"),N=m("a-popover"),H=m("a-input"),x=m("a-form-item"),s=m("a-form"),_=m("a-drawer");return f(),w("div",null,[t.value=="files"?(f(),w("section",Ie,[Oe,a(y,{style:{margin:"1rem 0 1.5rem 0"},class:"btn-produce",type:"primary",onClick:C},{default:l(()=>[A("NUEVO")]),_:1}),r("div",$e,[(f(!0),w(j,null,ce(O.value,n=>(f(),w("div",{class:"file",key:n.id},[a(N,{trigger:"click"},{content:l(()=>[r("div",Re,[r("span",{onClick:h=>k(n)},"Abrir",8,Te),r("span",{onClick:h=>U(n)},"Editar",8,Ue)])]),default:l(()=>[a(I(be),{class:"ico",style:de({color:n.color})},null,8,["style"])]),_:2},1024),r("span",qe,g(n.name),1)]))),128))])])):E("",!0),t.value=="table"?(f(),w("section",ze,[a(I(ue),{class:"close",onClick:i[0]||(i[0]=n=>t.value="files")}),a(xe,{idFile:$.value,onHandleDeleteItem:S},null,8,["idFile"])])):E("",!0),a(_,{open:d.value,"onUpdate:open":i[3]||(i[3]=n=>d.value=n),title:"Nueva carpeta",placement:"right",onClose:b},{default:l(()=>[a(s,{layout:"vertical",model:u,name:"basic",onFinish:q,onFinishFailed:z},{default:l(()=>[a(x,{label:"Nombre de la carpeta",name:"name",rules:[{required:!0,message:"Escribe un nombre del archivo"}]},{default:l(()=>[a(H,{value:u.name,"onUpdate:value":i[1]||(i[1]=n=>u.name=n)},null,8,["value"])]),_:1}),a(x,{label:"Color de la carpeta",name:"color"},{default:l(()=>[me(r("input",{type:"color","onUpdate:modelValue":i[2]||(i[2]=n=>u.color=n)},null,512),[[pe,u.color]])]),_:1}),a(x,null,{default:l(()=>[a(y,{class:"btn-produce",type:"primary","html-type":"submit",loading:p.value},{default:l(()=>[A(g(o.value?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Be=he(Ne,[["__scopeId","data-v-00ce7403"]]);export{Be as default};
