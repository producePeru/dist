import{_ as J}from"./TableComponent-dcafddd3.js";import{p as D,r as s,k as V,T as Z,a9 as U,b as x,o as r,y as N,d as p,e as o,F as K,v as Q,t as f,z as k,u as X,a as ee,W as R,c as C,w as g,m as H,i as F,ag as ae,n as G,ah as te,j as z}from"./index-617fe921.js";import{C as ne}from"./auto-f256c101.js";import"./es-aae8217e.js";import{u as oe,t as se}from"./timezone-c197f371.js";import{d as le}from"./downloadExcel-0e384af5.js";import"./icoexcel-1b303edf.js";import"./selectes-25eab61a.js";import"./SyncOutlined-d7cd5980.js";import"./MoreOutlined-5f968098.js";const re={key:1},ie={key:1},de={class:"chart-wrapper-diagnostic"},ce={class:"mp-diagnostic-detail"},ue={key:0,class:"hp"},me={key:1,class:"ge"},pe={class:"mp-diagnostic-detail"},he={class:"mp-diagnostic-detail"},_e={class:"mp-diagnostic-detail"},fe={__name:"MPShares",props:["info","statusLoading","valuesChart"],setup(M){D.locale("es"),D.extend(oe),D.extend(se);const c=M,i=s(null),u=s(null);s([0,0]),s("100px");const h=s([]),I=s(!0);function E(){var e,v;if(!i.value)return;u.value&&u.value.destroy();const l=i.value.getContext("2d");u.value=new ne(l,{type:"bar",data:{labels:["HABILIDADES PERSONALES","GESTIÓN EMPRESARIAL"],datasets:[{data:[(e=c.valuesChart)==null?void 0:e.habilidades_personales,(v=c.valuesChart)==null?void 0:v.gestion_empresarial],backgroundColor:["#ff5462","#1890ff"],borderColor:["#ff5462","#1890ff"],borderWidth:1,barThickness:60}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}const S=async l=>{try{if(!l||l.length===0)return;h.value=l,await U(),E()}catch(e){console.error("Error al cargar la información:",e)}},y=()=>{u.value&&(u.value.destroy(),u.value=null),i.value&&i.value.getContext("2d").clearRect(0,0,i.value.width,i.value.height)};return V(async()=>{c.info?S(c.info):I.value=!1}),Z(()=>c.info,async l=>{if(!l||l.length===0){h.value=[],y();return}h.value=l,await U(),E()},{immediate:!0}),(l,e)=>{const v=x("a-skeleton"),A=x("a-empty");return c.statusLoading?(r(),N(v,{key:0,active:""})):(r(),p("div",re,[h.value.length==0?(r(),N(A,{key:0})):(r(),p("div",ie,[o("div",de,[o("canvas",{ref_key:"myChart",ref:i},null,512)]),(r(!0),p(K,null,Q(h.value,(d,O)=>(r(),p("div",{class:"mp-diagnostic-box",key:O},[o("h4",null,f(d.title),1),o("div",ce,[e[0]||(e[0]=o("span",null,"Tipo de componente: ",-1)),d.component=="HABILIDADES PERSONALES"?(r(),p("span",ue,"HABILIDADES PERSONALES")):k("",!0),d.component=="GESTIÓN EMPRESARIAL"?(r(),p("span",me,"GESTIÓN EMPRESARIAL")):k("",!0)]),o("div",pe,[e[1]||(e[1]=o("span",null,"Exponente: ",-1)),o("span",null,f(d.capacitador),1)]),o("div",he,[e[2]||(e[2]=o("span",null,"Fecha y hora: ",-1)),o("span",null,f(d.date)+" - "+f(d.hourStart)+" "+f(d.hourEnd),1)]),o("div",_e,[e[3]||(e[3]=o("span",null,"Modalidad: ",-1)),o("span",null,f(d.modalidad),1)])]))),128))]))]))}}};const ve={class:"layout-content"},ge={key:0,class:"mp-diag-filter"},Ee={class:"mp-diag-filter-icos"},Ce=["onClick"],Ie=["onClick"],be={__name:"mp-diagnosticos",setup(M){JSON.parse(localStorage.getItem("role"));const c=s([]),i=s(0),u=s(150),h=s(null),I=s(!0),E=s(!1);s(!1),X();const S=s(!1),y=s(null),l=s(!1),e=ee({name:null,page:1,capas:null}),v=s([]),A=async t=>{e.capas=t,await w()},d=()=>{y.value=null,open.value=!0},O=async()=>{l.value=!0;try{const t={};e.name&&(t.name=e.name),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),await le("download/mp-export-participants-excel","diagnosticos",t)}catch(t){console.error("Error de red:",t)}finally{l.value=!1}},q=async t=>{e.page=t,await w()},j=async t=>{t&&(e.page=1,await w())},L=async t=>{E.value=!0,I.value=!0;try{const n=await H({url:`mp/detail-share/${t.participant_id}`,method:"GET"});n.status==200&&(y.value=n.data,h.value=n.totals)}catch(n){console.error("Error de red:",n)}finally{I.value=!1}},w=async()=>{try{S.value=!0;const t={page:e.page};e.year&&(t.year=D(e.year).format("YYYY")),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),e.name&&(t.name=e.name),e.capas&&(t.capas=e.capas);const n=await H({url:"mp/participant-diagnostic",method:"GET",params:t}),_=n,T=[{title:"#",dataIndex:"idx",align:"center",width:80,fixed:"left"},{title:"NOMBRE COMPLETO",dataIndex:"nombre_completo",width:160},{title:"APELLIDOS",dataIndex:"apellidos",width:160},{title:"FECHA NACIMIENTO",dataIndex:"fecha_nacimiento",width:100,align:"center"},{title:"CELULAR",dataIndex:"celular",width:90,align:"center"},{title:"TIPO DOCUMENTO",dataIndex:"tipo_documento",width:100,align:"center"},{title:"DOCUMENTO",dataIndex:"doc_number",width:100,align:"center"},{title:"EMAIL",dataIndex:"email",width:200},{title:"RUC",dataIndex:"ruc",width:100,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"actividad",width:160},{title:"RUBRO",dataIndex:"rubro",width:140},{title:"SECTOR ECONÓMICO",dataIndex:"economicSector",width:100},{title:"FECHA DEL DIAGNÓSTICO",dataIndex:"registrado",width:120,align:"center"},{title:"ASISTENCIA EN CAPACITACIONES",dataIndex:"shares",width:150,align:"center"}],b=n.questions.map(a=>({title:a.label,dataIndex:a.model,width:160}));v.value=[...T,...b,{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}];const m=_.data.map((a,Y)=>{const P={idx:Y+1,participant_id:a.participant_id,ruc:a.ruc,nombre_completo:a.nombre_completo,apellidos:a.apellidos,fecha_nacimiento:a.fecha_nacimiento,celular:a.celular,tipo_documento:a.tipo_documento,doc_number:a.doc_number,email:a.email,actividad:a.actividad,rubro:a.rubro,economicSector:a.economicSector,registrado:a.registrado,shares:a.shares};return _.questions.forEach(B=>{const $=a.responses.find(W=>W.question_model===B.model);P[B.model]=$?$.answer:null}),P});c.value=m,i.value=_.total,u.value=_.per_page}catch(t){console.error("Error de red:",t)}finally{S.value=!1}};return V(async()=>{await w()}),R("search",e),R("loading",S),R("loadingFile",l),(t,n)=>{const _=x("a-tag"),T=x("a-menu-item"),b=x("a-drawer");return r(),p("div",ve,[C(J,{title:"DIAGNÓSTICOS DE EMPRESAS",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",columns:v.value,titleSearch:"BUSCAR DNI - RUC - NOMBRES",pageSize:u.value,downloadExcel:!0,nameTotal:"Registros",dataSource:c.value,total:i.value,btnUpdate:!0,onHandleNew:d,onHandleCallFetchData:w,onHandleDownloadExcel:O,onHandleSearch:j,onHandlePaginator:q,heightTable:380},{headerCell:g(({column:m})=>[m.dataIndex==="shares"?(r(),p("div",ge,[n[3]||(n[3]=o("div",null,"ASISTENCIA EN CAPACITACIONES",-1)),o("div",Ee,[C(F(ae),{class:G([{activeobf:e.capas==="up"},"mp-f-ico"]),onClick:n[0]||(n[0]=a=>A("up"))},null,8,["class"]),C(F(te),{class:G([{activeobf:e.capas==="down"},"mp-f-ico"]),onClick:n[1]||(n[1]=a=>A("down"))},null,8,["class"])])])):k("",!0)]),"data-cell":g(({column:m,record:a})=>[m.dataIndex=="shares"?(r(),p("div",{key:0,onClick:Y=>L(a),style:{cursor:"pointer"}},[a.shares<1?(r(),N(_,{key:0,color:"pink"},{default:g(()=>[z(f(a.shares),1)]),_:2},1024)):(r(),N(_,{key:1,color:"blue"},{default:g(()=>[z(f(a.shares),1)]),_:2},1024))],8,Ce)):k("",!0)]),"custom-options":g(({record:m})=>[C(T,null,{default:g(()=>[o("span",{onClick:a=>L(m)}," Detalle ",8,Ie)]),_:2},1024)]),_:1},8,["columns","pageSize","dataSource","total"]),C(b,{open:E.value,"onUpdate:open":n[2]||(n[2]=m=>E.value=m),title:"PARTICIPACIONES",placement:"right",width:"500"},{default:g(()=>[C(fe,{info:y.value,valuesChart:h.value,statusLoading:I.value},null,8,["info","valuesChart","statusLoading"])]),_:1},8,["open"])])}}};export{be as default};
