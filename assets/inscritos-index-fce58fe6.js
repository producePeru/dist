import{l as K,r,a as Y,j as W,X as ve,a6 as Q,o as A,x as ee,h as U,L as Ee,d as G,c as n,R as F,E as be,u as ye,g as he,G as we,Z as Ce,b as i,e as u,w as l,i as L,F as X,a9 as xe,t as z,y as Z,a2 as Se,O as Oe,q as Ie,m as Re,K as Ne}from"./index-98b99797.js";import{_ as Ae}from"./icoexcel-1b303edf.js";import{_ as De}from"./FormComponent-1b6588b4.js";import{u as Te}from"./selectes-518c4b7c.js";import"./es-b1c98a74.js";import{M as ke}from"./MoreOutlined-8c20aaf9.js";import"./vue-quill.esm-bundler-bc30394d.js";import"./quill.snow-7b5b4157.js";/* empty css                                                      */const Le={key:1,class:"f-20"},Ue={__name:"EventosUgoAsistentes",props:["info","typeEvent"],emits:["closeDraw"],setup(V,{emit:D}){K.locale("es");const p=Te(),M=JSON.parse(localStorage.getItem("role")),P=D,_=V;p.fetchCities();const w=r({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!1},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!M.some(t=>t.id==1||t.id==5),rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("Escribe número de documento"));const d=String(s);if(!/^\d+$/.test(d))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(d.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(d.length<3||d.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("El número es requerido"));const d=s.toString();return d.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):d.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(t,s)=>s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!1,message:"Seleccionar"},ruc:{type:"iText",label:"RUC",name:"ruc",required:!1,message:"Escribir nombre",disabled:!1},comercialName:{type:"iText",label:"NOMBRE COMERCIAL",name:"comercialName",required:!1,message:"Escribir nombre",disabled:!1},comercialActivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialActivity",required:!1,message:"Escribir nombre",disabled:!1},..._.typeEvent===3&&{mercado:{type:"iText",label:"MERCADO",name:"mercado",required:!1,message:"Escribir nombre",disabled:!1}}}),v=r(!0),C=r("ACTUALIZAR"),e=Y({}),E=r(!1),x=r(null),m=r({typedocument_id:[],gender_id:[],sick:[]}),S=t=>{console.log("handleInputEvent",t)},b=async t=>{t=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),w.value.dateTramite.disabled=!1)},B=async t=>{},T=async t=>{t=="typedocument_id"&&(m.value.typedocument_id=p.typeDocuments),t=="gender_id"&&(m.value.gender_id=p.genders),t=="sick"&&I()},O=t=>{},I=()=>{m.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"}]},$=async()=>{E.value=!0;const t={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,gender_id:e.gender_id,phone:e.phone,email:e.email,ruc:e.ruc,comercialName:e.comercialName,comercialActivity:e.comercialActivity,mercado:e.mercado,sick:e.sick};try{(await F({url:`events-ugo/update-participant-data-ugo-event/${_.info.id}`,method:"PUT",data:t})).status===200&&(f(),P("closeDraw",!0))}catch(s){console.error("Error:",s);const d=document.getElementsByClassName("ant-drawer-body")[0];d&&(d.scrollTop=0)}finally{E.value=!1}},f=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},k=async t=>{v.value=!0;try{t&&(await p.fetchTypeDocuments(),m.value.typedocument_id=p.typeDocuments,e.typedocument_id=t.typedocument_id,e.documentnumber=t.documentnumber,e.lastname=t.lastname,e.middlename=t.middlename,e.name=t.name,e.phone=t.phone,e.email=t.email,await p.fetchGenders(),m.value.gender_id=p.genders,e.gender_id=t.gender_id,I(),e.sick=t.sick,e.ruc=t.ruc,e.comercialName=t.comercialName,e.comercialActivity=t.comercialActivity,e.mercado=t.mercado)}catch(s){console.error("Error al cargar la información:",s)}finally{v.value=!1}};return W(()=>{_.info&&k(_.info)}),ve(()=>_.info,t=>{t&&k(t)}),Q("formState",e),Q("loadingState",E),(t,s)=>v.value?(A(),ee(U(Ee),{key:0,style:{color:"#00a6db"}})):(A(),G("div",Le,[n(De,{fields:w.value,options:m.value,btnSaveName:C.value,onHandleInputEvent:S,resetSelect:x.value,onHandleChangeSelect:B,onHandleFocusSelect:T,onHandleBlurSelect:O,onHandleChangeClock:b,onOnSubmit:$},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const Me={class:"title-produce"},Pe={style:{color:"var(--secondary)"}},Be=["onClick"],$e={class:"paginator"},Xe={__name:"inscritos-index",props:["idConvenio"],setup(V){K.locale("es");const D=be();ye();const p=JSON.parse(localStorage.getItem("role"))||[],M=he.get("token"),P="https://apituempresa.soporte-pnte.com/api/",_="http://127.0.0.1:8000/api/",w=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?_:P;p.some(o=>o.id===10||o.id===11||o.id===5);const v=r(""),C=r(null),e=r(!1),E=r(null),x=r(!1),m=r(0),S=r(50),b=r({page:0}),B=r(1200),T=r([]),O=r(!1);r(!1);const I=r(window.innerHeight-100),$=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGISTRADO",dataIndex:"created_at",fixed:"left",width:120,align:"center"},{title:"APELLIDOS",dataIndex:"lastname",fixed:"left",width:160},{title:"NOMBRES ",dataIndex:"name",width:160,fixed:"left"},{title:"TIPO DOCUMENTO",dataIndex:"typedocument_name",width:100,align:"center"},{title:"NÚMERO DE DOCUMENTO",dataIndex:"documentnumber",align:"center",width:140},{title:"CELULAR",dataIndex:"phone",width:150,align:"center"},{title:"CORREO",dataIndex:"email",width:250},{title:"GÉNERO",dataIndex:"gender_name",align:"center",width:100},{title:"RUC",dataIndex:"ruc",align:"center",width:120},{title:"NOMBRE COMERCIAL",dataIndex:"comercialName",align:"center",width:140},{title:"RUBRO / ACTIVIDAD COMERCIAL",dataIndex:"comercialActivity",align:"center",width:200},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],f=Y({search:""}),k=()=>{y(),e.value=!1},t=o=>{E.value=o,e.value=!0},s=()=>{let o={search:f.search};y(o)},d=()=>{f.search||y()},te=o=>{b.value.page=o,y()},q=()=>{I.value=window.innerHeight-320},ae=async o=>{try{const a=await F({url:`events-ugo/remove-participant-ugo-event/${o.id}`,method:"DELETE"});a.status==200&&(y(),Re.success(a.message))}catch(a){console.error("Error de red:",a)}},ne=we(()=>o=>b.value.page*S.value+o+1),y=async o=>{try{O.value=!0;let a;a=b.value.page==0?"":b.value,a=o?{...a,...o}:a;const R=D.params.slug,g=await F({url:`attendance/applicants/${R}`,method:"GET",params:a});v.value=g.nameEvent,C.value=g.typeEvent;const c=g.data;T.value=c==null?void 0:c.data,m.value=c.total,S.value=c.per_page}catch(a){console.error("Error de red:",a)}finally{O.value=!1}},oe=async()=>{x.value=!0;try{const o=D.params.slug;let a=null;C.value==3?a=`${w}download/attendance-mercado/${o}`:a=`${w}download/attendance/${o}`;const R=await Ne({url:a,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${M}`}}),g=window.URL.createObjectURL(new Blob([R.data])),c=document.createElement("a"),N=`${o}.xlsx`;c.href=g,c.setAttribute("download",N),document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(g),document.body.removeChild(c)}catch(o){console.error("Error downloading file:",o)}finally{x.value=!1}};return Ce(()=>{window.removeEventListener("resize",q)}),W(()=>{window.addEventListener("resize",q),q(),y()}),(o,a)=>{const R=i("router-link"),g=i("a-breadcrumb-item"),c=i("a-breadcrumb"),N=i("a-button"),H=i("a-col"),le=i("a-input"),re=i("a-input-group"),se=i("a-row"),J=i("a-menu-item"),ie=i("a-popconfirm"),de=i("a-menu"),ce=i("a-dropdown"),ue=i("a-table"),me=i("a-tag"),pe=i("a-pagination"),ge=i("a-drawer");return A(),G(X,null,[u("div",null,[n(c,null,{default:l(()=>[n(g,null,{default:l(()=>[n(R,{to:"/admin/eventos-ugo/lista"},{default:l(()=>[n(U(xe)),a[3]||(a[3]=u("span",{class:"fs-13"},"Atrás",-1))]),_:1})]),_:1}),n(g,null,{default:l(()=>[u("h3",Me,[a[4]||(a[4]=L("EVENTOS REGISTRO DE ASISTENCIA - ")),u("span",Pe,z(v.value),1)])]),_:1})]),_:1}),n(se,{style:{margin:"1rem 0"}},{default:l(()=>[n(H,{xs:24,md:12,lg:18},{default:l(()=>[a[6]||(a[6]=u("span",null,null,-1)),n(N,{class:"btn-excel",onClick:oe,loading:x.value,type:"primary"},{default:l(()=>a[5]||(a[5]=[u("img",{width:"20",style:{margin:"-2px 0 0 0"},src:Ae},null,-1)])),_:1},8,["loading"])]),_:1}),n(H,{xs:24,md:12,lg:6},{default:l(()=>[n(re,{compact:""},{default:l(()=>[n(le,{onPressEnter:s,value:f.search,"onUpdate:value":a[0]||(a[0]=h=>f.search=h),style:{width:"calc(100% - 80px)"},onInput:d,placeholder:"Buscar por NOMBRE, DNI o RUC"},null,8,["value"]),n(N,{type:"primary",disabled:f.search==="",onClick:s},{default:l(()=>a[7]||(a[7]=[L("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(ue,{bordered:"",scroll:{x:B.value,y:I.value},class:"table-agreements-ugse",columns:$,"data-source":T.value,pagination:!1,loading:O.value,size:"small"},{bodyCell:l(({column:h,record:j,index:_e})=>[h.dataIndex=="idx"?(A(),G(X,{key:0},[L(z(ne.value(_e)),1)],64)):Z("",!0),h.dataIndex=="actions"?(A(),ee(ce,{key:1,trigger:["click"]},{overlay:l(()=>[n(de,null,{default:l(()=>[n(J,null,{default:l(()=>[u("a",{onClick:fe=>t(j)},"Editar",8,Be)]),_:2},1024),n(J,null,{default:l(()=>[n(ie,{placement:"rightBottom",title:`¿Quieres eliminar ${j.documentnumber} ?`,onConfirm:fe=>ae(j)},{icon:l(()=>[n(U(Se),{style:{color:"red"}})]),default:l(()=>[a[8]||(a[8]=u("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:2},1024)]),default:l(()=>[u("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=Oe(()=>{},["prevent"]))},[n(N,{shape:"circle",icon:Ie(U(ke)),size:"small"},null,8,["icon"])])]),_:2},1024)):Z("",!0)]),_:1},8,["scroll","data-source","loading"])]),u("div",$e,[u("span",null,[n(me,{color:"blue"},{default:l(()=>[u("b",null,z(m.value),1)]),_:1}),a[9]||(a[9]=L("Inscritos"))]),n(pe,{size:"small",total:m.value,pageSize:S.value,onChange:te,showSizeChanger:!1},null,8,["total","pageSize"])]),n(ge,{open:e.value,"onUpdate:open":a[2]||(a[2]=h=>e.value=h),title:"Nueva Feria",placement:"right",width:"650"},{default:l(()=>[n(Ue,{onCloseDraw:k,info:E.value,typeEvent:C.value},null,8,["info","typeEvent"])]),_:1},8,["open"])],64)}}};export{Xe as default};
