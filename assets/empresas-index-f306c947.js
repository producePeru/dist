import{_ as q}from"./TableComponent-81f0c58d.js";import{g as Q,b as g,o as n,y,w as o,c as i,i as F,h as N,K,r as s,a as X,p as Y,k as Z,X as C,d as x,m as R,f as J,t as W,z as d,F as b,j as S,e as O,a2 as ee}from"./index-0c10d00d.js";import{_ as ae}from"./EventosUgo-756f9b65.js";import{d as te}from"./downloadExcel-147ec75b.js";import{g as oe}from"./usePermissions-7602307e.js";import{U as ne}from"./UploadOutlined-ab94cab3.js";import"./es-f8cd8123.js";import"./icoexcel-1b303edf.js";import"./selectes-73b49fbf.js";import"./MoreOutlined-11c25ae6.js";const re={__name:"BtnInportExcel",props:{url:{type:String,default:""}},setup(A){const v=A,h=(localStorage.getItem("token")||Q.get("token")||"").replace(/"/g,""),w=h?`Bearer ${h}`:"",p="https://apituempresa.soporte-pnte.com/api/",c="http://127.0.0.1:8000/api/",E=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?c:p,m=async f=>{if(!w)return N.error("Token no encontrado"),!1;const I=new FormData;I.append("file",f);try{const{data:e}=await K.post(`${E}${v.url}`,I,{headers:{"Content-Type":"multipart/form-data",Authorization:w}});N.success(e.message||"Importación exitosa")}catch(e){console.error(e)}return!1};return(f,I)=>{const e=g("a-button"),D=g("a-upload");return n(),y(D,{style:{"margin-left":"8px"},"before-upload":m,"show-upload-list":!1,accept:".xlsx,.xls,.csv"},{default:o(()=>[i(e,{type:"dashed"},{default:o(()=>[i(F(ne))]),_:1})]),_:1})}}};const se={class:"advisory-table"},le={key:0},de=["onClick"],we={__name:"empresas-index",setup(A){const v=s([]),h=s(0),w=s(150),p=s({}),c=s(!1),E=s(!1),m=s(null),f=s(!1),I=s([]),e=X({year:Y("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),D=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],U=a=>{m.value=a,c.value=!0},M=()=>{_(),c.value=!1},V=()=>{m.value=null,c.value=!0},B=async a=>{try{const t=await R({url:`attendance/delete/${a.id}`,method:"DELETE"});t.status==200&&(_(),N.success(t.message))}catch(t){console.error("Error de red:",t)}},$=async()=>{f.value=!0;try{const a={};e.year&&(a.year=Y(e.year).format("YYYY")),e.range&&(a.dateStart=e.range[0].format("YYYY/MM/DD"),a.dateEnd=e.range[1].format("YYYY/MM/DD")),e.name&&(a.name=e.name),e.orderby&&(a.orderby=e.orderby),e.asesor&&(a.asesor=e.asesor),await te("download/attendance-ugo","Eventos-UGO",a)}catch(a){console.error("Error de red:",a)}finally{f.value=!1}},H=async a=>{e.page=a,await _()},P=async a=>{a&&(e.page=1,await _())},_=async()=>{try{E.value=!0;const a={page:e.page};e.year&&(a.year=Y(e.year).format("YYYY")),e.range&&(a.dateStart=e.range[0].format("YYYY/MM/DD"),a.dateEnd=e.range[1].format("YYYY/MM/DD")),e.name&&(a.name=e.name),e.orderby&&(a.orderby=e.orderby),e.asesor&&(a.asesor=e.asesor);const l=await R({url:"attendance/list",method:"GET",params:a});v.value=l.data.data,h.value=l.data.total,w.value=l.data.per_page}catch(a){console.error("Error de red:",a)}finally{E.value=!1}},L=async()=>{try{const a=await J({url:"select/asesores",method:"GET"});a.status==200&&(I.value=a.data)}catch{console.log("Failed to delete")}};return Z(async()=>{p.value=await oe("eventos-ugo-lista"),await _(),await L()}),C("search",e),C("loading",E),C("loadingFile",f),(a,t)=>{const l=g("a-tag"),k=g("a-menu-item"),G=g("a-popconfirm"),z=g("a-drawer");return n(),x("div",se,[i(q,{title:"EMPRESAS PNTE",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",searchYear:!0,columns:D,titleSearch:"RUC - NOMBRE",pageSize:w.value,nameTotal:"Empresas",dataSource:v.value,total:h.value,btnUpdate:!0,onHandleNew:V,onHandleDownloadExcel:$,onHandleSearch:P,permisos:p.value,onHandleCallFetchData:_,onHandlePaginator:H,btnImport:!0},{header:o(()=>[i(re,{url:"import/events-ugo"})]),"data-cell":o(({column:r,record:u})=>[r.dataIndex=="type_activity"?(n(),x("span",le,W(u.pnte),1)):d("",!0),r.dataIndex=="modality"?(n(),x(b,{key:1},[u.modality=="p"?(n(),y(l,{key:0,color:"blue"},{default:o(()=>t[1]||(t[1]=[S("PRESENCIAL")])),_:1})):d("",!0),u.modality=="v"?(n(),y(l,{key:1,color:"orange"},{default:o(()=>t[2]||(t[2]=[S("VIRTUAL")])),_:1})):d("",!0)],64)):d("",!0),r.dataIndex=="dateDiff"?(n(),x(b,{key:2},[u.finally?(n(),y(l,{key:0,color:"red"},{default:o(()=>t[3]||(t[3]=[S(" FINALIZADO ")])),_:1})):d("",!0)],64)):d("",!0)]),"custom-options":o(({record:r})=>{var u,T;return[(u=p.value)!=null&&u.can_update?(n(),y(k,{key:0},{default:o(()=>[O("a",{onClick:j=>U(r)},"Editar",8,de)]),_:2},1024)):d("",!0),(T=p.value)!=null&&T.can_delete?(n(),y(k,{key:1},{default:o(()=>[i(G,{placement:"rightBottom",title:`¿Quieres eliminar ${r.title} ?`,onConfirm:j=>B(r)},{icon:o(()=>[i(F(ee),{style:{color:"red"}})]),default:o(()=>[t[4]||(t[4]=O("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):d("",!0)]}),_:1},8,["pageSize","dataSource","total","permisos"]),i(z,{open:c.value,"onUpdate:open":t[0]||(t[0]=r=>c.value=r),title:m.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:o(()=>[i(ae,{onCloseDraw:M,dataRow:m.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{we as default};
