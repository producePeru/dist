import{d as Z,e as N,m as y,u as ee,L as ae,o as te}from"./index-0eb75d9d.js";import{u as ne}from"./selectes-b8a6816f.js";import"./es-72d4532a.js";import{g as t,e as oe,r as n,o as r,c as C,w as s,a as o,a6 as c,a5 as m,F as D,ab as se,u as M,aa as f,L as A,x as re,f as le,l as ue,a8 as U}from"./quill-blot-formatter-6fa41065.js";const ie={token:{type:"iText",label:"Token",name:"token",required:!0,message:"Escribir el token",disabled:!0},name:{type:"iText",label:"Nombre",name:"name",required:!0,message:"Escribir nombre",disabled:!0}},de={class:"grid-convenios"},ce={__name:"NuevoToken",emits:["closeDraw"],setup(P,{emit:E}){Z.locale("es");const p=E,d=t(!1),k=t(!1),u=oe({}),w=()=>{u.token=null,u.name=null},x=async()=>{d.value=!0;const I={token:u.token,name:u.name};try{const i=await N({url:"token/create",method:"POST",data:I});i.status==200&&(y.success(i.message),p("closeDraw",!0),w())}catch(i){y.error("Se originÃ³ un error: "+i.message)}finally{d.value=!1}},_=()=>{y.error("Debes de completar todos los espacios requeridos")};return(I,i)=>{const S=n("a-input"),g=n("a-form-item"),O=n("a-button"),h=n("a-form"),L=n("a-spin");return r(),C(L,{spinning:k.value},{default:s(()=>[o(h,{layout:"vertical",model:u,name:"basic",autocomplete:"off",onFinish:x,onFinishFailed:_},{default:s(()=>[c("div",de,[(r(!0),m(D,null,se(M(ie),(l,R)=>(r(),m(D,{key:R},[l.type==="iText"?(r(),C(g,{key:0,name:l.name,label:l.label,rules:[{required:l.required,message:l.message,max:l.max}]},{default:s(()=>[o(S,{value:u[l.name],"onUpdate:value":B=>u[l.name]=B,maxlength:l.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):f("",!0)],64))),128))]),o(g,null,{default:s(()=>[o(O,{type:"primary","html-type":"submit",loading:d.value},{default:s(()=>i[0]||(i[0]=[A("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])}}};const me={key:1},pe={key:1},_e={class:"paginator"},ke={__name:"MisTokens",setup(P){const E=ne();E.$patch({cdes:E.cdes});const p=t(!1),d=t(1);t(0);const k=t(50),u=t([]),w=t(!1),x=t(0);ee();const _=t({page:0}),I=t("token/list"),i=t(1200),S=t(window.innerHeight-100),g=t(!1),O=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:20},{title:"NOMBRE",dataIndex:"name",width:60},{title:"TOKEN",dataIndex:"token",width:120},{title:"TOTAL",dataIndex:"count",width:30,align:"center"},{title:"CREADO",dataIndex:"date",width:50},{title:"ACTIVADO",dataIndex:"status",width:30,align:"center"},{title:"TEST",dataIndex:"test",width:30,align:"center"}],h=()=>{S.value=window.innerHeight-300};re(()=>{window.removeEventListener("resize",h)});const L=a=>te(a).format("DD/MM/YYYY HH:mm A"),l=async a=>{await N({url:`token/update-status/${a.id}`,method:"PUT"})},R=async()=>{g.value=!0;try{const a=await N({url:"user/only-dni/45424747",method:"GET"});if(a.status==429)return y.warning(a.message);if(a.status==401)return y.error(a.message);y.success("Puedes usar este token")}catch(a){console.error("Error de red:",a)}finally{g.value=!1}},B=()=>{p.value=!0},V=()=>{F(),p.value=!1},Y=a=>{_.value.page=a,F()},F=async a=>{try{w.value=!0;let e;e=_.value.page==0?"":_.value,e=a?{...e,...a}:e;const b=await N({url:I.value,method:"GET",params:e}),T=b.data;u.value=T.data,x.value=T.total,k.value=T.per_page,d.value=b.id_active}catch(e){console.error("Error de red:",e)}finally{w.value=!1}},$=le(()=>a=>_.value.page*k.value+a+1);return ue(()=>{F(),window.addEventListener("resize",h),h()}),(a,e)=>{const b=n("a-button"),T=n("a-col"),H=n("a-row"),G=n("a-radio"),K=n("a-radio-group"),j=n("a-table"),X=n("a-tag"),J=n("a-pagination"),Q=n("a-drawer");return r(),m(D,null,[c("div",null,[e[4]||(e[4]=c("h3",{class:"title-produce"},"TOKENS",-1)),o(H,{style:{margin:"1rem 0"}},{default:s(()=>[o(T,{xs:24,md:12,lg:18},{default:s(()=>[o(b,{type:"primary",onClick:B,style:{"margin-right":".5rem"}},{default:s(()=>e[2]||(e[2]=[A("Nuevo Token")])),_:1}),e[3]||(e[3]=c("a",{href:"https://apis.net.pe/app/account/signup",target:"_blank"},"Crear cuenta",-1))]),_:1})]),_:1}),o(j,{bordered:"",scroll:{x:i.value,y:S.value},class:"table-users",columns:O,"data-source":u.value,pagination:!1,loading:w.value,size:"small"},{bodyCell:s(({column:v,record:z,index:W})=>[v.dataIndex=="idx"?(r(),m(D,{key:0},[A(U($.value(W)),1)],64)):f("",!0),v.dataIndex=="date"?(r(),m("div",me,U(L(z.created_at)),1)):f("",!0),v.dataIndex=="status"?(r(),C(K,{key:2,value:d.value,"onUpdate:value":e[0]||(e[0]=q=>d.value=q),onChange:q=>l(z)},{default:s(()=>[o(G,{value:z.id},null,8,["value"])]),_:2},1032,["value","onChange"])):f("",!0),v.dataIndex=="test"?(r(),m(D,{key:3},[d.value==z.id?(r(),C(b,{key:0,primary:"",type:"text",onClick:R,style:{"font-size":"13px"}},{default:s(()=>[g.value?(r(),C(M(ae),{key:0})):(r(),m("span",pe,"PROBAR"))]),_:1})):f("",!0)],64)):f("",!0)]),_:1},8,["scroll","data-source","loading"])]),c("div",_e,[c("span",null,[o(X,{color:"blue"},{default:s(()=>[c("b",null,U(x.value),1)]),_:1}),e[5]||(e[5]=A("Itens"))]),o(J,{size:"small",total:x.value,pageSize:k.value,onChange:Y,showSizeChanger:!1},null,8,["total","pageSize"])]),o(Q,{open:p.value,"onUpdate:open":e[1]||(e[1]=v=>p.value=v),class:"draw-notary","root-class-name":"root-class-name",title:"Tokens",placement:"right",width:"500"},{default:s(()=>[o(ce,{onCloseDraw:V})]),_:1},8,["open"])],64)}}};export{ke as default};
