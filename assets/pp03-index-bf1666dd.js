import{r as M,u as O}from"./xlsx-04f2268f.js";import{r as x,a as U,k as q,b as o,o as m,d as p,e as l,c as t,w as a,j as u,t as b,z as F,F as N,s as j,i as A,v as P,h as k,m as R}from"./index-b953f785.js";import{F as T}from"./FileExcelOutlined-ccb8a8b8.js";import{M as z}from"./MailOutlined-bb343d58.js";const $={class:"email-wrapper"},G={style:{display:"flex",gap:"10px","align-items":"center"}},H={key:0,class:"email-list"},J={key:0,class:"info-card"},K={style:{display:"flex",gap:"10px","align-items":"center"}},Q={style:{color:"#00a6db"}},te={__name:"pp03-index",setup(W){const h=x(!1),B=x([]),i=x([]),_=x(null),s=U({title:null,link:null,dates:null,email:null}),I=async d=>{const e=["xls","xlsx"],c=d.name.split(".").pop().toLowerCase();if(!e.includes(c))return k.error("Por favor, sube un archivo Excel válido (.xls o .xlsx)."),!1;const f=new FileReader;return f.onload=v=>{const y=new Uint8Array(v.target.result),g=M(y,{type:"array"}),w=g.Sheets[g.SheetNames[0]];let n=O.sheet_to_json(w).map(r=>r.Email).filter(r=>!!r);n.length>300&&(k.warning(`Se cargaron solo los primeros 300 correos de un total de ${n.length}.`),n=n.slice(0,300)),i.value=n},f.readAsArrayBuffer(d),!1},V=async()=>{h.value=!0;const d={title:s.title,link:s.link,dates:s.dates,emails:i.value};try{const e=await R({url:"automatic/invitaciones-capacitaciones-pp093",method:"POST",data:d});e.status==200&&(k.success(e.message),i.value=[])}catch(e){k.error("Error al enviar invitaciones"),console.log("error",e)}finally{h.value=!1}};return q(async()=>{}),(d,e)=>{var r,C,L;const c=o("a-select-option"),f=o("a-select"),v=o("a-form-item"),y=o("a-button"),g=o("a-upload"),w=o("a-form"),E=o("a-card"),n=o("a-image");return m(),p(N,null,[l("div",$,[t(E,{title:"Invitaciones a Capacitaciones",bordered:""},{default:a(()=>[t(w,{layout:"vertical",onFinish:V,model:s},{default:a(()=>[t(v,{label:"Elegir un correo",name:"email",rules:[{required:!0,message:"Ingrese un título"}]},{default:a(()=>[t(f,{value:s.email,"onUpdate:value":e[0]||(e[0]=S=>s.email=S),placeholder:"Seleccionar correo de la lista",style:{width:"100%"}},{default:a(()=>[t(c,{value:"lista1"},{default:a(()=>e[1]||(e[1]=[u("Lista 1")])),_:1}),t(c,{value:"lista2"},{default:a(()=>e[2]||(e[2]=[u("Lista 2")])),_:1}),t(c,{value:"lista3"},{default:a(()=>e[3]||(e[3]=[u("Lista 3")])),_:1})]),_:1},8,["value"])]),_:1}),t(v,{label:"Lista de correos (Excel)"},{default:a(()=>[l("div",G,[t(g,{"before-upload":I,"file-list":B.value,"show-upload-list":!1,accept:".xls,.xlsx"},{default:a(()=>[t(y,{type:"primary",icon:j(A(T)),style:{"background-color":"#006e37"}},{default:a(()=>e[4]||(e[4]=[u(" Seleccionar Lista ")])),_:1},8,["icon"])]),_:1},8,["file-list"]),t(y,{"html-type":"submit",loading:h.value,type:"primary",disabled:i.value.length===0,icon:j(A(z))},{default:a(()=>e[5]||(e[5]=[u(" Enviar Invitaciones ")])),_:1},8,["loading","disabled","icon"])])]),_:1})]),_:1},8,["model"]),i.value.length>0?(m(),p("div",H,[e[6]||(e[6]=l("h4",null,"Correos cargados:",-1)),l("ol",null,[(m(!0),p(N,null,P(i.value,(S,D)=>(m(),p("li",{key:D},b(S),1))),128))])])):F("",!0)]),_:1}),_.value?(m(),p("div",J,[l("p",null,[e[7]||(e[7]=u("Correo usado: ")),l("b",null,b((r=_.value)==null?void 0:r.emailAccount),1)]),l("div",K,[e[8]||(e[8]=l("p",null,"Cantidad enviada:",-1)),l("h3",Q,b((C=_.value)==null?void 0:C.count),1)]),t(n,{width:200,src:(L=_.value)==null?void 0:L.image},null,8,["src"])])):F("",!0)]),l("pre",null,b(s),1)],64)}}};export{te as default};
