import{c as n,A as ce,z as H,a as ee,r as k,k as ae,M as oe,b as i,o as s,s as b,w as o,d as y,F,y as te,v,i as A,t as w,B as J,m as j,N as Z,g as se,e as _,h as U,O as de,J as re,S as ie,a6 as me,a4 as pe,a8 as K,u as _e,K as fe,L as ve}from"./index-af55d7e2.js";import"./es-9405d451.js";import{C as ye}from"./CloudUploadOutlined-09d799b6.js";import{E as be}from"./EnvironmentOutlined-2e3cbec8.js";import{T as ge}from"./TeamOutlined-79451bb5.js";import{M as he}from"./MoreOutlined-75a38979.js";var we={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64L128 192v384c0 212.1 171.9 384 384 384s384-171.9 384-384V192L512 64zm312 512c0 172.3-139.7 312-312 312S200 748.3 200 576V246l312-110 312 110v330z"}},{tag:"path",attrs:{d:"M378.4 475.1a35.91 35.91 0 00-50.9 0 35.91 35.91 0 000 50.9l129.4 129.4 2.1 2.1a33.98 33.98 0 0048.1 0L730.6 434a33.98 33.98 0 000-48.1l-2.8-2.8a33.98 33.98 0 00-48.1 0L483 579.7 378.4 475.1z"}}]},name:"safety",theme:"outlined"};const xe=we;function le(S){for(var p=1;p<arguments.length;p++){var c=arguments[p]!=null?Object(arguments[p]):{},D=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(D=D.concat(Object.getOwnPropertySymbols(c).filter(function(g){return Object.getOwnPropertyDescriptor(c,g).enumerable}))),D.forEach(function(g){ke(S,g,c[g])})}return S}function ke(S,p,c){return p in S?Object.defineProperty(S,p,{value:c,enumerable:!0,configurable:!0,writable:!0}):S[p]=c,S}var ne=function(p,c){var D=le({},p,c.attrs);return n(ce,le({},D,{icon:xe}),null)};ne.displayName="SafetyOutlined";ne.inheritAttrs=!1;const Se=ne,Ce={__name:"DrawCompromisos",props:["dataRow"],emits:["closeDraw"],setup(S,{emit:p}){const c=S,D=p,g=H(),r=ee({title:null,type:null,description:null,meta:null}),L={title:{type:"iText",label:"Título del Compromiso",name:"title",required:!0,message:"Escribir el título",disabled:!0,max:100},type:{type:"iSelect",label:"Tipo compromiso",name:"type",required:!0,message:"Seleccionar una opción",disabled:!0},description:{type:"iTextarea",label:"Descripción del compromiso",name:"description",required:!1,message:"Escribir la descripción",disabled:!1,max:200},meta:{type:"iNumber",label:"Meta",name:"meta",required:!1,message:"Escribir la acción",disabled:!0}},E=k(!1),O=[{label:"Aliado",value:"aliado"},{label:"PNTE",value:"pnte"},{label:"Ambos",value:"ambos"}],a=()=>{r.title=null,r.type=null,r.description=null,r.meta=null},q=async()=>{E.value=!0;const f={title:r.title,type:r.type,description:r.description,meta:r.meta,agreement_id:g.params.id};try{const $=c.dataRow?"PUT":"POST",z=c.dataRow?`agreement/update-commitment/${c.dataRow.id}`:"/agreement/create-commitment",C=await J({url:z,method:$,data:f});C.status==200&&(j.success(C.message),D("closeDraw"),a())}catch{j.error("Se presentó un error, los valores son requeridos")}finally{E.value=!1}},P=f=>{const $=r[f]?r[f].trim():"";r[f]=$};function I(f){r.title=f.title,r.type=f.type,r.description=f.description,r.meta=f.meta}return ae(()=>{c.dataRow&&I(c.dataRow)}),oe(()=>c.dataRow,f=>{f?I(f):a()}),(f,$)=>{const z=i("a-input"),C=i("a-form-item"),h=i("a-select"),u=i("a-textarea"),m=i("a-input-number"),B=i("a-button"),x=i("a-form");return s(),b(x,{layout:"vertical",model:r,name:"basic",autocomplete:"off",onFinish:q},{default:o(()=>[(s(),y(F,null,te(L,(l,e)=>(s(),y(F,{key:e},[l.type==="iText"?(s(),b(C,{key:0,name:l.name,label:l.label,rules:[{required:l.required,message:l.message,max:l.max}]},{default:o(()=>[n(z,{value:r[l.name],"onUpdate:value":d=>r[l.name]=d,maxlength:l.max,onBlur:d=>P(l.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iSelect"?(s(),b(C,{key:1,class:"item-max",name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[l.name=="type"?(s(),b(h,{key:0,value:r[l.name],"onUpdate:value":d=>r[l.name]=d,options:O},null,8,["value","onUpdate:value"])):v("",!0)]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iTextarea"?(s(),b(C,{key:2,name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[n(u,{value:r[l.name],"onUpdate:value":d=>r[l.name]=d,rows:3,maxlength:l.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):v("",!0),l.type==="iNumber"?(s(),b(C,{key:3,class:"item-max",name:l.name,label:l.label,rules:[{required:l.required,message:l.message}]},{default:o(()=>[n(m,{value:r[l.name],"onUpdate:value":d=>r[l.name]=d,min:1,max:500,style:{width:"120px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0)],64))),64)),n(C,null,{default:o(()=>[n(B,{type:"primary","html-type":"submit",loading:E.value},{default:o(()=>[A(w(S.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},De={accion:{type:"iText",label:"Nombre de la capacitación",name:"accion",required:!0,message:"Escribir la acción",disabled:!0,max:100,visible:!0},date:{type:"iDate",label:"Fecha",name:"date",required:!0,message:"Seleccionar fecha",disabled:!1},modality:{type:"iSelect",label:"Modalidad",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},address:{type:"iText",label:"Lugar",name:"address",required:!1,message:"Escribir la acción",disabled:!0,max:100,visible:!1},participants:{type:"iNumber",label:"Número de participantes",name:"participants",required:!1,message:"Escribir la acción",disabled:!0},files:{type:"iFile",label:"Archivos (máximo 3 archivos)",name:"files",required:!1,message:"Subir archivos",disabled:!0},details:{type:"iTextarea",label:"Descripción",name:"details",required:!1,message:"Escribir la acción",disabled:!0,max:240,rows:3}};const Oe={class:"form-action"},Re="DD/MM/YYYY",Ue=3,qe=".pdf, .doc, .docx, .xls, .xlsx, .jpeg, .jpg, .png",$e={__name:"DrawAccionesUgse",props:["dataRow"],emits:["closeDraw"],setup(S,{emit:p}){Z.locale("es");const c=S,D=se.get("token"),g="https://apituempresa.soporte-pnte.com/api/",r="http://127.0.0.1:8000/api/",L=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?r:g,E=p,O=k(De),a=ee({}),q=k(!1),P=H(),I=[{label:"Virtual",value:"v"},{label:"Presencial",value:"p"}],f=e=>{const d=a[e]?a[e].trim():"";a[e]=d},$=()=>{a.accion=null,a.date=null,a.modality=null,a.address=null,a.participants=null,a.file1=null,a.file2=null,a.file3=null,a.details=null,m.value=[]},z=e=>e==="modality"?I:[],C=(e,d)=>{const R=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return d.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(R)},h=e=>{e=="p"?O.value.address.visible=!0:O.value.address.visible=!1,a.address=null},u=async()=>{q.value=!0;const e={accion:a.accion,date:Z(a.date).format("YYYY-MM-DD"),modality:a.modality,address:a.address,participants:a.participants,file1:a.file1,file2:a.file2,file3:a.file3,details:a.details,agreement_id:P.params.id,commitment_id:c.dataRow.id};try{const d=await re.post(`${L}agreement/commitments`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${D}`}});d.data.status==200&&(j.success(d.data.message),O.value.address.visible=!1,E("closeDraw"),$())}catch{j.error("Error al subir")}finally{q.value=!1}},m=k([]),B=({onSuccess:e})=>{setTimeout(()=>{e("ok")},0)},x=e=>m.value.length>=Ue?(j.error("Solo puedes cargar un máximo de 3 archivos"),!1):(a.file1?a.file2?a.file3||(a.file3=e):a.file2=e:a.file1=e,m.value.push({uid:e.uid,name:e.name,status:"done"}),!1),l=e=>{const d=m.value.findIndex(R=>R.uid===e.uid);d===0?a.file1=null:d===1?a.file2=null:d===2&&(a.file3=null),m.value.splice(d,1)};return(e,d)=>{const R=i("a-input"),N=i("a-form-item"),Q=i("a-date-picker"),W=i("a-select"),V=i("a-input-number"),T=i("a-textarea"),Y=i("a-button"),X=i("a-upload"),G=i("a-form");return s(),y("section",null,[n(G,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:u},{default:o(()=>[_("div",Oe,[(s(!0),y(F,null,te(O.value,(t,ue)=>(s(),y(F,{key:ue},[t.type==="iText"&&t.visible?(s(),b(N,{key:0,name:t.name,label:t.label,rules:[{required:t.required,message:t.message,max:t.max}]},{default:o(()=>[n(R,{value:a[t.name],"onUpdate:value":M=>a[t.name]=M,maxlength:t.max,onBlur:M=>f(t.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iDate"?(s(),b(N,{key:1,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(Q,{locale:U(de),value:a[t.name],"onUpdate:value":M=>a[t.name]=M,style:{width:"100%"},format:Re,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iSelect"?(s(),b(N,{key:2,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(W,{value:a[t.name],"onUpdate:value":M=>a[t.name]=M,options:z(t.name),"show-search":"","filter-option":C,onChange:h},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iNumber"?(s(),b(N,{key:3,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(V,{value:a[t.name],"onUpdate:value":M=>a[t.name]=M,min:1,max:200},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iTextarea"?(s(),b(N,{key:4,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(T,{value:a[t.name],"onUpdate:value":M=>a[t.name]=M,rows:t.rows,maxlength:t.max},null,8,["value","onUpdate:value","rows","maxlength"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iFile"?(s(),b(N,{key:5,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:o(()=>[n(X,{"before-upload":x,"custom-request":B,"file-list":m.value,accept:qe,multiple:!0,"on-remove":l,"show-upload-list":""},{default:o(()=>[n(Y,null,{default:o(()=>[n(U(ye)),A(" Cargar archivos ")]),_:1})]),_:1},8,["file-list"])]),_:2},1032,["name","label","rules"])):v("",!0)],64))),128))]),n(N,null,{default:o(()=>[n(Y,{type:"primary","html-type":"submit",loading:q.value},{default:o(()=>[A("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Ae={class:"convenios-header"},Te={key:0},Ee={key:"comment-nested-reply-to",class:"ico-delete-comp"},Ie={class:"convenios-description"},Ne={style:{"white-space":"normal"}},Me={key:0,class:"conv-part"},Le={key:1,class:"conv-part const-mod"},Pe=_("span",null," Modalidad: ",-1),ze={class:"conv-files"},Be=["onClick"],Fe=["onClick"],Ye=["onClick"],Ve={__name:"DrawAccionesDetalle",props:["dataRow"],setup(S){Z.locale("es");const p=S,c=JSON.parse(localStorage.getItem("role")),D=JSON.parse(localStorage.getItem("profile")),g=se.get("token"),r="https://apituempresa.soporte-pnte.com/api/",L="http://127.0.0.1:8000/api/",E=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?L:r;ee({}),k(!1);const O=k(!1),a=H(),q=k(null),P=k([]),I=ie(me,{style:{fontSize:"18px"},spin:!0}),f=h=>Z(h).format("DD/MM/YYYY"),$=async(h,u)=>{q.value=u;try{const m=await re.get(`${E}agreement/commitment-download/${h}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${g}`}}),B=window.URL.createObjectURL(new Blob([m.data])),x=document.createElement("a");x.href=B,x.setAttribute("download",u),document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch(m){console.error("Error al descargar el archivo",m)}finally{q.value=null}},z=async h=>{try{(await J({url:`/agreement/commitment-delete/${h}`,method:"DELETE"})).status==200&&C()}catch(u){console.error("Error de red:",u)}},C=async h=>{try{O.value=!0;const u=a.params.id,m=await J({url:`/agreement/commitments/${h.id}`,method:"GET"});P.value=m.data}catch(u){console.error("Error de red:",u)}finally{O.value=!1}};return k([]),ae(()=>{p.dataRow&&C(p.dataRow)}),oe(()=>p.dataRow,h=>{h&&C(h)}),(h,u)=>{const m=i("a-empty"),B=i("a-avatar"),x=i("a-spin"),l=i("a-comment");return s(),y("section",null,[n(x,{spinning:O.value},{default:o(()=>[P.value.length<1?(s(),b(m,{key:0})):(s(!0),y(F,{key:1},te(P.value,(e,d)=>(s(),b(l,{key:d},{author:o(()=>[_("div",Ae,[_("span",null,w(e.profile.name)+" "+w(e.profile.lastname)+" "+w(e.profile.middlename),1),U(D).user_id==e.profile.id||U(c).some(R=>R.id===8)?(s(),y("div",Te,[_("span",Ee,[n(U(pe),{onClick:R=>z(e.id)},null,8,["onClick"])])])):v("",!0)])]),avatar:o(()=>[n(B,null,{default:o(()=>[A(w(e.profile.name.charAt(0)),1)]),_:2},1024)]),content:o(()=>[_("div",Ie,[_("div",null,[_("b",null,w(e.accion),1),_("span",null," - "+w(f(e.date)),1)]),_("p",Ne,w(e.details),1),e.address?(s(),y("div",Me,[n(U(be)),A(" "+w(e.address),1)])):v("",!0),e.participants?(s(),y("div",Le,[_("div",null,[n(U(ge)),A(" "+w(e.participants)+" participantes ",1)]),_("div",null,[n(U(Se)),Pe,A(w(e.modality=="v"?"Virtual":"Presencial"),1)])])):v("",!0),_("div",ze,[e.file1_name?(s(),y(F,{key:0},[q.value==e.file1_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>$(e.file1_path,e.file1_name)},[n(U(K)),A(" "+w(e.file1_name),1)],8,Be))],64)):v("",!0),e.file2_name?(s(),y(F,{key:1},[q.value==e.file2_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>$(e.file2_path,e.file2_name)},[n(U(K)),A(" "+w(e.file2_name),1)],8,Fe))],64)):v("",!0),e.file3_name?(s(),y(F,{key:2},[q.value==e.file2_name?(s(),b(x,{key:0,indicator:U(I)},null,8,["indicator"])):(s(),y("a",{key:1,onClick:R=>$(e.file3_path,e.file3_name)},[n(U(K)),A(" "+w(e.file3_name),1)],8,Ye))],64)):v("",!0)])])]),_:2},1024))),128))]),_:1},8,["spinning"])])}}};const je=_("h4",null,"COMPROMISOS",-1),Ge={style:{margin:".5rem 0 1rem 0",color:"var(--secondary)"}},Je=_("br",null,null,-1),Ze=_("br",null,null,-1),He={style:{"text-transform":"uppercase"}},Qe={key:2},We=["onClick"],Xe=["onClick"],Ke=["onClick"],ea=50,ra={__name:"PageCompromisosUGSE",setup(S){const p=k(!1),c=k(!1),D=k(!1),g=k(null),r=H();_e();const L=k(!1),E=k([]),O=k(!1),a=[{title:"#",dataIndex:"idx",align:"center",width:50},{title:"COMPROMISO",dataIndex:"title",width:120},{title:"TIPO",dataIndex:"type",width:100,align:"center"},{title:"META",dataIndex:"meta",width:100,align:"center"},{title:"CATEGORÍA",dataIndex:"description",width:180},{title:"AVANCES",dataIndex:"avances",width:80,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],q=u=>{p.value=!0,g.value=u,c.value=!0},P=u=>{g.value=u,D.value=!0},I=u=>{g.value=u,O.value=!0},f=()=>{h(),c.value=!1,O.value=!1,p.value=!1},$=()=>{p.value=!1,g.value=null,c.value=!0},z=k({page:1}),C=fe(()=>u=>(z.value.page-1)*ea+u+1),h=async()=>{L.value=!0;try{const u=await J({url:`agreement/all-commitments/${r.params.id}`,method:"GET"});u.status==200&&(E.value=u.data)}catch{}finally{L.value=!1}};return ae(()=>{h()}),(u,m)=>{const B=i("router-link"),x=i("a-breadcrumb-item"),l=i("a-breadcrumb"),e=i("a-button"),d=i("a-tag"),R=i("a-menu-item"),N=i("a-menu"),Q=i("a-dropdown"),W=i("a-table"),V=i("a-drawer");return s(),y("section",null,[n(l,null,{default:o(()=>[n(x,null,{default:o(()=>[n(B,{to:"/admin/convenios/ugse"},{default:o(()=>[A("Lista de convenios")]),_:1})]),_:1}),n(x,null,{default:o(()=>[je]),_:1})]),_:1}),_("h3",Ge,w(u.$router.currentRoute.value.params.name),1),n(e,{type:"primary",onClick:$},{default:o(()=>[A("NUEVO")]),_:1}),Je,Ze,n(W,{bordered:"",scroll:{x:200},class:"table-compromisos",columns:a,"data-source":E.value,pagination:!1,loading:L.value,size:"small"},{bodyCell:o(({column:T,record:Y,index:X})=>[T.dataIndex=="idx"?(s(),y(F,{key:0},[A(w(C.value(X)),1)],64)):v("",!0),T.dataIndex=="type"?(s(),b(d,{key:1},{default:o(()=>[_("span",He,w(Y.type),1)]),_:2},1024)):v("",!0),T.dataIndex=="avances"?(s(),y("span",Qe,w(Y.commitments.length),1)):v("",!0),T.dataIndex=="actions"?(s(),b(Q,{key:3,trigger:["click"]},{overlay:o(()=>[n(N,null,{default:o(()=>[n(R,null,{default:o(()=>[_("a",{onClick:G=>I(Y)},"Nuevo avance",8,We)]),_:2},1024),n(R,null,{default:o(()=>[_("a",{onClick:G=>P(Y)},"Ver Avances",8,Xe)]),_:2},1024),n(R,null,{default:o(()=>[_("a",{onClick:G=>q(Y)},"Editar",8,Ke)]),_:2},1024)]),_:2},1024)]),default:o(()=>[_("a",{class:"ant-dropdown-link",onClick:m[0]||(m[0]=ve(()=>{},["prevent"]))},[n(e,{shape:"circle",icon:ie(U(he))},null,8,["icon"])])]),_:2},1024)):v("",!0)]),_:1},8,["data-source","loading"]),n(V,{open:c.value,"onUpdate:open":m[1]||(m[1]=T=>c.value=T),title:p.value?"Editar compromiso":"Nuevo compromiso",placement:"right",width:"450px"},{default:o(()=>[n(Ce,{onCloseDraw:f,dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open","title"]),n(V,{open:O.value,"onUpdate:open":m[2]||(m[2]=T=>O.value=T),title:"Registrar un Avance",placement:"right",width:"450px"},{default:o(()=>[n($e,{onCloseDraw:f,dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open"]),n(V,{open:D.value,"onUpdate:open":m[3]||(m[3]=T=>D.value=T),title:"Detalles",placement:"right",width:"600px"},{default:o(()=>[n(Ve,{dataRow:g.value},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{ra as default};
