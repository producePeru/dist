import{_ as ee}from"./TableComponent-2f7b1d05.js";import{p as D,r as s,a as z,k as B,T as ae,W as N,o as $,d as H,c as d,m as Y,h as k,b as R,w as m,e as E,t as P,z as q,y as te,i as ne,a2 as le}from"./index-f83297cf.js";import{_ as oe}from"./FormComponent-49323c9e.js";import{u as j}from"./selectes-9d20b055.js";import"./es-3a34cef2.js";import{_ as se,a as ie}from"./AsignarVistas-651858ee.js";import"./downloadExcel-3e5f39ec.js";import{g as re}from"./usePermissions-02208feb.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-2dfb26a7.js";import"./MoreOutlined-0b36acdc.js";import"./quill.snow-5ac337ed.js";const de={class:"usuarios-pnte"},ce={__name:"UsuariosUgo",props:["info"],emits:["closeDraw"],setup(V,{emit:O}){D.locale("es");const b=s({dni:{type:"iInputSearch",label:"DNI",name:"dni",required:!0,message:"Ingrese el DNI",disabled:!1,max:8,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("Escribe número de documento"));const i=String(c).trim();return/^\d{8}$/.test(i)?Promise.resolve():Promise.reject(new Error("DNI incorrecto."))},trigger:["change","blur"]}]},name:{type:"iText",label:"NOMBRE",name:"name",required:!0,message:"Ingrese el nombre",disabled:!1},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Ingrese el apellido paterno",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Ingrese el apellido materno",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("El número es requerido"));const i=c.toString();return i.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):i.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!1,message:"Seleccione la fecha de nacimiento",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccione el género",disabled:!1},cde_id:{type:"iSelect",label:"CDE",name:"cde_id",required:!0,message:"Seleccione la CDE",disabled:!1}}),A=O,_=V,v=s("GUARDAR"),e=z({office_id:1}),y=s(!1),l=j(),C=s(null),r=s({gender_id:[],office_id:[],cde_id:[]}),I=a=>{console.log("handleInputEvent",a)},x=async a=>{a=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),b.value.dateTramite.disabled=!1)},L=async a=>{console.log("handleChangeSelect",a)},f=async a=>{a=="gender_id"&&(await l.fetchGenders(),r.value.gender_id=l.genders),a=="office_id"&&(await l.fetchOffices(),r.value.office_id=l.Offices),a=="cde_id"&&(await l.fetchCdes(),r.value.cde_id=l.cdes)},F=async()=>{var c;y.value=!0;const a={dni:e.dni,name:e.name,lastname:e.lastname,middlename:e.middlename,phone:(c=e.phone)==null?void 0:c.toString().trim(),birthday:D(e.birthday).format("YYYY-MM-DD"),gender_id:e.gender_id,office_id:e.office_id,cde_id:e.cde_id,rol:2};try{let i,h=null;_.info?(i=`users/update-user-pnte/${_.info.id}`,h="PUT"):(i="users/register-user-pnte",h="POST");const T=await Y({url:i,method:h,data:a});T.status===200&&(k.success(T.message),w(),A("closeDraw",!0))}catch(i){i.response&&i.response.data&&i.response.data.message?k.error(i.response.data.message):k.error("Ocurrió un error inesperado.");const h=document.getElementsByClassName("ant-drawer-body")[0];h&&(h.scrollTop=0)}finally{y.value=!1}},w=()=>{e.dni=null,e.name=null,e.lastname=null,e.middlename=null,e.phone=null,e.birthday=null,e.gender_id=null,e.office_id=null,e.cde_id=null},U=async a=>{a&&(e.dni=a.dni,e.name=a.name,e.lastname=a.lastname,e.middlename=a.middlename,await l.fetchCdes(),r.value.cde_id=l.cdes,e.cde_id=a.cde_id,await l.fetchOffices(),r.value.office_id=l.Offices,e.office_id=a.office_id,await l.fetchGenders(),r.value.gender_id=l.genders,e.gender_id=a.gender_id,e.phone=a.phone,a.birthday&&(e.birthday=D(a.birthday,"YYYY-MM-DD")))};return B(()=>{_.info&&U(_.info)}),ae(()=>_.info,a=>{a?U(a):w()}),N("formState",e),N("loadingState",y),(a,c)=>($(),H("div",de,[d(oe,{fields:b.value,options:r.value,btnSaveName:v.value,onHandleInputEvent:I,resetSelect:C.value,onHandleChangeSelect:L,onHandleFocusSelect:f,onHandleChangeClock:x,onOnSubmit:F,mayus:!0},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const ue={class:"layout-content app-table"},me={key:0,class:"app-table-cell"},fe=["onClick"],pe=["onClick"],ge=["onClick"],Oe={__name:"list-ugo",setup(V){const O=j(),b=s([]),A=s(0),_=s(150),v=s(!1),e=s(!1),y=s({}),l=s(!1),C=s(!1),r=s(null),I=s(!1),x=s([]),L=s(!1),f=z({year:D("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),F=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"dni",fixed:"left",width:100,align:"center"},{title:"USUARIO",dataIndex:"datos_personales",width:300},{title:"FECHA NACIMIENTO",dataIndex:"birthday",width:100,align:"center"},{title:"OFICINA",dataIndex:"office_name",width:120,align:"center"},{title:"CDE",dataIndex:"cde_name",width:260,align:"center"},{title:"VISTAS ASIGNADAS",dataIndex:"views",width:240},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],w=(t,n)=>{r.value=t,n.value=!0},U=t=>w(t,l),a=t=>w(t,e),c=t=>w(t,v),i=(t,n)=>{const p=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(p)},h=async(t,n)=>{const p={cde_id:t,user_id:n};try{const g=await Y({url:"users/update-cde",method:"PUT",data:p});console.log("response",g)}catch(g){console.log("error",g)}},T=()=>{r.value=null,l.value=!0},Q=()=>{S(),l.value=!1},W=async t=>{try{const n=await Y({url:`users/delete-user-pnte/${t.id}`,method:"DELETE"});n.status==200&&(S(),k.success(n.message))}catch(n){console.error("Error de red:",n)}},J=async()=>{I.value=!0;try{}catch(t){console.error("Error de red:",t)}finally{I.value=!1}},K=async t=>{f.page=t,await S()},X=async t=>{t&&(f.page=1,await S())},S=async()=>{try{C.value=!0;const t={page:f.page};f.year&&(t.year=D(f.year).format("YYYY")),f.name&&(t.name=f.name);const p=await Y({url:"users/ugo",method:"GET",params:t});b.value=p.data.data,A.value=p.data.total,_.value=p.data.per_page}catch(t){console.error("Error de red:",t)}finally{C.value=!1}};return B(async()=>{y.value=await re("usuarios-lista-ugo"),await S(),await O.fetchCdes(),x.value=O.cdes}),N("search",f),N("loading",C),N("loadingFile",I),(t,n)=>{const p=R("a-select"),g=R("a-menu-item"),Z=R("a-popconfirm"),G=R("a-drawer");return $(),H("div",ue,[d(ee,{title:"USUARIOS UGO",nameTotal:"Usuarios UGO",titleSearch:"FILTRAR POR NÚMERO DE DNI",placeholderSearch:"Buscar",textNuevo:"NUEVO REGISTRO",new:!0,columns:F,pageSize:_.value,dataSource:b.value,total:A.value,btnUpdate:!0,permisos:y.value,onHandleNew:T,onHandleDownloadExcel:J,onHandleSearch:X,onHandleCallFetchData:S,onHandlePaginator:K},{"data-cell":m(({column:o,record:u})=>[o.dataIndex=="datos_personales"?($(),H("div",me,[E("b",null,P(u.name)+" "+P(u.fullname),1),E("span",null,P(u.phone)+" / "+P(u.email),1)])):q("",!0),o.dataIndex=="cde_name"?($(),te(p,{key:1,value:u.cde_id,"onUpdate:value":M=>u.cde_id=M,"show-search":"",placeholder:"Seleccionar CDE",class:"ugo-cde",loading:L.value,options:x.value,"filter-option":i,onChange:M=>h(M,u.id)},null,8,["value","onUpdate:value","loading","options","onChange"])):q("",!0)]),"custom-options":m(({record:o})=>[d(g,null,{default:m(()=>[E("a",{onClick:u=>U(o)},"Editar",8,fe)]),_:2},1024),d(g,null,{default:m(()=>[E("a",{onClick:u=>a(o)},"Cambiar de contraseña",8,pe)]),_:2},1024),d(g,null,{default:m(()=>[E("a",{onClick:u=>c(o)},"Vistas",8,ge)]),_:2},1024),d(g,null,{default:m(()=>[d(Z,{placement:"rightBottom",title:`¿Quieres eliminar a ${o.name} ${o.lastname} ?`,onConfirm:u=>W(o)},{icon:m(()=>[d(ne(le),{style:{color:"red"}})]),default:m(()=>[n[5]||(n[5]=E("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total","permisos"]),d(G,{open:l.value,"onUpdate:open":n[0]||(n[0]=o=>l.value=o),title:r.value?"EDITAR DATOS PNTE":"NUEVO USUARIO UGO",placement:"right",width:"550"},{default:m(()=>[d(ce,{onCloseDraw:Q,info:r.value},null,8,["info"])]),_:1},8,["open","title"]),d(G,{open:e.value,"onUpdate:open":n[2]||(n[2]=o=>e.value=o),title:"CAMBIAR CONTRASEÑA",placement:"right",width:"450"},{default:m(()=>[d(se,{onCloseDraw:n[1]||(n[1]=o=>e.value=!1),info:r.value},null,8,["info"])]),_:1},8,["open"]),d(G,{open:v.value,"onUpdate:open":n[4]||(n[4]=o=>v.value=o),title:"ASIGNAR VISTAS",placement:"right",width:"1300"},{default:m(()=>[d(ie,{onCloseDraw:n[3]||(n[3]=o=>v.value=!1),info:r.value,typeOffice:"UGO"},null,8,["info"])]),_:1},8,["open"])])}}};export{Oe as default};
