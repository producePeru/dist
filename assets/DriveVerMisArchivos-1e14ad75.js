import{f as G,r as n,L as j,k as P,b as i,o as k,d as E,e as d,N as J,O as Q,c,w as m,i as N,F as K,m as C,t as B,s as I,q as W,h as X,P as Z,M as ee,Q as ae}from"./index-3e84d68c.js";const te=d("h3",null,"ARCHIVOS",-1),oe={class:"w-search"},ne={key:0},le={class:"paginator-drive"},ce={__name:"DriveVerMisArchivos",setup(re){const v=JSON.parse(localStorage.getItem("user")),L="https://apituempresa.soporte-pnte.com/api/",F="http://127.0.0.1:8000/api/",M=window.location.hostname=="127.0.0.1"?F:L,U=G.get("token"),u=n({}),p=n([]),l=n(!1),$=n(0),g=n(0),D=n([]),z=n(""),_=n(!1),O=async a=>{try{if(a===0)return h();l.value=!0;const e=`/drive/author/${a}`,t=await C({url:e,method:"GET",params:w.value});p.value=t}catch(e){console.error("Error de red:",e)}finally{l.value=!1}},T=async a=>{try{if(_.value=!0,!a)return g.value=0,h();const e=`/drive/search-file/${a}/${v.id}`,{data:t}=await C({url:e,method:"GET"});p.value=t.data}catch(e){console.error("Error de red:",e)}finally{_.value=!1}},V=async a=>{u.value={...u.value,[a]:!0};try{const e=await ee.get(`${M}/drive/download/${a}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${U}`}}),t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download",a),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Error al descargar el archivo",e)}finally{u.value={...u.value,[a]:!1}}},H=(a,e)=>{const t=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)},Y=a=>ae(a).format("DD/MM/YYYY HH:mm A"),S=n(window.innerHeight-100),f=()=>{S.value=window.innerHeight-300};j(()=>{window.removeEventListener("resize",f)});const w=n({page:1}),R=[{title:"Autor",dataIndex:"user",fixed:"left",width:180},{title:"Nombre archivo",dataIndex:"filename",width:140},{title:"Fecha de carga",dataIndex:"date",width:120,align:"center"},{title:"",dataIndex:"actions",width:120,align:"center"}],q=a=>{w.value.page=a,h()},h=async()=>{let a=null;v.role=="100"||v.role=="10"?a="/drive/files/admin":a=`/drive/files/${v.id}`;try{l.value=!0;const{data:e}=await C({url:a,method:"GET",params:w.value});p.value=e;const t=new Map(e.map(r=>[r.idUser,r.user])),o=Array.from(t.entries()).map(([r,b])=>({value:r,label:b})),y={value:[{value:0,label:"Todos"},...o]};D.value=y.value}catch(e){console.error("Error de red:",e)}finally{l.value=!1}};return P(()=>{h(),window.addEventListener("resize",f),f()}),(a,e)=>{const t=i("a-input-search"),o=i("a-select"),A=i("a-button"),y=i("a-table"),r=i("a-tag"),b=i("a-pagination");return k(),E(K,null,[d("div",null,[te,J(d("div",oe,[c(t,{value:z.value,"onUpdate:value":e[0]||(e[0]=s=>z.value=s),placeholder:"Buscar por nombre del archivo",style:{width:"250px"},loading:_.value,onSearch:T},null,8,["value","loading"]),c(o,{value:g.value,"onUpdate:value":e[1]||(e[1]=s=>g.value=s),"show-search":"",placeholder:"Buscar",style:{width:"220px"},options:D.value,"filter-option":H,onChange:O},null,8,["value","options"])],512),[[Q,!l.value]]),c(y,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:S.value},columns:R,"data-source":p.value,pagination:!1,loading:l.value,size:"small"},{bodyCell:m(({column:s,record:x})=>[s.dataIndex=="date"?(k(),E("div",ne,B(Y(x.created_at)),1)):I("",!0),s.dataIndex=="actions"?(k(),W(A,{key:1,size:"small",onClick:se=>V(x.path),type:"primary",ghost:"",loading:u.value[x.path]},{icon:m(()=>[c(X(Z))]),default:m(()=>[N(" Descargar ")]),_:2},1032,["onClick","loading"])):I("",!0)]),_:1},8,["scroll","data-source","loading"])]),d("div",le,[d("span",null,[c(r,{color:"blue"},{default:m(()=>[d("b",null,B(p.value.length),1)]),_:1}),N(" Archivos Subidos")]),c(b,{size:"small",pageSize:50,total:$.value,onChange:q,showSizeChanger:!1},null,8,["total"])])],64)}}};export{ce as default};
