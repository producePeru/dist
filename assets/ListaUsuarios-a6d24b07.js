import{J as le,r as n,a as ie,b as p,o,q as g,w as d,e as x,d as v,F as h,B as re,h as I,s as l,c,K as de,t as f,i as b,y as R,m as L,u as ue,v as ce,H as pe,k as me,Q as _e,I as fe,O as ve,p as he,j as ge}from"./index-097ff9a2.js";import{u as X}from"./selectes-b6ada1fc.js";import{f as ye}from"./actualizarUsuario-dcb6b189.js";import"./es-91704f6e.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import{M as be}from"./MoreOutlined-45b0f570.js";const xe={class:"grid-profile"},we="YYYY-MM-DD",ke={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(D,{emit:q}){le.locale("es");const t=X(),A=JSON.parse(localStorage.getItem("profile")),z=q;t.$patch({genders:t.genders}),t.$patch({cdes:t.cdes}),t.$patch({Offices:t.Offices}),t.$patch({roles:t.roles}),t.$patch({supervisores:t.supervisores}),t.fetchGenders(),t.fetchCdes(),t.fetchOffices(),t.fetchRoles();const O=D,S=n(!1),w=n(ye),C=n(null),a=ie({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:A.id}),B=s=>{s&&(a.name=s.profile.name,a.lastname=s.profile.lastname,a.middlename=s.profile.middlename,a.birthday=s.profile.birthday,a.sick=s.profile.sick,a.phone=s.profile.phone,a.gender_id=s.profile.gender_id,a.cde_id=s.profile.cde_id,a.office_id=s.profile.office_id,a.email=s.email)},N=s=>{const y={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(s===2)t.fetchSupervisores(),w.value={...w.value,supervisor_id:y};else{const{supervisor_id:k,...U}=w.value;w.value=U}},$=async()=>{S.value=!0;let s=a;delete s.email;try{const y=await R({url:`user/update/${O.updateUser.profile.id}`,method:"PUT",data:s});L.success(y.message),z("closeDraw",!0)}catch{L.error("No se pudo registrar este usuario")}finally{S.value=!1}},M=()=>{L.error("Debes de completar todos los espacios requeridos")};return(s,y)=>{const k=p("a-select"),U=p("a-form-item"),E=p("a-input"),P=p("a-date-picker"),i=p("a-button"),u=p("a-form");return o(),g(u,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:$,onFinishFailed:M},{default:d(()=>[x("div",xe,[(o(!0),v(h,null,re(w.value,(e,F)=>(o(),v(h,{key:F},[e.type==="iSelect"?(o(),g(U,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:d(()=>[e.name=="gender_id"?(o(),g(k,{key:0,value:a[e.name],"onUpdate:value":r=>a[e.name]=r,options:I(t).genders},null,8,["value","onUpdate:value","options"])):l("",!0),e.name=="cde_id"?(o(),g(k,{key:1,value:a[e.name],"onUpdate:value":r=>a[e.name]=r,options:I(t).cdes},null,8,["value","onUpdate:value","options"])):l("",!0),e.name=="office_id"?(o(),g(k,{key:2,value:a[e.name],"onUpdate:value":r=>a[e.name]=r,options:I(t).Offices},null,8,["value","onUpdate:value","options"])):l("",!0),e.name=="role_id"?(o(),g(k,{key:3,value:a[e.name],"onUpdate:value":r=>a[e.name]=r,options:I(t).roles,onChange:N},null,8,["value","onUpdate:value","options"])):l("",!0),e.name=="supervisor_id"?(o(),g(k,{key:4,value:a[e.name],"onUpdate:value":r=>a[e.name]=r,options:I(t).supervisores},null,8,["value","onUpdate:value","options"])):l("",!0)]),_:2},1032,["name","label","rules"])):l("",!0),e.type==="iText"?(o(),g(U,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:d(()=>[c(E,{value:a[e.name],"onUpdate:value":r=>a[e.name]=r,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):l("",!0),e.type==="iDate"?(o(),g(U,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:d(()=>[c(P,{locale:I(de),value:C.value,"onUpdate:value":y[0]||(y[0]=r=>C.value=r),style:{width:"100%"},format:we},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):l("",!0)],64))),128))]),x("div",null,f(B(O.updateUser)),1),c(U,null,{default:d(()=>[c(i,{class:"btn-produce",type:"primary","html-type":"submit",loading:S.value},{default:d(()=>[b("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},Ue=W(ke,[["__scopeId","data-v-3578053d"]]);const T=D=>(he("data-v-ead49155"),D=D(),ge(),D),Ie=T(()=>x("h3",null,"USUARIOS",-1)),Se=T(()=>x("br",null,null,-1)),Ce=["onClick"],De=T(()=>x("a",null,"Eliminar",-1)),Ee={class:"paginator"},K=20,Oe={__name:"ListaUsuarios",setup(D){const q=X();q.$patch({cdes:q.cdes});const t=n(!1),A=i=>{console.log("open",i)},z=n(null);n(!1),n(!1),n(!1),n(0),n(!1),n(!1),n(!1),n("solicitante"),n(5);const O=n([]),S=n(!1),w=n(0);ue();const C=n({page:1});n("");const a=n("user/list");n([]),n(null);const B=n(1200),N=n(window.innerHeight-100),$=()=>{N.value=window.innerHeight-300};ce(()=>{window.removeEventListener("resize",$)});const M=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:100},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],s=()=>{E(),t.value=!1},y=i=>{C.value.page=i,E()},k=i=>{z.value=i,t.value=!0},U=async i=>{try{const u=await R({url:`user/delete/${i.id}`,method:"DELETE"});u&&(E(),L.success(u.message))}catch(u){console.error("Error de red:",u)}},E=async()=>{try{S.value=!0;let i=C.value.page==1?"":C.value;const u=await R({url:a.value,method:"GET",params:i});O.value=u.data,w.value=u.total}catch(i){console.error("Error de red:",i)}finally{S.value=!1}},P=pe(()=>i=>(C.value.page-1)*K+i+1);return me(()=>{E(),window.addEventListener("resize",$),$()}),(i,u)=>{const e=p("a-button"),F=p("a-menu-item"),r=p("a-popconfirm"),Z=p("a-menu"),ee=p("a-dropdown"),ae=p("a-table"),te=p("a-pagination"),ne=p("a-drawer");return o(),v(h,null,[x("div",null,[Ie,Se,c(ae,{bordered:"",scroll:{x:B.value,y:N.value},class:"ant-table-striped",columns:M,"data-source":O.value,pagination:!1,loading:S.value,size:"small"},{bodyCell:d(({column:m,record:_,index:oe})=>{var V,Y,G,H,j,J,Q;return[m.dataIndex=="idx"?(o(),v(h,{key:0},[b(f(P.value(oe)),1)],64)):l("",!0),m.dataIndex=="lastName"?(o(),v(h,{key:1},[b(f(_.last_name)+" "+f(_.middle_name),1)],64)):l("",!0),m.dataIndex=="documentnumber"?(o(),v(h,{key:2},[b(f((V=_.profile)==null?void 0:V.documentnumber),1)],64)):l("",!0),m.dataIndex=="name"?(o(),v(h,{key:3},[b(f((Y=_.profile)==null?void 0:Y.name),1)],64)):l("",!0),m.dataIndex=="lastname"?(o(),v(h,{key:4},[b(f((G=_.profile)==null?void 0:G.lastname)+" "+f((H=_.profile)==null?void 0:H.middlename),1)],64)):l("",!0),m.dataIndex=="phone"?(o(),v(h,{key:5},[b(f((j=_.profile)==null?void 0:j.phone),1)],64)):l("",!0),m.dataIndex=="office"?(o(),v(h,{key:6},[b(f((J=_.profile)==null?void 0:J.office.name),1)],64)):l("",!0),m.dataIndex=="cde"?(o(),v(h,{key:7},[b(f((Q=_.profile)==null?void 0:Q.cde.name),1)],64)):l("",!0),m.dataIndex=="actions"?(o(),g(ee,{key:8,trigger:["click"]},{overlay:d(()=>[c(Z,null,{default:d(()=>[c(F,null,{default:d(()=>[x("a",{onClick:se=>k(_)},"Editar",8,Ce)]),_:2},1024),c(F,null,{default:d(()=>[c(r,{title:"Â¿Seguro de eliminar?",onConfirm:se=>U(_)},{icon:d(()=>[c(I(_e),{style:{color:"red"}})]),default:d(()=>[De]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:d(()=>[x("a",{class:"ant-dropdown-link",onClick:u[0]||(u[0]=fe(()=>{},["prevent"]))},[c(e,{shape:"circle",icon:ve(I(be)),size:"small"},null,8,["icon"])])]),_:2},1024)):l("",!0)]}),_:1},8,["scroll","data-source","loading"])]),x("div",Ee,[c(te,{size:"small",total:w.value,pageSize:K,onChange:y,showSizeChanger:!1},null,8,["total"])]),c(ne,{open:t.value,"onUpdate:open":u[1]||(u[1]=m=>t.value=m),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:A},{default:d(()=>[c(Ue,{updateUser:z.value,onCloseDraw:s},null,8,["updateUser"])]),_:1},8,["open"])],64)}}},Ae=W(Oe,[["__scopeId","data-v-ead49155"]]);export{Ae as default};
