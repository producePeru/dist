import{_ as j}from"./TableComponent-c0651f2f.js";import{p as A,r as o,k as F,T as W,aa as B,b as x,o as r,y as D,d as h,e as s,F as G,v as J,t as _,z as k,u as Z,a as K,W as R,c as w,w as E,m as H,j as U}from"./index-4d8c910a.js";import{C as Q}from"./auto-ba4ecebb.js";import"./es-e28260b3.js";import{u as X,t as ee}from"./timezone-53ea1625.js";import{d as ae}from"./downloadExcel-058a6513.js";import"./icoexcel-1b303edf.js";import"./selectes-4cbab4f8.js";import"./SyncOutlined-9965ed00.js";import"./MoreOutlined-434dcd1a.js";const te={key:1},oe={key:1},ne={class:"chart-wrapper-diagnostic"},se={class:"mp-diagnostic-detail"},le={key:0,class:"hp"},re={key:1,class:"ge"},de={class:"mp-diagnostic-detail"},ie={class:"mp-diagnostic-detail"},ce={class:"mp-diagnostic-detail"},ue={__name:"MPShares",props:["info","statusLoading","valuesChart"],setup(M){A.locale("es"),A.extend(X),A.extend(ee);const c=M,d=o(null),u=o(null);o([0,0]),o("100px");const m=o([]),I=o(!0);function v(){var e,f;if(!d.value)return;u.value&&u.value.destroy();const n=d.value.getContext("2d");u.value=new Q(n,{type:"bar",data:{labels:["HABILIDADES PERSONALES","GESTIÓN EMPRESARIAL"],datasets:[{data:[(e=c.valuesChart)==null?void 0:e.habilidades_personales,(f=c.valuesChart)==null?void 0:f.gestion_empresarial],backgroundColor:["#ff5462","#1890ff"],borderColor:["#ff5462","#1890ff"],borderWidth:1,barThickness:60}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}const S=async n=>{try{if(!n||n.length===0)return;m.value=n,await B(),v()}catch(e){console.error("Error al cargar la información:",e)}},y=()=>{u.value&&(u.value.destroy(),u.value=null),d.value&&d.value.getContext("2d").clearRect(0,0,d.value.width,d.value.height)};return F(async()=>{c.info?S(c.info):I.value=!1}),W(()=>c.info,async n=>{if(!n||n.length===0){m.value=[],y();return}m.value=n,await B(),v()},{immediate:!0}),(n,e)=>{const f=x("a-skeleton"),N=x("a-empty");return c.statusLoading?(r(),D(f,{key:0,active:""})):(r(),h("div",te,[m.value.length==0?(r(),D(N,{key:0})):(r(),h("div",oe,[s("div",ne,[s("canvas",{ref_key:"myChart",ref:d},null,512)]),(r(!0),h(G,null,J(m.value,(i,T)=>(r(),h("div",{class:"mp-diagnostic-box",key:T},[s("h4",null,_(i.title),1),s("div",se,[e[0]||(e[0]=s("span",null,"Tipo de componente: ",-1)),i.component=="HABILIDADES PERSONALES"?(r(),h("span",le,"HABILIDADES PERSONALES")):k("",!0),i.component=="GESTIÓN EMPRESARIAL"?(r(),h("span",re,"GESTIÓN EMPRESARIAL")):k("",!0)]),s("div",de,[e[1]||(e[1]=s("span",null,"Exponente: ",-1)),s("span",null,_(i.capacitador),1)]),s("div",ie,[e[2]||(e[2]=s("span",null,"Fecha y hora: ",-1)),s("span",null,_(i.date)+" - "+_(i.hourStart)+" "+_(i.hourEnd),1)]),s("div",ce,[e[3]||(e[3]=s("span",null,"Modalidad: ",-1)),s("span",null,_(i.modalidad),1)])]))),128))]))]))}}};const me={class:"layout-content"},pe=["onClick"],Ce={__name:"mp-diagnosticos",setup(M){JSON.parse(localStorage.getItem("role"));const c=o([]),d=o(0),u=o(150),m=o(null),I=o(!0),v=o(!1);o(!1),Z();const S=o(!1),y=o(null),n=o(!1),e=K({name:null,page:1}),f=o([]),N=()=>{y.value=null,open.value=!0},i=async()=>{n.value=!0;try{const t={};e.name&&(t.name=e.name),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),await ae("download/mp-export-participants-excel","diagnosticos",t)}catch(t){console.error("Error de red:",t)}finally{n.value=!1}},T=async t=>{e.page=t,await C()},$=async t=>{t&&(e.page=1,await C())},z=async t=>{v.value=!0,I.value=!0;try{const l=await H({url:`mp/detail-share/${t.participant_id}`,method:"GET"});l.status==200&&(y.value=l.data,m.value=l.totals)}catch(l){console.error("Error de red:",l)}finally{I.value=!1}},C=async()=>{try{S.value=!0;const t={page:e.page};e.year&&(t.year=A(e.year).format("YYYY")),e.range&&(t.startDate=e.range[0].format("YYYY/MM/DD"),t.endDate=e.range[1].format("YYYY/MM/DD")),e.name&&(t.name=e.name),e.orderby&&(t.orderby=e.orderby);const l=await H({url:"mp/participant-diagnostic",method:"GET",params:t}),p=l,b=[{title:"#",dataIndex:"idx",align:"center",width:80,fixed:"left"},{title:"NOMBRE COMPLETO",dataIndex:"nombre_completo",width:160},{title:"APELLIDOS",dataIndex:"apellidos",width:160},{title:"FECHA NACIMIENTO",dataIndex:"fecha_nacimiento",width:100,align:"center"},{title:"CELULAR",dataIndex:"celular",width:90,align:"center"},{title:"TIPO DOCUMENTO",dataIndex:"tipo_documento",width:100,align:"center"},{title:"DOCUMENTO",dataIndex:"doc_number",width:100,align:"center"},{title:"EMAIL",dataIndex:"email",width:200},{title:"RUC",dataIndex:"ruc",width:100,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"actividad",width:160},{title:"RUBRO",dataIndex:"rubro",width:140},{title:"SECTOR ECONÓMICO",dataIndex:"economicSector",width:100},{title:"FECHA DEL DIAGNÓSTICO",dataIndex:"registrado",width:120,align:"center"},{title:"ASISTENCIA EN CAPACITACIONES",dataIndex:"shares",width:140,align:"center"}],O=l.questions.map(a=>({title:a.label,dataIndex:a.model,width:160}));f.value=[...b,...O,{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}];const g=p.data.map((a,V)=>{const L={idx:V+1,participant_id:a.participant_id,ruc:a.ruc,nombre_completo:a.nombre_completo,apellidos:a.apellidos,fecha_nacimiento:a.fecha_nacimiento,celular:a.celular,tipo_documento:a.tipo_documento,doc_number:a.doc_number,email:a.email,actividad:a.actividad,rubro:a.rubro,economicSector:a.economicSector,registrado:a.registrado,shares:a.shares};return p.questions.forEach(Y=>{const P=a.responses.find(q=>q.question_model===Y.model);L[Y.model]=P?P.answer:null}),L});c.value=g,d.value=p.total,u.value=p.per_page}catch(t){console.error("Error de red:",t)}finally{S.value=!1}};return F(async()=>{await C()}),R("search",e),R("loading",S),R("loadingFile",n),(t,l)=>{const p=x("a-tag"),b=x("a-menu-item"),O=x("a-drawer");return r(),h("div",me,[w(j,{title:"DIAGNÓSTICOS DE EMPRESAS",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",columns:f.value,titleSearch:"BUSCAR DNI - RUC - NOMBRES",pageSize:u.value,downloadExcel:!0,nameTotal:"Registros",dataSource:c.value,total:d.value,btnUpdate:!0,onHandleNew:N,onHandleCallFetchData:C,onHandleDownloadExcel:i,onHandleSearch:$,onHandlePaginator:T,heightTable:380},{"data-cell":E(({column:g,record:a})=>[g.dataIndex=="shares"?(r(),h(G,{key:0},[a.shares<1?(r(),D(p,{key:0,color:"pink"},{default:E(()=>[U(_(a.shares),1)]),_:2},1024)):(r(),D(p,{key:1,color:"blue"},{default:E(()=>[U(_(a.shares),1)]),_:2},1024))],64)):k("",!0)]),"custom-options":E(({record:g})=>[w(b,null,{default:E(()=>[s("span",{onClick:a=>z(g)}," Detalle ",8,pe)]),_:2},1024)]),_:1},8,["columns","pageSize","dataSource","total"]),w(O,{open:v.value,"onUpdate:open":l[0]||(l[0]=g=>v.value=g),title:"PARTICIPACIONES",placement:"right",width:"500"},{default:E(()=>[w(ue,{info:y.value,valuesChart:m.value,statusLoading:I.value},null,8,["info","valuesChart","statusLoading"])]),_:1},8,["open"])])}}};export{Ce as default};
