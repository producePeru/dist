import{f as j}from"./actualizarUsuario-3eaca126.js";import{u as G}from"./selectes-1c13fd40.js";import{K as C,r as g,a as J,k as K,b as u,o as s,d as x,e as k,c as d,w as c,y as Y,i as q,F,B as Z,q as l,h as m,s as i,L as H,p as Q,j as W,m as M}from"./index-205a5d88.js";import"./es-95d68f39.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";const ee=h=>(Q("data-v-f4a8052e"),h=h(),W(),h),ae={class:"profile-header"},te=ee(()=>k("h3",null,"MIS DATOS",-1)),oe={class:"my-profile"},ne={class:"grid-profile"},se="DD/MM/YYYY",le={__name:"MiPerfil",props:["updateUser"],emits:["closeDraw"],setup(h,{emit:ie}){C.locale("es");const t=G(),U=JSON.parse(localStorage.getItem("profile")),I=JSON.parse(localStorage.getItem("email")),S=g(!1);t.$patch({genders:t.genders}),t.$patch({cdes:t.cdes}),t.$patch({Offices:t.Offices}),t.$patch({roles:t.roles}),t.$patch({cities:t.cities}),t.$patch({supervisores:t.supervisores}),t.fetchCities(),t.fetchGenders(),t.fetchCdes(),t.fetchOffices(),t.fetchRoles();const D=g(!1),_=g(j),v=g(null),a=J({email:null,documentnumber:null,name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:U.id}),N=o=>{const r={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(o===2)t.fetchSupervisores(),_.value={..._.value,supervisor_id:r};else{const{supervisor_id:f,...b}=_.value;_.value=b}},w=(o,r)=>{const f=o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(f)},O=o=>{a.province_id=null,a.district_id=null,t.fetchProvinces(o)},L=o=>{a.district_id=null,t.fetchDistricts(o)},$=async()=>{D.value=!0,a.birthday=v.value?C(v.value).format("YYYY-MM-DD"):null;let o=a;delete o.email,delete o.documentnumber;try{const r=await Y({url:`user/update/${U.id}`,method:"PUT",data:o});M.success(r.message)}catch{M.error("No se pudo registrar este usuario")}finally{D.value=!1}},A=()=>{M.error("Debes de completar todos los espacios requeridos")},P=async()=>{try{S.value=!0;const{data:o}=await Y({url:"user/my-profile",method:"GET"});o&&(a.email=I,a.documentnumber=U.documentnumber,a.name=o.name,a.lastname=o.lastname,a.middlename=o.middlename,a.birthday=o.birthday,a.sick=o.sick,a.phone=o.phone,a.gender_id=o.gender_id,a.cde_id=o.cde_id,a.office_id=o.office_id,o.birthday&&(v.value=C(o.birthday,"YYYY-MM-DD")))}catch(o){console.error("Error de red:",o)}finally{S.value=!1}};return K(()=>{P()}),(o,r)=>{const f=u("a-button"),b=u("router-link"),T=u("a-divider"),p=u("a-select"),y=u("a-form-item"),z=u("a-input"),B=u("a-date-picker"),E=u("a-form"),V=u("a-spin");return s(),x("div",null,[k("div",ae,[te,d(b,{to:"cambiar-clave"},{default:c(()=>[d(f,null,{default:c(()=>[q("Cambiar contraseña")]),_:1})]),_:1})]),d(T),k("section",oe,[d(V,{spinning:S.value},{default:c(()=>[d(E,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:$,onFinishFailed:A},{default:c(()=>[k("div",ne,[(s(!0),x(F,null,Z(_.value,(e,R)=>(s(),x(F,{key:R},[e.type==="iSelect"?(s(),l(y,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:c(()=>[e.name=="gender_id"?(s(),l(p,{key:0,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).genders},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="cde_id"?(s(),l(p,{key:1,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).cdes},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="office_id"?(s(),l(p,{key:2,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).Offices},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="role_id"?(s(),l(p,{key:3,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).roles,onChange:N},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="supervisor_id"?(s(),l(p,{key:4,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).supervisores},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="city_id"?(s(),l(p,{key:5,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).cities,"show-search":"","filter-option":w,onChange:O},null,8,["value","onUpdate:value","options"])):i("",!0),e.name=="province_id"?(s(),l(p,{key:6,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).provinces,"show-search":"","filter-option":w,onChange:L,disabled:!a.city_id},null,8,["value","onUpdate:value","options","disabled"])):i("",!0),e.name=="district_id"?(s(),l(p,{key:7,value:a[e.name],"onUpdate:value":n=>a[e.name]=n,options:m(t).districts,"show-search":"","filter-option":w,disabled:!a.province_id},null,8,["value","onUpdate:value","options","disabled"])):i("",!0)]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iText"?(s(),l(y,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:c(()=>[d(z,{value:a[e.name],"onUpdate:value":n=>a[e.name]=n,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):i("",!0),e.type==="iDate"?(s(),l(y,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:c(()=>[d(B,{locale:m(H),value:v.value,"onUpdate:value":r[0]||(r[0]=n=>v.value=n),style:{width:"100%"},format:se,placeholder:"DÍA/MES/AÑO"},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):i("",!0)],64))),128))]),d(y,null,{default:c(()=>[d(f,{class:"btn-produce",type:"primary","html-type":"submit",loading:D.value},{default:c(()=>[q("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])])}}},pe=X(le,[["__scopeId","data-v-f4a8052e"]]);export{pe as default};
