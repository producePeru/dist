import{B as P,r as _,a as se,j as de,v as he,b as c,o as l,d as y,c as i,w as d,e as O,F as Y,x as ye,p as b,q as m,h as k,D as be,i as T,m as N,J as R,g as De,z as we,T as xe,t as F,G as ie,$ as Ee,I as Ie}from"./index-ff7b135e.js";import{_ as Ce}from"./icoexcel-1b303edf.js";import{u as re}from"./selectes-2e4334fd.js";import"./es-2011e178.js";import{_ as Se}from"./_plugin-vue_export-helper-c27b6911.js";import{S as Ne}from"./SaveOutlined-f0ce16c7.js";import{M as ke}from"./MoreOutlined-675ec443.js";const Ue={numberDocument:{type:"iSearch",label:"Número de documento",name:"numberDocument",required:!0,message:"Ingresar Número de documento",disabled:!1,max:11},namePerson:{type:"iText",label:"Nombre",name:"namePerson",required:!0,message:"Escribe nombre",disabled:!0},city_id:{type:"iSelectWrite",label:"Región del negocio",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelectWrite",label:"Provincia del negocio",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelectWrite",label:"Distrito del negocio",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"Seleccionar estado",disabled:!0},divider:{type:"iDivider"},ruc:{type:"iSearch",label:"Número de RUC",name:"ruc",required:!1,message:"Escribe el número de RUC",disabled:!1,max:11},component_1:{type:"iSelectWrite",is:"component",label:"Componente 1",name:"component_1",required:!0,message:"Seleccionar componente 1",disabled:!1},component_2:{type:"iSelectWrite",is:"component",label:"Componente 2",name:"component_2",required:!0,message:"Seleccionar componente 2",disabled:!1},component_3:{type:"iSelectWrite",is:"component",label:"Componente 3",name:"component_3",required:!1,message:"Seleccionar componente 3",disabled:!1},startDate:{type:"iDate",label:"Día Inicio",name:"startDate",required:!0,message:"Seleccionar fecha de inicio",placeholder:"año-mes-día"},endDate:{type:"iDate",label:"Día Fin",name:"endDate",required:!0,message:"Seleccionar fecha de fin",placeholder:"año-mes-día"}};const Oe={class:"grid-planes"},Ae="DD/MM/YYYY",Pe={__name:"NuevoPlanAccion",props:["info"],emits:["closeDraw"],setup(z,{emit:w}){P.locale("es");const U=JSON.parse(localStorage.getItem("profile")),D=re(),C=w,E=z;D.$patch({cities:D.cities}),D.fetchCities();const M=_(Ue),A=_(!1),S=_(null),H=[{label:"DESARROLLO PRODUCTIVO",value:1},{label:"DIGITALIZACIÓN",value:2},{label:"FINANZAS",value:3},{label:"FORMALIZACIÓN",value:4},{label:"GESTIÓN EMPRESARIAL",value:5}],J=[{value:1,label:"DNI"},{value:2,label:"RUC"}],B=[{label:"Si",value:"yes"},{label:"No",value:"no"}],e=se({component_1:null,component_2:null,component_3:null}),q=()=>{e.numberDocument=null,e.component_1=null,e.component_2=null,e.component_3=null,e.ruc=null,e.idPerson=null,e.namePerson=null,e.city_id=null,e.province_id=null,e.district_id=null,e.gender_id=null,e.sick=null,e.startDate=null,e.endDate=null},Q=t=>{const o=["component_1","component_2","component_3"].reduce((r,v)=>(v!==t&&e[v]!==null&&r.push(e[v]),r),[]);return H.filter(r=>!o.includes(r.value))},X=()=>{const t=e.ruc;return t&&!/^\d{11}$/.test(t)?(N.error("El número de RUC debe contener exactamente 11 dígitos numéricos."),{valid:!1}):t&&!/^(10|15|20)/.test(t)?(N.error("El número de RUC debe comenzar con 10, 15 o 20."),{valid:!1}):{valid:!0}},K=t=>{if(!t)return!1;const o=e.startDate?P(e.startDate):null;return o&&t.isBefore(o,"day")||t.isAfter(P().endOf("day"),"day")},ee=t=>{e[t]=e[t].replace(/\D/g,"")},L=(t,o)=>{const r=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(r)},$=async t=>{if(!e.numberDocument)return N.warning("Ingrese un número a buscar...");try{if(t=="numberDocument"){S.value=t;const o=await R({url:`person/data/${e.numberDocument}`,method:"GET"});if(o.status==404)return S.value=null,e.numberDocument=null,N.warning("Este usuario no fue registrado");o.status==200&&(e.idPerson=o.data.id,e.namePerson=o.data.namePerson,e.city_id=o.data.city_id,G(o.data.city_id),e.province_id=o.data.province_id,V(o.data.province_id),e.district_id=o.data.district_id,console.log("FormState",o.data.gender_id),e.sick=o.data.sick)}if(t=="ruc"){S.value=t;const o=await R({url:`plans-action/components/${e.ruc}`,method:"GET"});if(o.status==200){const r=o.data;r.component_1&&(e.component_1=r.component_1),r.component_2&&(e.component_2=r.component_2),r.component_3&&(e.component_3=r.component_3),r.endDate&&(e.endDate=P(r.endDate,"YYYY-MM-DD"))}else return S.value=null,e.ruc=null,N.warning("No se han registrado datos con ese número de RUC")}}catch{console.log("Failed to update record")}finally{S.value=null}},G=t=>{e.province_id=null,e.district_id=null,D.fetchProvinces(t)},V=t=>{e.district_id=null,D.fetchDistricts(t)},W=(t,o)=>{},Z=async()=>{A.value=!0;const t=X();if(e.ruc&&t.valid===!1){A.value=!1;return}const o={people_id:e.idPerson,cde_id:U.cde_id,component_1:e.component_1,component_2:e.component_2,component_3:e.component_3,ruc:e.ruc,startDate:P(e.startDate).format("YYYY-MM-DD"),endDate:P(e.endDate).format("YYYY-MM-DD"),...E.info&&{idItem:E.info.id}};let r=null;E.info?r="plans-action/update":r="plans-action/create";try{const v=await R({url:`${r}`,method:"POST",data:o});v.status==200&&(N.success(v.message),q(),C("closeDraw")),v.status==400&&N.warning(v.message)}catch{console.log("Failed to update record")}finally{A.value=!1}};function j(t){t?(e.numberDocument=t.emprendedor_dni,$("numberDocument"),e.ruc=t.ruc,e.component_1=t.component_1_id,e.component_2=t.component_2_id,e.component_3=t.component_3_id,e.startDate=t.startDate?P(t.startDate,"DD/MM/YYYY"):null,e.endDate=t.endDate?P(t.endDate,"DD/MM/YYYY"):null):q()}return de(()=>{E.info&&j(E.info)}),he(()=>E.info,t=>{t&&j(t)}),(t,o)=>{const r=c("a-input"),v=c("a-form-item"),g=c("a-select"),ae=c("a-input-search"),u=c("a-divider"),n=c("a-date-picker"),f=c("a-button"),x=c("a-form");return l(),y("div",null,[i(x,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Z},{default:d(()=>[O("div",Oe,[(l(!0),y(Y,null,ye(M.value,(a,te)=>(l(),y(Y,{key:te},[a.type==="iText"?(l(),b(v,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:d(()=>[i(r,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSelect"?(l(),b(v,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[a.name=="typeDocument"?(l(),b(g,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:J},null,8,["value","onUpdate:value"])):m("",!0),a.name=="gender_id"?(l(),b(g,{key:1,disabled:a.disabled,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:k(D).genders},null,8,["disabled","value","onUpdate:value","options"])):m("",!0),a.name=="sick"?(l(),b(g,{key:2,disabled:a.disabled,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:B},null,8,["disabled","value","onUpdate:value"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(l(),b(v,{key:2,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[i(ae,{loading:S.value==a.name,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,onSearch:s=>$(a.name),onInput:s=>ee(a.name),onEnterButton:s=>$(a.name),maxlength:a.max},null,8,["loading","value","onUpdate:value","onSearch","onInput","onEnterButton","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDivider"?(l(),b(u,{key:3,dashed:"",style:{"grid-column":"1/3",margin:".5rem 0 1rem 0"}})):m("",!0),a.type==="iSelectWrite"?(l(),b(v,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[a.name=="city_id"?(l(),b(g,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).cities,"filter-option":L,onChange:G},null,8,["value","onUpdate:value","options"])):m("",!0),a.name=="province_id"?(l(),b(g,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).provinces,"filter-option":L,onChange:V,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(l(),b(g,{key:2,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:k(D).districts,"filter-option":L,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.is=="component"?(l(),b(g,{key:3,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,"show-search":"",options:Q(a.name),"filter-option":L,onChange:s=>W(s,a.name)},null,8,["value","onUpdate:value","options","onChange"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(l(),b(v,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[i(n,{"disabled-date":K,locale:k(be),value:e[a.name],"onUpdate:value":s=>e[a.name]=s,style:{width:"100%"},format:Ae,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),i(v,null,{default:d(()=>[i(f,{class:"btn-produce",type:"primary","html-type":"submit",loading:A.value},{default:d(()=>o[0]||(o[0]=[T("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},Re=Se(Pe,[["__scopeId","data-v-104877f4"]]),Me=De.get("token"),Te="https://apituempresa.soporte-pnte.com/api/",Ye="http://127.0.0.1:8000/api/",Le=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?Ye:Te;async function qe(z,w){try{w(!0);const U=await we({url:`${Le}${z}`,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Me}`},method:"GET",responseType:"blob"}),D=window.URL.createObjectURL(new Blob([U.data])),C=document.createElement("a");C.href=D;const E=U.headers["content-disposition"],M=E?E.split("filename=")[1].split(";")[0]:"reporte.xlsx";C.setAttribute("download",M),document.body.appendChild(C),C.click(),document.body.removeChild(C)}catch(U){console.error("Error al descargar el archivo:",U)}finally{w(!1)}}const $e={key:0},Fe={key:1,style:{color:"#00c98a"}},ze={key:0},Be={key:1},Ge={key:0,class:"details-plans"},Ve={key:1},We={key:0},Ze=["onClick"],je={class:"paginator"},ta={__name:"PlanesDeAccion",setup(z){const w=JSON.parse(localStorage.getItem("role"));re(),_(null);const U=_(null);_(null);const D=_(!1);_();const C=_(50),E=_([]),M=_(!1),A=_(0),S=_({page:1}),H=_("plans-action/list"),J=_(1200),B=_(window.innerHeight-100),e=_(!1);_(null);const q=_([{value:"si",label:"SI"},{value:"no",label:"NO"}]),Q=_([{value:"aprobado",label:"Aprobado ✔"},{value:"observado",label:"Observado ⚠"}]),X=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},...w[0].id!=2?[{title:"CENTRO TU EMPRESA",dataIndex:"centro_empresa",fixed:"left",width:150}]:[],...w[0].id!=2?[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180}]:[],...w[0].id!=2?[{title:"DNI ASESOR",dataIndex:"asesor_dni",fixed:"left",width:100,align:"center"}]:[],{title:"RUC",dataIndex:"ruc",width:100,fixed:"left",align:"center"},{title:"NOMBRE DEL EMPRENDEDOR O MYPE",fixed:"left",dataIndex:"emprendedor_nombres",width:170},{title:"REGIÓN DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_region",width:170},{title:"PROVINCIA DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_provincia",width:170},{title:"DISTRITO DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_distrito",width:170},{title:"Genero",dataIndex:"genero",width:60,align:"center"},{title:"Tiene alguna Discapacidad ? (SI / NO)",dataIndex:"discapacidad",width:110,align:"center"},{title:"COMPONENTE 1",dataIndex:"component_1",width:190,align:"center"},{title:"COMPONENTE 2",dataIndex:"component_2",width:190,align:"center"},{title:"COMPONENTE 3",dataIndex:"component_3",width:190,align:"center"},{title:"NÚMERO DE SESIONES",dataIndex:"numberSessions",width:100,align:"center"},{title:"DÍA INICIO",dataIndex:"startDate",width:100,align:"center"},{title:"DÍA FIN",dataIndex:"endDate",width:100,align:"center"},{title:"TOTAL DE DÍAS",dataIndex:"totalDate",width:100,align:"center"},...w[0].id!=2?[{title:"ACTA DE COMPROMISO",dataIndex:"acta",width:160,align:"center"}]:[],...w[0].id!=2?[{title:"CULMINÓ EL PLAN Y ENVIÓ CORREO",dataIndex:"envioCorreo",width:160,align:"center"}]:[],{title:"FECHA ACTUALIZACIÓN",dataIndex:"updated_at",width:140,align:"center"},{title:"ESTADO",dataIndex:"status",width:160,align:"center"},{title:"DETALLES",dataIndex:"detalle",width:220,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],K=async(u,n)=>{try{const f={id:n.id,details:n.details},x=await R({url:"plans-action/details",method:"PUT",data:f});x.status==200&&(N.success(x.message),g())}catch{console.log("Failed to delete")}},ee=async(u,n)=>{try{const f=await R({url:`plans-action/status/${n.id}/${u}`,method:"PUT"});f.status==200&&(N.success(f.message),g())}catch{console.log("Failed to delete")}},L=async u=>{try{const n=await R({url:`plans-action/delete/${u.id}`,method:"DELETE"});n.status==200&&(N.success(n.message),g())}catch{console.log("Failed to delete")}},$=u=>{U.value=u,e.value=!0},G=u=>{D.value=u},V=async()=>{qe("download/actions-plans",G)},W=async(u,n,f)=>{const x={idPlan:n.id,type:f,value:u},a=await R({url:"plans-action/edit-yes-no",method:"PUT",data:x});a.status==200&&g(),a.status==400&&(N.warning(a.message),g())},Z=()=>{B.value=window.innerHeight-315},j=()=>{U.value=null,e.value=!1,g()},t=se({search:""}),o=()=>{g({search:t.search})},r=()=>{t.search||g()},v=u=>{S.value.page=u,g()},g=async u=>{try{M.value=!0;const n=S.value.page===1?"":S.value,f=u?{...n,...u}:n,{data:x}=await R({url:H.value,method:"GET",params:f});E.value=x.data,A.value=x.total,C.value=x.per_page}catch(n){console.error("Error de red:",n)}finally{M.value=!1}},ae=xe(()=>u=>(S.value.page-1)*C.value+u+1);return de(()=>{g(),window.addEventListener("resize",Z),Z()}),(u,n)=>{const f=c("a-button"),x=c("a-col"),a=c("a-input"),te=c("a-input-group"),s=c("a-row"),ne=c("a-select"),oe=c("a-tag"),ce=c("a-textarea"),le=c("a-menu-item"),ue=c("a-popconfirm"),me=c("a-menu"),pe=c("a-dropdown"),_e=c("a-table"),ve=c("a-pagination"),ge=c("a-drawer");return l(),y("div",null,[n[9]||(n[9]=O("h3",{class:"title-produce"},"PLANES DE ACCIÓN",-1)),i(s,{style:{margin:"1rem 0"}},{default:d(()=>[i(x,{xs:24,md:12,lg:18},{default:d(()=>[i(f,{onClick:n[0]||(n[0]=I=>e.value=!0),type:"primary"},{default:d(()=>n[4]||(n[4]=[T("NUEVO")])),_:1}),i(f,{class:"btn-excel",loading:D.value,type:"primary",style:{"margin-left":".6rem"},onClick:V},{default:d(()=>n[5]||(n[5]=[O("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Ce},null,-1),T(" DESCARGAR ")])),_:1},8,["loading"])]),_:1}),i(x,{xs:24,md:12,lg:6},{default:d(()=>[i(te,{compact:""},{default:d(()=>[i(a,{value:t.search,"onUpdate:value":n[1]||(n[1]=I=>t.search=I),style:{width:"calc(100% - 80px)"},onInput:r},null,8,["value"]),i(f,{type:"primary",disabled:t.search==="",onClick:o},{default:d(()=>n[6]||(n[6]=[T("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(_e,{bordered:"",scroll:{x:J.value,y:B.value},class:"table-actions",columns:X,"data-source":E.value,pagination:!1,loading:M.value,size:"small"},{bodyCell:d(({column:I,record:p,index:fe})=>[I.dataIndex==="idx"?(l(),y(Y,{key:0},[T(F(ae.value(fe)),1)],64)):m("",!0),I.dataIndex==="ruc"?(l(),y(Y,{key:1},[p.ruc?(l(),y("span",$e,F(p.ruc),1)):(l(),y("span",Fe,"En trámite"))],64)):m("",!0),I.dataIndex==="acta"?(l(),b(ne,{key:2,value:p.actaCompromiso,"onUpdate:value":h=>p.actaCompromiso=h,style:{width:"70%"},options:q.value,onChange:h=>W(h,p,"actaCompromiso")},null,8,["value","onUpdate:value","options","onChange"])):m("",!0),I.dataIndex==="envioCorreo"?(l(),b(ne,{key:3,value:p.envioCorreo,"onUpdate:value":h=>p.envioCorreo=h,style:{width:"70%"},options:q.value,onChange:h=>W(h,p,"envioCorreo")},null,8,["value","onUpdate:value","options","onChange"])):m("",!0),I.dataIndex==="status"?(l(),y(Y,{key:4},[k(w)[0].id!=2?(l(),y("div",ze,[i(ne,{value:p.status,"onUpdate:value":h=>p.status=h,options:Q.value,style:{width:"90%"},onChange:h=>ee(h,p)},null,8,["value","onUpdate:value","options","onChange"])])):(l(),y("div",Be,[i(oe,{color:p.status=="observado"?"orange":"green"},{default:d(()=>[T(F(p.status),1)]),_:2},1032,["color"])]))],64)):m("",!0),I.dataIndex==="detalle"?(l(),y(Y,{key:5},[k(w)[0].id!=2?(l(),y("div",Ge,[i(ce,{value:p.details,"onUpdate:value":h=>p.details=h,rows:1,maxlength:255},null,8,["value","onUpdate:value"]),i(f,{class:"details-plans-btn",type:"text",icon:ie(k(Ne)),onClick:h=>K(h,p)},null,8,["icon","onClick"])])):(l(),y("div",Ve,[O("p",null,F(p.details),1)]))],64)):m("",!0),I.dataIndex=="actions"?(l(),y(Y,{key:6},[p.status=="observado"||k(w)[0].id!=2?(l(),y("div",We,[i(pe,{trigger:["click"]},{overlay:d(()=>[i(me,null,{default:d(()=>[i(le,null,{default:d(()=>[O("a",{onClick:h=>$(p)},"Editar",8,Ze)]),_:2},1024),i(le,null,{default:d(()=>[i(ue,{title:"¿Seguro de eliminar?",onConfirm:h=>L(p)},{icon:d(()=>[i(k(Ee),{style:{color:"red"}})]),default:d(()=>[n[7]||(n[7]=O("a",null,"Eliminar",-1))]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:d(()=>[O("a",{class:"ant-dropdown-link",onClick:n[2]||(n[2]=Ie(()=>{},["prevent"]))},[i(f,{shape:"circle",icon:ie(k(ke)),size:"small"},null,8,["icon"])])]),_:2},1024)])):m("",!0)],64)):m("",!0)]),_:1},8,["scroll","data-source","loading"]),O("div",je,[O("span",null,[i(oe,{color:"blue"},{default:d(()=>[O("b",null,F(A.value),1)]),_:1}),n[8]||(n[8]=T("Registros"))]),i(ve,{size:"small",total:A.value,pageSize:C.value,onChange:v,showSizeChanger:!1},null,8,["total","pageSize"])]),i(ge,{open:e.value,"onUpdate:open":n[3]||(n[3]=I=>e.value=I),title:"Agregar Plan de Acción",placement:"right",width:"650"},{default:d(()=>[i(Re,{onCloseDraw:j,info:U.value},null,8,["info"])]),_:1},8,["open"])])}}};export{ta as default};
