import{N as ye,r as _,a as j,b as d,o as n,s as h,w as l,e as U,d as y,F as k,y as ke,h as L,v as r,c as i,O as we,t as v,i as p,B as M,m as N,k as pe,M as ce,K as Ue,L as xe,R as Ce}from"./index-74782dfc.js";import{f as Ae}from"./actualizarUsuario-3eaca126.js";import{u as De}from"./selectes-1f021d5d.js";import"./es-7ea590ce.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Se}from"./MoreOutlined-ce8463ad.js";const Ee={class:"grid-profile"},Pe="YYYY-MM-DD",Re={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(q,{emit:E}){ye.locale("es");const a=De(),P=JSON.parse(localStorage.getItem("profile")),A=E;a.$patch({genders:a.genders}),a.$patch({cdes:a.cdes}),a.$patch({Offices:a.Offices}),a.$patch({roles:a.roles}),a.$patch({supervisores:a.supervisores}),a.fetchGenders(),a.fetchCdes(),a.fetchOffices(),a.fetchRoles();const D=q,x=_(!1),c=_(Ae),I=_(null),t=j({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:P.id}),m=s=>{s&&(t.name=s.profile.name,t.lastname=s.profile.lastname,t.middlename=s.profile.middlename,t.birthday=s.profile.birthday,t.sick=s.profile.sick,t.phone=s.profile.phone,t.gender_id=s.profile.gender_id,t.cde_id=s.profile.cde_id,t.office_id=s.profile.office_id,t.email=s.email)},w=s=>{const C={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(s===2)a.fetchSupervisores(),c.value={...c.value,supervisor_id:C};else{const{supervisor_id:R,...S}=c.value;c.value=S}},z=async()=>{x.value=!0;let s=t;delete s.email;try{const C=await M({url:`user/update/${D.updateUser.profile.id}`,method:"PUT",data:s});N.success(C.message),A("closeDraw",!0)}catch{N.error("No se pudo registrar este usuario")}finally{x.value=!1}},O=()=>{N.error("Debes de completar todos los espacios requeridos")};return(s,C)=>{const R=d("a-select"),S=d("a-form-item"),T=d("a-input"),B=d("a-date-picker"),Y=d("a-button"),F=d("a-form");return n(),h(F,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:z,onFinishFailed:O},{default:l(()=>[U("div",Ee,[(n(!0),y(k,null,ke(c.value,(e,H)=>(n(),y(k,{key:H},[e.type==="iSelect"?(n(),h(S,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[e.name=="gender_id"?(n(),h(R,{key:0,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:L(a).genders},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="cde_id"?(n(),h(R,{key:1,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:L(a).cdes},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="office_id"?(n(),h(R,{key:2,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:L(a).Offices},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="role_id"?(n(),h(R,{key:3,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:L(a).roles,onChange:w},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="supervisor_id"?(n(),h(R,{key:4,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:L(a).supervisores},null,8,["value","onUpdate:value","options"])):r("",!0)]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iText"?(n(),h(S,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:l(()=>[i(T,{value:t[e.name],"onUpdate:value":o=>t[e.name]=o,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iDate"?(n(),h(S,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[i(B,{locale:L(we),value:I.value,"onUpdate:value":C[0]||(C[0]=o=>I.value=o),style:{width:"100%"},format:Pe},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):r("",!0)],64))),128))]),U("div",null,v(m(D.updateUser)),1),i(S,null,{default:l(()=>[i(Y,{class:"btn-produce",type:"primary","html-type":"submit",loading:x.value},{default:l(()=>[p("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},Fe=Ie(Re,[["__scopeId","data-v-3578053d"]]);const Le=U("br",null,null,-1),Oe=U("br",null,null,-1),$e={__name:"DrawAdministrarVistasUsuario",props:["idUser"],emits:["closeDraw"],setup(q,{emit:E}){const a=q,P=E,A=_(!0),D=_(!1),x=[{label:"Inicio",value:"inicio"},{label:"Drive Principal",value:"drive"},{label:"Drive Carpetas",value:"drive-mis-carpetas"},{label:"Drive Archivos",value:"drive-mis-archivos"},{label:"Drive Subir Archivo",value:"drive-subir-archivo"},{label:"AF - Principal",value:"asesorias"},{label:"AF - Registro",value:"asesorias-formalizaciones"},{label:"AF - Reportes",value:"asesorias"},{label:"AF - Planes de AcciÃ³n",value:"planes-accion"},{label:"AF - Solicitantes",value:"solicitantes"},{label:"AF - Notarias",value:"notarias"},{label:"AF - Asesores",value:"asesores"},{label:"Convenios Principal",value:"convenios"},{label:"Convenios Lista",value:"estado-convenio"},{label:"Usuarios Principal",value:"usuarios"},{label:"Usuarios Registrar",value:"usuarios-nuevo"},{label:"Usuarios Externo",value:"asesor-externo-notario"},{label:"Usuarios Lista",value:"usuarios-lista"},{label:"Config. Principal",value:"configuraciones"},{label:"Config. Token API",value:"tokens"}];pe(()=>{a.idUser&&t(a.idUser)});const c=j({indeterminate:!0,checkAll:!1,checkedList:[]});ce(()=>c.checkedList,m=>{c.indeterminate=!!m.length&&m.length<x.length,c.checkAll=m.length===x.length}),ce(()=>a.idUser,m=>{m&&t()});const I=async()=>{D.value=!0;const m={views:c.checkedList};try{const w=await M({url:`user/views/${a.idUser.id}`,method:"PUT",data:m});if(w.status==403)return N.error(w.message);N.success(w.message),P("closeDraw",!0)}catch{N.error("No se pudo registrar este usuario")}finally{D.value=!1}},t=async()=>{A.value=!0;try{const{data:m}=await M({url:`user/views/${a.idUser.id}`,method:"GET"});c.checkedList=m}catch(m){console.log("Error",m)}finally{A.value=!1}};return(m,w)=>{const z=d("a-checkbox-group"),O=d("a-spin"),s=d("a-button");return n(),y(k,null,[i(O,{spinning:A.value},{default:l(()=>[i(z,{value:c.checkedList,"onUpdate:value":w[0]||(w[0]=C=>c.checkedList=C),options:x,class:"views-list"},null,8,["value"])]),_:1},8,["spinning"]),Le,Oe,i(s,{type:"primary","html-type":"submit",loading:D.value,onClick:I},{default:l(()=>[p("GUARDAR")]),_:1},8,["loading"])],64)}}};const Ne=U("h3",{class:"title-produce"},"USUARIOS DEL PROGRAMA PNTE",-1),ze=["onClick"],Ve=["onClick"],qe={class:"paginator"},je={__name:"ListaUsuarios",setup(q){const E=_(null),a=_(!1),P=_(!1),A=_(50),D=_([]),x=_(!1),c=_(0),I=_({page:1}),t=_("user/list"),m=_(1200),w=_(window.innerHeight-100),z=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:80},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Fecha Nac.",dataIndex:"birthday",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"ROL",dataIndex:"role",width:160},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],O=()=>{w.value=window.innerHeight-300},s=j({search:""}),C=()=>{let o={search:s.search};F(o)},R=()=>{s.search||F()},S=()=>{F(),a.value=!1,P.value=!1},T=o=>{I.value.page=o,F()},B=o=>{E.value=o,a.value=!0},Y=o=>{E.value=o,P.value=!0},F=async o=>{try{x.value=!0;const g=I.value.page===1?"":I.value,G=o?{...g,...o}:g,{data:V}=await M({url:t.value,method:"GET",params:G});D.value=V.data,c.value=V.total,A.value=V.per_page}catch(g){console.error("Error de red:",g)}finally{x.value=!1}},e=Ue(()=>o=>(I.value.page-1)*A.value+o+1);pe(()=>{F(),window.addEventListener("resize",O),O()});const H=()=>{console.log("Drawer state changed")};return(o,g)=>{const G=d("a-col"),V=d("a-input"),J=d("a-button"),me=d("a-input-group"),fe=d("a-row"),$=d("a-tag"),K=d("a-menu-item"),_e=d("a-menu"),ve=d("a-dropdown"),he=d("a-table"),ge=d("a-pagination"),X=d("a-drawer");return n(),y(k,null,[U("div",null,[Ne,i(fe,{style:{margin:"1rem 0"}},{default:l(()=>[i(G,{xs:24,md:12,lg:18}),i(G,{xs:24,md:12,lg:6},{default:l(()=>[i(me,{compact:""},{default:l(()=>[i(V,{value:s.search,"onUpdate:value":g[0]||(g[0]=f=>s.search=f),style:{width:"calc(100% - 80px)"},onInput:R},null,8,["value"]),i(J,{type:"primary",disabled:s.search==="",onClick:C},{default:l(()=>[p("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(he,{bordered:"",scroll:{x:m.value,y:w.value},class:"table-users",columns:z,"data-source":D.value,pagination:!1,loading:x.value,size:"small"},{bodyCell:l(({column:f,record:u,index:be})=>{var Q,W,Z,ee,ae,te,ne,oe,le,se,ie,re,ue,de;return[f.dataIndex==="idx"?(n(),y(k,{key:0},[p(v(e.value(be)),1)],64)):r("",!0),f.dataIndex=="documentnumber"?(n(),y(k,{key:1},[p(v((Q=u.profile)==null?void 0:Q.documentnumber),1)],64)):r("",!0),f.dataIndex=="name"?(n(),y(k,{key:2},[p(v((W=u.profile)==null?void 0:W.name),1)],64)):r("",!0),f.dataIndex=="lastname"?(n(),y(k,{key:3},[p(v((Z=u.profile)==null?void 0:Z.lastname)+" "+v((ee=u.profile)==null?void 0:ee.middlename),1)],64)):r("",!0),f.dataIndex=="phone"?(n(),y(k,{key:4},[p(v((ae=u.profile)!=null&&ae.phone?(te=u.profile)==null?void 0:te.phone:"ðŸ”’"),1)],64)):r("",!0),f.dataIndex=="birthday"?(n(),y(k,{key:5},[p(v((ne=u.profile)!=null&&ne.birthday?(oe=u.profile)==null?void 0:oe.birthday:"ðŸ”’"),1)],64)):r("",!0),f.dataIndex=="office"?(n(),y(k,{key:6},[((le=u.profile.office)==null?void 0:le.name)=="UGSE"?(n(),h($,{key:0,color:"blue"},{default:l(()=>{var b;return[p(v((b=u.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((se=u.profile.office)==null?void 0:se.name)=="UGO"?(n(),h($,{key:1,color:"orange"},{default:l(()=>{var b;return[p(v((b=u.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((ie=u.profile.office)==null?void 0:ie.name)=="DE"?(n(),h($,{key:2,color:"green"},{default:l(()=>{var b;return[p(v((b=u.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((re=u.profile.office)==null?void 0:re.name)=="UGEER"?(n(),h($,{key:3,color:"gray"},{default:l(()=>{var b;return[p(v((b=u.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((ue=u.profile.office)==null?void 0:ue.id)==5?(n(),h($,{key:4,color:"blue"},{default:l(()=>[p("Asesor NotarÃ­a ")]),_:1})):r("",!0)],64)):r("",!0),f.dataIndex=="cde"?(n(),y(k,{key:7},[p(v((de=u.profile)==null?void 0:de.cde.name),1)],64)):r("",!0),f.dataIndex=="role"?(n(),y(k,{key:8},[p(v(u.roles[0].name),1)],64)):r("",!0),f.dataIndex=="actions"?(n(),h(ve,{key:9,trigger:["click"]},{overlay:l(()=>[i(_e,null,{default:l(()=>[i(K,null,{default:l(()=>[U("a",{onClick:b=>B(u)},"Editar",8,ze)]),_:2},1024),i(K,null,{default:l(()=>[U("a",{onClick:b=>Y(u)},"Vistas",8,Ve)]),_:2},1024)]),_:2},1024)]),default:l(()=>[U("a",{class:"ant-dropdown-link",onClick:g[1]||(g[1]=xe(()=>{},["prevent"]))},[i(J,{shape:"circle",icon:Ce(L(Se)),size:"small"},null,8,["icon"])])]),_:2},1024)):r("",!0)]}),_:1},8,["scroll","data-source","loading"])]),U("div",qe,[U("span",null,[i($,{color:"blue"},{default:l(()=>[U("b",null,v(c.value),1)]),_:1}),p("Usuarios")]),i(ge,{size:"small",total:c.value,pageSize:A.value,onChange:T,showSizeChanger:!1},null,8,["total","pageSize"])]),i(X,{width:"550",open:a.value,"onUpdate:open":g[2]||(g[2]=f=>a.value=f),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:H},{default:l(()=>[i(Fe,{updateUser:E.value,onCloseDraw:S},null,8,["updateUser"])]),_:1},8,["open"]),i(X,{width:"450",open:P.value,"onUpdate:open":g[3]||(g[3]=f=>P.value=f),class:"draw-notary",title:"Administrar Vistas",placement:"right"},{default:l(()=>[i($e,{idUser:E.value,onCloseDraw:S},null,8,["idUser"])]),_:1},8,["open"])],64)}}};export{je as default};
