import{p as te,s as E,E as ne,r as y,a as se,k as oe,b,o as l,d as h,c as m,w as u,i as I,F as O,L as re,f as S,e as c,j as C,N as le,O as ie,t as ce,v as de,y as f,z as g,M as me,h as N,Q as P,R as M}from"./index-119169c4.js";import{_ as ue}from"./calendar-e0a6119a.js";import{u as pe}from"./selectes-0b54015a.js";import{F as be}from"./FormalizacionFooter-2a5b3717.js";import{u as ge}from"./useBusinessman-bed215e3.js";import"./es-5629675f.js";/* empty css                                                                            */import"./_plugin-vue_export-helper-c27b6911.js";import"./EnvironmentOutlined-2a2514e1.js";const fe={class:"attendance"},_e={class:"container"},ye={key:0,class:"fair-caducated"},ve={key:1,class:"attendance-section"},he={class:"attendance-title"},Ee={class:"attendance-form"},Se={key:7},xe="DD/MM/YYYY",Ue={__name:"IndexAsistencias",emits:["nextStep2"],setup(Re,{emit:De}){te.locale("es");const $=E(re,{style:{fontSize:"24px"},spin:!0}),A=ne(),i=pe();i.$patch({typeDocuments:i.typeDocuments}),i.$patch({economicSectors:i.economicSectors}),i.$patch({genders:i.genders}),i.fetchEconomicSectors(),i.fetchTypeDocuments(),i.fetchGenders();const z=ge(),k=y(!1),x=y(!0),q=y(null),R=y(!1),D=y(!1),T=y(!1),e=se({}),B=[{value:"si",label:"SI"},{value:"no",label:"NO"}],F=n=>{if(n==="country_id")return i.countries;if(n==="gender_id")return i.genders;if(n==="sick")return B;if(n==="typedocument_id")return i.typeDocuments},w=y({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO DE IDENTIDAD",name:"typedocument_id",required:!0,message:"Seleccionar tipo",disabled:!1},documentnumber:{type:"iSearch",label:"INGRESE NÚMERO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir tu número de documento",disabled:!0,max:11},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0,max:50},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir nombre",disabled:!0,max:50},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir nombre",disabled:!0,max:50},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0,max:255},phone:{type:"iText",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe tu num. de celular",disabled:!0,max:9},ruc:{type:"iSearchRuc",label:"NÚMERO DE RUC",name:"ruc",required:!1,message:"Escribir RUC",disabled:!0,max:11},socialReason:{type:"iText",label:"NOMBRE COMERCIAL",name:"socialReason",required:!1,message:"Escribir la razón social",disabled:!1,max:100},economicsector_id:{type:"iSelectWrite",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!1,message:"Seleccionar sector económnico",disabled:!1},comercialactivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity",required:!1,message:"Seleccionar sector económnico",disabled:!1,max:100}}),G=(n,t)=>{if(!t)return Promise.reject("La fecha es requerida");const s=new Date,o=new Date(t);let d=s.getFullYear()-o.getFullYear();const p=s.getMonth()-o.getMonth();return(p<0||p===0&&s.getDate()<o.getDate())&&d--,d<18||d>99?Promise.reject("La edad debe estar entre 18 y 99 años"):Promise.resolve()},V=(n,t)=>{if(n.field==="phone"){const s=/^9\d{8}$/;if(t){if(!s.test(t))return Promise.reject("El número debe empezar con 9 y tener exactamente 9 dígitos")}else return Promise.reject("El número de teléfono es obligatorio")}return n.field,Promise.resolve()},j=n=>{const t=e[n]?e[n].trim():"";e[n]=t},Y=n=>{n=="typedocument_id"&&(e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.email=null,e.phone=null)},W=(n,t)=>{const s=e.typedocument_id;return/^\d+$/.test(t)?s===1&&t.length!==8?Promise.reject("Debe tener exactamente 8 caracteres."):s!==1&&t.length>12?Promise.reject("Debe tener exactamente 12 caracteres."):(s===1&&t.startsWith("0")&&t.length===8,Promise.resolve()):Promise.reject("Solo se permiten números.")},K=async()=>{const{typedocument_id:n,documentnumber:t}=e;if(!n||!t){N.error("El tipo de documento y el número de documento no pueden estar vacíos.");return}if(!/^\d+$/.test(t)){N.error("El número de documento solo debe contener caracteres numéricos.");return}if(n===1&&t.length!==8){N.error("El número de documento debe tener exactamente 8 caracteres para el tipo de documento DNI.");return}const s=["name","lastname","middlename","sick","email","phone","gender_id","ruc"],o=d=>{s.forEach(p=>{w.value[p].disabled=d})};try{if(R.value=!0,e.typedocument_id==1){const d={documentnumber:e.documentnumber},p=await S({url:`api/consult-businessman-dni/${e.documentnumber}`,method:"POST"}),{data:_}=p;if(p.status==200)e.lastname=_.lastname,e.middlename=_.middlename,e.name=_.name,e.gender_id=_.gender_id;else if(p.status==404){const v=await z.reniec(d);return v.status==200&&(e.name=v.data.name,e.lastname=v.data.lastname,e.middlename=v.data.middlename),P.warning({message:"Aviso",description:"El servicio de consulta RENIEC no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}else return console.log("Error...")}}catch(d){console.error("Error de red:",d)}finally{o(!1),R.value=!1}},Q=async()=>{if(!(/^\d{11}$/.test(e.ruc)&&/^(10|15|20)/.test(e.ruc)))return console.error("El RUC debe tener 11 caracteres, comenzar con 11, 15 o 20, y contener solo números.");D.value=!0;try{const t=await S({url:`api/consult-company-ruc/${e.ruc}`,method:"POST"});if(t.status==200){const{data:s}=t;e.socialReason=s.socialReason}else t.status==404&&P.warning({message:"Aviso",description:"El servicio de consulta SUNAT no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}catch(t){console.log("Error: ",t)}finally{D.value=!1}},U=(n,t)=>{const s=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s)},L=()=>{e.typedocument_id=null,e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.email=null,e.phone=null,e.ruc=null,e.socialReason=null,e.economicsector_id=null,e.comercialactivity=null},H=async()=>{T.value=!0;const t={slug:A.params.slug,typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,name:e.name,lastname:e.lastname,middlename:e.middlename,gender_id:e.gender_id,sick:e.sick,email:e.email,phone:e.phone,ruc:e.ruc,socialReason:e.socialReason,economicsector_id:e.economicsector_id,comercialActivity:e.comercialactivity};try{const s=await S({url:"public/attendance-present",method:"POST",data:t});s.status==200&&M.success({title:"REGISTRADO",content:E("div",{},[E("p",s.message)]),onOk(){L(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"}),s.status==400&&M.warning({title:"REGISTRO AVISO",content:E("div",{},[E("p",s.message)]),onOk(){L(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"})}catch(s){console.error("Error de red:",s)}finally{T.value=!1}},J=async()=>{try{const n=A.params.slug,t=await S({url:`public/data-attendance/${n}`,method:"GET"});t.status==200&&(q.value=t.data.title,x.value=!1),t.status==400&&router.push("/404"),t.status==500&&(k.value=!0,x.value=!1)}catch(n){console.error("Error de red:",n)}finally{}};return oe(()=>{J()}),(n,t)=>{const s=b("a-input-search"),o=b("a-form-item"),d=b("a-input"),p=b("a-date-picker"),_=b("a-select"),v=b("a-textarea"),X=b("a-button"),Z=b("a-form"),ee=b("a-spin");return l(),h(O,null,[m(ee,{spinning:x.value,indicator:I($)},{default:u(()=>[c("div",fe,[c("div",_e,[k.value?(l(),h("section",ye,t[1]||(t[1]=[c("div",{class:"container"},[c("div",{class:"fair-caducated-info"},[c("img",{src:ue,alt:""}),c("h4",null,"EL REGISTRO NO ESTÁ DISPONIBLE"),c("p",null,[C("El formulario de inscripción ya no está disponible. "),c("br"),C(" Agradecemos su interés y lo invitamos a estar atento a nuestros próximos eventos.")])])],-1)]))):(l(),h("section",ve,[m(Z,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:H,onKeydown:t[0]||(t[0]=le(ie(()=>{},["prevent"]),["enter"]))},{default:u(()=>[c("div",he,[t[2]||(t[2]=c("h2",null,"REGISTRO DE ASISTENCIA",-1)),c("h3",null,ce(q.value),1)]),c("div",Ee,[(l(!0),h(O,null,de(w.value,(a,ae)=>(l(),h(O,{key:ae},[a.type==="iSearch"?(l(),f(o,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,validator:W}]},{default:u(()=>[m(s,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,placeholder:"","enter-button":"CONSULTAR DNI",loading:R.value,maxlength:e.typedocument_id===1?8:12,onSearch:K},null,8,["value","onUpdate:value","loading","maxlength"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSearchRuc"?(l(),f(o,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{pattern:/^(10|15|20)\d{9,}$/,message:"El número debe comenzar con 10, 15 o 20, tener solo números, y al menos 11 caracteres"}]},{default:u(()=>[m(s,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,placeholder:"Ingresar RUC","enter-button":"BUSCAR",loading:D.value,maxlength:a.max,onSearch:Q,disabled:a.disabled},null,8,["value","onUpdate:value","loading","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iText"?(l(),f(o,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{validator:V}]},{default:u(()=>[m(d,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,maxlength:a.max,onBlur:r=>j(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","onBlur","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iDate"?(l(),f(o,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message},{validator:G,message:"La edad debe estar entre 18 y 99 años"}]},{default:u(()=>[m(p,{locale:I(me),value:e[a.name],"onUpdate:value":r=>e[a.name]=r,style:{width:"100%"},format:xe,placeholder:"día/mes/año",disabled:a.disabled},null,8,["locale","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSelect"?(l(),f(o,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:u(()=>[m(_,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:F(a.name),"show-search":"","filter-option":U,onChange:r=>Y(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","options","onChange","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iTextarea"?(l(),f(o,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:u(()=>[m(v,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,rows:4,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSelectWrite"?(l(),f(o,{key:6,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:u(()=>[a.name=="economicsector_id"?(l(),f(_,{key:0,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,"show-search":"",options:I(i).economicSectors,"filter-option":U,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):g("",!0)]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="space1"?(l(),h("div",Se)):g("",!0)],64))),128))]),m(o,null,{default:u(()=>[m(X,{type:"primary","html-type":"submit",loading:T.value,class:"attendance-btn"},{default:u(()=>t[3]||(t[3]=[C("REGISTRARSE")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))])])]),_:1},8,["spinning","indicator"]),m(be)],64)}}};export{Ue as default};
