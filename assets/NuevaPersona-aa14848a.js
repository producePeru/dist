import{K as v,y as fe,r as h,u as he,a as ge,k as De,b as _,o as r,d as L,c as g,w as f,e as F,F as ae,x as qe,q as c,h as x,s as m,L as Ye,t as Se,i as xe,p as Te,j as Ne,m as q,z as T,f as I}from"./index-990720bf.js";import{u as we}from"./selectes-73568308.js";import{d as Ee}from"./selects-c77e0024.js";import"./es-4ca361dc.js";import{_ as Me}from"./_plugin-vue_export-helper-c27b6911.js";const ke={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country:{type:"iText",label:"País Origen",name:"country",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"Departamento residente",name:"city_id",required:!0,message:"Seleccionar departamento",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",min:9,max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!0,message:"¿Tiene discapacidad?",disabled:!0}};const te=N=>(Te("data-v-dd6e956a"),N=N(),Ne(),N),Ue={class:"agreement-wrapper"},Pe=te(()=>F("h3",null,"Formulario de registro",-1)),$e=te(()=>F("br",null,null,-1)),Ie={class:"grid-item"},Fe="DD/MM/YYYY",Ce={__name:"NuevaPersona",setup(N){v.locale("es");const Y=fe(),l=we();l.$patch({typeDocuments:l.typeDocuments}),l.$patch({cities:l.cities}),l.$patch({provinces:l.provinces}),l.$patch({districts:l.districts}),l.$patch({genders:l.genders}),l.fetchTypeDocuments(),l.fetchCities(),l.fetchGenders();const C=h(null),G=h(null),ne=he(),O=JSON.parse(localStorage.getItem("profile")),n=h(ke),D=h(!0),p=h(null),R=h(!1),ie=h(!0),e=ge({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,country:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,lession:null,people_id:O.user_id,from_id:1}),de=i=>{i=="phone"&&(e[i]=e[i].replace(/[^0-9]/g,""))},le=async i=>{try{const{data:o}=await I({url:`select/provinces/${i}`,method:"GET"});C.value=o}catch(o){console.error("Error de red:",o)}},oe=async i=>{try{const{data:o}=await I({url:`select/districts/${i}`,method:"GET"});G.value=o}catch(o){console.error("Error de red:",o)}},z=(i,o)=>{const u=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(u)},se=()=>{l.typeDocuments&&(ie.value=!1)},re=()=>{n.value.lastname.disabled=!1,n.value.middlename.disabled=!1,n.value.name.disabled=!1,n.value.city_id.disabled=!1,n.value.province_id.disabled=!1,n.value.district_id.disabled=!1,n.value.address.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthday.disabled=!1,n.value.gender_id.disabled=!1,n.value.lession.disabled=!1},A=i=>{i&&(n.value.documentnumber.disabled=!1,e.documentnumber=null)},B=async i=>{var o,u,b,w,E,M,k,U,P,a,$,d,j,J,K,H,Q,W;if(D.value=!0,!i)return q.warning("Ingresa un número de documento"),D.value=!1;try{if(e.typedocument_id==1){const{data:t}=await T({url:`user/api/dni/${e.documentnumber}`,method:"GET"});if(!t||!t.body||!t.body.apePaterno){const s=await T({url:`user/only-dni/${e.documentnumber}`,method:"GET"});return e.lastname=s.data.apellidoPaterno,e.middlename=s.data.apellidoMaterno,e.name=s.data.nombres,e.country="PERÚ",D.value=!1}if(t.body&&(e.lastname=(o=t.body)==null?void 0:o.apePaterno,e.middlename=(u=t.body)==null?void 0:u.apeMaterno,e.name=(b=t.body)==null?void 0:b.preNombres,e.address=(w=t.body)==null?void 0:w.desDireccion,e.country="PERÚ",(E=t.body)!=null&&E.feNacimiento&&(e.birthday=v((M=t.body)==null?void 0:M.feNacimiento,"DD/MM/YYYY")),(k=t.body)!=null&&k.feNacimiento&&(p.value=v((U=t.body)==null?void 0:U.feNacimiento,"DD/MM/YYYY")),(P=t.body)!=null&&P.ubigeo)){let s=l.cities.find(S=>{var y;return S.label===((y=t.body.ubigeo)==null?void 0:y.departamento)}),X=await I({url:`select/provinces/${s.value}`,method:"GET"});C.value=X.data;let Z=X.data.find(S=>{var y;return S.label===((y=t.body.ubigeo)==null?void 0:y.provincia)}),ee=await I({url:`select/districts/${Z.value}`,method:"GET"});G.value=ee.data;let _e=ee.data.find(S=>{var y;return S.label===((y=t.body.ubigeo)==null?void 0:y.distrito)});e.city_id=s.value,e.province_id=Z.value,e.district_id=_e.value}}if(e.typedocument_id==2){const{data:t}=await T({url:`user/api/ce/${e.documentnumber}`,method:"GET"});t.body&&(console.log("data: "+t),e.lastname=(a=t.body)==null?void 0:a.apellido_paterno,e.middlename=($=t.body)==null?void 0:$.apellido_materno,e.name=(d=t.body)==null?void 0:d.nombres,e.gender_id=((j=t.body)==null?void 0:j.sexo)=="F"?2:1,(J=t.body)!=null&&J.fecha_nacimiento&&(e.birthday=v((K=t.body)==null?void 0:K.fecha_nacimiento,"DD/MM/YYYY")),(H=t.body)!=null&&H.fecha_nacimiento&&(p.value=v((Q=t.body)==null?void 0:Q.fecha_nacimiento,"DD/MM/YYYY")),e.country=t.body.nacionalidad)}if(e.typedocument_id==3){const{data:t}=await T({url:`user/api/pas/${e.documentnumber}`,method:"GET"}),s=(W=t.body)==null?void 0:W.data[0];e.lastname=s.apellido_paterno,e.middlename=s.apellido_materno,e.name=s.nombres,e.gender_id=s.sexo=="F"?2:1,s.fecha_nacimiento&&(e.birthday=v(s.fecha_nacimiento,"DD/MM/YYYY")),s.fecha_nacimiento&&(p.value=v(s.fecha_nacimiento,"DD/MM/YYYY"))}}catch(t){console.log("err",t)}finally{return re(),D.value=!1}},ue=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},ce=i=>{e.province_id=null,e.district_id=null,le(i)},me=i=>{e.district_id=null,oe(i)},pe=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.lession=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=O.id,p.value=null,V()},V=()=>{n.value.documentnumber.disabled=!0,n.value.lastname.disabled=!0,n.value.middlename.disabled=!0,n.value.name.disabled=!0,n.value.city_id.disabled=!0,n.value.city_id.disabled=!0,n.value.province_id.disabled=!0,n.value.address.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthday.disabled=!0,n.value.gender_id.disabled=!0,n.value.lession.disabled=!0},be=async()=>{R.value=!0,e.birthday=p.value?v(p.value).format("YYYY-MM-DD"):null;try{const i=await T({url:"person/create",method:"POST",data:e});if(i.status==400)return q.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(i.status==401)return q.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(i.status==200){const o={type:e.typedocument_id,number:e.documentnumber};return ne.push({name:"asesorias-formalizaciones",query:o}),q.success(i.message),pe()}}catch{q.error("No se pudo registrar este usuario")}finally{R.value=!1}},ye=()=>{q.error("Debes de completar todos los espacios requeridos")},ve=async()=>{V(),Y.query&&(e.typedocument_id=+Y.query.type,A(Y.query.type),e.documentnumber=Y.query.number,await l.fetchCities(),await B(Y.query.number))};return De(()=>{ve()}),(i,o)=>{const u=_("a-select"),b=_("a-form-item"),w=_("a-input-search"),E=_("a-input"),M=_("a-date-picker"),k=_("a-button"),U=_("a-form"),P=_("a-spin");return r(),L("div",Ue,[Pe,$e,g(P,{spinning:D.value},{default:f(()=>[g(U,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:be,onFinishFailed:ye},{default:f(()=>[F("div",Ie,[(r(!0),L(ae,null,qe(n.value,(a,$)=>(r(),L(ae,{key:$},[a.type==="iSelect"?(r(),c(b,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[a.name=="typedocument_id"?(r(),c(u,{key:0,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:x(l).typeDocuments,disabled:a.disabled,onChange:A},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="city_id"?(r(),c(u,{key:1,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:x(l).cities,"show-search":"","filter-option":z,onChange:ce,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="province_id"?(r(),c(u,{key:2,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:C.value,"show-search":"","filter-option":z,onChange:me,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(r(),c(u,{key:3,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:G.value,"show-search":"","filter-option":z,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="gender_id"?(r(),c(u,{key:4,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:x(l).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="lession"?(r(),c(u,{key:5,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,options:x(Ee),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(r(),c(b,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[g(w,{loading:D.value,value:e[a.name],"onUpdate:value":d=>e[a.name]=d,onSearch:B,onInput:ue,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(r(),c(b,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max,min:a.min}]},{default:f(()=>[g(E,{value:e[a.name],"onUpdate:value":d=>e[a.name]=d,disabled:a.disabled,maxlength:a.max,onInput:d=>de(a.name)},null,8,["value","onUpdate:value","disabled","maxlength","onInput"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(r(),c(b,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[g(M,{locale:x(Ye),value:p.value,"onUpdate:value":o[0]||(o[0]=d=>p.value=d),style:{width:"100%"},format:Fe,placeholder:"día/mes/año",onChange:o[1]||(o[1]=d=>e.birthday=p.value),disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),F("div",null,Se(se()),1),g(b,null,{default:f(()=>[g(k,{class:"btn-produce",type:"primary","html-type":"submit",loading:R.value},{default:f(()=>[xe("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Ae=Me(Ce,[["__scopeId","data-v-dd6e956a"]]);export{Ae as default};
