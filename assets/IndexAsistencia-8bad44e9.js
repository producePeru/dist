import{_ as ee}from"./TableComponent-3702aecc.js";import{l as b,r as y,E as ae,a as Z,X as j,j as J,b as _,o,x as u,w as i,e as N,d as U,F as V,s as te,c as p,y as d,h as A,M as ne,i as k,t as se,R as P,m as O,u as le,a6 as Q,f as re,a2 as ie}from"./index-de215d4c.js";import{u as oe}from"./selectes-00f4059e.js";import"./es-b2c0b038.js";import{d as de}from"./downloadExcel-ddd3bf72.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-a0a6ebb2.js";const ce={class:"form-attendance"},ue="DD/MM/YYYY",me={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup($,{emit:B}){b.locale("es");const c=oe();c.$patch({cities:c.cities}),c.$patch({provinces:c.provinces}),c.$patch({districts:c.districts}),c.fetchCities(),c.fetchAsesores();const x=y(!1),D=$,E=B;ae();const e=Z({}),Y={eventsoffice_id:{type:"iSelect",label:"TIPO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA FIN",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1},modality:{type:"iSelect",label:"MODALIDAD",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"LUGAR",name:"address",required:!0,message:"Escribir lugar del evento",disabled:!0,max:100},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}},R=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}];j(()=>e.startDate,t=>{e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=null)}),j(()=>e.endDate,t=>{e.startDate&&new Date(t)<new Date(e.startDate)&&(e.startDate=null)});const g=(t,v)=>{const w=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return v.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(w)},L=t=>{if(t=="modality")return R;if(t=="powerBy")return pertenece;if(t=="fairtype_id")return typeFair;if(t=="eventsoffice_id")return s()},s=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],M=t=>{e.province_id=null,e.district_id=null,c.fetchProvinces(t)},q=t=>{e.district_id=null,c.fetchDistricts(t)},C=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null},G=async()=>{x.value=!0;const t={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:b(e.startDate).format("YYYY-MM-DD"),endDate:b(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,people_id:e.people_id,description:e.description};try{const v=D.dataRow?"PUT":"POST",w=D.dataRow?`attendance/update/${D.dataRow.id}`:"attendance/create",m=await P({url:w,method:v,data:t});m.status==200&&(O.success(m.message),E("closeDraw"),C()),m.status==500&&(O.error(m.message),C())}catch(v){O.error("Se presentó un error, los valores son requeridos",v)}finally{x.value=!1}},z=t=>{const v=e[t]?e[t].trim():"";e[t]=v};function F(t){e.eventsoffice_id=t.id_pnte,e.title=t.title,e.startDate=t.startDate?b(t.startDate,"DD/MM/YYYY"):null,e.endDate=t.endDate?b(t.endDate,"DD/MM/YYYY"):null,e.modality=t.modality,e.city_id=t.city_id,M(t.city_id),e.province_id=t.province_id,q(t.province_id),e.district_id=t.district_id,e.address=t.address,e.people_id=t.people_id,e.description=t.description}return J(()=>{D.dataRow&&F(D.dataRow)}),j(()=>D.dataRow,t=>{t?F(t):C()}),(t,v)=>{const w=_("a-input"),m=_("a-form-item"),I=_("a-select"),T=_("a-textarea"),h=_("a-input-number"),H=_("a-date-picker"),n=_("a-button"),l=_("a-form");return o(),u(l,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:G},{default:i(()=>[N("div",ce,[(o(),U(V,null,te(Y,(a,W)=>(o(),U(V,{key:W},[a.type==="iText"?(o(),u(m,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:i(()=>[p(w,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,maxlength:a.max,onBlur:r=>z(a.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelect"?(o(),u(m,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[p(I,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:L(a.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iTextarea"?(o(),u(m,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[p(T,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iNumber"?(o(),u(m,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[p(h,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iDate"?(o(),u(m,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[p(H,{locale:A(ne),value:e[a.name],"onUpdate:value":r=>e[a.name]=r,style:{width:"100%"},format:ue,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelectWrite"?(o(),u(m,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:i(()=>[a.name=="city_id"?(o(),u(I,{key:0,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(c).cities,"show-search":"","filter-option":g,onChange:M},null,8,["value","onUpdate:value","options"])):d("",!0),a.name=="province_id"?(o(),u(I,{key:1,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(c).provinces,"show-search":"","filter-option":g,onChange:q,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="district_id"?(o(),u(I,{key:2,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(c).districts,"show-search":"","filter-option":g,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="people_id"?(o(),u(I,{key:3,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:A(c).asesores,"show-search":"","filter-option":g},null,8,["value","onUpdate:value","options"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0)],64))),64))]),p(m,null,{default:i(()=>[p(n,{type:"primary","html-type":"submit",loading:x.value},{default:i(()=>[k(se($.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const pe={class:"advisory-table"},_e=["onClick"],fe=["onClick"],ve=["onClick"],Ie={__name:"IndexAsistencia",setup($){const B=JSON.parse(localStorage.getItem("role"))||[],c=y([]),x=y(0),D=y(150),E=y(!1),e=le(),Y=y(!1),R=y(null),g=y(!1),L=y([]),s=Z({year:b("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),M=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:140,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],q=y([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),C=n=>{e.push(`/admin/asistencia/inscritos/${n.slug}`)},G=n=>{R.value=n,E.value=!0},z=()=>{h(),E.value=!1},F=()=>{R.value=null,E.value=!0},t=async n=>{try{const l=await P({url:`attendance/delete/${n.id}`,method:"DELETE"});l.status==200&&(h(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},v=async n=>{try{const l=await P({url:`attendance/event-finally/${n.id}`,method:"PUT"});l.status==200&&(h(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},w=async()=>{g.value=!0;try{const n={};s.year&&(n.year=b(s.year).format("YYYY")),s.range&&(n.dateStart=s.range[0].format("YYYY/MM/DD"),n.dateEnd=s.range[1].format("YYYY/MM/DD")),s.name&&(n.name=s.name),s.orderby&&(n.orderby=s.orderby),s.asesor&&(n.asesor=s.asesor),await de("download/attendance-ugo","eventos-ugo",n)}catch(n){console.error("Error de red:",n)}finally{g.value=!1}},m=async n=>{s.page=n,await h()},I=async n=>{n&&(s.page=1,await h())},T=n=>B.some(l=>n.includes(l.id)),h=async()=>{try{Y.value=!0;const n={page:s.page};s.year&&(n.year=b(s.year).format("YYYY")),s.range&&(n.dateStart=s.range[0].format("YYYY/MM/DD"),n.dateEnd=s.range[1].format("YYYY/MM/DD")),s.name&&(n.name=s.name),s.orderby&&(n.orderby=s.orderby),s.asesor&&(n.asesor=s.asesor);const a=await P({url:"attendance/list",method:"GET",params:n});c.value=a.data.data,x.value=a.data.total,D.value=a.data.per_page}catch(n){console.error("Error de red:",n)}finally{Y.value=!1}},H=async()=>{try{const n=await re({url:"select/asesores-report",method:"GET"});n.status==200&&(L.value=n.data)}catch{console.log("Failed to delete")}};return J(async()=>{await h(),await H()}),Q("search",s),Q("loading",Y),Q("loadingFile",g),(n,l)=>{const a=_("a-tag"),W=_("router-link"),r=_("a-menu-item"),X=_("a-popconfirm"),K=_("a-drawer");return o(),U("div",pe,[p(ee,{title:"LISTA EVENTOS UGO",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:M,othersList:q.value,titleSearch:"BUSCAR POR EVENTO",pageSize:D.value,nameTotal:"Eventos UGO",asesoresList:L.value,dataSource:c.value,total:x.value,onHandleNew:F,onHandleDownloadExcel:w,onHandleSearch:I,onHandlePaginator:m},{"data-cell":i(({column:f,record:S})=>[f.dataIndex=="modality"?(o(),U(V,{key:0},[S.modality=="p"?(o(),u(a,{key:0,color:"blue"},{default:i(()=>l[1]||(l[1]=[k("PRESENCIAL")])),_:1})):d("",!0),S.modality=="v"?(o(),u(a,{key:1,color:"orange"},{default:i(()=>l[2]||(l[2]=[k("VIRTUAL")])),_:1})):d("",!0)],64)):d("",!0),f.dataIndex=="dateDiff"?(o(),U(V,{key:1},[S.finally?(o(),u(a,{key:0,color:"red"},{default:i(()=>l[3]||(l[3]=[k(" FINALIZADO ")])),_:1})):d("",!0)],64)):d("",!0)]),"custom-options":i(({record:f})=>[p(r,null,{default:i(()=>[p(W,{to:`/asistencias/${f.slug}`,target:"_blank"},{default:i(()=>l[4]||(l[4]=[k(" Ver Link ")])),_:2},1032,["to"])]),_:2},1024),p(r,null,{default:i(()=>[N("a",{onClick:S=>C(f)},"Inscritos",8,_e)]),_:2},1024),T([1,5])?(o(),u(r,{key:0},{default:i(()=>[N("a",{onClick:S=>G(f)},"Editar",8,fe)]),_:2},1024)):d("",!0),T([1,5])?(o(),u(r,{key:1},{default:i(()=>[N("span",{style:{color:"#ff4d4f"},onClick:S=>v(f)},"Finalizar",8,ve)]),_:2},1024)):d("",!0),T([1,5])?(o(),u(r,{key:2},{default:i(()=>[p(X,{placement:"rightBottom",title:`¿Quieres eliminar ${f.title} ?`,onConfirm:S=>t(f)},{icon:i(()=>[p(A(ie),{style:{color:"red"}})]),default:i(()=>[l[5]||(l[5]=N("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):d("",!0)]),_:1},8,["othersList","pageSize","asesoresList","dataSource","total"]),p(K,{open:E.value,"onUpdate:open":l[0]||(l[0]=f=>E.value=f),title:R.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:i(()=>[p(me,{onCloseDraw:z,dataRow:R.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{Ie as default};
