import{_ as U}from"./TableComponent-9154ecd0.js";import{p as b,r as l,a as k,k as L,T as G,W as f,o as I,d as R,y as H,i as Y,L as j,c as y,e as q,t as B,F,m as M,b as P,w as x,f as $}from"./index-ac49fc64.js";import{_ as V}from"./FormComponent-92ab5338.js";import{u as J}from"./selectes-c6bf1abf.js";import"./es-7f81e3a4.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-9b4fac6c.js";import"./quill.snow-bd7ec515.js";const z={key:1,class:"f-20"},W={__name:"DrawerSolicitante.componente",props:["info"],emits:["closeDraw"],setup(A,{emit:w}){b.locale("es");const a=J(),_=JSON.parse(localStorage.getItem("role"));a.fetchCities();const c=l({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!_.some(t=>t.id==1||t.id==5)},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!_.some(t=>t.id==1||t.id==5),rules:[{validator:(t,r)=>{if(!r)return Promise.reject(new Error("Escribe número de documento"));const d=String(r);if(!/^\d+$/.test(d))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(d.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(d.length<3||d.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},country_id:{type:"iSelect",label:"PAÍS ORIGEN",name:"country_id",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(t,r)=>{if(!r)return Promise.reject(new Error("El número es requerido"));const d=r.toString();return d.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):d.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(t,r)=>r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},sick:{type:"iSelect",label:"¿TIENE DISCAPACIDAD?",name:"sick",required:!0,message:"Seleccionar"},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS?",name:"hasSoon",required:!1,message:"¿Tiene hijos?"}});JSON.parse(localStorage.getItem("profile"));const g=w,m=A,u=l(!0),v=l("ACTUALIZAR"),e=k({}),h=l(!1),o=l(null),i=l({country_id:[],city_id:[],province_id:[],district_id:[],modality_id:[],comercialactivity_id:[],isbic:[],typecapital_id:[],component_id:[],theme_id:[],typedocument_id:[],gender_id:[],sick:[],hasSoon:[]}),O=t=>{console.log("handleInputEvent",t)},D=async t=>{t=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),c.value.dateTramite.disabled=!1)},N=async t=>{t=="city_id"&&(e.province_id=null,e.district_id=null,i.value.province_id=[],await a.fetchProvinces(e.city_id),i.value.province_id=a.provinces,c.value.province_id.disabled=!1),t=="province_id"&&(await a.fetchDistricts(e.province_id),i.value.district_id=a.districts,c.value.district_id.disabled=!1)},C=async t=>{console.log("handleFocusSelect",t),t=="city_id"&&(i.value.city_id=a.cities),t=="province_id"&&(e.province_id=null,e.district_id=null,i.value.district_id=[]),t=="typedocument_id"&&(i.value.typedocument_id=a.typeDocuments),t=="country_id"&&(i.value.country_id=a.countries),t=="gender_id"&&(i.value.gender_id=a.genders),t=="sick"&&p(),t=="hasSoon"&&S()},T=t=>{},p=()=>{i.value.sick=[{value:"yes",label:"SI"},{value:"no",label:"NO"}]},S=()=>{i.value.hasSoon=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}]},n=async()=>{h.value=!0;const t={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,phone:e.phone,email:e.email,gender_id:e.gender_id,birthday:e.birthday?b(e.birthday).format("YYYY-MM-DD"):null,sick:e.sick=="SI"?"yes":"no",hasSoon:e.hasSoon,country_id:e.country_id};try{(await M({url:`person/update/${m.info.id}`,method:"PUT",data:t})).status===200&&(s(),g("closeDraw",!0))}catch(r){console.error("Error:",r);const d=document.getElementsByClassName("ant-drawer-body")[0];d&&(d.scrollTop=0)}finally{h.value=!1}},s=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},E=async t=>{u.value=!0;try{t&&(await a.fetchTypeDocuments(),i.value.typedocument_id=a.typeDocuments,e.typedocument_id=t.typedocument_id,e.documentnumber=t.document,e.lastname=t.lastname,e.middlename=t.middlename,e.name=t.name,await a.fetchCountries(),i.value.country_id=a.countries,e.country_id=t.country_id,e.address=t.address,t.birthday&&(e.birthday=b(t.birthday,"YYYY-MM-DD")),e.phone=t.phone,e.email=t.email,await a.fetchGenders(),i.value.gender_id=a.genders,e.gender_id=t.gender_id,p(),e.sick=t.sick,S(),e.address=t.address,e.hasSoon=t.hasSoon,await a.fetchCities(),i.value.city_id=a.cities,e.city_id=t.city_id,await a.fetchProvinces(e.city_id),i.value.province_id=a.provinces,c.value.province_id.disabled=!1,e.province_id=t.province_id,await a.fetchDistricts(e.province_id),i.value.district_id=a.districts,c.value.district_id.disabled=!1,e.district_id=t.district_id)}catch(r){console.error("Error al cargar la información:",r)}finally{u.value=!1}};return L(()=>{m.info&&E(m.info)}),G(()=>m.info,t=>{t&&E(t)}),f("formState",e),f("loadingState",h),(t,r)=>(I(),R(F,null,[u.value?(I(),H(Y(j),{key:0,style:{color:"#00a6db"}})):(I(),R("div",z,[y(V,{fields:c.value,options:i.value,btnSaveName:v.value,onHandleInputEvent:O,resetSelect:o.value,onHandleChangeSelect:N,onHandleFocusSelect:C,onHandleBlurSelect:T,onHandleChangeClock:D,onOnSubmit:n},null,8,["fields","options","btnSaveName","resetSelect"])])),q("pre",null,B(),1)],64))}},Z={class:"layout-content"},K=["onClick"],le={__name:"SolicitantesLista",setup(A){const w=JSON.parse(localStorage.getItem("profile"))||{},a=l([]),_=l(0),c=l(100),g=l(!1),m=l(!1),u=l(!1),v=l(null),e=l(!1),h=l([]),o=k({asesor:null,name:null,page:1}),i=[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:70},{title:"TIPO DOCUMENTO",fixed:"left",dataIndex:"typedocument",align:"center",width:120},{title:"NUM. DOC",dataIndex:"document",fixed:"left",width:120,align:"center"},{title:"NOMBRES",dataIndex:"name",width:170},{title:"APELLIDOS",dataIndex:"last_name",width:180},{title:"REGIÓN",dataIndex:"city",align:"center",width:140},{title:"PROVINCIA",dataIndex:"province",align:"center",width:140},{title:"DISTRITO",dataIndex:"district",align:"center",width:150},{title:"CELULAR",dataIndex:"phone",align:"center",width:100},{title:"EMAIL",dataIndex:"email",width:240},{title:"GÉNERO",dataIndex:"gender",align:"center",width:100},{title:"DISCAPACIDAD",dataIndex:"sick",align:"center",width:120},{title:"HIJOS",dataIndex:"hasSoon",align:"center",width:120},...w.rol!=2?[{title:"REGISTRADO POR",dataIndex:"registered",width:200,customCell:()=>({style:{backgroundColor:"#f0f5ff"}})}]:[],{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],O=()=>{console.log("handleNew...")},D=async()=>{m.value=!0},N=async n=>{o.page=n,await p()},C=async n=>{n&&(o.page=1,await p())},T=n=>{v.value=n,u.value=!0},p=async()=>{g.value=!0;try{const n={page:o.page};o.year&&(n.year=b(o.year).format("YYYY")),o.asesor&&(n.asesor=o.asesor),o.name&&(n.name=o.name);const s=await M({url:"businessman/list",method:"GET",params:n});s.status==200&&(a.value=s.data.data,_.value=s.data.total,c.value=s.data.per_page,e.value=s.rol,s.rol!=2&&await S())}catch(n){console.error("Error de red:",n)}finally{g.value=!1}},S=async()=>{try{const n=await $({url:"select/asesores-report",method:"GET"});n.status==200&&(h.value=n.data)}catch{console.log("Failed to delete")}};return L(async()=>{await p()}),f("search",o),f("loading",g),f("loadingFile",m),(n,s)=>{const E=P("a-menu-item"),t=P("a-drawer");return I(),R("div",Z,[y(U,{title:"SOLICITANTES",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",columns:i,titleSearch:"NÚMERO DE DOCUMENTO",pageSize:c.value,nameTotal:"Solicitantes",dataSource:a.value,total:_.value,onHandleNew:O,onHandleDownloadExcel:D,onHandleSearch:C,onHandlePaginator:N},{"custom-options":x(({record:r})=>[y(E,null,{default:x(()=>[q("a",{onClick:d=>T(r)},"Editar",8,K)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),y(t,{width:"500",title:"EDITAR DATOS DEL SOLICITANTE",open:u.value,"onUpdate:open":s[1]||(s[1]=r=>u.value=r),placement:"right"},{default:x(()=>[y(W,{info:v.value,onCloseDraw:s[0]||(s[0]=r=>(u.value=!1,p()))},null,8,["info"])]),_:1},8,["open"])])}}};export{le as default};
