import{L as I,r as x,y as J,a as X,k as Z,b as c,o as n,d as k,c as b,e as _,w as p,F as q,f as H,z as f,Z as K,P as w,m as F,x as Q,q as l,t as h,s as m,h as S,M as W,i as ee,p as ae,j as te}from"./index-a89c85d3.js";import{u as oe}from"./selectes-f79054a0.js";import"./es-abd47609.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";const re={notary_id:{type:"iSelect",label:"Selecciona la notaría",name:"notary_id",required:!0,message:"Seleccionar una notaría",disabled:!1},name:{type:"iText",label:"Nombres del encargado externo",name:"name",required:!0,message:"Ingresar los nombres"},lastname:{type:"iText",label:"Apellido paterno del encargado externo",name:"lastname",required:!0,message:"Escribe el apellido paterno"},middlename:{type:"iText",label:"Apellido materno del encargado externo",name:"middlename",required:!0,message:"Escribe el apellido paterno"},documentnumber:{type:"iText",label:"Número de DNI del encargado externo",name:"documentnumber",required:!0,message:"Ingresa el número de DNI",max:8},birthday:{type:"iDate",label:"Fecha de nacimiento - día/mes/año",name:"birthday",required:!1,message:"año-mes-día"},phone:{type:"iText",label:"Ingresar número celular",name:"phone",required:!0,message:"Escribe número de documento",disabled:!1,max:9},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},role_id:{type:"iSelect",label:"Rol",name:"role_id",required:!0,message:"Seleccionar un rol de usuario",disabled:!0}};const se=N=>(ae("data-v-6a594fce"),N=N(),te(),N),le=se(()=>_("h3",{class:"title-produce"},"REGISTRO DE NUEVO ASESOR EXTERNO - NOTARÍA",-1)),de={class:"user"},ie={class:"grid-item"},ue={class:"select-notaries"},me={class:"name"},ce={class:"city"},pe={class:"address"},_e="DD/MM/YYYY",ve={__name:"NuevoUsuariosNotaria",setup(N){I.locale("es");const i=oe();JSON.parse(localStorage.getItem("profile")),i.$patch({genders:i.genders}),i.$patch({cdes:i.cdes}),i.fetchGenders(),i.fetchCdes();const T=x([]),R=x(re),g=x(null);J();const U=x(!1),O=[{label:"Notaria",value:7}],e=X({}),z=(s,t)=>{const d=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=t.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),u=t.city.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),v=t.province.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),y=t.district.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r.includes(d)||u.includes(d)||v.includes(d)||y.includes(d)},P=async()=>{try{const{data:s}=await H({url:"public/notaries-filters",method:"GET"});T.value=s.map(t=>({value:t.id,name:t.name,city:t.city.name,province:t.province.name,district:t.district.name,address:t.address}))}catch(s){console.error("Error de red:",s)}},L=()=>{e.name=null,e.lastname=null,e.middlename=null,e.documentnumber=null,g.value=null,e.phone=null,e.gender_id=null,e.cde_id=null,e.office_id=null,e.email=null,e.password=null,e.role_id=null,e.notary_id=null},E=s=>{e[s]=e[s].replace(/\D/g,"")},Y=async()=>{U.value=!0,e.email=`${e.name.replace(/\s/g,"").toLowerCase()}${e.lastname.replace(/\s/g,"").toLowerCase()}@pnte.com`,e.password=e.documentnumber,e.birthday=g.value?I(g.value).format("YYYY-MM-DD"):null;const s={notary_id:e.notary_id},t=await f({url:"create/cde-notary",method:"POST",data:s});console.log("😄😁",t);try{const d={email:e.email,documentnumber:e.documentnumber,password:e.documentnumber},r=await f({url:"user/register-user",method:"POST",data:d});if(r.status!==200)throw new Error("User registration failed");const u={name:e.name,lastname:e.lastname,middlename:e.middlename,documentnumber:e.documentnumber,birthday:e.birthday,phone:e.phone,gender_id:e.gender_id,cde_id:t,office_id:5,user_id:r.data.id,notary_id:e.notary_id};if((await f({url:"user/register-profile",method:"POST",data:u})).status!==200)throw new Error("Profile registration failed");const y={role_id:e.role_id,user_id:r.data.id,documentnumber:e.documentnumber};if((await f({url:"user/register-roles",method:"POST",data:y})).status!==200)throw new Error("Role registration failed");const D={user_id:r.data.id},a=await f({url:"user/register-views",method:"POST",data:D});K.success({title:"La cuenta ha sido registrada",content:w("div",{},[w("br"),w("p",`Correo: ${e.documentnumber} o ${e.email}`),w("p","Contraseña es el número de DNI ingresado")]),onOk(){L()}})}catch(d){F.error("No se pudo registrar este usuario"),console.log("error",d)}finally{U.value=!1}},$=()=>{F.error("Debes de completar todos los espacios requeridos")};return Z(()=>{P()}),(s,t)=>{const d=c("a-divider"),r=c("a-select"),u=c("a-form-item"),v=c("a-input"),y=c("a-date-picker"),C=c("a-button"),D=c("a-form");return n(),k(q,null,[le,b(d),_("div",de,[b(D,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Y,onFinishFailed:$},{default:p(()=>[_("div",ie,[(n(!0),k(q,null,Q(R.value,(a,A)=>(n(),k(q,{key:A},[a.type==="iSelect"?(n(),l(u,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[a.name=="notary_id"?(n(),l(r,{key:0,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:T.value,"option-label-prop":"name","show-search":"","filter-option":z},{option:p(({value:o,name:M,city:V,province:G,district:B,address:j})=>[_("div",ue,[_("span",me,h(M),1),_("span",ce,h(V)+" - "+h(G)+" - "+h(B),1),_("span",pe,h(j),1)])]),_:2},1032,["value","onUpdate:value","options"])):m("",!0),a.name=="gender_id"?(n(),l(r,{key:1,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:S(i).genders},null,8,["value","onUpdate:value","options"])):m("",!0),a.name=="cde_id"?(n(),l(r,{key:2,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:S(i).cdes},null,8,["value","onUpdate:value","options"])):m("",!0),a.name=="role_id"?(n(),l(r,{key:3,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:O},null,8,["value","onUpdate:value"])):m("",!0),a.name=="supervisor_id"?(n(),l(r,{key:4,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:S(i).supervisores},null,8,["value","onUpdate:value","options"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(n(),l(u,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:p(()=>[a.name=="documentnumber"?(n(),l(v,{key:0,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,maxlength:a.max,onInput:t[0]||(t[0]=o=>E("documentnumber"))},null,8,["value","onUpdate:value","maxlength"])):a.name=="phone"?(n(),l(v,{key:1,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,maxlength:a.max,onInput:t[1]||(t[1]=o=>E("phone"))},null,8,["value","onUpdate:value","maxlength"])):(n(),l(v,{key:2,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"]))]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(n(),l(u,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[b(y,{locale:S(W),value:g.value,"onUpdate:value":t[2]||(t[2]=o=>g.value=o),style:{width:"100%"},format:_e},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),b(u,null,{default:p(()=>[b(C,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:p(()=>[ee("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])],64)}}},he=ne(ve,[["__scopeId","data-v-6a594fce"]]);export{he as default};
