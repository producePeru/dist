import{l as z,r as u,a as re,b as p,o as r,d as q,c as m,w as c,N as ae,O as de,e as N,F as Q,s as pe,x as b,h as M,y as h,M as Ee,i as K,m as D,R as A,_ as te,f as ne,g as _e,K as Se,G as Ie,Z as we,j as De,t as ue,a2 as Ce,q as xe}from"./index-6e01b1ef.js";import{_ as Re}from"./icoexcel-1b303edf.js";import{u as ve}from"./selectes-0cdee9e8.js";import"./es-ca729dd9.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Oe}from"./MoreOutlined-e63ccc9e.js";const Ne={class:"agreement-wrapper"},Te={class:"grid-item"},ke="DD/MM/YYYY",Ae={__name:"RutaDigitalEmpresario",emits:["stepNumber"],setup(H,{emit:R}){z.locale("es");const s=ve(),E=R;s.$patch({typeDocuments:s.typeDocuments}),s.$patch({cities:s.countries}),s.$patch({cities:s.cities}),s.$patch({provinces:s.provinces}),s.$patch({districts:s.districts}),s.$patch({genders:s.genders}),s.fetchTypeDocuments(),s.fetchCountries(),s.fetchCities(),s.fetchGenders();const _=u({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!1},documentnumber:{type:"iSearch",label:"NÚMERO DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country_id:{type:"iSelect",label:"PAÍS ORIGEN",name:"country_id",required:!0,message:"Seleccionar país de origen",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN RESIDENTE",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelect",label:"PROVINCIA RESIDENTE",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO RESIDENTE",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"CELULAR",name:"phone",required:!0,message:"Número de celular",min:9,max:9,disabled:!0},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿TIENE DISCAPACIDAD?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS? (Opcional)",name:"hasSoon",required:!1,message:"¿Tiene hijos?",disabled:!0}}),y=u(null),O=u(null),I=u(!1),C=u(null),U=u(!1);u(!0);const i=[{value:"yes",label:"SI"},{value:"no",label:"NO"}],F=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}],e=re({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,country_id:null,city_id:null,province_id:null,district_id:null,address:null,birthday:null,phone:null,email:null,gender_id:null,sick:null,hasSoon:null}),G=o=>{o&&(_.value.documentnumber.disabled=!1,e.documentnumber=null)},$=o=>{const a=e[o]?e[o].trim():"";e[o]=a},x=(o,a)=>{if(!a)return Promise.reject("La fecha es requerida");const d=new Date,n=new Date(a);let k=d.getFullYear()-n.getFullYear();const f=d.getMonth()-n.getMonth();return(f<0||f===0&&d.getDate()<n.getDate())&&k--,k<18||k>99?Promise.reject("La edad debe estar entre 18 y 99 años"):Promise.resolve()},B=async o=>{try{const{data:a}=await ne({url:`select/provinces/${o}`,method:"GET"});y.value=a}catch(a){console.error("Error de red:",a)}},j=async o=>{try{const{data:a}=await ne({url:`select/districts/${o}`,method:"GET"});O.value=a}catch(a){console.error("Error de red:",a)}},P=(o,a)=>{const d=o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(d)},V=()=>{_.value.lastname.disabled=!1,_.value.middlename.disabled=!1,_.value.name.disabled=!1,_.value.city_id.disabled=!1,_.value.province_id.disabled=!1,_.value.district_id.disabled=!1,_.value.address.disabled=!1,_.value.phone.disabled=!1,_.value.email.disabled=!1,_.value.birthday.disabled=!1,_.value.gender_id.disabled=!1,_.value.sick.disabled=!1,_.value.hasSoon.disabled=!1},Y=async o=>{if(I.value=!0,!o)return D.warning("Debes de ingresar el número de documento"),I.value=!1;try{const a=await A({url:`ruta-digital/is-new/${e.typedocument_id}/${e.documentnumber}`,method:"GET"});if(a.status===200&&(e.lastname=a.data.lastname,e.middlename=a.data.middlename,e.name=a.data.name,e.country_id=a.data.country_id,e.city_id=a.data.city_id,B(a.data.city_id),e.province_id=a.data.province_id,j(a.data.province_id),e.district_id=a.data.district_id,e.address=a.data.address,a.data.birthday&&(e.birthday=z(a.data.birthday,"YYYY-MM-DD")),e.phone=a.data.phone,e.email=a.data.email,e.gender_id=a.data.gender_id,e.sick=a.data.sick,e.hasSoon=a.data.hasSoon,V()),a.status===300&&(w(),e.typedocument_id===1))if(e.documentnumber.length>=8)try{const d=await A({url:`user/only-dni/${e.documentnumber}`,method:"GET"});d.status===429?te.open({message:"ALERTA",description:"Se superó el número de consultas, coméntale a tu supervisor para que actualice el token"}):d.status===200&&(e.lastname=d.data.apellidoPaterno,e.middlename=d.data.apellidoMaterno,e.name=d.data.nombres),V()}catch(d){console.error("Error fetching DNI data:",d),te.open({message:"Error",description:"Hubo un problema al consultar el DNI. Por favor, intente nuevamente."})}else return D.error("COMPLETA EL NÚMERO DE DNI")}catch{console.log("There was an error")}finally{return I.value=!1}},Z=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},g=()=>{e.phone=e.phone.replace(/\D/g,"")},l=o=>{e.province_id=null,e.district_id=null,B(o)},S=o=>{e.district_id=null,j(o)},w=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.sick=null,C.value=null,e.country_id=null,e.hasSoon=null},T=async()=>{if(U.value=!0,e.typedocument_id!==1&&e.country_id==155)return U.value=!1,D.error("Por favor cambiar el país, no está permitido para esta opción, Gracias");const o={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,country_id:e.country_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,birthday:z(e.birthday).format("YYYY-MM-DD"),phone:e.phone,email:e.email,gender_id:e.gender_id,sick:e.sick,hasSoon:e.hasSoon};try{const a=await A({url:"ruta-digital/businessman",method:"POST",data:o});if(a.status==200){e.typedocument_id=null,e.documentnumber=null;const d={id:a.id,dni:a.dni,step:1};E("stepNumber",d),w()}}catch{D.error("No se pudo registrar a este usuario")}finally{U.value=!1}},J=()=>{D.error("COMPLETA LOS VALORES REQUERIDOS")};return(o,a)=>{const d=p("a-select"),n=p("a-form-item"),k=p("a-input-search"),f=p("a-input"),ie=p("a-date-picker"),oe=p("a-button"),se=p("a-form"),W=p("a-spin");return r(),q("div",Ne,[m(W,{spinning:I.value},{default:c(()=>[m(se,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:T,onFinishFailed:J,onKeydown:a[0]||(a[0]=ae(de(()=>{},["prevent"]),["enter"]))},{default:c(()=>[N("div",Te,[(r(!0),q(Q,null,pe(_.value,(t,le)=>(r(),q(Q,{key:le},[t.type==="iSelect"?(r(),b(n,{key:0,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:c(()=>[t.name=="typedocument_id"?(r(),b(d,{key:0,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:M(s).typeDocuments,disabled:t.disabled,onChange:G},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),t.name=="country_id"?(r(),b(d,{key:1,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:M(s).countries,"show-search":"","filter-option":P},null,8,["value","onUpdate:value","options"])):h("",!0),t.name=="city_id"?(r(),b(d,{key:2,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:M(s).cities,"show-search":"","filter-option":P,onChange:l,disabled:t.disabled},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),t.name=="province_id"?(r(),b(d,{key:3,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:y.value,"show-search":"","filter-option":P,onChange:S,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),t.name=="district_id"?(r(),b(d,{key:4,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:O.value,"show-search":"","filter-option":P,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),t.name=="gender_id"?(r(),b(d,{key:5,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:M(s).genders,disabled:t.disabled},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),t.name=="sick"?(r(),b(d,{key:6,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:i,disabled:t.disabled},null,8,["value","onUpdate:value","disabled"])):h("",!0),t.name=="hasSoon"?(r(),b(d,{key:7,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,options:F,disabled:t.disabled},null,8,["value","onUpdate:value","disabled"])):h("",!0)]),_:2},1032,["name","label","rules"])):h("",!0),t.type==="iSearch"?(r(),b(n,{key:1,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:c(()=>[m(k,{loading:I.value,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,onKeyup:ae(Y,["enter"]),onSearch:Y,onInput:Z,maxlength:e.typedocument_id==1?8:20,disabled:t.disabled},null,8,["loading","value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):h("",!0),t.type==="iText"?(r(),b(n,{key:2,name:t.name,label:t.label,rules:[{required:t.required,message:t.message,type:t.email,max:t.max,min:t.min}]},{default:c(()=>[t.name=="phone"?(r(),b(f,{key:0,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,disabled:t.disabled,maxlength:t.max,onInput:g},null,8,["value","onUpdate:value","disabled","maxlength"])):(r(),b(f,{key:1,value:e[t.name],"onUpdate:value":v=>e[t.name]=v,disabled:t.disabled,maxlength:t.max,onBlur:v=>$(t.name)},null,8,["value","onUpdate:value","disabled","maxlength","onBlur"]))]),_:2},1032,["name","label","rules"])):h("",!0),t.type==="iDate"?(r(),b(n,{key:3,name:t.name,label:t.label,rules:[{required:t.required,message:t.message},{validator:x,message:"La edad debe estar entre 18 y 99 años"}]},{default:c(()=>[m(ie,{locale:M(Ee),value:e[t.name],"onUpdate:value":v=>e[t.name]=v,style:{width:"100%"},format:ke,placeholder:"día/mes/año",disabled:t.disabled},null,8,["locale","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):h("",!0)],64))),128))]),m(n,null,{default:c(()=>[m(oe,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:c(()=>a[1]||(a[1]=[K("SIGUIENTE")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Ue=ce(Ae,[["__scopeId","data-v-236e5392"]]);const Le={class:"agreement-wrapper"},Me={class:"grid-item"},qe={key:3},$e={__name:"RutaDigitalEmpresa",props:["dataStepOne"],emits:["close"],setup(H,{emit:R}){const s=ve(),E=R,_=H;s.$patch({cities:s.cities}),s.$patch({provinces:s.provinces}),s.$patch({districts:s.districts}),s.$patch({economicSectors:s.economicSectors}),s.$patch({comercialActivities:s.comercialActivities}),s.fetchCities(),s.fetchEconomicSectors(),s.fetchComercialActivities();const y=u({ruc:{type:"iSearch",label:"NÚMERO RUC",name:"ruc",required:!0,message:"Escribe número de documento",disabled:!1,max:11},space:{type:"space"},comercialName:{type:"iText",label:"NOMBRE COMERCIAL",name:"comercialName",required:!0,message:"Escribir nombre comercial",disabled:!0},socialReason:{type:"iText",label:"RAZÓN SOCIAL",name:"socialReason",required:!0,message:"Escribir razón social",disabled:!0},city_id:{type:"iSelect",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelect",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0},comercialactivity_id:{type:"iSelect",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar la actividad comercial",disabled:!0},economicsector_id:{type:"iSelect",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!0,message:"Seleccionar sector económico",disabled:!0}}),O=u(null),I=u(null),C=u(!1);u(null);const U=u(!1);u(!0);const i=re({}),F=g=>{const l=i[g]?i[g].trim():"";i[g]=l},e=async g=>{try{const{data:l}=await ne({url:`select/provinces/${g}`,method:"GET"});O.value=l}catch(l){console.error("Error de red:",l)}},G=async g=>{try{const{data:l}=await ne({url:`select/districts/${g}`,method:"GET"});I.value=l}catch(l){console.error("Error de red:",l)}},$=(g,l)=>{const S=g.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(S)},x=()=>{y.value.comercialName.disabled=!1,y.value.socialReason.disabled=!1,y.value.city_id.disabled=!1,y.value.province_id.disabled=!1,y.value.district_id.disabled=!1,y.value.address.disabled=!1,y.value.comercialactivity_id.disabled=!1,y.value.economicsector_id.disabled=!1},B=async g=>{if(g.length!==11)return D.warning("El RUC debe tener exactamente 11 caracteres.");if(!/^\d+$/.test(g))return D.warning("El RUC debe contener solo números.");if(!/^(10|15|20)/.test(g))return D.warning("El RUC debe comenzar con 10, 15 o 20.");C.value=!0;try{const l=await A({url:`mype/get-by-ruc/${i.ruc}`,method:"GET"});if(l.status===200&&(i.comercialName=l.data.comercialName,i.socialReason=l.data.socialReason,i.city_id=l.data.city_id,e(l.data.city_id),i.province_id=l.data.province_id,G(l.data.province_id),i.district_id=l.data.district_id,i.address=l.data.address,i.comercialactivity_id=l.data.comercialactivity_id,i.economicsector_id=l.data.economicsector_id,x()),l.status===404)if(V(),i.ruc.length>=11)try{const S=await A({url:`mype/search-api-ruc/${i.ruc}`,method:"GET"});S.status===429?te.open({message:"ALERTA",description:"Se superó el número de consultas, coméntale a tu supervisor para que actualice el token"}):S.status===200&&(i.socialReason=S.data.socialReason,i.address=S.data.address),x()}catch(S){console.error("Error fetching DNI data:",S),te.open({message:"Error",description:"Hubo un problema al consultar el RUC. Por favor, revise el número registrado."})}else return D.error("COMPLETA EL NÚMERO DEL RUC")}catch{console.log("There was an error")}finally{return C.value=!1}},j=g=>{i.province_id=null,i.district_id=null,e(g)},P=g=>{i.district_id=null,G(g)},V=()=>{i.comercialName=null,i.socialReason=null,i.city_id=null,i.province_id=null,i.district_id=null,i.address=null,i.comercialactivity_id=null,i.economicsector_id=null},Y=async()=>{U.value=!0;const g={ruc:i.ruc,comercialName:i.comercialName,socialReason:i.socialReason,city_id:i.city_id,province_id:i.province_id,district_id:i.district_id,address:i.address,comercialactivity_id:i.comercialactivity_id,economicsector_id:i.economicsector_id};try{const l=await A({url:"ruta-digital/mype",method:"POST",data:g});if(l.status==200){const S={ruc:l.ruc,dni:_.dataStepOne.dni,person_id:_.dataStepOne.id,mype_id:l.id},w=await A({url:"ruta-digital/create",method:"POST",data:S});if(w.status==409)return D.error(w.message);w.status==200&&(V(),i.ruc=null,D.success(w.message),E("close"))}}catch{D.error("No se pudo registrar a este usuario")}finally{U.value=!1}},Z=()=>{D.error("COMPLETA LOS VALORES REQUERIDOS")};return(g,l)=>{const S=p("a-select"),w=p("a-form-item"),T=p("a-input-search"),J=p("a-input"),o=p("a-button"),a=p("a-form"),d=p("a-spin");return r(),q("div",Le,[m(d,{spinning:C.value},{default:c(()=>[m(a,{layout:"vertical",model:i,name:"basic",autocomplete:"off",onFinish:Y,onFinishFailed:Z,onKeydown:l[0]||(l[0]=ae(de(()=>{},["prevent"]),["enter"]))},{default:c(()=>[N("div",Me,[(r(!0),q(Q,null,pe(y.value,(n,k)=>(r(),q(Q,{key:k},[n.type==="iSelect"?(r(),b(w,{key:0,class:"item-max",name:n.name,label:n.label,rules:[{required:n.required,message:n.message}]},{default:c(()=>[n.name=="city_id"?(r(),b(S,{key:0,value:i[n.name],"onUpdate:value":f=>i[n.name]=f,options:M(s).cities,"show-search":"","filter-option":$,onChange:j,disabled:n.disabled},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),n.name=="province_id"?(r(),b(S,{key:1,value:i[n.name],"onUpdate:value":f=>i[n.name]=f,options:O.value,"show-search":"","filter-option":$,onChange:P,disabled:!i.city_id},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),n.name=="district_id"?(r(),b(S,{key:2,value:i[n.name],"onUpdate:value":f=>i[n.name]=f,options:I.value,"show-search":"","filter-option":$,disabled:!i.province_id},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),n.name=="economicsector_id"?(r(),b(S,{key:3,value:i[n.name],"onUpdate:value":f=>i[n.name]=f,"show-search":"",options:M(s).economicSectors,"filter-option":$,disabled:n.disabled},null,8,["value","onUpdate:value","options","disabled"])):h("",!0),n.name=="comercialactivity_id"?(r(),b(S,{key:4,value:i[n.name],"onUpdate:value":f=>i[n.name]=f,"show-search":"",options:M(s).comercialActivities,"filter-option":$,disabled:n.disabled},null,8,["value","onUpdate:value","options","disabled"])):h("",!0)]),_:2},1032,["name","label","rules"])):h("",!0),n.type==="iSearch"?(r(),b(w,{key:1,name:n.name,label:n.label,rules:[{required:n.required,message:n.message,max:n.max},{pattern:/^(10|15|20)\d{9,}$/,message:"El número debe comenzar con 10, 15 o 20, tener solo números, y al menos 11 caracteres"}]},{default:c(()=>[m(T,{value:i[n.name],"onUpdate:value":f=>i[n.name]=f,loading:C.value,maxlength:n.max,onSearch:B,onKeyup:ae(B,["enter"])},null,8,["value","onUpdate:value","loading","maxlength"])]),_:2},1032,["name","label","rules"])):h("",!0),n.type==="iText"?(r(),b(w,{key:2,name:n.name,label:n.label,rules:[{required:n.required,message:n.message,type:n.email,max:n.max,min:n.min}]},{default:c(()=>[m(J,{value:i[n.name],"onUpdate:value":f=>i[n.name]=f,disabled:n.disabled,maxlength:n.max,onBlur:f=>F(n.name)},null,8,["value","onUpdate:value","disabled","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):h("",!0),n.type==="space"?(r(),q("div",qe)):h("",!0)],64))),128))]),m(w,null,{default:c(()=>[m(o,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:c(()=>l[1]||(l[1]=[K("FINALIZAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Pe=ce($e,[["__scopeId","data-v-db713ee5"]]),Ye={__name:"RutaDigitalNuevo",emits:["closeDraw"],setup(H,{emit:R}){const s=R,E=u(1),_=u(null),y=I=>{_.value=I,E.value=I.step+1},O=()=>{E.value=1,s("closeDraw")};return(I,C)=>(r(),q("section",null,[E.value==1?(r(),b(Ue,{key:0,onStepNumber:y})):h("",!0),E.value==2?(r(),b(Pe,{key:1,dataStepOne:_.value,onClose:O},null,8,["dataStepOne"])):h("",!0)]))}},me=(localStorage.getItem("token")||_e.get("token")||"").replace(/"/g,""),ze=me?`Bearer ${me}`:"",Fe="https://apituempresa.soporte-pnte.com/api/",Ge="http://127.0.0.1:8000/api/",Be=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?Ge:Fe;async function Ve(H,R,s){try{const E=await Se({url:`${Be}${H}`,headers:{"Content-Type":"application/json",Authorization:`Bearer ${ze}`},method:"POST",responseType:"blob",data:s}),_=window.URL.createObjectURL(new Blob([E.data])),y=document.createElement("a");y.href=_;const O=`${R}.xlsx`;y.setAttribute("download",O),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(E){console.error("Error al descargar el archivo:",E)}}const He=["onClick"],je={class:"paginator"},Ke={__name:"RutaDigitalIndex",props:["idConvenio"],setup(H){z.locale("es"),_e.get("token");const R=JSON.parse(localStorage.getItem("role")),s=u(null),E=u(null);u(null);const _=u(!1),y=u(null),O=u(0),I=u(50),C=u({page:1}),U=u(1200),i=u([]),F=u(!1),e=u(!1);u(!1),u(!1),u(!1),u(null);const G=u(window.innerHeight-100),$=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"FECHA DE REGISTRO",dataIndex:"date",fixed:"left",align:"center",width:140},{title:"DNI ASESOR",dataIndex:"asesor_documentnumber",fixed:"left",align:"center",width:100},{title:"NOMBRE DEL ASESOR",dataIndex:"asesor_name",width:180},{title:"CDE/MAC",dataIndex:"asesor_cde",width:160,align:"center"},...R.some(o=>o.id!==1)?[{title:"SUPERVISOR",dataIndex:"supervisador",width:180}]:[],{title:"TIPO DOCUMENTO",dataIndex:"typedocument",align:"center",width:130},{title:"NRO DOCUMENTO",dataIndex:"documentnumber",align:"center",width:130},{title:"NACIONALIDAD (NOMBRE DEL PAIS)",dataIndex:"country",align:"center",width:140},{title:"FECHA DE NACIMIENTO",dataIndex:"birthdate",align:"center",width:120},{title:"APELLIDOS",dataIndex:"lastname",width:150},{title:"NOMBRES",dataIndex:"name",width:150},...R.some(o=>o.id!==1)?[{title:"SEXO (F/M)",dataIndex:"gender",width:60}]:[],...R.some(o=>o.id!==1)?[{title:"DISCAPACIDAD (SI/NO)",dataIndex:"sick",width:120}]:[],...R.some(o=>o.id!==1)?[{title:"CELULAR",dataIndex:"phone",width:100}]:[],...R.some(o=>o.id!==1)?[{title:"CORREO",dataIndex:"email",width:150}]:[],{title:"NÚMERO DE RUC",dataIndex:"ruc",align:"center",width:120},{title:"REGION DE LA MYPE",dataIndex:"region",align:"center",width:120},{title:"PROVINCIA DE LA MYPE",dataIndex:"province",align:"center",width:150},{title:"DISTRITO DE LA MYPE",dataIndex:"district",align:"center",width:130},{title:"DIRECCIÓN",dataIndex:"address",width:240},{title:"SECTOR ECONOMICO",dataIndex:"comercialactivity",align:"center",width:180},{title:"ACTIVIDAD COMERCIAL",dataIndex:"economicsector",align:"center",width:140},{title:"AUTODIAGNÓSTICO",dataIndex:"status",align:"center",fixed:"right",width:140}],x=re({search:""}),B=()=>{C.value.page=1,x.search,T()},j=()=>{x.search||T()},P=o=>{y.value=o,e.value=!0},V=o=>{params.value.page=o,T()},Y=()=>{G.value=window.innerHeight-320},Z=()=>{y.value=null,e.value=!0},g=()=>{e.value=!1,T()},l=async o=>{try{const a=await A({url:`agreement/delete/${o.id}`,method:"DELETE"});a.status==200&&(T(),D.success(a.message))}catch(a){console.error("Error de red:",a)}},S=Ie(()=>o=>(C.value.page-1)*I.value+o+1),w=async o=>{try{const a=await A({url:`ruta-digital/status/${o}`,method:"PUT"});a.status==200&&(T(),D.success(a.message))}catch(a){console.error("Error de red:",a)}},T=async o=>{try{F.value=!0;const a={};E.value&&(a.start=z(E.value[0]).format("YYYY-MM-DD"),a.end=z(E.value[1]).format("YYYY-MM-DD")),x.search&&(a.search=x.search),C.value.page&&(a.page=C.value.page);const d=await A({url:"ruta-digital/list",method:"GET",params:a}),n=d.data;i.value=n.data,O.value=n.total,I.value=n.per_page,s.value=d.role}catch(a){console.error("Error de red:",a)}finally{F.value=!1}},J=async()=>{try{_.value=!0;const o={};E.value&&(o.start=z(E.value[0]).format("YYYY-MM-DD"),o.end=z(E.value[1]).format("YYYY-MM-DD")),x.search&&(o.search=x.search),C.value.page&&(o.page=C.value.page);const{data:a}=await A({url:"ruta-digital/list-all",method:"GET",params:o});await Ve("download/digital-routes","ruta-digital",a)}catch(o){console.error("Error de red:",o)}finally{_.value=!1}};return we(()=>{window.removeEventListener("resize",Y)}),De(()=>{window.addEventListener("resize",Y),Y(),T()}),(o,a)=>{const d=p("a-button"),n=p("a-range-picker"),k=p("a-col"),f=p("a-input"),ie=p("a-input-group"),oe=p("a-row"),se=p("a-switch"),W=p("a-menu-item"),t=p("a-popconfirm"),le=p("a-menu"),v=p("a-dropdown"),be=p("a-table"),he=p("a-tag"),ge=p("a-pagination"),ye=p("a-drawer");return r(),q(Q,null,[N("div",null,[a[11]||(a[11]=N("h3",{class:"title-produce"},"RUTA DIGITAL - UGO",-1)),m(oe,{style:{margin:"1rem 0"}},{default:c(()=>[m(k,{xs:24,md:16,lg:18},{default:c(()=>[m(d,{type:"primary",onClick:Z,style:{}},{default:c(()=>a[4]||(a[4]=[K("REGISTRAR")])),_:1}),m(d,{class:"btn-excel",onClick:J,loading:_.value,type:"primary",style:{margin:"0 .6rem"}},{default:c(()=>a[5]||(a[5]=[N("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Re},null,-1)])),_:1},8,["loading"]),m(n,{value:E.value,"onUpdate:value":a[0]||(a[0]=L=>E.value=L),style:{width:"240px","font-size":"13px"},onChange:T},null,8,["value"])]),_:1}),m(k,{xs:24,md:8,lg:6},{default:c(()=>[m(ie,{compact:""},{default:c(()=>[m(f,{value:x.search,"onUpdate:value":a[1]||(a[1]=L=>x.search=L),style:{width:"calc(100% - 80px)"},onInput:j,placeholder:"Buscar por RUC o DNI"},null,8,["value"]),m(d,{type:"primary",disabled:x.search==="",onClick:B},{default:c(()=>a[6]||(a[6]=[K("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),m(be,{bordered:"",scroll:{x:U.value,y:G.value},class:"table-agreements-ugse",columns:$,"data-source":i.value,pagination:!1,loading:F.value,size:"small"},{headerCell:c(({column:L})=>a[7]||(a[7]=[])),bodyCell:c(({column:L,record:X,index:fe})=>[L.dataIndex=="idx"?(r(),q(Q,{key:0},[K(ue(S.value(fe)),1)],64)):h("",!0),L.dataIndex=="status"?(r(),b(se,{key:1,checked:X.status,"onUpdate:checked":ee=>X.status=ee,checkedValue:1,unCheckedValue:0,onChange:ee=>w(X.id)},{checkedChildren:c(()=>a[8]||(a[8]=[N("span",{style:{"font-size":"12px"}},"Si",-1)])),unCheckedChildren:c(()=>a[9]||(a[9]=[N("span",{style:{"font-size":"12px"}},"No",-1)])),_:2},1032,["checked","onUpdate:checked","onChange"])):h("",!0),L.dataIndex=="actions"?(r(),b(v,{key:2,trigger:["click"]},{overlay:c(()=>[m(le,null,{default:c(()=>[m(W,null,{default:c(()=>[N("a",{onClick:ee=>P(X)},"Editar",8,He)]),_:2},1024),m(W,null,{default:c(()=>[m(t,{title:"¿Seguro de eliminar?",onConfirm:ee=>l(X)},{icon:c(()=>[m(M(Ce),{style:{color:"red"}})]),default:c(()=>[a[10]||(a[10]=N("a",null,"Eliminar",-1))]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:c(()=>[N("a",{class:"ant-dropdown-link",onClick:a[2]||(a[2]=de(()=>{},["prevent"]))},[m(d,{shape:"circle",icon:xe(M(Oe)),size:"small"},null,8,["icon"])])]),_:2},1024)):h("",!0)]),_:1},8,["scroll","data-source","loading"])]),N("div",je,[N("span",null,[m(he,{color:"blue"},{default:c(()=>[N("b",null,ue(O.value),1)]),_:1}),a[12]||(a[12]=K("Registros"))]),m(ge,{size:"small",total:O.value,pageSize:I.value,onChange:V,showSizeChanger:!1},null,8,["total","pageSize"])]),m(ye,{open:e.value,"onUpdate:open":a[3]||(a[3]=L=>e.value=L),"root-class-name":"root-class-name",title:"Ruta Digital",placement:"right",width:"650"},{default:c(()=>[m(Ye,{onCloseDraw:g})]),_:1},8,["open"])],64)}}},aa=ce(Ke,[["__scopeId","data-v-e5b5539c"]]);export{aa as default};
