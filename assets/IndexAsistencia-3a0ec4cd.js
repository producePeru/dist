import{_ as K}from"./TableComponent-04163bfb.js";import{l as g,r as D,E as ee,a as Z,X as W,j as J,b as _,o,x as u,w as s,e as q,d as N,F as V,s as ae,c as p,y as d,h as T,M as te,i as A,t as X,R as F,m as O,u as ne,a6 as Q,f as le,a2 as re}from"./index-d011bb8f.js";import{u as se}from"./selectes-977b0a6c.js";import"./es-1d828a40.js";import{d as oe}from"./downloadExcel-896b0bbf.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-3b2fcc36.js";const ie={class:"form-attendance"},de="DD/MM/YYYY",ce={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup(P,{emit:$}){g.locale("es");const m=se();m.$patch({cities:m.cities}),m.$patch({provinces:m.provinces}),m.$patch({districts:m.districts}),m.fetchCities(),m.fetchAsesores();const x=D(!1),h=P,b=$;ee();const e=Z({}),R={eventsoffice_id:{type:"iSelect",label:"TIPO DE EVENTO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD DEL EVENTO",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO DE INSCRIPCIONES",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA CIERRE DE INSCRIPCIONES",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1,placeholder:"Ejemplo: Lunes 20 de enero"},modality:{type:"iSelect",label:"MODALIDAD DEL EVENTO",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN DEL EVENTO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA DEL EVENTO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO DEL EVENTO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"LUGAR DEL EVENTO",name:"address",required:!0,message:"Escribir lugar del evento",disabled:!0,max:100,placeholder:"Ejemplo: Av. Los Incas 1234 - San Miguel"},fecha:{type:"iText",label:"FECHA DEL EVENTO",name:"fecha",required:!1,message:"Escribir fecha del evento",disabled:!0,max:100,placeholder:"Ejemplo: Lunes 20 de enero"},hora:{type:"iText",label:"HORA DEL EVENTO",name:"hora",required:!1,message:"Escribir hora del evento",disabled:!0,max:100,placeholder:"Ejemplo: 8:00 am hasta las 5:00 pm"},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}},Y=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}];W(()=>e.startDate,t=>{e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=null)}),W(()=>e.endDate,t=>{e.startDate&&new Date(t)<new Date(e.startDate)&&(e.startDate=null)});const I=(t,y)=>{const S=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return y.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(S)},r=t=>{if(t=="modality")return Y;if(t=="powerBy")return pertenece;if(t=="fairtype_id")return typeFair;if(t=="eventsoffice_id")return B()},B=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],L=t=>{e.province_id=null,e.district_id=null,m.fetchProvinces(t)},k=t=>{e.district_id=null,m.fetchDistricts(t)},C=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null},G=async()=>{x.value=!0;const t={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:g(e.startDate).format("YYYY-MM-DD"),endDate:g(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,fecha:e.fecha,hora:e.hora,people_id:e.people_id,description:e.description};try{const y=h.dataRow?"PUT":"POST",S=h.dataRow?`attendance/update/${h.dataRow.id}`:"attendance/create",c=await F({url:S,method:y,data:t});c.status==200&&(O.success(c.message),b("closeDraw"),C()),c.status==500&&(O.error(c.message),C())}catch(y){O.error("Se presentó un error, los valores son requeridos",y)}finally{x.value=!1}},H=t=>{const y=e[t]?e[t].trim():"";e[t]=y};function U(t){e.eventsoffice_id=t.id_pnte,e.title=t.title,e.startDate=t.startDate?g(t.startDate,"DD/MM/YYYY"):null,e.endDate=t.endDate?g(t.endDate,"DD/MM/YYYY"):null,e.modality=t.modality,e.city_id=t.city_id,L(t.city_id),e.province_id=t.province_id,k(t.province_id),e.district_id=t.district_id,e.address=t.address,e.fecha=t.fecha,e.hora=t.hora,e.people_id=t.people_id,e.description=t.description}return J(()=>{h.dataRow&&U(h.dataRow)}),W(()=>h.dataRow,t=>{t?U(t):C()}),(t,y)=>{const S=_("a-input"),c=_("a-form-item"),f=_("a-select"),z=_("a-textarea"),n=_("a-input-number"),l=_("a-date-picker"),E=_("a-button"),M=_("a-form");return o(),u(M,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:G},{default:s(()=>[q("div",ie,[(o(),N(V,null,ae(R,(a,j)=>(o(),N(V,{key:j},[a.type==="iText"?(o(),u(c,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:s(()=>[p(S,{value:e[a.name],"onUpdate:value":i=>e[a.name]=i,maxlength:a.max,onBlur:i=>H(a.name),placeholder:a.placeholder},null,8,["value","onUpdate:value","maxlength","onBlur","placeholder"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelect"?(o(),u(c,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[p(f,{value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:r(a.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iTextarea"?(o(),u(c,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[p(z,{value:e[a.name],"onUpdate:value":i=>e[a.name]=i,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iNumber"?(o(),u(c,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[p(n,{value:e[a.name],"onUpdate:value":i=>e[a.name]=i,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iDate"?(o(),u(c,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[p(l,{locale:T(te),value:e[a.name],"onUpdate:value":i=>e[a.name]=i,style:{width:"100%"},format:de,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelectWrite"?(o(),u(c,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[a.name=="city_id"?(o(),u(f,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(m).cities,"show-search":"","filter-option":I,onChange:L},null,8,["value","onUpdate:value","options"])):d("",!0),a.name=="province_id"?(o(),u(f,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(m).provinces,"show-search":"","filter-option":I,onChange:k,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="district_id"?(o(),u(f,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(m).districts,"show-search":"","filter-option":I,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="people_id"?(o(),u(f,{key:3,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:T(m).asesores,"show-search":"","filter-option":I},null,8,["value","onUpdate:value","options"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0)],64))),64))]),p(c,null,{default:s(()=>[p(E,{type:"primary","html-type":"submit",loading:x.value},{default:s(()=>[A(X(P.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const ue={class:"advisory-table"},me={key:0},pe=["onClick"],_e=["onClick"],be={__name:"IndexAsistencia",setup(P){const $=JSON.parse(localStorage.getItem("role"))||[],m=D([]),x=D(0),h=D(150),b=D(!1);ne();const e=D(!1),R=D(null),Y=D(!1),I=D([]),r=Z({year:g("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),B=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],L=D([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),k=n=>{R.value=n,b.value=!0},C=()=>{f(),b.value=!1},G=()=>{R.value=null,b.value=!0},H=async n=>{try{const l=await F({url:`attendance/delete/${n.id}`,method:"DELETE"});l.status==200&&(f(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},U=async n=>{try{const l=await F({url:`attendance/event-finally/${n.id}`,method:"PUT"});l.status==200&&(f(),O.success(l.message))}catch(l){console.error("Error de red:",l)}},t=async()=>{Y.value=!0;try{const n={};r.year&&(n.year=g(r.year).format("YYYY")),r.range&&(n.dateStart=r.range[0].format("YYYY/MM/DD"),n.dateEnd=r.range[1].format("YYYY/MM/DD")),r.name&&(n.name=r.name),r.orderby&&(n.orderby=r.orderby),r.asesor&&(n.asesor=r.asesor),await oe("download/attendance-ugo","eventos-ugo",n)}catch(n){console.error("Error de red:",n)}finally{Y.value=!1}},y=async n=>{r.page=n,await f()},S=async n=>{n&&(r.page=1,await f())},c=n=>$.some(l=>n.includes(l.id)),f=async()=>{try{e.value=!0;const n={page:r.page};r.year&&(n.year=g(r.year).format("YYYY")),r.range&&(n.dateStart=r.range[0].format("YYYY/MM/DD"),n.dateEnd=r.range[1].format("YYYY/MM/DD")),r.name&&(n.name=r.name),r.orderby&&(n.orderby=r.orderby),r.asesor&&(n.asesor=r.asesor);const E=await F({url:"attendance/list",method:"GET",params:n});m.value=E.data.data,x.value=E.data.total,h.value=E.data.per_page}catch(n){console.error("Error de red:",n)}finally{e.value=!1}},z=async()=>{try{const n=await le({url:"select/asesores-report",method:"GET"});n.status==200&&(I.value=n.data)}catch{console.log("Failed to delete")}};return J(async()=>{await f(),await z()}),Q("search",r),Q("loading",e),Q("loadingFile",Y),(n,l)=>{const E=_("a-tag"),M=_("router-link"),a=_("a-menu-item"),j=_("a-popconfirm"),i=_("a-drawer");return o(),N("div",ue,[p(K,{title:"LISTA EVENTOS UGO",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:B,othersList:L.value,titleSearch:"BUSCAR POR EVENTO",pageSize:h.value,nameTotal:"Eventos UGO",asesoresList:I.value,dataSource:m.value,total:x.value,onHandleNew:G,onHandleDownloadExcel:t,onHandleSearch:S,onHandlePaginator:y},{"data-cell":s(({column:v,record:w})=>[v.dataIndex=="type_activity"?(o(),N("span",me,X(w.pnte),1)):d("",!0),v.dataIndex=="modality"?(o(),N(V,{key:1},[w.modality=="p"?(o(),u(E,{key:0,color:"blue"},{default:s(()=>l[1]||(l[1]=[A("PRESENCIAL")])),_:1})):d("",!0),w.modality=="v"?(o(),u(E,{key:1,color:"orange"},{default:s(()=>l[2]||(l[2]=[A("VIRTUAL")])),_:1})):d("",!0)],64)):d("",!0),v.dataIndex=="dateDiff"?(o(),N(V,{key:2},[w.finally?(o(),u(E,{key:0,color:"red"},{default:s(()=>l[3]||(l[3]=[A(" FINALIZADO ")])),_:1})):d("",!0)],64)):d("",!0)]),"custom-options":s(({record:v})=>[p(a,null,{default:s(()=>[p(M,{to:`/asistencias/${v.slug}`,target:"_blank"},{default:s(()=>l[4]||(l[4]=[A(" Ver Link ")])),_:2},1032,["to"])]),_:2},1024),c([1,5])?(o(),u(a,{key:0},{default:s(()=>[p(M,{to:`inscritos/${v.slug}`},{default:s(()=>l[5]||(l[5]=[A("Inscritos")])),_:2},1032,["to"])]),_:2},1024)):d("",!0),c([1,5])?(o(),u(a,{key:1},{default:s(()=>[q("a",{onClick:w=>k(v)},"Editar",8,pe)]),_:2},1024)):d("",!0),c([1,5])?(o(),u(a,{key:2},{default:s(()=>[q("span",{style:{color:"#ff4d4f"},onClick:w=>U(v)},"Finalizar",8,_e)]),_:2},1024)):d("",!0),c([1,5])?(o(),u(a,{key:3},{default:s(()=>[p(j,{placement:"rightBottom",title:`¿Quieres eliminar ${v.title} ?`,onConfirm:w=>H(v)},{icon:s(()=>[p(T(re),{style:{color:"red"}})]),default:s(()=>[l[6]||(l[6]=q("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):d("",!0)]),_:1},8,["othersList","pageSize","asesoresList","dataSource","total"]),p(i,{open:b.value,"onUpdate:open":l[0]||(l[0]=v=>b.value=v),title:R.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:s(()=>[p(ce,{onCloseDraw:C,dataRow:R.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{be as default};
