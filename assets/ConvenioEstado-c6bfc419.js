import{c as a,A as de,N as P,r as m,a as ne,k as K,M as oe,b as p,o as c,s as U,w as i,e as I,d as O,F as B,y as Ce,h as z,v as k,O as _e,B as G,m as R,a3 as Pe,a4 as De,t as j,i as H,a5 as fe,g as we,R as Oe,a6 as Ve,J as ae,K as Fe,x as qe,W as Be,L as je,p as He,j as Ge}from"./index-b7e174ec.js";import{_ as Je}from"./icoexcel-1b303edf.js";import{u as xe}from"./selectes-639f74bd.js";import"./es-cb05a220.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Ze}from"./MoreOutlined-94b0205d.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};const We=Qe;function ge(d){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?Object(arguments[s]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable}))),u.forEach(function(f){Xe(d,f,n[f])})}return d}function Xe(d,s,n){return s in d?Object.defineProperty(d,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):d[s]=n,d}var ce=function(s,n){var u=ge({},s,n.attrs);return a(de,ge({},u,{icon:We}),null)};ce.displayName="CloudUploadOutlined";ce.inheritAttrs=!1;const Ke=ce;var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};const tt=et;function he(d){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?Object(arguments[s]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable}))),u.forEach(function(f){at(d,f,n[f])})}return d}function at(d,s,n){return s in d?Object.defineProperty(d,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):d[s]=n,d}var ue=function(s,n){var u=he({},s,n.attrs);return a(de,he({},u,{icon:tt}),null)};ue.displayName="MessageOutlined";ue.inheritAttrs=!1;const nt=ue;var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};const st=ot;function ye(d){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?Object(arguments[s]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable}))),u.forEach(function(f){it(d,f,n[f])})}return d}function it(d,s,n){return s in d?Object.defineProperty(d,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):d[s]=n,d}var pe=function(s,n){var u=ye({},s,n.attrs);return a(de,ye({},u,{icon:st}),null)};pe.displayName="SaveOutlined";pe.inheritAttrs=!1;const lt=pe,rt={city_id:{type:"iSelect",label:"Región",name:"city_id",required:!0,message:"Seleccionar una región",disabled:!0},province_id:{type:"iSelect",label:"Provincia",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},alliedEntity:{type:"iText",label:"Entidad Aliada",name:"alliedEntity",required:!0,message:"Escribir la entidad aliada",disabled:!0},homeOperations:{type:"iDate",label:"Fecha de suscripción del convenio",name:"homeOperations",required:!0,message:"Seleccionar fecha",disabled:!0},space:{type:"iSpace"},startDate:{type:"iDate",label:"Inicio Convenio Vigente",name:"startDate",required:!0,message:"Seleccionar fecha de convenio vigente",disabled:!0},years:{type:"iSelect",label:"Número de años vigente",name:"years",required:!0,message:"Seleccionar años",disabled:!1},observations:{type:"iTextarea",label:"Observaciones",name:"observations",required:!1,message:"Seleccionar",disabled:!1}};const dt={class:"grid-convenios"},ct={key:4},ut={key:0},pt={key:1},be="DD/MM/YYYY",mt={__name:"DrawConvenio",props:["idConvenio"],emits:["closeDraw"],setup(d,{emit:s}){P.locale("es");const n=JSON.parse(localStorage.getItem("profile")),u=xe(),f=s,b=d;u.$patch({cities:u.cities}),u.$patch({provinces:u.provinces}),u.$patch({districts:u.districts}),u.fetchCities();const g=m(!1),x=m(!1),t=ne({}),D=[{value:1,label:"1 Año"},{value:2,label:"2 Años"},{value:3,label:"3 Años"},{value:4,label:"4 Años"},{value:5,label:"5 Años"},{value:6,label:"6 Años"},{value:7,label:"7 Años"},{value:8,label:"8 Años"},{value:9,label:"9 Años"},{value:10,label:"10 Años"}],M=e=>{const l=P(t.startDate).add(1,"day").startOf("day");return P(e).startOf("day").isBefore(l,"day")},V=e=>{t.province_id=null,t.district_id=null,u.fetchProvinces(e)},N=e=>{t.district_id=null,u.fetchDistricts(e)},A=(e,l)=>{const h=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(h)},Y=()=>{t.city_id=null,t.province_id=null,t.district_id=null,t.alliedEntity=null,t.homeOperations=null,t.startDate=null,t.years=null,t.endDate=null,t.observations=null,t.created_id=n.user_id},T=async()=>{g.value=!0;const e={city_id:t.city_id,province_id:t.province_id,district_id:t.district_id,alliedEntity:t.alliedEntity,homeOperations:P(t.homeOperations).format("YYYY-MM-DD"),startDate:P(t.startDate).format("YYYY-MM-DD"),years:t.years,endDate:P(t.startDate).add(t.years,"year").format("YYYY-MM-DD"),observations:t.observations,created_id:n.user_id};try{const l=b.idConvenio?"PUT":"POST",h=b.idConvenio?`agreement/update-values/${b.idConvenio.id}`:"agreement/create",w=await G({url:h,method:l,data:e});w.status==200&&(R.success(w.message),f("closeDraw",!0),Y())}catch(l){R.error("Se originó un error: "+l.message)}finally{g.value=!1}},L=()=>{R.error("Debes de completar todos los espacios requeridos")},v=async()=>{if(b.idConvenio){x.value=!0;const e=b.idConvenio;t.city_id=e.city_id,V(e.city_id),t.province_id=e.province_id,N(e.province_id),t.district_id=e.district_id,t.homeOperations=P(e.startOperations,"YYYY-MM-DD"),t.startDate=P(e.startDate,"YYYY-MM-DD"),t.years=e.years,t.observations=e.observations,t.alliedEntity=e.entity,t.district_id&&(x.value=!1)}else Y()};return K(()=>{b.idConvenio&&v(b.idConvenio)}),oe(()=>b.idConvenio,e=>{e&&v()}),(e,l)=>{const h=p("a-input"),w=p("a-form-item"),F=p("a-select"),J=p("a-date-picker"),E=p("a-textarea"),Z=p("a-button"),q=p("a-form"),W=p("a-spin");return c(),U(W,{spinning:x.value},{default:i(()=>[a(q,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:T,onFinishFailed:L},{default:i(()=>[I("div",dt,[(c(!0),O(B,null,Ce(z(rt),(o,se)=>(c(),O(B,{key:se},[o.type==="iText"?(c(),U(w,{key:0,name:o.name,label:o.label,rules:[{required:o.required,message:o.message,max:o.max}]},{default:i(()=>[a(h,{value:t[o.name],"onUpdate:value":S=>t[o.name]=S,maxlength:o.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):k("",!0),o.type==="iSelect"?(c(),U(w,{key:1,class:"item-max",name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:i(()=>[o.name=="city_id"?(c(),U(F,{key:0,value:t[o.name],"onUpdate:value":S=>t[o.name]=S,options:z(u).cities,"show-search":"","filter-option":A,onChange:V},null,8,["value","onUpdate:value","options"])):k("",!0),o.name=="province_id"?(c(),U(F,{key:1,value:t[o.name],"onUpdate:value":S=>t[o.name]=S,options:z(u).provinces,"show-search":"","filter-option":A,onChange:N,disabled:!t.city_id},null,8,["value","onUpdate:value","options","disabled"])):k("",!0),o.name=="district_id"?(c(),U(F,{key:2,value:t[o.name],"onUpdate:value":S=>t[o.name]=S,options:z(u).districts,"show-search":"","filter-option":A,disabled:!t.province_id},null,8,["value","onUpdate:value","options","disabled"])):k("",!0),o.name=="years"?(c(),U(F,{key:3,value:t[o.name],"onUpdate:value":S=>t[o.name]=S,options:D,"show-search":"","filter-option":A},null,8,["value","onUpdate:value"])):k("",!0)]),_:2},1032,["name","label","rules"])):k("",!0),o.type==="iDate"?(c(),U(w,{key:2,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:i(()=>[o.name=="endDate"?(c(),U(J,{key:0,"disabled-date":M,locale:z(_e),disabled:!t.startDate,value:t[o.name],"onUpdate:value":S=>t[o.name]=S,style:{width:"100%"},format:be,placeholder:"día/mes/año"},null,8,["locale","disabled","value","onUpdate:value"])):(c(),U(J,{key:1,locale:z(_e),value:t[o.name],"onUpdate:value":S=>t[o.name]=S,style:{width:"100%"},format:be,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"]))]),_:2},1032,["name","label","rules"])):k("",!0),o.type==="iTextarea"?(c(),U(w,{key:3,name:o.name,label:o.label,rules:[{required:o.required,message:o.message}]},{default:i(()=>[a(E,{value:t[o.name],"onUpdate:value":S=>t[o.name]=S,rows:3},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):k("",!0),o.type==="iSpace"?(c(),O("span",ct)):k("",!0)],64))),128))]),a(w,null,{default:i(()=>[a(Z,{type:"primary","html-type":"submit",loading:g.value},{default:i(()=>[d.idConvenio?(c(),O("span",ut,"ACTUALIZAR")):(c(),O("span",pt,"GUARDAR"))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])}}},vt=Ee(mt,[["__scopeId","data-v-324b1377"]]);const _t={class:"accion-icons"},ft={key:0},gt={key:1},ht={__name:"DrawAcciones",props:["idConvenio"],emits:["refreshTable"],setup(d,{emit:s}){const n=d,u=s,f=m([]),b=m(!0),g=m(null),x=m(""),t=m(!1);m(null);const D=ne({description:null});K(()=>{n.idConvenio&&T(n.idConvenio)}),oe(()=>n.idConvenio,v=>{v&&T()});function M(v){g.value=v.id,x.value=v.description,fe(()=>{L()})}function V(v){const e=f.value.findIndex(l=>l.id===v.id);e!==-1&&(f.value[e].description=x.value),g.value=null,A(v.id)}const N=async v=>{try{const e=await G({url:`agreement/delete-acction/${v.id}`,method:"DELETE"});e.status==200&&(T(),R.success(e.message),u("refreshTable",!0))}catch(e){console.error("Error de red:",e)}},A=async v=>{try{const e={description:x.value},l=await G({url:`agreement/update/${v}`,method:"PUT",data:e});l.status==200&&(R.success(l.message),T())}catch(e){console.error("Error de red:",e)}},Y=async()=>{try{const v={description:D.description,agreements_id:n.idConvenio},e=await G({url:"agreement/create-acction",method:"POST",data:v});e.status==200&&(R.success(e.message),u("refreshTable",!0),T(),D.description=null)}catch(v){console.error("Error de red:",v)}},T=async()=>{b.value=!0;try{const v=await G({url:`agreement/list/${n.idConvenio}`,method:"GET"});v.status==200&&(f.value=v.data)}catch{}finally{b.value=!1}},L=()=>{fe(()=>{const v=document.getElementById("auto-resize");v.style.height="auto",v.style.height=v.scrollHeight+"px"})};return(v,e)=>{const l=p("a-textarea"),h=p("a-spin"),w=p("a-form-item"),F=p("a-button"),J=p("a-form");return c(),O("div",null,[a(h,{spinning:b.value},{default:i(()=>[(c(!0),O(B,null,Ce(f.value,(E,Z)=>(c(),O("div",{class:"acciones",key:Z},[I("div",_t,[a(z(Pe),{class:"pointer ico-acc",onClick:q=>M(E)},null,8,["onClick"]),g.value===E.id?(c(),U(z(lt),{key:0,class:"pointer ico-save",onClick:q=>V(E)},null,8,["onClick"])):k("",!0),a(z(De),{class:"pointer ico-acc",onClick:q=>N(E)},null,8,["onClick"])]),g.value===E.id?(c(),O("div",ft,[a(l,{value:x.value,"onUpdate:value":e[0]||(e[0]=q=>x.value=q),onInput:L,id:"auto-resize"},null,8,["value"])])):(c(),O("p",gt,j(E.description),1))]))),128))]),_:1},8,["spinning"]),a(J,{layout:"vertical",model:D,name:"basic",autocomplete:"off",onFinish:Y},{default:i(()=>[a(w,{name:"description",label:"Registra una acción",rules:[{required:!0,message:"Escribir la descripción"}]},{default:i(()=>[a(l,{value:D.description,"onUpdate:value":e[1]||(e[1]=E=>D.description=E),maxlength:250,rows:4},null,8,["value"])]),_:1}),a(w,null,{default:i(()=>[a(F,{type:"primary","html-type":"submit",loading:t.value},{default:i(()=>[H("CREAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const yt={__name:"DrawObservations",props:["idConvenio"],emits:["refreshTable"],setup(d,{emit:s}){const n=d,u=s;m([]);const f=m(!0);m(null),m("");const b=m(!1);m(null);const g=ne({description:null});K(()=>{n.idConvenio&&t(n.idConvenio)}),oe(()=>n.idConvenio,D=>{D&&t()});const x=async()=>{b.value=!0;try{const D={observations:g.description},M=await G({url:`agreement/update-values/${n.idConvenio.id}`,method:"PUT",data:D});M.status==200&&(R.success(M.message),u("refreshTable",!0))}catch(D){console.error("Error de red:",D)}finally{b.value=!1}},t=async()=>{g.description=n.idConvenio.observations,g.description!=null&&(f.value=!1)};return(D,M)=>{const V=p("a-textarea"),N=p("a-form-item"),A=p("a-button"),Y=p("a-form"),T=p("a-spin");return c(),O("div",null,[a(T,{spinning:f.value},{default:i(()=>[a(Y,{layout:"vertical",model:g,name:"basic",autocomplete:"off",onFinish:x},{default:i(()=>[a(N,{name:"description",label:"Orbservaciones",rules:[{required:!0,message:"Escribir la descripción"}]},{default:i(()=>[a(V,{value:g.description,"onUpdate:value":M[0]||(M[0]=L=>g.description=L),rows:6},null,8,["value"])]),_:1}),a(N,null,{default:i(()=>[a(A,{type:"primary","html-type":"submit",loading:b.value},{default:i(()=>[H("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}};const bt=I("div",{class:"agreements-file"},[I("b",null,"Formatos a subir"),I("span",null,"pdf, doc, docx, xls, xlsx, ppt, pptx"),I("span",null,"*(Máximo 20MB)")],-1),Ct={class:"file-options"},Dt={style:{"line-height":"1.3"}},wt=["onClick"],Ot=["onClick"],xt={__name:"DrawFiles",props:["idConvenio"],setup(d){P.locale("es");const s=we.get("token"),n=d,u="https://apituempresa.soporte-pnte.com/api/",f="http://127.0.0.1:8000/api/",b=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?f:u,g=m(!1),x=m([]),t=m(null),D=m(null),M=Oe(Ve,{style:{fontSize:"20px"},spin:!0});K(()=>{n.idConvenio&&v(n.idConvenio)}),oe(()=>n.idConvenio,e=>{e&&v(e)});const V=e=>P(e).format("DD-MM-YYYY HH:mm"),N=e=>(A(e),!1),A=async e=>{const l=new FormData;l.append("file",e),l.append("agreements_id",n.idConvenio),g.value=!0;try{const{data:h}=await ae.post(`${b}agreement/file`,l,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${s}`}});h.status==200&&(R.success(h.message),v(n.idConvenio))}catch{R.error("Error al subir este tipo de archivo")}finally{g.value=!1}},Y=async e=>{t.value=e.uid;try{const l=await ae({url:`${b}agreement/file-download/${e.uid}`,method:"POST",responseType:"blob",headers:{Authorization:`Bearer ${s}`}}),h=window.URL.createObjectURL(new Blob([l.data])),w=document.createElement("a");w.href=h,w.setAttribute("download",e.name),document.body.appendChild(w),w.click(),window.URL.revokeObjectURL(h),document.body.removeChild(w)}catch(l){console.error("Error downloading file:",l)}finally{t.value=null}},T=e=>{e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?(R.success(`${e.file.name} file uploaded successfully`),x.value=e.fileList.filter(l=>l.status!=="error")):e.file.status==="error"&&(R.error(`${e.file.name} file upload failed.`),x.value=e.fileList.filter(l=>l.uid!==e.file.uid))},L=async e=>{D.value=e.uid;try{const l=await G({url:`agreement/delete/file/${e.uid}`,method:"DELETE"});l.status==200&&(v(n.idConvenio),R.success(l.message))}catch(l){console.error("Error de red:",l)}finally{D.value=null}},v=async e=>{try{const{data:l}=await ae.get(`${b}agreement/list-files/${e}`,{headers:{Authorization:`Bearer ${s}`}});l.status===200&&(x.value=l.data.map(h=>({uid:h.id,name:h.name,status:"done",url:h.path,date:h.created_at})))}catch(l){console.error("Error fetching files:",l)}};return(e,l)=>{const h=p("a-button"),w=p("a-spin"),F=p("a-space"),J=p("a-upload");return c(),O("div",null,[bt,a(J,{"file-list":x.value,name:"file",onChange:T,"custom-request":A,"before-upload":N},{itemRender:i(({file:E,actions:Z})=>[a(F,{style:{margin:"0rem 0","font-size":"13px",width:"100%"}},{default:i(()=>[I("div",Ct,[I("span",Dt,j(E.name),1),I("span",null,j(V(E.date)),1),t.value!=E.uid?(c(),O("a",{key:0,onClick:q=>Y(E)},"Descargar",8,wt)):(c(),U(w,{key:1,indicator:z(M)},null,8,["indicator"])),D.value==E.uid?(c(),U(w,{key:2,indicator:z(M)},null,8,["indicator"])):(c(),O("a",{key:3,onClick:q=>L(E),style:{color:"var(--error)"}},[a(z(De))],8,Ot))])]),_:2},1024)]),default:i(()=>[a(h,{style:{"margin-bottom":".6rem"},loading:g.value},{default:i(()=>[a(z(Ke)),H(" SUBIR ARCHIVO ")]),_:1},8,["loading"])]),_:1},8,["file-list"])])}}};const me=d=>(He("data-v-5cb3d3c9"),d=d(),Ge(),d),Et=me(()=>I("h3",{class:"title-produce"},"ESTADO DE CONVENIOS",-1)),St=me(()=>I("img",{width:"20",style:{margin:"-2px 0 0 0"},src:Je},null,-1)),kt={key:0,class:"list-days"},It={key:1,class:"list-days"},$t=["onClick"],At=["onClick"],Ut=me(()=>I("a",null,"Eliminar",-1)),Tt={class:"paginator"},zt={__name:"ConvenioEstado",props:["idConvenio"],setup(d){P.locale("es"),JSON.parse(localStorage.getItem("profile")),xe();const s=we.get("token"),n="https://apituempresa.soporte-pnte.com/api/",u="http://127.0.0.1:8000/api/",f=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?u:n;m(null),m(null);const b=m(!1),g=m(null),x=m(0),t=m(50),D=m({page:0}),M=m(1200),V=m([]),N=m(!1),A=m(!1),Y=m(!1),T=m(!1),L=m(!1),v=m(null);m(null);const e=m(window.innerHeight-100),l=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGIÓN",dataIndex:"city",fixed:"left",width:120},{title:"PROVINCIA",dataIndex:"province",fixed:"left",width:120},{title:"DISTRITO",dataIndex:"district",fixed:"left",width:140},{title:"ENTIDAD ALIADA",dataIndex:"entity",width:300},{title:"FECHA DE SUSCRIPCIÓN DE CONVENIO",dataIndex:"startOperations",align:"center",width:180},{title:"INICIO DE CONVENIO VIGENTE",dataIndex:"startDate",align:"center",width:180},{title:"N° DE AÑOS VIGENTE",dataIndex:"years",width:120,align:"center"},{title:"FIN DEL CONVENIO",dataIndex:"endDate",align:"center",width:180},{title:"ESTADO",dataIndex:"status",align:"center",width:150},{title:"FECHA RESTANTE",dataIndex:"numbrestantes",align:"center",width:140},{title:"OBSERVACIONES",dataIndex:"observations",align:"center",width:140},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],h=ne({search:""}),w=()=>{let _={search:h.search};Q(_)},F=()=>{h.search||Q()},J=_=>{g.value=_,A.value=!0},E=_=>{g.value=_,T.value=!0},Z=_=>P(_).format("DD/MM/YYYY"),q=_=>{g.value=_.id,L.value=!0},W=(_,r)=>{const $=new Date(_),X=new Date,ie=$.getTime()-X.getTime();return Math.floor(ie/(1e3*3600*24))+1},o=_=>_<=0||_<20?"red":_<40?"#f9e717":"#11d811",se=_=>{D.value.page=_,Q()},S=()=>{e.value=window.innerHeight-320},Se=()=>{v.value=null,A.value=!0},ee=_=>{Q(),_==1&&(A.value=!1),_==2&&(Y.value=!1),_==4&&(T.value=!1),g.value=null},ke=async _=>{try{const r=await G({url:`agreement/delete/${_.id}`,method:"DELETE"});r.status==200&&(Q(),R.success(r.message))}catch(r){console.error("Error de red:",r)}},Ie=Fe(()=>_=>D.value.page*t.value+_+1),Q=async _=>{try{N.value=!0;let r;r=D.value.page==0?"":D.value,r=_?{...r,..._}:r;const{data:$}=await G({url:"agreement/list",method:"GET",params:r});V.value=$==null?void 0:$.data,x.value=$.total,t.value=$.per_page}catch(r){console.error("Error de red:",r)}finally{N.value=!1}},$e=async()=>{b.value=!0;try{const _=await ae({url:`${f}agreement/download`,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${s}`}}),r=window.URL.createObjectURL(new Blob([_.data])),$=document.createElement("a"),X="convenios.xlsx";$.href=r,$.setAttribute("download",X),document.body.appendChild($),$.click(),window.URL.revokeObjectURL(r),document.body.removeChild($)}catch(_){console.error("Error downloading file:",_)}finally{b.value=!1}};return qe(()=>{window.removeEventListener("resize",S)}),K(()=>{window.addEventListener("resize",S),S(),Q()}),(_,r)=>{const $=p("a-button"),X=p("a-col"),ie=p("a-input"),ve=p("a-input-group"),Ae=p("a-row"),Ue=p("a-progress"),le=p("a-menu-item"),Te=p("a-popconfirm"),ze=p("a-menu"),Me=p("a-dropdown"),Ne=p("a-table"),Re=p("a-tag"),Ye=p("a-pagination"),te=p("a-drawer");return c(),O(B,null,[I("div",null,[Et,a(Ae,{style:{margin:"1rem 0"}},{default:i(()=>[a(X,{xs:24,md:12,lg:18},{default:i(()=>[a($,{type:"primary",onClick:Se,style:{"margin-right":".5rem"}},{default:i(()=>[H("NUEVO")]),_:1}),a($,{class:"btn-excel",onClick:$e,loading:b.value,type:"primary"},{default:i(()=>[St]),_:1},8,["loading"])]),_:1}),a(X,{xs:24,md:12,lg:6},{default:i(()=>[a(ve,{compact:""},{default:i(()=>[a(ie,{value:h.search,"onUpdate:value":r[0]||(r[0]=y=>h.search=y),style:{width:"calc(100% - 80px)"},onInput:F},null,8,["value"]),a($,{type:"primary",disabled:h.search==="",onClick:w},{default:i(()=>[H("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(Ne,{bordered:"",scroll:{x:M.value,y:e.value},class:"table-agreements",columns:l,"data-source":V.value,pagination:!1,loading:N.value,size:"small"},{headerCell:i(({column:y})=>[]),bodyCell:i(({column:y,record:C,index:Le})=>[y.dataIndex=="idx"?(c(),O(B,{key:0},[H(j(Ie.value(Le)),1)],64)):k("",!0),y.dataIndex=="startOperations"?(c(),O(B,{key:1},[H(j(Z(C.startOperations)),1)],64)):k("",!0),y.dataIndex=="startDate"?(c(),O(B,{key:2},[H(j(Z(C==null?void 0:C.startDate)),1)],64)):k("",!0),y.dataIndex=="endDate"?(c(),O(B,{key:3},[H(j(Z(C==null?void 0:C.endDate)),1)],64)):k("",!0),y.dataIndex=="numbrestantes"?(c(),O(B,{key:4},[W(C.endDate,C.startDate)>=1?(c(),O("p",kt,j(W(C.endDate,C.startDate))+" días faltantes",1)):(c(),O("p",It,j(W(C.endDate,C.startDate))+" días vencidos",1))],64)):k("",!0),y.dataIndex=="status"?(c(),U(Ue,{key:5,style:{margin:"0"},percent:W(C.endDate,C.startDate),size:4,showInfo:!1,strokeColor:o(W(C.endDate,C.startDate))},null,8,["percent","strokeColor"])):k("",!0),y.dataIndex=="observations"?(c(),O(B,{key:6},[C!=null&&C.observations?(c(),U(z(nt),{key:0,class:"observation-icon",onClick:re=>E(C)},null,8,["onClick"])):k("",!0)],64)):k("",!0),y.dataIndex=="actions"?(c(),U(Me,{key:7,trigger:["click"]},{overlay:i(()=>[a(ze,null,{default:i(()=>[a(le,null,{default:i(()=>[I("a",{onClick:re=>q(C)},"Archivos",8,$t)]),_:2},1024),a(le,null,{default:i(()=>[I("a",{onClick:re=>J(C)},"Editar",8,At)]),_:2},1024),a(le,null,{default:i(()=>[a(Te,{title:"¿Seguro de eliminar?",onConfirm:re=>ke(C)},{icon:i(()=>[a(z(Be),{style:{color:"red"}})]),default:i(()=>[Ut]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:i(()=>[I("a",{class:"ant-dropdown-link",onClick:r[1]||(r[1]=je(()=>{},["prevent"]))},[a($,{shape:"circle",icon:Oe(z(Ze)),size:"small"},null,8,["icon"])])]),_:2},1024)):k("",!0)]),_:1},8,["scroll","data-source","loading"])]),I("div",Tt,[I("span",null,[a(Re,{color:"blue"},{default:i(()=>[I("b",null,j(x.value),1)]),_:1}),H("Convenios")]),a(Ye,{size:"small",total:x.value,pageSize:t.value,onChange:se,showSizeChanger:!1},null,8,["total","pageSize"])]),a(te,{open:A.value,"onUpdate:open":r[3]||(r[3]=y=>A.value=y),class:"draw-notary","root-class-name":"root-class-name",title:"Convenios",placement:"right",width:"650"},{default:i(()=>[a(vt,{idConvenio:g.value,onCloseDraw:r[2]||(r[2]=y=>ee(1))},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:Y.value,"onUpdate:open":r[6]||(r[6]=y=>Y.value=y),title:"Acciones",placement:"right",width:"550"},{default:i(()=>[a(ht,{idConvenio:g.value,onCloseDraw:r[4]||(r[4]=y=>ee(2)),onRefreshTable:r[5]||(r[5]=y=>Q())},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:L.value,"onUpdate:open":r[8]||(r[8]=y=>L.value=y),title:"Cargar Archivos",placement:"right",width:"550"},{default:i(()=>[a(xt,{idConvenio:g.value,onCloseDraw:r[7]||(r[7]=y=>ee(3))},null,8,["idConvenio"])]),_:1},8,["open"]),a(te,{open:T.value,"onUpdate:open":r[11]||(r[11]=y=>T.value=y),title:"Observaciones",placement:"right",width:"550"},{default:i(()=>[a(yt,{idConvenio:g.value,onCloseDraw:r[9]||(r[9]=y=>ee(4)),onRefreshTable:r[10]||(r[10]=y=>Q())},null,8,["idConvenio"])]),_:1},8,["open"])],64)}}},Vt=Ee(zt,[["__scopeId","data-v-5cb3d3c9"]]);export{Vt as default};
