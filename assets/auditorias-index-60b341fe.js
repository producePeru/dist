import{_ as F}from"./TableComponent-54382a32.js";import{r as o,a as H,p as P,k as $,W as w,b as _,o as r,d as g,c as d,w as s,m as x,y as E,j as z,t as l,z as f,F as G,v as Y,i as M,a2 as j,e as L,h as Q}from"./index-eae8bbce.js";import{_ as q}from"./EventosUgo-8ad29ba3.js";import{g as W}from"./usePermissions-51a976d3.js";import"./es-ade3237a.js";import"./icoexcel-1b303edf.js";import"./selectes-8bf5dd6f.js";import"./SyncOutlined-f16f82b8.js";import"./MoreOutlined-a2507d86.js";const J={class:"layout-content"},K={key:1},re={__name:"auditorias-index",setup(X){const y=o([]),I=o(0),S=o(150),c=o({}),u=o(!1),h=o(!1),v=o(null),C=o(!1),m=H({year:P("2026","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),D=[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:50},{title:"TIPO",dataIndex:"action",width:80},{title:"USUARIO",dataIndex:"user_id",width:100},{title:"CAMBIOS",dataIndex:"changes",width:180},{title:"FECHA DE CAMBIOS",dataIndex:"created_at",width:100}],A=()=>{i(),u.value=!1},T=()=>{v.value=null,u.value=!0},O=async e=>{try{const a=await x({url:`attendance/delete/${e.id}`,method:"DELETE"});a.status==200&&(i(),Q.success(a.message))}catch(a){console.error("Error de red:",a)}},k=async e=>{m.page=e,await i()},U=async e=>{e&&(m.page=1,await i())},i=async()=>{try{h.value=!0;const e={page:m.page,table_name:"attendancelist"},a=await x({url:"page/audit-logs",method:"GET",params:e});y.value=a.data,I.value=a.total,S.value=a.per_page}catch(e){console.error("Error de red:",e)}finally{h.value=!1}};return $(async()=>{var e;c.value=await W("eventos-ugo"),(e=c.value)!=null&&e.can_view_all&&await i()}),w("search",m),w("loading",h),w("loadingFile",C),(e,a)=>{const B=_("a-tag"),N=_("a-popconfirm"),R=_("a-menu-item"),V=_("a-drawer");return r(),g("div",J,[d(F,{title:"AUDITORIAS ACTIVIDADES UGO",btnUpdate:!0,btnImport:!0,placeholderSearch:"Buscar",columns:D,titleSearch:"BUSCAR POR EVENTO",pageSize:S.value,nameTotal:"Registros",dataSource:y.value,total:I.value,onHandleNew:T,onHandleSearch:U,permisos:c.value,onHandleCallFetchData:i,onHandlePaginator:k,heightTable:440},{"data-cell":s(({column:n,record:t})=>[n.dataIndex=="action"?(r(),E(B,{key:0},{default:s(()=>[z(l(t.action),1)]),_:2},1024)):f("",!0),n.dataIndex=="user_id"?(r(),g("span",K,l(t==null?void 0:t.user.name)+" "+l(t.user.lastname)+" "+l(t.user.middlename),1)):f("",!0),n.dataIndex=="changes"?(r(!0),g(G,{key:2},Y(t==null?void 0:t.changes,(p,b)=>(r(),g("div",{key:b},l(p.field)+" : "+l(p.before)+" --> "+l(p.after),1))),128)):f("",!0)]),"custom-options":s(({record:n})=>{var t;return[(t=c.value)!=null&&t.can_delete?(r(),E(R,{key:0},{default:s(()=>[d(N,{placement:"rightBottom",title:`Â¿Quieres eliminar ${n.title} ?`,onConfirm:p=>O(n)},{icon:s(()=>[d(M(j),{style:{color:"red"}})]),default:s(()=>[a[1]||(a[1]=L("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):f("",!0)]}),_:1},8,["pageSize","dataSource","total","permisos"]),d(V,{open:u.value,"onUpdate:open":a[0]||(a[0]=n=>u.value=n),title:v.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD - UGO",placement:"right",width:"550"},{default:s(()=>[d(q,{onCloseDraw:A,dataRow:v.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{re as default};
