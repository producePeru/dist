import{_ as W}from"./TableComponent-a4d6c292.js";import{p as _,r as o,a as G,k as B,U as ee,X as T,o as p,y as z,i as Q,L as te,d as m,c as u,h as j,m as V,b,w as c,e as E,F as H,j as k,z as Y,t as x,a2 as ae}from"./index-e2d6d64a.js";import{d as ie}from"./downloadExcel-af63d668.js";import{u as Z}from"./selectes-fa9f793b.js";import{_ as ne}from"./FormComponent-441813b8.js";import"./es-ae1e3dd4.js";import{_ as le}from"./DrawResultados-c766759b.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-222ed6a9.js";import"./MoreOutlined-36845e5a.js";import"./quill.snow-c61fd9f8.js";const se={key:1,class:"f-20"},oe={__name:"DrawEventosCalendario",props:["info"],emits:["closeDraw"],setup(q,{emit:C}){_.locale("es");const v=o({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÌTULO DEL EVENTO",name:"title",required:!0,message:"Escribir el título del evento",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA",name:"province_id",required:!1,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO",name:"district_id",required:!1,message:"Seleccionar distrito",disabled:!0},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!1,message:"",disabled:!1,max:100},organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iNumber",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100},date:{type:"iDatePicker",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iQuillEditor",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:255}}),l=Z(),N=C,r=q,y=o(!1),h=o("GUARDAR"),e=G({}),f=o(!1),O=o(null),t=o({id_pnte:[],city_id:[],province_id:[],district_id:[]}),M=async n=>{n=="city_id"&&(console.log("city_id kakakaka"),await l.fetchProvinces(e.city_id),t.value.province_id=l.provinces,v.value.province_id.disabled=!1),n=="province_id"&&(await l.fetchDistricts(e.province_id),t.value.district_id=l.districts,v.value.district_id.disabled=!1)},P=async n=>{n=="id_pnte"&&(await l.fetchOfficesPnte(),t.value.id_pnte=l.officesPnte),n=="city_id"&&(await l.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,t.value.province_id=[],t.value.city_id=l.cities),n=="province_id"&&(e.province_id=null,e.district_id=null,t.value.district_id=[])},U=async()=>{if(!e.date)return j.warning("Debes de seleccionar una fecha del calendario");f.value=!0;const n={id_pnte:e.id_pnte,title:e.title,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,place:e.place,dateStart:_(e.date.start).format("YYYY-MM-DD"),dateEnd:_(e.date.end).format("YYYY-MM-DD"),organiza:e.organiza,numMypes:e.numMypes,description:e.description,nameUser:e.nameUser,link:e.link};try{const g=r.info?`event/update/${r.info.id}`:"event/create",w=r.info?"PUT":"POST";(await V({url:g,method:w,data:n})).status===200&&(S(),N("closeDraw",!0))}catch(g){console.error("Error:",g);const w=document.getElementsByClassName("ant-drawer-body")[0];w&&(w.scrollTop=0)}finally{f.value=!1}},S=()=>{e.id_pnte=null,e.title=null,e.city_id=null,e.province_id=null,e.district_id=null,e.place=null,e.date=null,e.organiza=null,e.numMypes=null,e.description="</p>",e.nameUser=null,e.link=null},I=async n=>{y.value=!0;try{n&&(await l.fetchOfficesPnte(),t.value.id_pnte=l.officesPnte,e.id_pnte=n.id_pnte,e.title=n.title,e.place=n.place,e.organiza=n.organiza,e.numMypes=n.numMypes,e.date={start:_(n.dateStart).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),end:_(n.dateEnd).format("YYYY-MM-DDTHH:mm:ss.SSSZ")},e.description=n.description,e.nameUser=n.nameUser,e.link=n.link,await l.fetchCities(),t.value.city_id=l.cities,e.city_id=n.city_id,await l.fetchProvinces(e.city_id),t.value.province_id=l.provinces,v.value.province_id.disabled=!1,e.province_id=n.province_id,await l.fetchDistricts(e.province_id),t.value.district_id=l.districts,v.value.district_id.disabled=!1,e.district_id=n.district_id)}finally{y.value=!1}};return B(()=>{r.info&&I(r.info)}),ee(()=>r.info,n=>{n?I(n):S()}),T("formState",e),T("loadingState",f),(n,g)=>y.value?(p(),z(Q(te),{key:0,style:{color:"#00a6db"}})):(p(),m("div",se,[u(ne,{fields:v.value,options:t.value,btnSaveName:h.value,mayus:!1,resetSelect:O.value,onHandleChangeSelect:M,onHandleFocusSelect:P,onOnSubmit:U},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const de={class:"layout-content"},re={class:"filter-asesor"},ce={key:0},ue={key:1},pe={key:0},fe={key:1},me=["onClick"],_e=["onClick"],xe={__name:"EventosCalendario",setup(q){const C=Z();JSON.parse(localStorage.getItem("role"));const v=o([]),l=o(0),N=o(150),r=o(null),y=o(!1),h=o(!1),e=o(!1),f=o(!1);o(null);const O=o({}),t=G({asesor:null,name:null,page:1,type:null}),M=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"OFICINA",fixed:"left",dataIndex:"office",width:80,align:"center"},{title:"TIPO DE ACTIVIDAD",fixed:"left",dataIndex:"area",width:120,align:"center"},{title:"TÍTULO",dataIndex:"title",width:200},{title:"REGIÓN",dataIndex:"city",width:140},{title:"PROVINCIA",dataIndex:"province",width:140},{title:"DISTRITO",dataIndex:"district",width:140},{title:"LUGAR",dataIndex:"place",width:180},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"resultado",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],P=(a,i)=>{const R=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return i.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(R)},U=a=>{r.value=a.all,y.value=!0},S=a=>_(a).format("DD/MM/YYYY"),I=a=>_(a,"HH:mm:ss").format("HH:mm"),n=()=>{r.value=null,f.value=!0},g=async()=>{e.value=!0;try{const a={};t.year&&(a.year=_(t.year).format("YYYY")),t.name&&(a.name=t.name),t.range&&(a.dateStart=t.range[0].format("YYYY/MM/DD"),a.dateEnd=t.range[1].format("YYYY/MM/DD")),t.offices&&(a.offices=t.offices),t.type&&(a.type=t.type),await ie("download/events","eventos_pnte",a)}catch(a){console.error("Error de red:",a)}finally{e.value=!1}},w=async a=>{try{const i=await V({url:`event/delete/${a.id}`,method:"DELETE"});i.status==200&&(j.success(i.message),D())}catch{console.log("Failed to delete")}},F=async a=>{t.page=a,await D()},J=async a=>{a&&(t.page=1,await D())},K=a=>{r.value=a.all,f.value=!0},D=async()=>{h.value=!0;try{const a={page:t.page};t.year&&(a.year=_(t.year).format("YYYY")),t.name&&(a.name=t.name),t.range&&(a.dateStart=t.range[0].format("YYYY/MM/DD"),a.dateEnd=t.range[1].format("YYYY/MM/DD")),t.offices&&(a.offices=t.offices),t.type&&(a.type=t.type);const i=await V({url:"event/list",method:"GET",params:a});v.value=i.data.data,l.value=i.data.total,N.value=i.data.per_page}catch(a){console.error("Error de red:",a)}finally{h.value=!1}};return B(async()=>{await D(),await C.fetchOfficesPnte(),O.value.id_pnte=C.officesPnte}),T("search",t),T("loading",h),T("loadingFile",e),(a,i)=>{const R=b("a-select"),A=b("a-tag"),L=b("a-menu-item"),X=b("a-popconfirm"),$=b("a-drawer");return p(),m("div",de,[u(W,{title:"EVENTOS PNTE",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",tipooficina:!0,columns:M,titleSearch:"NOMBRE DEL EVENTO",pageSize:N.value,nameTotal:"Eventos",rangeDate:!0,dataSource:v.value,total:l.value,onHandleNew:n,downloadExcel:!0,onHandleDownloadExcel:g,onHandleSearch:J,onHandlePaginator:F},{header:c(()=>[E("div",re,[i[5]||(i[5]=E("small",null,"TIPO DE ACTIVIDAD",-1)),u(R,{allowClear:!0,value:t.type,"onUpdate:value":i[0]||(i[0]=s=>t.type=s),placeholder:"Selecciona Tipo","show-search":"",options:O.value.id_pnte,"filter-option":P},null,8,["value","options"])])]),"data-cell":c(({column:s,record:d})=>[s.dataIndex=="office"?(p(),m(H,{key:0},[d.office=="UGO"?(p(),z(A,{key:0,color:"blue"},{default:c(()=>i[6]||(i[6]=[k("UGO")])),_:1})):Y("",!0),d.office=="UGSE"?(p(),z(A,{key:1,color:"red"},{default:c(()=>i[7]||(i[7]=[k("UGSE")])),_:1})):Y("",!0)],64)):Y("",!0),s.dataIndex=="date"?(p(),m(H,{key:1},[d.dateStart!=d.dateEnd?(p(),m("span",ce,[i[8]||(i[8]=E("b",null,"Desde:",-1)),k(" "+x(S(d.dateStart))+" ",1),i[9]||(i[9]=E("b",null,"Hasta:",-1)),k(" "+x(S(d.dateEnd)),1)])):(p(),m("span",ue,x(S(d.dateStart)),1))],64)):Y("",!0),s.dataIndex=="hours"?(p(),m(H,{key:2},[d.start?(p(),m("span",fe,x(I(d.start))+" - "+x(I(d.end)),1)):(p(),m("span",pe,"Todo el día"))],64)):Y("",!0)]),"custom-options":c(({record:s})=>[u(L,null,{default:c(()=>[E("a",{onClick:d=>U(s)},"Resultados",8,me)]),_:2},1024),u(L,null,{default:c(()=>[E("a",{onClick:d=>K(s)},"Editar",8,_e)]),_:2},1024),u(L,null,{default:c(()=>[u(X,{placement:"rightBottom",title:`¿Quieres eliminar ${s.title} ?`,onConfirm:d=>w(s)},{icon:c(()=>[u(Q(ae),{style:{color:"red"}})]),default:c(()=>[i[10]||(i[10]=E("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),u($,{width:"500",title:"EVENTO PNTE",open:f.value,"onUpdate:open":i[2]||(i[2]=s=>f.value=s),placement:"right"},{default:c(()=>[u(oe,{info:r.value,onCloseDraw:i[1]||(i[1]=s=>(f.value=!1,D()))},null,8,["info"])]),_:1},8,["open"]),u($,{open:y.value,"onUpdate:open":i[4]||(i[4]=s=>y.value=s),title:"RESULTADOS",placement:"right",width:"550"},{default:c(()=>[u(le,{dataRow:r.value,onCloseDraw:i[3]||(i[3]=s=>{y.value=!1,D()})},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{xe as default};
