import{_ as $}from"./TableComponent-23b544e2.js";import{p as q,r as l,a as R,k,T as F,W as y,o as C,y as P,i as H,L as V,d as A,c as f,m as x,h as z,b as T,w,z as G,e as M}from"./index-27eb4ced.js";import{_ as L}from"./FormComponent-6f0e120d.js";import{u as j}from"./selectes-73cf3849.js";import"./es-6769ff5b.js";import{d as J}from"./downloadExcel-37a93cdc.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-e332b705.js";import"./MoreOutlined-ac973a5f.js";import"./quill.snow-308ce936.js";const W={key:1,class:"f-20"},K={__name:"EditarCde",props:["info"],emits:["closeDraw"],setup(O,{emit:h}){q.locale("es");const c=l({name:{type:"iText",label:"NOMBRE DEL CDE",name:"name",required:!1,message:"",disabled:!1,max:100},city_id:{type:"iSelect",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iTextArea",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir la dirección del CDE",disabled:!1,rows:3}}),i=j(),_=h,o=O,d=l(!1),m=l("GUARDAR"),e=R({}),v=l(!1),E=l(null),s=l({id_pnte:[],city_id:[],province_id:[],district_id:[]}),I=async t=>{t=="city_id"&&(console.log("city_id kakakaka"),await i.fetchProvinces(e.city_id),s.value.province_id=i.provinces,c.value.province_id.disabled=!1),t=="province_id"&&(await i.fetchDistricts(e.province_id),s.value.district_id=i.districts,c.value.district_id.disabled=!1)},D=async t=>{t=="id_pnte"&&(await i.fetchOfficesPnte(),s.value.id_pnte=i.officesPnte),t=="city_id"&&(await i.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,s.value.province_id=[],s.value.city_id=i.cities),t=="province_id"&&(e.province_id=null,e.district_id=null,s.value.district_id=[])},b=async()=>{v.value=!0;const t={name:e.name,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address};try{const a=o.info?`config/cde/${o.info.id}`:"config/cde",n=o.info?"PUT":"POST",r=await x({url:a,method:n,data:t});r.status===200&&(S(),z.success(r.message),_("closeDraw",!0))}catch(a){console.error("Error:",a);const n=document.getElementsByClassName("ant-drawer-body")[0];n&&(n.scrollTop=0)}finally{v.value=!1}},S=()=>{e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null},u=async t=>{d.value=!0;try{t&&(e.name=t.name,e.address=t.address,await i.fetchCities(),s.value.city_id=i.cities,e.city_id=t.city_id,await i.fetchProvinces(e.city_id),s.value.province_id=i.provinces,c.value.province_id.disabled=!1,e.province_id=t.province_id,await i.fetchDistricts(e.province_id),s.value.district_id=i.districts,c.value.district_id.disabled=!1,e.district_id=t.district_id)}finally{d.value=!1}};return k(()=>{o.info&&u(o.info)}),F(()=>o.info,t=>{t?u(t):S()}),y("formState",e),y("loadingState",v),(t,a)=>d.value?(C(),P(H(V),{key:0,style:{color:"#00a6db"}})):(C(),A("div",W,[f(L,{fields:c.value,options:s.value,btnSaveName:m.value,mayus:!0,resetSelect:E.value,onHandleChangeSelect:I,onHandleFocusSelect:D,onOnSubmit:b},null,8,["fields","options","btnSaveName","resetSelect"])]))}},Q={class:"layout-content"},X=["onClick"],de={__name:"CdesPnte",setup(O){JSON.parse(localStorage.getItem("role"));const h=l([]),c=l(0),i=l(150);l(!1);const _=l(!1),o=l(!1),d=l(!1),m=l(null),e=R({name:null,page:1}),v=[{title:"#",dataIndex:"idx",align:"center",width:70},{title:"NOMBRE CDE",dataIndex:"name",width:220},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:120},{title:"DISTRITO",dataIndex:"district",width:120},{title:"DIRECCIÓN",dataIndex:"address",width:250},{title:"TIPO",dataIndex:"cdeType",align:"center",width:200},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],E=()=>{m.value=null,d.value=!0},s=l([{label:"CDE",value:1},{label:"CDEAI INSTITUCIONES",value:2},{label:"CDEAN NOTARÍAS",value:3}]),I=a=>{m.value=a,d.value=!0},D=async()=>{o.value=!0;try{const a={};e.name&&(a.name=e.name),await J("download/cdes","cdes-pnte",a)}catch(a){console.error("Error de red:",a)}finally{o.value=!1}},b=async a=>{e.page=a,await u()},S=async a=>{a&&(e.page=1,await u())},u=async()=>{_.value=!0;try{const a={page:e.page};e.name&&(a.name=e.name);const n=await x({url:"config/cdes",method:"GET",params:a});h.value=n.data.data,c.value=n.data.total,i.value=n.data.per_page}catch(a){console.error("Error de red:",a)}finally{_.value=!1}},t=async(a,n)=>{try{const r={value:a};await x({url:`config/chooseCde/${n.id}`,method:"PUT",data:r})}catch{console.log("Failed to delete")}};return k(async()=>{await u()}),y("search",e),y("loading",_),y("loadingFile",o),(a,n)=>{const r=T("a-select"),B=T("a-menu-item"),U=T("a-drawer");return C(),A("div",Q,[f($,{title:"CDE PNTE",new:!0,textNuevo:"NUEVO CDE",placeholderSearch:"Buscar",columns:v,titleSearch:"NOMBRE CDE",pageSize:i.value,nameTotal:"Solicitantes",dataSource:h.value,total:c.value,onHandleNew:E,onHandleDownloadExcel:D,onHandleSearch:S,onHandlePaginator:b},{"data-cell":w(({column:p,record:g})=>[p.dataIndex=="cdeType"?(C(),P(r,{key:0,style:{width:"100%"},value:g.cdetype_id,"onUpdate:value":N=>g.cdetype_id=N,options:s.value,onChange:N=>t(N,g)},null,8,["value","onUpdate:value","options","onChange"])):G("",!0)]),"custom-options":w(({record:p})=>[f(B,null,{default:w(()=>[M("a",{onClick:g=>I(p)},"Editar",8,X)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),f(U,{width:"500",title:"EDITAR DATOS DE CDE",open:d.value,"onUpdate:open":n[1]||(n[1]=p=>d.value=p),placement:"right"},{default:w(()=>[f(K,{info:m.value,onCloseDraw:n[0]||(n[0]=p=>(d.value=!1,u()))},null,8,["info"])]),_:1},8,["open"])])}}};export{de as default};
