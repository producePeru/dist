import{L as y,y as ge,r as h,u as De,a as Se,k as qe,b as _,o as s,d as z,c as D,w as f,e as F,F as ae,x as Ye,q as u,h as P,s as m,M as xe,t as ke,i as Te,p as Ne,j as we,m as S,z as k,f as $}from"./index-06cb9dfe.js";import{u as Ee}from"./selectes-de8c5c4f.js";import"./es-52b9c26f.js";import{_ as Me}from"./_plugin-vue_export-helper-c27b6911.js";const Ue={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country:{type:"iText",label:"País Origen",name:"country",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"Región residente",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",min:9,max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},hasSoon:{type:"iSelect",label:"¿Tiene hijos? (Opcional)",name:"hasSoon",required:!1,message:"¿Tiene hijos?",disabled:!1}};const te=T=>(Ne("data-v-787b0985"),T=T(),we(),T),Ie={class:"agreement-wrapper"},Pe=te(()=>F("h3",null,"Formulario de registro",-1)),$e=te(()=>F("br",null,null,-1)),Fe={class:"grid-item"},Ce="DD/MM/YYYY",Ge={__name:"NuevaPersona",setup(T){y.locale("es");const q=ge(),d=Ee();d.$patch({typeDocuments:d.typeDocuments}),d.$patch({cities:d.cities}),d.$patch({provinces:d.provinces}),d.$patch({districts:d.districts}),d.$patch({genders:d.genders}),d.fetchTypeDocuments(),d.fetchCities(),d.fetchGenders();const C=h(null),G=h(null),ne=De(),L=JSON.parse(localStorage.getItem("profile")),n=h(Ue),g=h(!0),p=h(null),R=h(!1),ie=h(!0),le=[{value:"yes",label:"SI"},{value:"no",label:"NO"}],de=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}],e=Se({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,country:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,sick:null,people_id:L.user_id,from_id:1}),oe=async l=>{try{const{data:o}=await $({url:`select/provinces/${l}`,method:"GET"});C.value=o}catch(o){console.error("Error de red:",o)}},se=async l=>{try{const{data:o}=await $({url:`select/districts/${l}`,method:"GET"});G.value=o}catch(o){console.error("Error de red:",o)}},O=(l,o)=>{const c=l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(c)},re=()=>{d.typeDocuments&&(ie.value=!1)},ue=()=>{n.value.lastname.disabled=!1,n.value.middlename.disabled=!1,n.value.name.disabled=!1,n.value.city_id.disabled=!1,n.value.province_id.disabled=!1,n.value.district_id.disabled=!1,n.value.address.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthday.disabled=!1,n.value.gender_id.disabled=!1,n.value.sick.disabled=!1},j=l=>{l&&(n.value.documentnumber.disabled=!1,e.documentnumber=null)},A=async l=>{var o,c,b,N,Y,w,E,M,U,a,I,i,V,J,H,K,Q,W;if(g.value=!0,!l)return S.warning("Ingresa un número de documento"),g.value=!1;try{if(e.typedocument_id==1){const{data:t}=await k({url:`user/api/dni/${e.documentnumber}`,method:"GET"});if(!t||!t.body||!t.body.apePaterno){const r=await k({url:`user/only-dni/${e.documentnumber}`,method:"GET"});return e.lastname=r.data.apellidoPaterno,e.middlename=r.data.apellidoMaterno,e.name=r.data.nombres,e.country="PERÚ",g.value=!1}if(t.body&&(e.lastname=(o=t.body)==null?void 0:o.apePaterno,e.middlename=(c=t.body)==null?void 0:c.apeMaterno,e.name=(b=t.body)==null?void 0:b.preNombres,e.address=(N=t.body)==null?void 0:N.desDireccion,e.country="PERÚ",(Y=t.body)!=null&&Y.feNacimiento&&(e.birthday=y((w=t.body)==null?void 0:w.feNacimiento,"DD/MM/YYYY")),(E=t.body)!=null&&E.feNacimiento&&(p.value=y((M=t.body)==null?void 0:M.feNacimiento,"DD/MM/YYYY")),(U=t.body)!=null&&U.ubigeo)){let r=d.cities.find(x=>{var v;return x.label===((v=t.body.ubigeo)==null?void 0:v.departamento)}),X=await $({url:`select/provinces/${r.value}`,method:"GET"});C.value=X.data;let Z=X.data.find(x=>{var v;return x.label===((v=t.body.ubigeo)==null?void 0:v.provincia)}),ee=await $({url:`select/districts/${Z.value}`,method:"GET"});G.value=ee.data;let he=ee.data.find(x=>{var v;return x.label===((v=t.body.ubigeo)==null?void 0:v.distrito)});e.city_id=r.value,e.province_id=Z.value,e.district_id=he.value}}if(e.typedocument_id==2){const{data:t}=await k({url:`user/api/ce/${e.documentnumber}`,method:"GET"});t.body&&(console.log("data: "+t),e.lastname=(a=t.body)==null?void 0:a.apellido_paterno,e.middlename=(I=t.body)==null?void 0:I.apellido_materno,e.name=(i=t.body)==null?void 0:i.nombres,e.gender_id=((V=t.body)==null?void 0:V.sexo)=="F"?2:1,(J=t.body)!=null&&J.fecha_nacimiento&&(e.birthday=y((H=t.body)==null?void 0:H.fecha_nacimiento,"DD/MM/YYYY")),(K=t.body)!=null&&K.fecha_nacimiento&&(p.value=y((Q=t.body)==null?void 0:Q.fecha_nacimiento,"DD/MM/YYYY")),e.country=t.body.nacionalidad)}if(e.typedocument_id==3){const{data:t}=await k({url:`user/api/pas/${e.documentnumber}`,method:"GET"}),r=(W=t.body)==null?void 0:W.data[0];e.lastname=r.apellido_paterno,e.middlename=r.apellido_materno,e.name=r.nombres,e.gender_id=r.sexo=="F"?2:1,r.fecha_nacimiento&&(e.birthday=y(r.fecha_nacimiento,"DD/MM/YYYY")),r.fecha_nacimiento&&(p.value=y(r.fecha_nacimiento,"DD/MM/YYYY"))}}catch(t){console.log("err",t)}finally{return ue(),g.value=!1}},ce=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},me=()=>{e.phone=e.phone.replace(/\D/g,"")},pe=l=>{e.province_id=null,e.district_id=null,oe(l)},be=l=>{e.district_id=null,se(l)},ve=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.sick=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=L.id,p.value=null,B()},B=()=>{n.value.documentnumber.disabled=!0,n.value.lastname.disabled=!0,n.value.middlename.disabled=!0,n.value.name.disabled=!0,n.value.city_id.disabled=!0,n.value.city_id.disabled=!0,n.value.province_id.disabled=!0,n.value.address.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthday.disabled=!0,n.value.gender_id.disabled=!0,n.value.sick.disabled=!0},ye=async()=>{R.value=!0,e.birthday=p.value?y(p.value).format("YYYY-MM-DD"):null;try{const l=await k({url:"person/create",method:"POST",data:e});if(l.status==400)return S.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(l.status==401)return S.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(l.status==200){const o={type:e.typedocument_id,number:e.documentnumber};return ne.push({name:"asesorias-formalizaciones",query:o}),S.success(l.message),ve()}}catch{S.error("No se pudo registrar este usuario")}finally{R.value=!1}},_e=()=>{S.error("Debes de completar todos los espacios requeridos")},fe=async()=>{B(),q.query&&(e.typedocument_id=+q.query.type,j(q.query.type),e.documentnumber=q.query.number,await d.fetchCities(),await A(q.query.number))};return qe(()=>{fe()}),(l,o)=>{const c=_("a-select"),b=_("a-form-item"),N=_("a-input-search"),Y=_("a-input"),w=_("a-date-picker"),E=_("a-button"),M=_("a-form"),U=_("a-spin");return s(),z("div",Ie,[Pe,$e,D(U,{spinning:g.value},{default:f(()=>[D(M,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:ye,onFinishFailed:_e},{default:f(()=>[F("div",Fe,[(s(!0),z(ae,null,Ye(n.value,(a,I)=>(s(),z(ae,{key:I},[a.type==="iSelect"?(s(),u(b,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[a.name=="typedocument_id"?(s(),u(c,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:P(d).typeDocuments,disabled:a.disabled,onChange:j},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="city_id"?(s(),u(c,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:P(d).cities,"show-search":"","filter-option":O,onChange:pe,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="province_id"?(s(),u(c,{key:2,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:C.value,"show-search":"","filter-option":O,onChange:be,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district_id"?(s(),u(c,{key:3,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:G.value,"show-search":"","filter-option":O,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="gender_id"?(s(),u(c,{key:4,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:P(d).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="sick"?(s(),u(c,{key:5,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:le,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])):m("",!0),a.name=="hasSoon"?(s(),u(c,{key:6,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,options:de,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(s(),u(b,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[D(N,{loading:g.value,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,onSearch:A,onInput:ce,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(s(),u(b,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max,min:a.min}]},{default:f(()=>[a.name=="phone"?(s(),u(Y,{key:0,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max,onInput:me},null,8,["value","onUpdate:value","disabled","maxlength"])):(s(),u(Y,{key:1,value:e[a.name],"onUpdate:value":i=>e[a.name]=i,disabled:a.disabled,maxlength:a.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iDate"?(s(),u(b,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:f(()=>[D(w,{locale:P(xe),value:p.value,"onUpdate:value":o[0]||(o[0]=i=>p.value=i),style:{width:"100%"},format:Ce,placeholder:"día/mes/año",onChange:o[1]||(o[1]=i=>e.birthday=p.value),disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),F("div",null,ke(re()),1),D(b,null,{default:f(()=>[D(E,{class:"btn-produce",type:"primary","html-type":"submit",loading:R.value},{default:f(()=>[Te("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},je=Me(Ge,[["__scopeId","data-v-787b0985"]]);export{je as default};
