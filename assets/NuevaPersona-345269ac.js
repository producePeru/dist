import{r as u,l as Y,u as Z,a as ee,D as A,n as ae,b as c,o as s,d as g,e as U,t as te,i as le,B as i,c as b,w as p,F as E,f as N,h as F,m as _,v as ne,s as m,j as se,p as oe,k as re}from"./index-ef958b15.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const ie={document_type:{type:"iSelect",label:"Tipo de documento",name:"document_type",required:!0,message:"Seleccionar tipo de documento",disabled:!1},number_document:{type:"iSearch",label:"Ingresar número",name:"number_document",required:!0,message:"Escribe número de documento",disabled:!1},last_name:{type:"iText",label:"Apellido Paterno",name:"last_name",required:!0,message:"Escribir apellido",disabled:!1},middle_name:{type:"iText",label:"Apellido Materno",name:"middle_name",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!1},department:{type:"iSelect",label:"Departamento",name:"department",required:!1,message:"Seleccionar departamento",disabled:!1},province:{type:"iSelect",label:"Provincia",name:"province",required:!1,message:"Seleccionar provincia",disabled:!1},district:{type:"iSelect",label:"Distrito",name:"district",required:!1,message:"Seleccionar distrito",disabled:!1},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!1,message:"Número de contacto y 9 max",max:9,disabled:!1},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Número de contacto y 9 max",email:"email",disabled:!1}};const ue=f=>(oe("data-v-0c989a17"),f=f(),re(),f),ce={class:"uppercase"},me=ue(()=>U("br",null,null,-1)),pe={key:1,class:"agreement-wrapper"},ve={class:"grid-item"},be={__name:"NuevaPersona",setup(f){const n=u(ie),S=Y(),q=Z(),P=u(!0),x=u(!1),T=u(!1),k=u([]),y=u([]),v=u([]),B=[{label:"DNI",value:"dni"},{label:"CE",value:"ce"},{label:"PAS",value:"pas"},{label:"PTP",value:"ptp"}],e=ee({document_type:"dni",number_document:null,last_name:null,middle_name:null,name:null,department:null,province:null,district:null,phone:null,email:null,created_by:A,update_by:A,post:S.query.access}),w=()=>{e.document_type=null,e.number_document=null,e.last_name=null,e.middle_name=null,e.name=null,e.department=null,e.province=null,e.district=null,e.phone=null,e.email=null},C=()=>{n.value.last_name.disabled=!1,n.value.middle_name.disabled=!1,n.value.name.disabled=!1,n.value.department.disabled=!1,n.value.province.disabled=!1,n.value.district.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1},D=()=>{n.value.last_name.disabled=!0,n.value.middle_name.disabled=!0,n.value.name.disabled=!0,n.value.department.disabled=!0,n.value.province.disabled=!0,n.value.district.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0},G=()=>{e.number_document=e.number_document.replace(/\D/g,"")},$=async()=>{if(!e.document_type)return _.warning("Debes escoger un tipo de documento");x.value=!0;try{const l=await F({url:`/person/${e.document_type}/${e.number_document}`,method:"GET"});if(l.status===404)return C();const t=l.data;e.name=t.nombres,e.last_name=t.apellidoPaterno,e.middle_name=t.apellidoMaterno,t.department&&(e.department=t.department,I(t.department)),t.province&&(e.province=t.province,R(t.province)),t.document_type&&(e.document_type=t.document_type),t.district&&(e.district=t.district),t.email&&(e.email=t.email),t.phone&&(e.phone=t.phone),C()}catch(l){console.log("Hhhhh",l)}finally{x.value=!1}},V=l=>{w(),D(),e.document_type=l},M=(l,t)=>{e.province=null,e.district=null,y.value=[],v.value=[],I(t.value)},L=(l,t)=>{e.district=null,v.value=[],R(t.value)},O=()=>{const l=S.query.access;l==1&&q.push("/admin/asesorias/supervisores"),l==2&&q.push("/admin/asesorias/asesores"),l==3&&q.push("/admin/asesorias/solicitantes")},j=async()=>{n.value.document_type.disabled=!1;try{const{data:l}=await N({url:"/departaments",method:"GET"});let t=l.map(d=>({label:d.label,value:d.id}));k.value=[...k.value,...t],P.value=!1,D()}catch(l){console.log(l)}},I=async l=>{try{const{data:t}=await N({url:`/province/${l}`,method:"GET"});let d=t.map(r=>({label:r.label,value:r.id}));y.value=[...y.value,...d]}catch(t){console.log(t)}},R=async l=>{try{const{data:t}=await N({url:`/district/${l}`,method:"GET"});let d=t.map(r=>({label:r.label,value:r.id}));v.value=[...v.value,...d]}catch(t){console.log(t)}},H=async()=>{const l=e;T.value=!0;try{await F({url:"/new-person",method:"POST",data:l})&&(w(),D(),e.document_type="dni",O(),_.success("Registro exitoso"))}catch(t){if(t.response.status==550)return _.error("El usuario ya se encuentra registrado");_.error("Error al registrar")}finally{T.value=!1}},z=()=>{_.error("Debes de completar todos los espacios requeridos")};return ae(j),(l,t)=>{const d=c("a-spin"),r=c("a-select"),h=c("a-form-item"),J=c("a-input-search"),K=c("a-input"),Q=c("a-button"),W=c("a-form");return s(),g(E,null,[U("h3",ce,"REGISTRO DE "+te(le(S).query.rol),1),me,P.value?(s(),i(d,{key:0})):(s(),g("div",pe,[b(W,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:H,onFinishFailed:z},{default:p(()=>[U("div",ve,[(s(!0),g(E,null,ne(n.value,(a,X)=>(s(),g(E,{key:X},[a.type==="iSelect"?(s(),i(h,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[a.name=="document_type"?(s(),i(r,{key:0,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:B,disabled:a.disabled,onChange:V},null,8,["value","onUpdate:value","disabled"])):m("",!0),a.name=="department"?(s(),i(r,{key:1,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:k.value,onChange:M,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="province"?(s(),i(r,{key:2,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:y.value,onChange:L,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0),a.name=="district"?(s(),i(r,{key:3,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:v.value,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):m("",!0)]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iSearch"?(s(),i(h,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[b(J,{maxlength:15,loading:x.value,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,onSearch:$,onInput:G},null,8,["loading","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):m("",!0),a.type==="iText"?(s(),i(h,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:p(()=>[b(K,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):m("",!0)],64))),128))]),b(h,null,{default:p(()=>[b(Q,{type:"primary","html-type":"submit",loading:T.value},{default:p(()=>[se("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))],64)}}},ye=de(be,[["__scopeId","data-v-0c989a17"]]);export{ye as default};
