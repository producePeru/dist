import{_ as A}from"./FormComponent-3748bf27.js";import{u as P}from"./selectes-3d14beea.js";import{K as T,g as k,U as q,r as u,a as x,p as c,k as B,T as L,W as v,o as S,y as M,i as j,L as F,d as Y,c as U,h as I}from"./index-d5aef40d.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";const $="https://apituempresa.soporte-pnte.com/api/",H="http://127.0.0.1:8000/api/",V=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?H:$;function z(){const n=(localStorage.getItem("token")||k.get("token")||"").replace(/"/g,"");return n?`Bearer ${n}`:""}const m=T.create({baseURL:V,timeout:2e4});m.interceptors.request.use(n=>{n.headers=n.headers||{};const d=z();return d&&(n.headers.Authorization=d),n.headers["Content-Type"]="application/json",n});const J=q("businessman",{state:()=>({loading:!1,loadingDocument:!1,loadingReniec:!1,error:null}),actions:{async create(n){var d,l;this.loading=!0,this.error=null;try{const{data:i}=await m.post("/businessman/register-new-businessman",n);return i}catch(i){throw this.error=((l=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:l.message)||"Error al crear empresario",i}finally{this.loading=!1}},async get(n){var d,l;this.loading=!0,this.error=null;try{const{data:i}=await m.get(`/businessman/get-businessman-data/${n.documentnumber}`);return i}catch(i){throw this.error=((l=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:l.message)||"Error al obtener información",i}finally{this.loading=!1}},async reniec(n){var d,l;this.loading=!0,this.error=null;try{const{data:i}=await m.post(`/api/consult-businessman-dni/${n.documentnumber}`);return i}catch(i){throw this.error=((l=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:l.message)||"Error al obtener información",i}finally{this.loading=!1}}}});const K={key:1},W={__name:"EditarEmpresario",props:{updateInfoBusinessman:{type:Object,required:!0,default:()=>({})}},emits:["registered"],setup(n,{emit:d}){const l=n,i=d,a=P(),O=J(),p=u(!0),y=u(!1),e=x({}),D=u("REGISTRAR"),s=u({city_id:[],province_id:[],district_id:[],gender_id:[],sick:[]}),w=async t=>{t=="city_id"&&(await a.fetchProvinces(e.city_id),s.value.province_id=a.provinces,_.value.province_id.disabled=!1),t=="province_id"&&(await a.fetchDistricts(e.province_id),s.value.district_id=a.districts,_.value.district_id.disabled=!1)},N=async t=>{t=="typedocument_id"&&(s.value.typedocument_id=a.typeDocuments),t=="country_id"&&(await a.fetchCountries(),s.value.country_id=a.countries),t=="city_id"&&(await a.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,s.value.province_id=[],s.value.city_id=a.cities),t=="province_id"&&(e.province_id=null,e.district_id=null,s.value.district_id=[]),t=="sick"&&h(),t=="gender_id"&&(await a.fetchGenders(),s.value.gender_id=a.genders),t=="hasSoon"&&g()},h=()=>{s.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},g=()=>{s.value.hasSoon=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},R=async()=>{y.value=!0;const t={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,country_id:e.country_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,birthday:c(e.birthday).format("YYYY-MM-DD"),phone:e.phone,email:e.email,gender_id:e.gender_id,sick:e.sick,hasSoon:e.hasSoon};try{const r=await O.create(t);r.status==200&&(I.success(r.message),i("registered",r.data),f())}catch{I.error(a.error)}finally{y.value=!1}},f=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},_=u({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir número de documento",disabled:!0},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!0},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!0},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country_id:{type:"iSelect",label:"PAÍS",name:"country_id",required:!0,message:"Seleccionar país"},city_id:{type:"iSelect",label:"REGIÓN RESIDENCIA",name:"city_id",required:!1,message:"Seleccionar región"},province_id:{type:"iSelect",label:"PROVINCIA RESIDENCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelect",label:"DISTRITO RESIDENCIA",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN RESIDENCIA",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"FECHA NACIMIENTO",name:"birthday",required:!0,disabled:!0,message:"Seleccionar fecha de nacimiento",disabledDate:t=>{if(!t)return!1;const r=c(),o=r.subtract(100,"year").endOf("day"),b=r.subtract(18,"year").endOf("day");return t.isAfter(b)||t.isBefore(o)},defaultPickerValue:(()=>{const t=c(),r=t.subtract(100,"year").endOf("day");let o=t.subtract(18,"year").endOf("day");for(;o.day()===0||o.day()===6;)o=o.subtract(1,"day");return o.isBefore(r)?r:o})(),rules:[{validator:(t,r)=>{if(!r)return Promise.reject(new Error("Seleccionar fecha de nacimiento"));const o=c(),b=o.subtract(100,"year").endOf("day"),C=o.subtract(18,"year").endOf("day");return c(r).isAfter(C)?Promise.reject(new Error("Debe tener 18 años o más")):c(r).isBefore(b)?Promise.reject(new Error("La edad no puede superar los 100 años")):Promise.resolve()},trigger:"change"}]},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(t,r)=>{if(!r)return Promise.reject(new Error("El número es requerido"));const o=r.toString();return o.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):o.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(t,r)=>r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"Seleccionar opción"},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS?",name:"hasSoon",required:!0,message:"Seleccionar opción"}}),E=async t=>{console.log("iaiaiaia",t),p.value=!0;try{t&&(await a.fetchTypeDocuments(),s.value.typedocument_id=a.typeDocuments,e.typedocument_id=t.typedocument_id,e.documentnumber=t.documentnumber,e.lastname=t.lastname,e.middlename=t.middlename,e.name=t.name,await a.fetchCountries(),s.value.country_id=a.countries,e.country_id=t.country_id,await a.fetchCities(),s.value.city_id=a.cities,e.city_id=t.city_id,await a.fetchProvinces(e.city_id),s.value.province_id=a.provinces,e.province_id=t.province_id,await a.fetchDistricts(e.province_id),s.value.district_id=a.districts,e.district_id=t.district_id,e.address=t.address,t.birthday&&(e.birthday=c(t.birthday,"YYYY-MM-DD")),e.phone=t.phone,e.email=t.email,await a.fetchGenders(),s.value.gender_id=a.genders,e.gender_id=t.gender_id,h(),e.sick=t.sick,g(),e.hasSoon=t.hasSoon)}catch(r){console.error("Error al cargar la información:",r)}finally{p.value=!1}};return B(()=>{l.updateInfoBusinessman&&E(l.updateInfoBusinessman)}),L(()=>l.updateInfoBusinessman,t=>{t?E(t):f()}),v("formState",e),v("loadingState",y),(t,r)=>p.value?(S(),M(j(F),{key:0,style:{color:"#00a6db"}})):(S(),Y("div",K,[U(A,{fields:_.value,options:s.value,btnSaveName:D.value,onHandleFocusSelect:N,onHandleChangeSelect:w,onOnSubmit:R,mayus:!0},null,8,["fields","options","btnSaveName"])]))}},te=G(W,[["__scopeId","data-v-9fa6a6b9"]]);export{te as E,J as u};
