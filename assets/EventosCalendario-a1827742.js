import{_ as Q}from"./TableComponent-b5b7f2e7.js";import{r as _,a as j,l as g,j as B,U as W,b as h,o as r,d as y,c as u,w as d,e as b,F as U,s as Z,x,y as v,h as $,i as T,t as S,m as H,N as F,a6 as V,a1 as J}from"./index-cc9eac84.js";import{d as K}from"./downloadExcel-c9e4b1b0.js";/* empty css             */import{u as X}from"./selectes-75823ef3.js";import{Q as ee}from"./quill.snow-4b47fb0e.js";import{_ as ae}from"./DrawResultados-22cc651f.js";import"./es-e5d57d23.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-71e56f85.js";const te={class:"grid-events"},ne={style:{display:"flex",margin:"1rem 0 .5rem"}},le={key:3,class:"grid-events-hour"},se={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup(G,{emit:C}){const E=X();E.$patch({officesPnte:E.officesPnte}),E.fetchOfficesPnte(),E.$patch({cities:E.cities}),E.fetchCities();const M=C,p=G,w=_(!1),D={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},R=_([{dates:new Date}]),f=_({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},city_id:{type:"iSelectWrite",label:"SELECCIONAR REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!1,message:"",disabled:!1,max:100},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),e=j({allDay:1});_([{start:null,end:g().subtract(0,"day").format("YYYY-MM-DD")}]);const P=n=>n==="id_pnte"?E.officesPnte:[],N={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},I=n=>{if(n==2||n==7){const o=Object.entries(f.value),c=o.findIndex(([t])=>t==="city_id"),i=[...o.slice(0,c+1),...Object.entries(N),...o.slice(c+1)];f.value=Object.fromEntries(i)}else{const o={...f.value};delete o.organiza,delete o.numMypes,f.value=o}},Y=(n,o)=>{const c=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(c)},q=async()=>{if(!e.date)return H.warning("Debes de seleccionar una fecha del calendario");const n={id_pnte:e.id_pnte,title:e.title,...e.organiza&&{organiza:e.organiza},...e.numMypes&&{numMypes:e.numMypes},dateStart:g(e.date.start).format("YYYY-MM-DD"),dateEnd:g(e.date.end).format("YYYY-MM-DD"),city_id:e.city_id,place:e.place,...e.hours?{start:g(e.hours[0]).format("HH:mm"),end:g(e.hours[1]).format("HH:mm")}:{start:null,end:null},description:e.description,nameUser:e.nameUser,link:e.link};w.value=!0;try{const o=p.dataRow?`event/update/${p.dataRow.id}`:"event/create",c=p.dataRow?"PUT":"POST",i=await F({url:o,method:c,data:n});i.status===200&&(H.success(i.message),e.title="",e.hours=[],e.organiza="",e.numMypes="",e.description="</p>",e.nameUser="",e.link="",e.date=null,M("closeDraw"))}catch(o){H.error(o.message)}finally{w.value=!1}},L=()=>{e.id_pnte=null,e.numMypes="",e.organiza="",e.title="",e.description="</p>",e.nameUser="",e.link="",e.date=null},A=n=>{if(n){if(e.id_pnte=n.id_pnte,n.id_pnte==2||n.id_pnte==7){const o=Object.entries(f.value),c=o.findIndex(([t])=>t==="title"),i=[...o.slice(0,c+1),...Object.entries(N),...o.slice(c+1)];f.value=Object.fromEntries(i)}e.numMypes=n.numMypes,e.organiza=n.organiza,e.title=n.title,e.description=n.description,e.nameUser=n.nameUser,e.link=n.link,e.date={start:g(n.dateStart).toISOString(),end:g(n.dateEnd).toISOString()},n.start&&n.end?e.hours=[g(n.start,"HH:mm"),g(n.end,"HH:mm")]:e.hours=[]}};return B(()=>{p.dataRow&&A(p.dataRow)}),W(()=>p.dataRow,n=>{n?A(n):L()}),(n,o)=>{const c=h("a-select"),i=h("a-form-item"),t=h("a-input"),l=h("VDatePicker"),k=h("a-time-range-picker"),O=h("a-button"),z=h("a-form");return r(),y("div",null,[u(z,{class:"form-events",layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:q},{default:d(()=>[b("div",te,[(r(!0),y(U,null,Z(f.value,(a,m)=>(r(),y(U,{key:m},[a.type==="iSelect"?(r(),x(i,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[u(c,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:P(a.name),"show-search":"","filter-option":Y,onChange:I},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):v("",!0),a.type==="iText"?(r(),x(i,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[u(t,{value:e[a.name],"onUpdate:value":s=>e[a.name]=s,maxlength:a.max,disabled:a.disabled,placeholder:a.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):v("",!0),a.type==="iDate"?(r(),x(i,{key:2,name:a.name,label:a.label},{default:d(()=>[u(l,{modelValue:e[a.name],"onUpdate:modelValue":s=>e[a.name]=s,modelModifiers:{range:!0},mode:"date",attributes:R.value},null,8,["modelValue","onUpdate:modelValue","attributes"]),b("div",ne,[b("div",null,[o[1]||(o[1]=b("label",{style:{display:"block"},for:""},"HORARIO",-1)),u(k,{minuteStep:30,value:e.hours,"onUpdate:value":o[0]||(o[0]=s=>e.hours=s),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):v("",!0),a.type==="iSwitch"?(r(),y("div",le)):v("",!0),a.type==="iTextArea"?(r(),x(i,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[u($(ee),{class:"quill-editor",content:e[a.name],"onUpdate:content":s=>e[a.name]=s,options:D,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):v("",!0),a.type==="iSelectWrite"?(r(),x(i,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:d(()=>[a.name=="city_id"?(r(),x(c,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:$(E).cities,"show-search":"","filter-option":Y,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):v("",!0)]),_:2},1032,["name","label","rules"])):v("",!0)],64))),128))]),u(i,null,{default:d(()=>[u(O,{type:"primary","html-type":"submit",loading:w.value,style:{"margin-top":"1rem"}},{default:d(()=>[T(S(p.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const oe={class:"advisory-table"},ie={key:0},re={key:1},de={key:0},ue={key:1},me=["onClick"],ce=["onClick"],xe={__name:"EventosCalendario",setup(G){JSON.parse(localStorage.getItem("role"));const C=_([]),E=_(0),M=_(150),p=_(null),w=_(!1),D=_(!1),R=_(!1),f=_(!1);_(null);const e=j({asesor:null,name:null,page:1}),P=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"OFICINA",fixed:"left",dataIndex:"office",width:80,align:"center"},{title:"TIPO DE ACTIVIDAD",fixed:"left",dataIndex:"area",width:120,align:"center"},{title:"TÍTULO",dataIndex:"title",width:200},{title:"REGIÓN",dataIndex:"city",width:140},{title:"LUGAR",dataIndex:"place",width:180},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"resultado",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],N=t=>{p.value=t.all,w.value=!0},I=t=>g(t).format("DD/MM/YYYY"),Y=t=>g(t,"HH:mm:ss").format("HH:mm"),q=()=>{p.value=null,f.value=!0},L=async()=>{R.value=!0;try{const t={};e.year&&(t.year=g(e.year).format("YYYY")),e.name&&(t.name=e.name),e.range&&(t.dateStart=e.range[0].format("YYYY/MM/DD"),t.dateEnd=e.range[1].format("YYYY/MM/DD")),e.offices&&(t.offices=e.offices),await K("download/events","eventos_pnte",t)}catch(t){console.error("Error de red:",t)}finally{R.value=!1}},A=async t=>{try{const l=await F({url:`event/delete/${t.id}`,method:"DELETE"});l.status==200&&(H.success(l.message),i())}catch{console.log("Failed to delete")}},n=async t=>{e.page=t,await i()},o=async t=>{t&&(e.page=1,await i())},c=t=>{p.value=t.all,f.value=!0},i=async()=>{D.value=!0;try{const t={page:e.page};e.year&&(t.year=g(e.year).format("YYYY")),e.name&&(t.name=e.name),e.range&&(t.dateStart=e.range[0].format("YYYY/MM/DD"),t.dateEnd=e.range[1].format("YYYY/MM/DD")),e.offices&&(t.offices=e.offices);const l=await F({url:"event/list",method:"GET",params:t});C.value=l.data.data,E.value=l.data.total,M.value=l.data.per_page}catch(t){console.error("Error de red:",t)}finally{D.value=!1}};return B(async()=>{await i()}),V("search",e),V("loading",D),V("loadingFile",R),(t,l)=>{const k=h("a-tag"),O=h("a-menu-item"),z=h("a-popconfirm"),a=h("a-drawer");return r(),y("div",oe,[u(Q,{title:"EVENTOS PNTE",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",tipooficina:!0,columns:P,titleSearch:"NOMBRE DEL EVENTO",pageSize:M.value,nameTotal:"Eventos",rangeDate:!0,dataSource:C.value,total:E.value,onHandleNew:q,onHandleDownloadExcel:L,onHandleSearch:o,onHandlePaginator:n},{"data-cell":d(({column:m,record:s})=>[m.dataIndex=="office"?(r(),y(U,{key:0},[s.office=="UGO"?(r(),x(k,{key:0,color:"blue"},{default:d(()=>l[4]||(l[4]=[T("UGO")])),_:1})):v("",!0),s.office=="UGSE"?(r(),x(k,{key:1,color:"red"},{default:d(()=>l[5]||(l[5]=[T("UGSE")])),_:1})):v("",!0)],64)):v("",!0),m.dataIndex=="date"?(r(),y(U,{key:1},[s.dateStart!=s.dateEnd?(r(),y("span",ie,[l[6]||(l[6]=b("b",null,"Desde:",-1)),T(" "+S(I(s.dateStart))+" ",1),l[7]||(l[7]=b("b",null,"Hasta:",-1)),T(" "+S(I(s.dateEnd)),1)])):(r(),y("span",re,S(I(s.dateStart)),1))],64)):v("",!0),m.dataIndex=="hours"?(r(),y(U,{key:2},[s.start?(r(),y("span",ue,S(Y(s.start))+" - "+S(Y(s.end)),1)):(r(),y("span",de,"Todo el día"))],64)):v("",!0)]),"custom-options":d(({record:m})=>[u(O,null,{default:d(()=>[b("a",{onClick:s=>N(m)},"Resultados",8,me)]),_:2},1024),u(O,null,{default:d(()=>[b("a",{onClick:s=>c(m)},"Editar",8,ce)]),_:2},1024),u(O,null,{default:d(()=>[u(z,{placement:"rightBottom",title:`¿Quieres eliminar ${m.title} ?`,onConfirm:s=>A(m)},{icon:d(()=>[u($(J),{style:{color:"red"}})]),default:d(()=>[l[8]||(l[8]=b("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),u(a,{width:"500",title:"EVENTO PNTE",open:f.value,"onUpdate:open":l[1]||(l[1]=m=>f.value=m),placement:"right"},{default:d(()=>[u(se,{dataRow:p.value,onCloseDraw:l[0]||(l[0]=m=>(f.value=!1,i()))},null,8,["dataRow"])]),_:1},8,["open"]),u(a,{open:w.value,"onUpdate:open":l[3]||(l[3]=m=>w.value=m),title:"RESULTADOS",placement:"right",width:"550"},{default:d(()=>[u(ae,{dataRow:p.value,onCloseDraw:l[2]||(l[2]=m=>{w.value=!1,i()})},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{xe as default};
