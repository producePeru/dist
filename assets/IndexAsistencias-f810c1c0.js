import{p as te,s as E,E as ne,r as y,a as se,k as oe,b,o as i,d as h,c as u,w as p,i as O,F as C,L as re,f as k,e as m,j as A,N as le,O as ie,t as ce,v as de,y as _,z as g,M as me,h as S,Q as M,R as B}from"./index-490b41db.js";import{_ as ue}from"./calendar-e0a6119a.js";import{u as pe}from"./selectes-b43ca217.js";import{F as be}from"./FormalizacionFooter-d31603f7.js";import{u as ge}from"./useBusinessman-04a2ec74.js";import"./es-3c758a9d.js";/* empty css                                                                            */import"./_plugin-vue_export-helper-c27b6911.js";import"./EnvironmentOutlined-2eacac22.js";const fe={class:"attendance"},_e={class:"container"},ye={key:0,class:"fair-caducated"},ve={key:1,class:"attendance-section"},he={class:"attendance-title"},Ee={class:"attendance-form"},Se={key:7},xe="DD/MM/YYYY",we={__name:"IndexAsistencias",emits:["nextStep2"],setup(Re,{emit:De}){te.locale("es");const F=E(re,{style:{fontSize:"24px"},spin:!0}),N=ne(),c=pe();c.$patch({typeDocuments:c.typeDocuments}),c.$patch({economicSectors:c.economicSectors}),c.$patch({genders:c.genders}),c.fetchEconomicSectors(),c.fetchTypeDocuments(),c.fetchGenders();const q=ge(),U=y(!1),x=y(!0),w=y(null),R=y(!1),D=y(!1),T=y(!1),e=se({}),z=[{value:"si",label:"SI"},{value:"no",label:"NO"}],$=n=>{if(n==="country_id")return c.countries;if(n==="gender_id")return c.genders;if(n==="sick")return z;if(n==="typedocument_id")return c.typeDocuments},I=y({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO DE IDENTIDAD",name:"typedocument_id",required:!0,message:"Seleccionar tipo",disabled:!1},documentnumber:{type:"iSearch",label:"INGRESE NÚMERO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir tu número de documento",disabled:!0,max:11},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0,max:50},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir nombre",disabled:!0,max:50},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir nombre",disabled:!0,max:50},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0,max:255},phone:{type:"iText",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe tu num. de celular",disabled:!0,max:9},ruc:{type:"iSearchRuc",label:"NÚMERO DE RUC",name:"ruc",required:!1,message:"Escribir RUC",disabled:!0,max:11},socialReason:{type:"iText",label:"NOMBRE COMERCIAL",name:"socialReason",required:!1,message:"Escribir la razón social",disabled:!1,max:100},economicsector_id:{type:"iSelectWrite",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!1,message:"Seleccionar sector económnico",disabled:!1},comercialactivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity",required:!1,message:"Seleccionar sector económnico",disabled:!1,max:100}}),G=(n,t)=>{if(!t)return Promise.reject("La fecha es requerida");const s=new Date,r=new Date(t);let o=s.getFullYear()-r.getFullYear();const d=s.getMonth()-r.getMonth();return(d<0||d===0&&s.getDate()<r.getDate())&&o--,o<18||o>99?Promise.reject("La edad debe estar entre 18 y 99 años"):Promise.resolve()},j=(n,t)=>{if(n.field==="phone"){const s=/^9\d{8}$/;if(t){if(!s.test(t))return Promise.reject("El número debe empezar con 9 y tener exactamente 9 dígitos")}else return Promise.reject("El número de teléfono es obligatorio")}return n.field,Promise.resolve()},V=n=>{const t=e[n]?e[n].trim():"";e[n]=t},Y=n=>{n=="typedocument_id"&&(e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.email=null,e.phone=null)},W=(n,t)=>{const s=e.typedocument_id;return/^\d+$/.test(t)?s===1&&t.length!==8?Promise.reject("Debe tener exactamente 8 caracteres."):s!==1&&t.length>12?Promise.reject("Debe tener exactamente 12 caracteres."):(s===1&&t.startsWith("0")&&t.length===8,Promise.resolve()):Promise.reject("Solo se permiten números.")},K=async()=>{const{typedocument_id:n,documentnumber:t}=e;if(!n||!t){S.error("El tipo de documento y el número de documento no pueden estar vacíos.");return}if(!/^\d+$/.test(t)){S.error("El número de documento solo debe contener caracteres numéricos.");return}if(n===1&&t.length!==8){S.error("El número de documento debe tener exactamente 8 caracteres para el tipo de documento DNI.");return}const s=["name","lastname","middlename","sick","email","phone","gender_id","ruc"],r=o=>{s.forEach(d=>{I.value[d].disabled=o})};try{if(R.value=!0,e.typedocument_id==1){const o={documentnumber:e.documentnumber},d=await q.get(o),{data:f}=d;if(d.status==200)e.name=f.name,e.lastname=f.lastname,e.middlename=f.middlename,e.gender_id=f.gender_id,e.sick=f.sick;else if(d.status==404){const v=await q.reniec(o);v.status==200&&(e.name=v.data.name,e.lastname=v.data.lastname,e.middlename=v.data.middlename)}else M.warning({message:"Aviso",description:"El servicio de consulta RENIEC no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}}catch(o){console.error("Error de red:",o)}finally{r(!1),R.value=!1}},Q=async()=>{const n=e.ruc,t=/^\d{11}$/.test(n)&&/^(10|15|20)/.test(n),s=["socialReason","economicsector_id"],r=o=>{s.forEach(d=>{I.value[d].disabled=o})};if(!t)console.error("El RUC debe tener 11 caracteres, comenzar con 11, 15 o 20, y contener solo números."),r(!0);else{D.value=!0;try{const o=await k({url:`api/consult-company-ruc/${e.ruc}`,method:"POST"});o.status==200?(e.socialReason=o.data.socialReason,r(!1)):M.warning({message:"Aviso",description:"El servicio de consulta SUNAT no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}catch(o){console.error("Error de red:",o),o&&S.error("Este número de RUC no es válido")}finally{D.value=!1}}},L=(n,t)=>{const s=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s)},P=()=>{e.typedocument_id=null,e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.email=null,e.phone=null,e.ruc=null,e.socialReason=null,e.economicsector_id=null,e.comercialactivity=null},H=async()=>{T.value=!0;const t={slug:N.params.slug,typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,name:e.name,lastname:e.lastname,middlename:e.middlename,gender_id:e.gender_id,sick:e.sick,email:e.email,phone:e.phone,ruc:e.ruc,socialReason:e.socialReason,economicsector_id:e.economicsector_id,comercialActivity:e.comercialactivity};try{const s=await k({url:"public/attendance-present",method:"POST",data:t});s.status==200&&B.success({title:"REGISTRADO",content:E("div",{},[E("p",s.message)]),onOk(){P(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"}),s.status==400&&B.warning({title:"REGISTRO AVISO",content:E("div",{},[E("p",s.message)]),onOk(){P(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"})}catch(s){console.error("Error de red:",s)}finally{T.value=!1}},J=async()=>{try{const n=N.params.slug,t=await k({url:`public/data-attendance/${n}`,method:"GET"});t.status==200&&(w.value=t.data.title,x.value=!1),t.status==400&&router.push("/404"),t.status==500&&(U.value=!0,x.value=!1)}catch(n){console.error("Error de red:",n)}finally{}};return oe(()=>{J()}),(n,t)=>{const s=b("a-input-search"),r=b("a-form-item"),o=b("a-input"),d=b("a-date-picker"),f=b("a-select"),v=b("a-textarea"),X=b("a-button"),Z=b("a-form"),ee=b("a-spin");return i(),h(C,null,[u(ee,{spinning:x.value,indicator:O(F)},{default:p(()=>[m("div",fe,[m("div",_e,[U.value?(i(),h("section",ye,t[1]||(t[1]=[m("div",{class:"container"},[m("div",{class:"fair-caducated-info"},[m("img",{src:ue,alt:""}),m("h4",null,"EL REGISTRO NO ESTÁ DISPONIBLE"),m("p",null,[A("El formulario de inscripción ya no está disponible. "),m("br"),A(" Agradecemos su interés y lo invitamos a estar atento a nuestros próximos eventos.")])])],-1)]))):(i(),h("section",ve,[u(Z,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:H,onKeydown:t[0]||(t[0]=le(ie(()=>{},["prevent"]),["enter"]))},{default:p(()=>[m("div",he,[t[2]||(t[2]=m("h2",null,"REGISTRO DE ASISTENCIA",-1)),m("h3",null,ce(w.value),1)]),m("div",Ee,[(i(!0),h(C,null,de(I.value,(a,ae)=>(i(),h(C,{key:ae},[a.type==="iSearch"?(i(),_(r,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,validator:W}]},{default:p(()=>[u(s,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,placeholder:"","enter-button":"BUSCAR",loading:R.value,maxlength:e.typedocument_id===1?8:12,onSearch:K},null,8,["value","onUpdate:value","loading","maxlength"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSearchRuc"?(i(),_(r,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{pattern:/^(10|15|20)\d{9,}$/,message:"El número debe comenzar con 10, 15 o 20, tener solo números, y al menos 11 caracteres"}]},{default:p(()=>[u(s,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,placeholder:"Ingresar RUC","enter-button":"BUSCAR",loading:D.value,maxlength:a.max,onSearch:Q,disabled:a.disabled},null,8,["value","onUpdate:value","loading","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iText"?(i(),_(r,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{validator:j}]},{default:p(()=>[u(o,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,maxlength:a.max,onBlur:l=>V(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","onBlur","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iDate"?(i(),_(r,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message},{validator:G,message:"La edad debe estar entre 18 y 99 años"}]},{default:p(()=>[u(d,{locale:O(me),value:e[a.name],"onUpdate:value":l=>e[a.name]=l,style:{width:"100%"},format:xe,placeholder:"día/mes/año",disabled:a.disabled},null,8,["locale","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSelect"?(i(),_(r,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[u(f,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:$(a.name),"show-search":"","filter-option":L,onChange:l=>Y(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","options","onChange","disabled"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iTextarea"?(i(),_(r,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[u(v,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,rows:4,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="iSelectWrite"?(i(),_(r,{key:6,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:p(()=>[a.name=="economicsector_id"?(i(),_(f,{key:0,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,"show-search":"",options:O(c).economicSectors,"filter-option":L,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):g("",!0)]),_:2},1032,["name","label","rules"])):g("",!0),a.type==="space1"?(i(),h("div",Se)):g("",!0)],64))),128))]),u(r,null,{default:p(()=>[u(X,{type:"primary","html-type":"submit",loading:T.value,class:"attendance-btn"},{default:p(()=>t[3]||(t[3]=[A("REGISTRARSE")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))])])]),_:1},8,["spinning","indicator"]),u(be)],64)}}};export{we as default};
