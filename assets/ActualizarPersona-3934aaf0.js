import{G as E,r as m,y as oe,u as re,b as de,l as ie,d as r,o as s,e as x,c as p,w as u,f as h,t as ue,i as D,s as o,F as N,g as w,m as B,h as U,B as ce,v as d,H as me,j as pe,p as be,k as _e}from"./index-2e48186f.js";import"./es-0df8289c.js";import{d as ve,g as ye}from"./selects-0fbcf7fc.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const ge={document_type:{type:"iSelect",label:"Tipo de documento",name:"document_type",required:!0,message:"Seleccionar tipo de documento",disabled:!0},number_document:{type:"iSearch",label:"Ingresar número",name:"number_document",required:!0,message:"Escribe número de documento",disabled:!0},last_name:{type:"iText",label:"Apellido Paterno",name:"last_name",required:!0,message:"Escribir apellido",disabled:!1},middle_name:{type:"iText",label:"Apellido Materno",name:"middle_name",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!1},department:{type:"iSelect",label:"Departamento",name:"department",required:!1,message:"Seleccionar departamento",disabled:!1},province:{type:"iSelect",label:"Provincia",name:"province",required:!1,message:"Seleccionar provincia",disabled:!1},district:{type:"iSelect",label:"Distrito",name:"district",required:!1,message:"Seleccionar distrito",disabled:!1},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!1,message:"Número de contacto y 9 max",max:9,disabled:!1},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Número de contacto y 9 max",email:"email",disabled:!1},birthdate:{type:"iDate",label:"Fecha de nacimiento",name:"birthdate",required:!1,message:"Seleccionar fecha",disabled:!1},gender:{type:"iSelect",label:"Género",name:"gender",required:!1,message:"Seleccionar tipo de documento"},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!1,message:"Seleccionar un tipo"}};const R=q=>(be("data-v-581724bb"),q=q(),_e(),q),he=R(()=>h("br",null,null,-1)),qe={class:"uppercase"},Se=R(()=>h("br",null,null,-1)),ke={key:1,class:"agreement-wrapper"},xe={class:"grid-item"},M="YYYY-MM-DD",De={__name:"ActualizarPersona",setup(q){E.locale("es");const C=JSON.parse(localStorage.getItem("user")),i=m(ge),b=oe(),S=re(),y=m(null),P=m(!0),z=m(!1),T=m(!1),A=m([]),k=m([]),f=m([]),V=[{label:"DNI",value:"dni"},{label:"CE",value:"ce"},{label:"PAS",value:"pas"},{label:"PTP",value:"ptp"}],a=de({document_type:"dni",number_document:null,last_name:null,middle_name:null,name:null,department:null,province:null,district:null,phone:null,email:null,birthdate:null,gender:null,lession:null,created_by:C.id,update_by:C.id,post:b.query.access}),F=()=>{a.document_type=null,a.number_document=null,a.last_name=null,a.middle_name=null,a.name=null,a.department=null,a.province=null,a.district=null,a.phone=null,a.email=null},$=()=>{i.value.document_type.disabled=!0,i.value.number_document.disabled=!0,i.value.name.disabled=!0,i.value.department.disabled=!0,i.value.province.disabled=!0,i.value.district.disabled=!0,i.value.phone.disabled=!0,i.value.email.disabled=!0},L=()=>{a.number_document=a.number_document.replace(/\D/g,"")},j=async()=>{},O=t=>{F(),$(),a.document_type=t},H=(t,n)=>{a.province=null,a.district=null,k.value=[],f.value=[],Y(n.value)},J=(t,n)=>{a.district=null,f.value=[],G(n.value)},I=()=>{const t=b.query.access;if(b.query.dni){const n={dni:b.query.dni,typedoc:b.query.typedoc};S.push({name:"asesorias-formalizaciones",query:n})}else t==1&&S.push("/admin/asesorias/supervisores"),t==2&&S.push("/admin/asesorias/asesores"),t==3&&S.push("/admin/asesorias/solicitantes")},Z=async()=>{try{const{data:t}=await w({url:"/departaments",method:"GET"});let n=t.map(c=>({label:c.label,value:c.id}));A.value=[...A.value,...n]}catch(t){console.log(t)}},Y=async t=>{try{const{data:n}=await w({url:`/province/${t}`,method:"GET"});let c=n.map(_=>({label:_.label,value:_.id}));k.value=[...k.value,...c]}catch(n){console.log(n)}},G=async t=>{try{const{data:n}=await w({url:`/district/${t}`,method:"GET"});let c=n.map(_=>({label:_.label,value:_.id}));f.value=[...f.value,...c]}catch(n){console.log(n)}},K=async()=>{a.birthdate=y.value?E(y.value).format("YYYY-MM-DD"):null;const t=a;T.value=!0;try{await B({url:"/new-person",method:"POST",data:t})&&(F(),I(),U.success("Usuario actualizado exitosamente."))}catch(n){if(n.response.status==550)return U.error("El usuario ya se encuentra registrado");U.error("Error al registrar")}finally{T.value=!1}},Q=()=>{U.error("Debes de completar todos los espacios requeridos")},W=async()=>{try{const{data:t}=await B({url:`/person-by-dni/${b.query.dni}`,method:"GET"});Y(t.department),G(t.province),a.document_type=t.document_type,a.number_document=t.number_document,a.last_name=t.last_name,a.middle_name=t.middle_name,a.name=t.name,a.department=t.department,a.province=t.province,a.district=t.district,a.phone=t.phone,a.email=t.email,a.gender=t.gender,a.lession=t.lession,t.birthdate&&(y.value=E(t.birthdate,M)),P.value=!1}catch(t){console.error("Error de red:",t)}};return ie(()=>{Z(),W()}),(t,n)=>{const c=r("a-breadcrumb-item"),_=r("a-breadcrumb"),X=r("a-spin"),v=r("a-select"),g=r("a-form-item"),ee=r("a-input-search"),ae=r("a-input"),te=r("a-date-picker"),ne=r("a-button"),le=r("a-form");return s(),x(N,null,[p(_,null,{default:u(()=>[p(c,null,{default:u(()=>[h("a",{onClick:I},"Atrás")]),_:1})]),_:1}),he,h("h3",qe,"ACTUALIZAR "+ue(D(b).query.rol),1),Se,P.value?(s(),o(X,{key:0})):(s(),x("div",ke,[p(le,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:K,onFinishFailed:Q},{default:u(()=>[h("div",xe,[(s(!0),x(N,null,ce(i.value,(e,se)=>(s(),x(N,{key:se},[e.type==="iSelect"?(s(),o(g,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[e.name=="document_type"?(s(),o(v,{key:0,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:V,disabled:e.disabled,onChange:O},null,8,["value","onUpdate:value","disabled"])):d("",!0),e.name=="department"?(s(),o(v,{key:1,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:A.value,onChange:H,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.name=="province"?(s(),o(v,{key:2,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:k.value,onChange:J,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.name=="district"?(s(),o(v,{key:3,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:f.value,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.name=="lession"?(s(),o(v,{key:4,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:D(ve),disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.name=="gender"?(s(),o(v,{key:5,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:D(ye),disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iSearch"?(s(),o(g,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[p(ee,{maxlength:15,loading:z.value,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,"enter-button":"",onSearch:j,onInput:L,disabled:e.disabled},null,8,["loading","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iText"?(s(),o(g,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email,max:e.max}]},{default:u(()=>[p(ae,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,disabled:e.disabled},null,8,["value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iDate"?(s(),o(g,{key:3,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[p(te,{locale:D(me),value:y.value,"onUpdate:value":n[0]||(n[0]=l=>y.value=l),style:{width:"100%"},format:M,disabled:e.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):d("",!0)],64))),128))]),p(g,null,{default:u(()=>[p(ne,{type:"primary","html-type":"submit",loading:T.value},{default:u(()=>[pe("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))],64)}}},Ne=fe(De,[["__scopeId","data-v-581724bb"]]);export{Ne as default};
