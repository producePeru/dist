import{_ as ee}from"./TableComponent-b5e2290e.js";import{p,r as s,a as j,k as Z,T as ae,W as U,b as M,o as d,y as W,i as D,L as te,d as u,c as r,w as k,e as n,F as Q,v as K,j as q,$ as ne,z as w,h as Y,m as X,u as oe,t as v,n as se}from"./index-9efe7972.js";import{_ as le}from"./FormComponent-efa81010.js";import{u as ie}from"./selectes-5b97efab.js";import{U as re}from"./UpImage-9c3caf3b.js";import"./es-4cb79e05.js";import{u as de,t as ce}from"./timezone-7d9bb5c4.js";import"./downloadExcel-b0647e83.js";import{G as ue}from"./GlobalOutlined-913d6169.js";import{U as me}from"./UserOutlined-1dc8207c.js";import{M as pe}from"./MailOutlined-2a4fc432.js";import{P as fe}from"./PhoneOutlined-32b4c3a3.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-ac0e435d.js";import"./MoreOutlined-55406c12.js";import"./quill.snow-82b028ba.js";import"./_plugin-vue_export-helper-c27b6911.js";const _e={key:1,class:"mp-asesoria"},he={key:0},ge={class:"as-personalizada"},ve={__name:"DrawMPAsesorias",props:["info"],emits:["closeDraw"],setup(J,{emit:P}){p.locale("es"),p.extend(de),p.extend(ce);const O=s({title:{type:"iText",label:"NOMBRE DEL EVENTO",name:"title",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},description:{type:"iTextArea",label:"DESCRIPCIÓN DEL EVENTO",name:"description",required:!0,message:"Escribir nombre del evento",disabled:!1,rows:6,max:250},requirements:{type:"iQuillEditor",label:"MENSAJE DE LOS REQUISITOS",name:"requirements",required:!0,message:"Escribir los requisitos",disabled:!1,class:"quill-height-200"},capacitador_id:{type:"iSelect",label:"ASESOR DE LA ASESORÍA",name:"capacitador_id",required:!0,message:"Seleccionar capacitador",disabled:!1},imgBanner:{type:"iSlot",name:"iSlotOptions"}}),I=ie(),S=P,l=J,f=s(!0),z=s("GUARDAR"),a=j({}),R=s(!1),H=s(null),B=s(null),N=s({city_id:[],fairtype_id:[],modality_id:[],capacitador_id:[]}),g=j({schedules:[{date:null,startTime:null}]}),$=()=>{g.schedules.push({date:""})},F=e=>{g.schedules.splice(e,1)},V=()=>l.info?{name:l.info.image_name,url:l.info.image_url}:null,y=e=>{e=="modality_id"&&console.log("a9a9a9a99a9a9")},o=async e=>{e=="dateReception"&&(a.dateTramite&&(a.dateTramite=null),O.value.dateTramite.disabled=!1)},m=async e=>{H.value=e.id},E=async e=>{e=="city_id"&&(a.city_id=null),e=="capacitador_id"&&(N.value.capacitadores=I.capacitadores)},G=async(e,t)=>{},_=async()=>{var t,x;const e=H.value??((x=(t=l.info)==null?void 0:t.image)==null?void 0:x.id);if(!e){Y.error("Debe seleccionar una imagen.");return}if(!g.schedules.length){Y.error("Debe agregar al menos una fecha y horario.");return}for(const c of g.schedules)if(!c.date||!c.startTime||c.startTime.length!==2){Y.error("Todas las fechas deben tener rango de horario válido.");return}R.value=!0;try{const c={title:a.title,description:a.description,requirements:a.requirements,capacitador_id:a.capacitador_id,image_id:e,link:a.link,schedules:g.schedules.map(b=>({date:p(b.date).format("YYYY-MM-DD"),startTime:p(b.startTime[0]).format("HH:mm"),endTime:p(b.startTime[1]).format("HH:mm")}))},h=l.info?`mp/update-event/${l.info.id}`:"mp/create-personalized-advice",C=l.info?"PUT":"POST",T=await X({url:h,method:C,data:c});T.status===200&&(Y.success(T.message),A(),S("closeDraw",!0))}catch(c){console.error("Error:",c);const h=document.getElementsByClassName("ant-drawer-body")[0];h&&(h.scrollTop=0)}finally{R.value=!1}},A=()=>{},i=async e=>{f.value=!0;try{e&&(a.title=e.title,a.description=e.description,a.requirements=e.requirements,a.capacitador_id=e.capacitador_id,a.date=e.date?p(e.date,"YYYY-MM-DD"):null,a.hours=[p(e.hourStart,"HH:mm"),p(e.hourEnd,"HH:mm")],a.link=e.link)}catch(t){console.error("Error al cargar la información:",t)}finally{f.value=!1}};return Z(async()=>{l.info?i(l.info):f.value=!1,await I.fetchCapacitadores(),N.value.capacitador_id=I.capacitadores}),ae(()=>l.info,e=>{e&&i(e)}),U("formState",a),U("loadingState",R),(e,t)=>{const x=M("a-date-picker"),c=M("a-time-range-picker"),h=M("a-button");return f.value?(d(),W(D(te),{key:0,style:{color:"#00a6db"}})):(d(),u("div",_e,[r(le,{fields:O.value,options:N.value,btnSaveName:z.value,onHandleInputEvent:y,resetSelect:B.value,onHandleFocusSelect:E,onHandleChangeSelect:G,onHandleChangeClock:o,onOnSubmit:_},{default:k(({field:C})=>[C.name=="iSlotOptions"?(d(),u("div",he,[n("div",null,[(d(!0),u(Q,null,K(g.schedules,(T,b)=>(d(),u("div",{class:"as-dates",key:b},[n("label",null,[t[0]||(t[0]=q(" FECHA DE LA ASESORÍA ")),r(x,{value:T.date,"onUpdate:value":L=>T.date=L,style:{width:"100%","margin-bottom":"8px"},format:"DD/MM/YYYY",placeholder:"Seleccionar fecha"},null,8,["value","onUpdate:value"])]),n("label",null,[t[1]||(t[1]=q(" HORARIO DE LA ASESORÍA ")),r(c,{value:T.startTime,"onUpdate:value":L=>T.startTime=L,style:{width:"100%","margin-bottom":"8px"},format:"HH:mm",minuteStep:30},null,8,["value","onUpdate:value"])]),b!=0?(d(),W(D(ne),{key:0,class:"as-date-delete",onClick:L=>F(b)},null,8,["onClick"])):w("",!0)]))),128)),r(h,{type:"dashed",block:"",onClick:$,style:{"margin-bottom":"2rem"}},{default:k(()=>t[2]||(t[2]=[q(" + Agregar fecha y horario ")])),_:1})]),n("div",ge,[t[3]||(t[3]=n("label",null,"CARGAR IMAGEN",-1)),r(re,{"accept-formats":["image/jpeg","image/png"],maxImages:1,nameType:"mp",onUploadSuccess:m,imageLoad:V()},null,8,["imageLoad"])])])):w("",!0)]),_:1},8,["fields","options","btnSaveName","resetSelect"])]))}}};const Se={class:"layout-content"},ye=["href"],Ee={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={key:0},xe={style:{"font-weight":"500"}},Te={style:{"font-size":"13px"}},be={style:{"font-size":"13px"}},ke=["innerHTML"],we=["onClick"],Ve={__name:"mp-asesorias",setup(J){JSON.parse(localStorage.getItem("role"));const P=s([]),O=s(0),I=s(150),S=s(!1);s(!1),oe();const l=s(!1),f=s(null),z=s(!1),a=j({page:1}),R=[{title:"#",dataIndex:"idx",align:"center",width:50,fixed:"left"},{title:"TEMA",dataIndex:"title",width:140},{title:"DESCRIPCIÓN",dataIndex:"description",width:200},{title:"HORARIO",dataIndex:"hours",width:220},{title:"REQUISITOS",dataIndex:"requirements",width:160},{title:"CAPACITADOR",dataIndex:"capacitador_name",width:160},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],H=o=>o?p(o,["HH:mm:ss","HH:mm"]).format("hh:mm A"):null,B=o=>{f.value=o,S.value=!0},N=()=>{y(),S.value=!1},g=()=>{f.value=null,S.value=!0},$=async()=>{},F=async o=>{a.page=o,await y()},V=async o=>{o&&(a.page=1,await y())},y=async()=>{try{l.value=!0;const o={page:a.page},m=await X({url:"mp/mp-index-advice",method:"GET",params:o}),{data:E}=m;P.value=E.data,O.value=E.total,I.value=E.per_page}catch(o){console.error("Error de red:",o)}finally{l.value=!1}};return Z(async()=>{await y()}),U("search",a),U("loading",l),U("loadingFile",z),(o,m)=>{const E=M("a-menu-item"),G=M("a-drawer");return d(),u("div",Se,[r(ee,{title:"ASESORÍAS PERSONALIZADAS",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",columns:R,titleSearch:"BUSCAR POR EVENTO",pageSize:I.value,nameTotal:"Capacitaciones",dataSource:P.value,total:O.value,btnUpdate:!0,onHandleNew:g,onHandleCallFetchData:y,onHandleDownloadExcel:$,onHandleSearch:V,onHandlePaginator:F},{header:k(()=>m[1]||(m[1]=[])),"data-cell":k(({column:_,record:A})=>[_.dataIndex=="link"?(d(),u(Q,{key:0},[A.link?(d(),u("a",{key:0,target:"'_blank'",href:A.link,style:{color:"#7d4fc6","font-size":"16px","margin-top":"-2px"}},[r(D(ue))],8,ye)):w("",!0)],64)):w("",!0),_.dataIndex=="hours"?(d(!0),u(Q,{key:1},K(A.schedules,(i,e)=>{var t,x,c,h,C;return d(),u("div",{class:"hour-participant",key:e},[n("div",{class:se(i.participant?"hour-participant-detail":"hour-participant-no-detail")},[n("span",null,v(i.date_format),1),m[2]||(m[2]=q(" | ")),n("span",null,v(H(i.startTime))+" - "+v(H(i.endTime)),1),n("div",Ee,[i.participant?(d(),u("div",Ae,[n("div",null,[n("span",xe,[r(D(me)),q(" "+v((t=i.participant)==null?void 0:t.names)+" "+v((x=i.participant)==null?void 0:x.last_name)+" "+v((c=i.participant)==null?void 0:c.middle_name),1)])]),n("div",null,[r(D(pe),{style:{"padding-right":"5px"}}),n("span",Te,v((h=i.participant)==null?void 0:h.email),1)]),n("div",null,[r(D(fe),{style:{"padding-right":"5px"}}),n("span",be,v((C=i.participant)==null?void 0:C.phone),1)])])):w("",!0)])],2)])}),128)):w("",!0),_.dataIndex=="requirements"?(d(),u("div",{key:2,innerHTML:A.requirements},null,8,ke)):w("",!0)]),"custom-options":k(({record:_})=>[r(E,null,{default:k(()=>[n("a",{onClick:A=>B(_)},"Editar",8,we)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),r(G,{open:S.value,"onUpdate:open":m[0]||(m[0]=_=>S.value=_),title:f.value?"EDITAR EVENTO MP":"REGISTRAR UNA ASESORÍA",placement:"right",width:"550"},{default:k(()=>[r(ve,{onCloseDraw:N,info:f.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{Ve as default};
