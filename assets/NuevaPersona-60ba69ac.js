import{K as p,x as ie,r as y,u as le,a as de,k as se,b,o,d as I,c as f,w as v,e as k,F as z,B as oe,q as r,h as q,s as u,L as re,t as ue,i as ce,p as me,j as pe,m as h,y as T,f as N}from"./index-fd163366.js";import{u as be}from"./selectes-95b92080.js";import{d as ve}from"./selects-56d2dd8e.js";import"./es-6ce47e03.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const ye={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},city_id:{type:"iSelect",label:"Departamento residente",name:"city_id",required:!0,message:"Seleccionar departamento",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!1,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!1,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!1,message:"Número de celular",max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},lession:{type:"iSelect",label:"¿Tiene discapacidad?",name:"lession",required:!0,message:"¿Tiene discapacidad?",disabled:!0}};const R=Y=>(me("data-v-8fef8587"),Y=Y(),pe(),Y),fe={class:"agreement-wrapper"},he=R(()=>k("h3",null,"Formulario de registro",-1)),ge=R(()=>k("br",null,null,-1)),De={class:"grid-item"},qe="DD/MM/YYYY",Ye={__name:"NuevaPersona",setup(Y){p.locale("es");const g=ie(),d=be();d.$patch({typeDocuments:d.typeDocuments}),d.$patch({cities:d.cities}),d.$patch({provinces:d.provinces}),d.$patch({districts:d.districts}),d.$patch({genders:d.genders}),d.fetchTypeDocuments(),d.fetchCities(),d.fetchGenders();const w=y(null),M=y(null),B=le(),$=JSON.parse(localStorage.getItem("profile")),n=y(ye),x=y(!1),m=y(null),U=y(!1),C=y(!0),e=de({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,lession:null,people_id:$.user_id,from_id:1}),A=async i=>{try{const{data:t}=await N({url:`select/provinces/${i}`,method:"GET"});w.value=t}catch(t){console.error("Error de red:",t)}},V=async i=>{try{const{data:t}=await N({url:`select/districts/${i}`,method:"GET"});M.value=t}catch(t){console.error("Error de red:",t)}},E=(i,t)=>{const l=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)},O=()=>{d.typeDocuments&&(C.value=!1)},j=()=>{n.value.lastname.disabled=!1,n.value.middlename.disabled=!1,n.value.name.disabled=!1,n.value.city_id.disabled=!1,n.value.province_id.disabled=!1,n.value.district_id.disabled=!1,n.value.address.disabled=!1,n.value.phone.disabled=!1,n.value.email.disabled=!1,n.value.birthday.disabled=!1,n.value.gender_id.disabled=!1,n.value.lession.disabled=!1},P=i=>{i&&(n.value.documentnumber.disabled=!1,e.documentnumber=null)},G=async i=>{if(x.value=!0,!i)return h.warning("Ingresa un número de documento"),x.value=!1;if(e.typedocument_id==1){const{data:t}=await T({url:`user/api/dni/${e.documentnumber}`,method:"GET"});if(t.body&&(e.lastname=t.body.apePaterno,e.middlename=t.body.apeMaterno,e.name=t.body.preNombres,e.address=t.body.desDireccion,t.body.feNacimiento&&(e.birthday=p(t.body.feNacimiento,"DD/MM/YYYY")),t.body.feNacimiento&&(m.value=p(t.body.feNacimiento,"DD/MM/YYYY")),t.body.ubigeo)){let l=d.cities.find(_=>_.label===t.body.ubigeo.departamento),c=await N({url:`select/provinces/${l.value}`,method:"GET"});w.value=c.data;let S=c.data.find(_=>_.label===t.body.ubigeo.provincia),D=await N({url:`select/districts/${S.value}`,method:"GET"});M.value=D.data;let F=D.data.find(_=>_.label===t.body.ubigeo.distrito);e.city_id=l.value,e.province_id=S.value,e.district_id=F.value}}if(e.typedocument_id==2){const{data:t}=await T({url:`user/api/ce/${e.documentnumber}`,method:"GET"});t.body&&(e.lastname=t.body.apellido_paterno,e.middlename=t.body.apellido_materno,e.name=t.body.nombres,e.gender_id=t.body.sexo=="F"?2:1,t.body.fecha_nacimiento&&(e.birthday=p(t.body.fecha_nacimiento,"DD/MM/YYYY")),t.body.fecha_nacimiento&&(m.value=p(t.body.fecha_nacimiento,"DD/MM/YYYY")))}if(e.typedocument_id==3){const{data:t}=await T({url:`user/api/pas/${e.documentnumber}`,method:"GET"}),l=t.body.data[0];e.lastname=l.apellido_paterno,e.middlename=l.apellido_materno,e.name=l.nombres,e.gender_id=l.sexo=="F"?2:1,l.fecha_nacimiento&&(e.birthday=p(l.fecha_nacimiento,"DD/MM/YYYY")),l.fecha_nacimiento&&(m.value=p(l.fecha_nacimiento,"DD/MM/YYYY"))}return j(),x.value=!1},J=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},K=()=>{e.phone=e.phone.replace(/\D/g,"")},H=i=>{e.province_id=null,e.district_id=null,A(i)},Q=i=>{e.district_id=null,V(i)},W=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.lession=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=$.id,m.value=null,L()},L=()=>{n.value.documentnumber.disabled=!0,n.value.lastname.disabled=!0,n.value.middlename.disabled=!0,n.value.name.disabled=!0,n.value.city_id.disabled=!0,n.value.city_id.disabled=!0,n.value.province_id.disabled=!0,n.value.address.disabled=!0,n.value.phone.disabled=!0,n.value.email.disabled=!0,n.value.birthday.disabled=!0,n.value.gender_id.disabled=!0,n.value.lession.disabled=!0},X=async()=>{U.value=!0,e.birthday=m.value?p(m.value).format("YYYY-MM-DD"):null;try{const i=await T({url:"person/create",method:"POST",data:e});if(i.status==400)return h.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(i.status==401)return h.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(i.status==200){const t={type:e.typedocument_id,number:e.documentnumber};return B.push({name:"asesorias-formalizaciones",query:t}),h.success(i.message),W()}}catch{h.error("No se pudo registrar este usuario")}finally{U.value=!1}},Z=()=>{h.error("Debes de completar todos los espacios requeridos")},ee=async()=>{L(),g.query&&(e.typedocument_id=+g.query.type,P(g.query.type),e.documentnumber=g.query.number,await d.fetchCities(),await G(g.query.number))};return se(()=>{ee()}),(i,t)=>{const l=b("a-select"),c=b("a-form-item"),S=b("a-input-search"),D=b("a-input"),F=b("a-date-picker"),_=b("a-button"),ae=b("a-form"),te=b("a-spin");return o(),I("div",fe,[he,ge,f(te,{spinning:C.value},{default:v(()=>[f(ae,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:X,onFinishFailed:Z},{default:v(()=>[k("div",De,[(o(!0),I(z,null,oe(n.value,(a,ne)=>(o(),I(z,{key:ne},[a.type==="iSelect"?(o(),r(c,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:v(()=>[a.name=="typedocument_id"?(o(),r(l,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(d).typeDocuments,disabled:a.disabled,onChange:P},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="city_id"?(o(),r(l,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(d).cities,"show-search":"","filter-option":E,onChange:H,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="province_id"?(o(),r(l,{key:2,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:w.value,"show-search":"","filter-option":E,onChange:Q,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="district_id"?(o(),r(l,{key:3,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:M.value,"show-search":"","filter-option":E,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="gender_id"?(o(),r(l,{key:4,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(d).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="lession"?(o(),r(l,{key:5,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,options:q(ve),disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):u("",!0)]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iSearch"?(o(),r(c,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:v(()=>[f(S,{loading:x.value,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,onSearch:G,onInput:J,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iText"?(o(),r(c,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max}]},{default:v(()=>[a.name=="phone"?(o(),r(D,{key:0,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,disabled:a.disabled,maxlength:a.max,onInput:K},null,8,["value","onUpdate:value","disabled","maxlength"])):(o(),r(D,{key:1,value:e[a.name],"onUpdate:value":s=>e[a.name]=s,disabled:a.disabled,maxlength:a.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iDate"?(o(),r(c,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:v(()=>[f(F,{locale:q(re),value:m.value,"onUpdate:value":t[0]||(t[0]=s=>m.value=s),style:{width:"100%"},format:qe,placeholder:"día / mes / año",disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):u("",!0)],64))),128))]),k("div",null,ue(O()),1),f(c,null,{default:v(()=>[f(_,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:v(()=>[ce("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},we=_e(Ye,[["__scopeId","data-v-8fef8587"]]);export{we as default};
