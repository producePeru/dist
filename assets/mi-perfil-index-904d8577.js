import{r as _,a as S,k as $,b as r,o as A,d as B,c as e,w as o,m as x,e as d,t as p,i as g,j as u,h as X}from"./index-8b7de5e5.js";const G={style:{"max-width":"900px",margin:"0 auto",padding:"24px"}},L={style:{"text-align":"center"}},J={style:{"margin-top":"12px","font-weight":"600"}},H={style:{color:"#888","font-size":"13px"}},K={style:{"text-align":"right"}},Q={style:{"text-align":"right"}},Z={__name:"mi-perfil-index",setup(W){const i=JSON.parse(localStorage.getItem("profile")),E=_(null),w=_(!1),l=S({email:"@produce.gob.pe",phone:"9"}),N={fullName:[{required:!0,message:"Ingrese su nombre completo"}],email:[{required:!0,type:"email",message:"Ingrese un correo válido"}],phone:[{pattern:/^\d{9,15}$/g,message:"Ingrese solo números (9 a 15 dígitos)"}]},q=async()=>{w.value=!0;try{const s=await x({url:`users/updated-personal-info/${i.id}/${i.dni}`,method:"PUT",data:{email:l.email,phone:l.phone}});s.status==200&&X.success(s.message)}catch(s){console.error("Error de red:",s)}finally{w.value=!1}},D=_(null),v=_(!1),t=S({currentPassword:"",newPassword:"",confirmPassword:""}),I={currentPassword:[{required:!0,message:"Ingrese su contraseña actual"}],newPassword:[{required:!0,message:"Ingrese una nueva contraseña"},{min:8,message:"Mínimo 8 caracteres"}],confirmPassword:[{required:!0,message:"Confirme la nueva contraseña"},{validator:(s,a)=>a!==t.newPassword?Promise.reject("Las contraseñas no coinciden"):Promise.resolve()}]},T=async()=>{try{v.value=!0;const s={current_password:t.currentPassword,password:t.newPassword,password_confirmation:t.confirmPassword,dni:i.dni},a=await x({url:"users/password-reset",method:"POST",data:s});X.success(a.message),R()}finally{v.value=!1}},R=()=>Object.keys(t).forEach(s=>t[s]=""),j=async()=>{try{const s=await x({url:"users/get-personal-info",method:"GET"});l.email=s.email,l.phone=s.phone}catch(s){console.error("Error de red:",s)}};return $(async()=>{await j()}),(s,a)=>{const F=r("a-page-header"),O=r("a-avatar"),M=r("a-divider"),y=r("a-descriptions-item"),V=r("a-descriptions"),P=r("a-card"),f=r("a-col"),C=r("a-input"),m=r("a-form-item"),k=r("a-row"),b=r("a-button"),U=r("a-form"),h=r("a-input-password");return A(),B("div",G,[e(F,{title:"Perfil del Usuario","sub-title":"Visualiza y actualiza tu información personal",style:{padding:"0","margin-bottom":"16px"}}),e(k,{gutter:16},{default:o(()=>[e(f,{xs:24,md:8},{default:o(()=>[e(P,{bordered:""},{default:o(()=>{var n,z;return[d("div",L,[e(O,{size:128,src:"https://img.freepik.com/premium-vector/user-icon-icon_1076610-59410.jpg"}),d("h3",J,p((n=g(i))==null?void 0:n.name)+" "+p((z=g(i))==null?void 0:z.lastname),1),d("p",H,p(l.email),1),e(M),e(V,{column:1,size:"small"},{default:o(()=>[e(y,{label:"Teléfono"},{default:o(()=>{var c;return[u(p((c=g(i))==null?void 0:c.phone),1)]}),_:1}),e(y,{label:"Documento"},{default:o(()=>{var c;return[u(p((c=g(i))==null?void 0:c.dni),1)]}),_:1}),e(y,{label:"Organización"},{default:o(()=>a[5]||(a[5]=[u("PNTE")])),_:1})]),_:1})])]}),_:1}),a[6]||(a[6]=d("br",null,null,-1))]),_:1}),e(f,{xs:24,md:16},{default:o(()=>[e(P,{title:"Datos personales",style:{"margin-bottom":"16px"}},{default:o(()=>[e(U,{layout:"vertical",model:l,rules:N,ref_key:"formRef",ref:E,onFinish:q},{default:o(()=>[e(k,{gutter:16},{default:o(()=>[e(f,{span:12},{default:o(()=>[e(m,{label:"Correo electrónico PRODUCE",name:"email"},{default:o(()=>[e(C,{value:l.email,"onUpdate:value":a[0]||(a[0]=n=>l.email=n),placeholder:"ejemplo: tuempresa_tempxyz@produce.gob.pe"},null,8,["value"])]),_:1})]),_:1}),e(f,{span:12},{default:o(()=>[e(m,{label:"Celular",name:"phone",rules:[{max:9,message:"Máximo 9 caracteres"},{pattern:/^[0-9]*$/,message:"Solo números permitidos"}]},{default:o(()=>[e(C,{value:l.phone,"onUpdate:value":a[1]||(a[1]=n=>l.phone=n),placeholder:"9XXXXXXXX",maxlength:9},null,8,["value"])]),_:1})]),_:1})]),_:1}),d("div",K,[e(b,{type:"primary","html-type":"submit",loading:w.value},{default:o(()=>a[7]||(a[7]=[u("GUARDAR")])),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1}),e(P,{title:"Seguridad - Cambiar contraseña"},{default:o(()=>[e(U,{layout:"vertical",model:t,rules:I,ref_key:"passwordFormRef",ref:D,onFinish:T},{default:o(()=>[e(m,{label:"Contraseña actual",name:"currentPassword"},{default:o(()=>[e(h,{value:t.currentPassword,"onUpdate:value":a[2]||(a[2]=n=>t.currentPassword=n),placeholder:"••••••••"},null,8,["value"])]),_:1}),e(m,{label:"Nueva contraseña",name:"newPassword"},{default:o(()=>[e(h,{value:t.newPassword,"onUpdate:value":a[3]||(a[3]=n=>t.newPassword=n),placeholder:"Mínimo 8 caracteres"},null,8,["value"])]),_:1}),e(m,{label:"Confirmar nueva contraseña",name:"confirmPassword"},{default:o(()=>[e(h,{value:t.confirmPassword,"onUpdate:value":a[4]||(a[4]=n=>t.confirmPassword=n),placeholder:"Repite la nueva contraseña"},null,8,["value"])]),_:1}),d("div",Q,[e(b,{onClick:R,style:{"margin-right":"8px"}},{default:o(()=>a[8]||(a[8]=[u("Limpiar")])),_:1}),e(b,{type:"primary","html-type":"submit",loading:v.value},{default:o(()=>a[9]||(a[9]=[u("Actualizar contraseña")])),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}};export{Z as default};
