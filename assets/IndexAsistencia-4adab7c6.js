import{l as w,r as c,D as be,a as oe,T as ae,j as re,b as d,o,v as p,w as l,e as h,d as C,F as Y,q as he,c as i,x as u,h as S,H as Ie,i as x,t as U,K as te,m as G,u as we,g as Ee,E as xe,X as Se,ac as Ce,s as ie,ad as ke,a0 as Re,J as Ae,p as Te}from"./index-62266265.js";import{_ as Ne}from"./icoexcel-1b303edf.js";import{u as de}from"./selectes-b886f1d3.js";import"./es-b43b0347.js";import{d as Oe}from"./downloadExcel-5a422933.js";import{C as Ue}from"./CloudOutlined-6b694f09.js";import{M as Ye}from"./MoreOutlined-0087e1f1.js";const qe={class:"form-attendance"},Le="DD/MM/YYYY",Fe={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup(H,{emit:y}){w.locale("es");const m=de();m.$patch({cities:m.cities}),m.$patch({provinces:m.provinces}),m.$patch({districts:m.districts}),m.fetchCities(),m.fetchAsesores();const q=c(!1),g=H,A=y;be();const e=oe({}),L={eventsoffice_id:{type:"iSelect",label:"TIPO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA FIN",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1},modality:{type:"iSelect",label:"MODALIDAD",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0,max:100},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}},F=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}];ae(()=>e.startDate,n=>{e.endDate&&new Date(n)>new Date(e.endDate)&&(e.endDate=null)}),ae(()=>e.endDate,n=>{e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=null)});const D=(n,E)=>{const R=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return E.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(R)},W=n=>{if(n=="modality")return F;if(n=="powerBy")return pertenece;if(n=="fairtype_id")return typeFair;if(n=="eventsoffice_id")return z()},z=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],T=n=>{e.province_id=null,e.district_id=null,m.fetchProvinces(n)},M=n=>{e.district_id=null,m.fetchDistricts(n)},I=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null},j=async()=>{q.value=!0;const n={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:w(e.startDate).format("YYYY-MM-DD"),endDate:w(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,people_id:e.people_id,description:e.description};try{const E=g.dataRow?"PUT":"POST",R=g.dataRow?`attendance/update/${g.dataRow.id}`:"attendance/create",_=await te({url:R,method:E,data:n});_.status==200&&(G.success(_.message),A("closeDraw"),I()),_.status==500&&(G.error(_.message),I())}catch(E){G.error("Se presentó un error, los valores son requeridos",E)}finally{q.value=!1}},P=n=>{const E=e[n]?e[n].trim():"";e[n]=E};function b(n){e.eventsoffice_id=n.id_pnte,e.title=n.title,e.startDate=n.startDate?w(n.startDate,"DD/MM/YYYY"):null,e.endDate=n.endDate?w(n.endDate,"DD/MM/YYYY"):null,e.modality=n.modality,e.city_id=n.city_id,T(n.city_id),e.province_id=n.province_id,M(n.province_id),e.district_id=n.district_id,e.address=n.address,e.people_id=n.people_id,e.description=n.description}return re(()=>{g.dataRow&&b(g.dataRow)}),ae(()=>g.dataRow,n=>{n?b(n):I()}),(n,E)=>{const R=d("a-input"),_=d("a-form-item"),k=d("a-select"),J=d("a-textarea"),Q=d("a-input-number"),X=d("a-date-picker"),Z=d("a-button"),$=d("a-form");return o(),p($,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:j},{default:l(()=>[h("div",qe,[(o(),C(Y,null,he(L,(a,K)=>(o(),C(Y,{key:K},[a.type==="iText"?(o(),p(_,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:l(()=>[i(R,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,maxlength:a.max,onBlur:r=>P(a.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iSelect"?(o(),p(_,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[i(k,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:W(a.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iTextarea"?(o(),p(_,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[i(J,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iNumber"?(o(),p(_,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[i(Q,{value:e[a.name],"onUpdate:value":r=>e[a.name]=r,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iDate"?(o(),p(_,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[i(X,{locale:S(Ie),value:e[a.name],"onUpdate:value":r=>e[a.name]=r,style:{width:"100%"},format:Le,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):u("",!0),a.type==="iSelectWrite"?(o(),p(_,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:l(()=>[a.name=="city_id"?(o(),p(k,{key:0,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:S(m).cities,"show-search":"","filter-option":D,onChange:T},null,8,["value","onUpdate:value","options"])):u("",!0),a.name=="province_id"?(o(),p(k,{key:1,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:S(m).provinces,"show-search":"","filter-option":D,onChange:M,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="district_id"?(o(),p(k,{key:2,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:S(m).districts,"show-search":"","filter-option":D,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):u("",!0),a.name=="people_id"?(o(),p(k,{key:3,value:e[a.name],"onUpdate:value":r=>e[a.name]=r,options:S(m).asesores,"show-search":"","filter-option":D},null,8,["value","onUpdate:value","options"])):u("",!0)]),_:2},1032,["name","label","rules"])):u("",!0)],64))),64))]),i(_,null,{default:l(()=>[i(Z,{type:"primary","html-type":"submit",loading:q.value},{default:l(()=>[x(U(H.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const Me={key:0,class:"ant-table-cell"},$e={class:"table-order"},ze={key:1},Pe={key:1},Ve=["onClick"],Be=["onClick"],Ge={class:"paginator"},Ke={__name:"IndexAsistencia",props:["idConvenio"],setup(H){w.locale("es");const y=c(w("2025","YYYY")),m=we(),q=JSON.parse(localStorage.getItem("role"))||[];de(),Ee.get("token");const g=c(!1),A=c(null),e=c(!1);c(null);const L=c(0),F=c(50),D=c({page:1}),W=c(1200),z=c([]),T=c(!1);c(!1),c(!1),c(!1),c(!1),c(null);const M=c(window.innerHeight-100),I=c(""),j=[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:140,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"DÍAS RESTANTES",dataIndex:"dateDiff",align:"center",width:140},{title:"MODALIDAD",dataIndex:"modality",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],P=s=>{I.value=s,r()},b=oe({search:""}),n=s=>q.some(t=>s.includes(t.id)),E=()=>{r(),g.value=!1},R=s=>{A.value=s,g.value=!0},_=()=>{A.value=null,g.value=!0},k=s=>{const t=w().startOf("day"),O=w(s).startOf("day").diff(t,"days");return O<=-1?O:O===0?1:O},J=()=>{D.value.page=1,b.search,r()},Q=()=>{b.search||r()},X=s=>{m.push(`/admin/asistencia/inscritos/${s.slug}`)},Z=s=>{D.value.page=s,r()},$=()=>{M.value=window.innerHeight-320},a=async s=>{try{const t=await te({url:`attendance/delete/${s.id}`,method:"DELETE"});t.status==200&&(r(),G.success(t.message))}catch(t){console.error("Error de red:",t)}},K=xe(()=>s=>(D.value.page-1)*F.value+s+1),r=async()=>{try{T.value=!0;const s={};y!=null&&y.value&&(s.year=w(y.value).format("YYYY")),b.search&&(s.search=b.search),D.value.page&&(s.page=D.value.page),I.value&&(s.order_by=I.value);const{data:t}=await te({url:"attendance/list",method:"GET",params:s});z.value=t==null?void 0:t.data,L.value=t.total,F.value=t.per_page}catch(s){console.error("Error de red:",s)}finally{T.value=!1}},ue=async()=>{try{e.value=!0;const s={};y!=null&&y.value&&(s.year=w(y.value).format("YYYY")),b.search&&(s.search=b.search),D.value.page&&(s.page=D.value.page),I.value&&(s.order_by=I.value),await Oe("download/attendance-ugo","eventos-ugo",s)}catch(s){console.error("Error de red:",s)}finally{e.value=!1}};return Se(()=>{window.removeEventListener("resize",$)}),re(()=>{window.addEventListener("resize",$),$(),r()}),(s,t)=>{const N=d("a-button"),O=d("a-date-picker"),ne=d("a-col"),ce=d("a-input"),pe=d("a-input-group"),me=d("a-row"),le=d("router-link"),V=d("a-tag"),B=d("a-menu-item"),_e=d("a-popconfirm"),ve=d("a-menu"),fe=d("a-dropdown"),ye=d("a-table"),ge=d("a-pagination"),De=d("a-drawer");return o(),C(Y,null,[h("div",null,[t[15]||(t[15]=h("h3",{class:"title-produce"},"LISTA EVENTOS UGO",-1)),i(me,{style:{margin:"1rem 0"}},{default:l(()=>[i(ne,{xs:24,md:12,lg:18},{default:l(()=>[n([1,2,5])?(o(),p(N,{key:0,type:"primary",onClick:_},{default:l(()=>t[6]||(t[6]=[x("NUEVO EVENTO")])),_:1})):u("",!0),i(N,{class:"btn-excel",onClick:ue,loading:e.value,type:"primary",style:{"margin-left":".6rem"}},{default:l(()=>t[7]||(t[7]=[h("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Ne},null,-1)])),_:1},8,["loading"]),i(O,{allowClear:!1,value:y.value,"onUpdate:value":t[0]||(t[0]=v=>y.value=v),picker:"year",placeholder:"Seleccionar año",onChange:r,style:{width:"80px",margin:"0 0 0 8px"}},null,8,["value"])]),_:1}),i(ne,{xs:24,md:12,lg:6},{default:l(()=>[i(pe,{compact:""},{default:l(()=>[i(ce,{value:b.search,"onUpdate:value":t[1]||(t[1]=v=>b.search=v),style:{width:"calc(100% - 80px)"},onInput:Q,placeholder:"Buscar por Nombre Evento"},null,8,["value"]),i(N,{type:"primary",disabled:b.search==="",onClick:J},{default:l(()=>t[8]||(t[8]=[x("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(ye,{bordered:"",scroll:{x:W.value,y:M.value},class:"table-fairs",columns:j,"data-source":z.value,pagination:!1,loading:T.value,size:"small"},{headerCell:l(({column:v,text:f})=>[v.dataIndex==="attendance_list_count"?(o(),C("span",Me,[t[9]||(t[9]=x(" INSCRITOS ")),h("span",$e,[i(S(Ce),{onClick:t[2]||(t[2]=ee=>P("desc")),style:ie({color:I.value==="desc"?"#e91e63":""})},null,8,["style"]),i(S(ke),{onClick:t[3]||(t[3]=ee=>P("asc")),style:ie({color:I.value==="asc"?"#e91e63":""})},null,8,["style"])])])):u("",!0)]),bodyCell:l(({column:v,record:f,index:ee})=>[v.dataIndex=="idx"?(o(),C(Y,{key:0},[x(U(K.value(ee)),1)],64)):u("",!0),v.dataIndex=="title"?(o(),C("span",ze,U(f.pnte)+" - "+U(f.title),1)):u("",!0),v.dataIndex=="slug"?(o(),p(le,{key:2,to:`/asistencias/${f.slug}`,target:"_blank"},{default:l(()=>[i(S(Ue),{class:"fair-link"})]),_:2},1032,["to"])):u("",!0),v.dataIndex=="modality"?(o(),C(Y,{key:3},[f.modality=="p"?(o(),p(V,{key:0,color:"blue"},{default:l(()=>t[10]||(t[10]=[x("PRESENCIAL")])),_:1})):u("",!0),f.modality=="v"?(o(),p(V,{key:1,color:"orange"},{default:l(()=>t[11]||(t[11]=[x("VIRTUAL")])),_:1})):u("",!0)],64)):u("",!0),v.dataIndex=="dateDiff"?(o(),C(Y,{key:4},[k(f.endDate2)<0?(o(),p(V,{key:0,color:"red"},{default:l(()=>t[12]||(t[12]=[x(" FINALIZADO ")])),_:1})):(o(),C("span",Pe,U(k(f.endDate2)),1))],64)):u("",!0),v.dataIndex=="actions"?(o(),p(fe,{key:5,trigger:["click"]},{overlay:l(()=>[i(ve,null,{default:l(()=>[i(B,null,{default:l(()=>[i(le,{to:`/asistencias/${f.slug}`,target:"_blank"},{default:l(()=>t[13]||(t[13]=[x(" Ver Link ")])),_:2},1032,["to"])]),_:2},1024),i(B,null,{default:l(()=>[h("a",{onClick:se=>X(f)},"Inscritos",8,Ve)]),_:2},1024),n([1,5])?(o(),p(B,{key:0},{default:l(()=>[h("a",{onClick:se=>R(f)},"Editar",8,Be)]),_:2},1024)):u("",!0),n([1,5])?(o(),p(B,{key:1},{default:l(()=>[i(_e,{placement:"rightBottom",title:`¿Quieres eliminar ${f.title} ?`,onConfirm:se=>a(f)},{icon:l(()=>[i(S(Re),{style:{color:"red"}})]),default:l(()=>[t[14]||(t[14]=h("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):u("",!0)]),_:2},1024)]),default:l(()=>[h("a",{class:"ant-dropdown-link",onClick:t[4]||(t[4]=Ae(()=>{},["prevent"]))},[i(N,{shape:"circle",icon:Te(S(Ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):u("",!0)]),_:1},8,["scroll","data-source","loading"])]),h("div",Ge,[h("span",null,[i(V,{color:"blue"},{default:l(()=>[h("b",null,U(L.value),1)]),_:1}),t[16]||(t[16]=x("Eventos creados"))]),i(ge,{size:"small",total:L.value,pageSize:F.value,onChange:Z,showSizeChanger:!1},null,8,["total","pageSize"])]),i(De,{open:g.value,"onUpdate:open":t[5]||(t[5]=v=>g.value=v),title:A.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:l(()=>[i(Fe,{onCloseDraw:E,dataRow:A.value},null,8,["dataRow"])]),_:1},8,["open","title"])],64)}}};export{Ke as default};
