import{r as V,u as D}from"./xlsx-04f2268f.js";import{r as x,a as M,k as O,b as o,o as c,d as m,c as a,w as t,e as s,j as r,t as k,z as F,s as N,i as j,F as U,v as q,h as b,m as R}from"./index-3d734e37.js";import{F as T}from"./FileExcelOutlined-3ac2270e.js";import{M as z}from"./MailOutlined-7c2cdd4e.js";const $={class:"email-wrapper"},G={style:{display:"flex",gap:"10px","align-items":"center"}},H={key:0,class:"email-list"},J={key:0,class:"info-card"},K={style:{display:"flex",gap:"10px","align-items":"center"}},Q={style:{color:"#00a6db"}},ae={__name:"pp03-index",setup(W){const h=x(!1),A=x([]),n=x([]),p=x(null),_=M({email:null}),B=async u=>{const e=["xls","xlsx"],d=u.name.split(".").pop().toLowerCase();if(!e.includes(d))return b.error("Por favor, sube un archivo Excel válido (.xls o .xlsx)."),!1;const f=new FileReader;return f.onload=v=>{const y=new Uint8Array(v.target.result),g=V(y,{type:"array"}),w=g.Sheets[g.SheetNames[0]];let l=D.sheet_to_json(w).map(i=>i.Email).filter(i=>!!i);l.length>300&&(b.warning(`Se cargaron solo los primeros 300 correos de un total de ${l.length}.`),l=l.slice(0,300)),n.value=l},f.readAsArrayBuffer(u),!1},I=async()=>{h.value=!0;const u={email:_.email,emails:n.value};try{const e=await R({url:"automatic/invitaciones-capacitaciones-pp093",method:"POST",data:u});e.status==200&&(b.success(e.message),n.value=[])}catch(e){b.error("Error al enviar invitaciones"),console.log("error",e)}finally{h.value=!1}};return O(async()=>{}),(u,e)=>{var i,C,L;const d=o("a-select-option"),f=o("a-select"),v=o("a-form-item"),y=o("a-button"),g=o("a-upload"),w=o("a-form"),E=o("a-card"),l=o("a-image");return c(),m("div",$,[a(E,{title:"Invitaciones a Capacitaciones PP093",bordered:""},{default:t(()=>[a(w,{layout:"vertical",onFinish:I,model:_},{default:t(()=>[a(v,{label:"Elegir un correo",name:"email",rules:[{required:!0,message:"Ingrese un título"}]},{default:t(()=>[a(f,{value:_.email,"onUpdate:value":e[0]||(e[0]=S=>_.email=S),placeholder:"Seleccionar correo de la lista",style:{width:"100%"}},{default:t(()=>[a(d,{value:"lista1"},{default:t(()=>e[1]||(e[1]=[r("Lista 1")])),_:1}),a(d,{value:"lista2"},{default:t(()=>e[2]||(e[2]=[r("Lista 2")])),_:1}),a(d,{value:"lista3"},{default:t(()=>e[3]||(e[3]=[r("Lista 3")])),_:1})]),_:1},8,["value"])]),_:1}),a(v,{label:"Lista de correos (Excel)"},{default:t(()=>[s("div",G,[a(g,{"before-upload":B,"file-list":A.value,"show-upload-list":!1,accept:".xls,.xlsx"},{default:t(()=>[a(y,{type:"primary",icon:N(j(T)),style:{"background-color":"#006e37"}},{default:t(()=>e[4]||(e[4]=[r(" Seleccionar Lista ")])),_:1},8,["icon"])]),_:1},8,["file-list"]),a(y,{"html-type":"submit",loading:h.value,type:"primary",disabled:n.value.length===0,icon:N(j(z))},{default:t(()=>e[5]||(e[5]=[r(" Enviar Invitaciones ")])),_:1},8,["loading","disabled","icon"])])]),_:1})]),_:1},8,["model"]),n.value.length>0?(c(),m("div",H,[e[6]||(e[6]=s("h4",null,"Correos cargados:",-1)),s("ol",null,[(c(!0),m(U,null,q(n.value,(S,P)=>(c(),m("li",{key:P},k(S),1))),128))])])):F("",!0)]),_:1}),p.value?(c(),m("div",J,[s("p",null,[e[7]||(e[7]=r("Correo usado: ")),s("b",null,k((i=p.value)==null?void 0:i.emailAccount),1)]),s("div",K,[e[8]||(e[8]=s("p",null,"Cantidad enviada:",-1)),s("h3",Q,k((C=p.value)==null?void 0:C.count),1)]),a(l,{width:200,src:(L=p.value)==null?void 0:L.image},null,8,["src"])])):F("",!0)])}}};export{ae as default};
