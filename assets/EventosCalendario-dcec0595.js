import{_ as Q}from"./TableComponent-b58a73f2.js";import{r as _,a as j,l as g,j as B,T as K,b,o as r,d as y,c as u,w as d,e as h,F as T,q as W,v as x,x as v,h as $,i as O,t as S,m as A,K as F,a5 as V,a0 as Z}from"./index-62266265.js";import"./downloadExcel-5a422933.js";/* empty css             */import{u as J}from"./selectes-b886f1d3.js";import{Q as X}from"./quill.snow-7427a127.js";import{_ as ee}from"./DrawResultados-aa3054c4.js";import"./es-b43b0347.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-0087e1f1.js";const te={class:"grid-events"},ae={style:{display:"flex",margin:"1rem 0 .5rem"}},ne={key:3,class:"grid-events-hour"},le={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup(G,{emit:U}){const E=J();E.$patch({officesPnte:E.officesPnte}),E.fetchOfficesPnte(),E.$patch({cities:E.cities}),E.fetchCities();const C=U,p=G,w=_(!1),D={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},H=_([{dates:new Date}]),f=_({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},city_id:{type:"iSelectWrite",label:"SELECCIONAR REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!1,message:"",disabled:!1,max:100},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),e=j({allDay:1});_([{start:null,end:g().subtract(0,"day").format("YYYY-MM-DD")}]);const q=a=>a==="id_pnte"?E.officesPnte:[],N={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},R=a=>{if(a==2||a==7){const o=Object.entries(f.value),c=o.findIndex(([n])=>n==="city_id"),i=[...o.slice(0,c+1),...Object.entries(N),...o.slice(c+1)];f.value=Object.fromEntries(i)}else{const o={...f.value};delete o.organiza,delete o.numMypes,f.value=o}},I=(a,o)=>{const c=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(c)},P=async()=>{if(!e.date)return A.warning("Debes de seleccionar una fecha del calendario");const a={id_pnte:e.id_pnte,title:e.title,...e.organiza&&{organiza:e.organiza},...e.numMypes&&{numMypes:e.numMypes},dateStart:g(e.date.start).format("YYYY-MM-DD"),dateEnd:g(e.date.end).format("YYYY-MM-DD"),city_id:e.city_id,place:e.place,...e.hours?{start:g(e.hours[0]).format("HH:mm"),end:g(e.hours[1]).format("HH:mm")}:{start:null,end:null},description:e.description,nameUser:e.nameUser,link:e.link};w.value=!0;try{const o=p.dataRow?`event/update/${p.dataRow.id}`:"event/create",c=p.dataRow?"PUT":"POST",i=await F({url:o,method:c,data:a});i.status===200&&(A.success(i.message),e.title="",e.hours=[],e.organiza="",e.numMypes="",e.description="</p>",e.nameUser="",e.link="",e.date=null,C("closeDraw"))}catch(o){A.error(o.message)}finally{w.value=!1}},L=()=>{e.id_pnte=null,e.numMypes="",e.organiza="",e.title="",e.description="</p>",e.nameUser="",e.link="",e.date=null},Y=a=>{if(a){if(e.id_pnte=a.id_pnte,a.id_pnte==2||a.id_pnte==7){const o=Object.entries(f.value),c=o.findIndex(([n])=>n==="title"),i=[...o.slice(0,c+1),...Object.entries(N),...o.slice(c+1)];f.value=Object.fromEntries(i)}e.numMypes=a.numMypes,e.organiza=a.organiza,e.title=a.title,e.description=a.description,e.nameUser=a.nameUser,e.link=a.link,e.date={start:g(a.dateStart).toISOString(),end:g(a.dateEnd).toISOString()},a.start&&a.end?e.hours=[g(a.start,"HH:mm"),g(a.end,"HH:mm")]:e.hours=[]}};return B(()=>{p.dataRow&&Y(p.dataRow)}),K(()=>p.dataRow,a=>{a?Y(a):L()}),(a,o)=>{const c=b("a-select"),i=b("a-form-item"),n=b("a-input"),l=b("VDatePicker"),M=b("a-time-range-picker"),k=b("a-button"),z=b("a-form");return r(),y("div",null,[u(z,{class:"form-events",layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:P},{default:d(()=>[h("div",te,[(r(!0),y(T,null,W(f.value,(t,m)=>(r(),y(T,{key:m},[t.type==="iSelect"?(r(),x(i,{key:0,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:d(()=>[u(c,{value:e[t.name],"onUpdate:value":s=>e[t.name]=s,options:q(t.name),"show-search":"","filter-option":I,onChange:R},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iText"?(r(),x(i,{key:1,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:d(()=>[u(n,{value:e[t.name],"onUpdate:value":s=>e[t.name]=s,maxlength:t.max,disabled:t.disabled,placeholder:t.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iDate"?(r(),x(i,{key:2,name:t.name,label:t.label},{default:d(()=>[u(l,{modelValue:e[t.name],"onUpdate:modelValue":s=>e[t.name]=s,modelModifiers:{range:!0},mode:"date",attributes:H.value},null,8,["modelValue","onUpdate:modelValue","attributes"]),h("div",ae,[h("div",null,[o[1]||(o[1]=h("label",{style:{display:"block"},for:""},"HORARIO",-1)),u(M,{minuteStep:30,value:e.hours,"onUpdate:value":o[0]||(o[0]=s=>e.hours=s),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):v("",!0),t.type==="iSwitch"?(r(),y("div",ne)):v("",!0),t.type==="iTextArea"?(r(),x(i,{key:4,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:d(()=>[u($(X),{class:"quill-editor",content:e[t.name],"onUpdate:content":s=>e[t.name]=s,options:D,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):v("",!0),t.type==="iSelectWrite"?(r(),x(i,{key:5,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:d(()=>[t.name=="city_id"?(r(),x(c,{key:0,value:e[t.name],"onUpdate:value":s=>e[t.name]=s,options:$(E).cities,"show-search":"","filter-option":I,disabled:t.disabled},null,8,["value","onUpdate:value","options","disabled"])):v("",!0)]),_:2},1032,["name","label","rules"])):v("",!0)],64))),128))]),u(i,null,{default:d(()=>[u(k,{type:"primary","html-type":"submit",loading:w.value,style:{"margin-top":"1rem"}},{default:d(()=>[O(S(p.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const se={class:"advisory-table"},oe={key:0},ie={key:1},re={key:0},de={key:1},ue=["onClick"],me=["onClick"],we={__name:"EventosCalendario",setup(G){JSON.parse(localStorage.getItem("role"));const U=_([]),E=_(0),C=_(150),p=_(null),w=_(!1),D=_(!1),H=_(!1),f=_(!1);_(null);const e=j({asesor:null,name:null,page:1}),q=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"OFICINA",fixed:"left",dataIndex:"office",width:80,align:"center"},{title:"TIPO DE ACTIVIDAD",fixed:"left",dataIndex:"area",width:120,align:"center"},{title:"TÍTULO",dataIndex:"title",width:200},{title:"REGIÓN",dataIndex:"city",width:140},{title:"LUGAR",dataIndex:"place",width:180},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"resultado",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],N=n=>{p.value=n.all,w.value=!0},R=n=>g(n).format("DD/MM/YYYY"),I=n=>g(n,"HH:mm:ss").format("HH:mm"),P=()=>{p.value=null,f.value=!0},L=async()=>{},Y=async n=>{try{const l=await F({url:`event/delete/${n.id}`,method:"DELETE"});l.status==200&&(A.success(l.message),i())}catch{console.log("Failed to delete")}},a=async n=>{e.page=n,await i()},o=async n=>{n&&(e.page=1,await i())},c=n=>{p.value=n.all,f.value=!0},i=async()=>{D.value=!0;try{const n={page:e.page};e.year&&(n.year=g(e.year).format("YYYY")),e.name&&(n.name=e.name),e.range&&(n.dateStart=e.range[0].format("YYYY/MM/DD"),n.dateEnd=e.range[1].format("YYYY/MM/DD")),e.offices&&(n.offices=e.offices);const l=await F({url:"event/list",method:"GET",params:n});U.value=l.data.data,E.value=l.data.total,C.value=l.data.per_page}catch(n){console.error("Error de red:",n)}finally{D.value=!1}};return B(async()=>{await i()}),V("search",e),V("loading",D),V("loadingFile",H),(n,l)=>{const M=b("a-tag"),k=b("a-menu-item"),z=b("a-popconfirm"),t=b("a-drawer");return r(),y("div",se,[u(Q,{title:"EVENTOS PNTE",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",tipooficina:!0,columns:q,titleSearch:"NOMBRE DEL EVENTO",pageSize:C.value,nameTotal:"Eventos",rangeDate:!0,dataSource:U.value,total:E.value,onHandleNew:P,onHandleDownloadExcel:L,onHandleSearch:o,onHandlePaginator:a},{"data-cell":d(({column:m,record:s})=>[m.dataIndex=="office"?(r(),y(T,{key:0},[s.office=="UGO"?(r(),x(M,{key:0,color:"blue"},{default:d(()=>l[4]||(l[4]=[O("UGO")])),_:1})):v("",!0),s.office=="UGSE"?(r(),x(M,{key:1,color:"red"},{default:d(()=>l[5]||(l[5]=[O("UGSE")])),_:1})):v("",!0)],64)):v("",!0),m.dataIndex=="date"?(r(),y(T,{key:1},[s.dateStart!=s.dateEnd?(r(),y("span",oe,[l[6]||(l[6]=h("b",null,"Desde:",-1)),O(" "+S(R(s.dateStart))+" ",1),l[7]||(l[7]=h("b",null,"Hasta:",-1)),O(" "+S(R(s.dateEnd)),1)])):(r(),y("span",ie,S(R(s.dateStart)),1))],64)):v("",!0),m.dataIndex=="hours"?(r(),y(T,{key:2},[s.start?(r(),y("span",de,S(I(s.start))+" - "+S(I(s.end)),1)):(r(),y("span",re,"Todo el día"))],64)):v("",!0)]),"custom-options":d(({record:m})=>[u(k,null,{default:d(()=>[h("a",{onClick:s=>N(m)},"Resultados",8,ue)]),_:2},1024),u(k,null,{default:d(()=>[h("a",{onClick:s=>c(m)},"Editar",8,me)]),_:2},1024),u(k,null,{default:d(()=>[u(z,{placement:"rightBottom",title:`¿Quieres eliminar ${m.title} ?`,onConfirm:s=>Y(m)},{icon:d(()=>[u($(Z),{style:{color:"red"}})]),default:d(()=>[l[8]||(l[8]=h("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),u(t,{width:"500",title:"EVENTO PNTE",open:f.value,"onUpdate:open":l[1]||(l[1]=m=>f.value=m),placement:"right"},{default:d(()=>[u(le,{dataRow:p.value,onCloseDraw:l[0]||(l[0]=m=>(f.value=!1,i()))},null,8,["dataRow"])]),_:1},8,["open"]),u(t,{open:w.value,"onUpdate:open":l[3]||(l[3]=m=>w.value=m),title:"RESULTADOS",placement:"right",width:"550"},{default:d(()=>[u(ee,{dataRow:p.value,onCloseDraw:l[2]||(l[2]=m=>{w.value=!1,i()})},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{we as default};
