import{_ as Q}from"./TableComponent-382a1d65.js";import{r as _,a as j,l as g,j as B,T as K,b as y,o as d,d as v,c as u,w as r,e as E,F as I,q as Z,v as S,x as h,h as G,i as O,t as x,m as H,K as $,a5 as V,a0 as J}from"./index-e79988f3.js";import"./downloadExcel-09cb73b6.js";import{_ as W}from"./DrawResultados-6c2b9eb7.js";import{u as X}from"./selectes-43282fae.js";import{Q as ee}from"./quill.snow-d9b7b900.js";import"./es-31dcee15.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-8f297f64.js";const te={class:"grid-events"},ae={style:{display:"flex",margin:"1rem 0 .5rem"}},ne={key:3,class:"grid-events-hour"},le={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup(F,{emit:T}){const w=X();w.$patch({officesPnte:w.officesPnte}),w.fetchOfficesPnte();const U=T,c=F,b=_(!1),D={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},A=_([{dates:new Date}]),p=_({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),e=j({allDay:1});_([{start:null,end:g().subtract(0,"day").format("YYYY-MM-DD")}]);const P=a=>a==="id_pnte"?w.officesPnte:[],C={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},R=a=>{if(a==2||a==7){const s=Object.entries(p.value),f=s.findIndex(([n])=>n==="title"),i=[...s.slice(0,f+1),...Object.entries(C),...s.slice(f+1)];p.value=Object.fromEntries(i)}else{const s={...p.value};delete s.organiza,delete s.numMypes,p.value=s}},Y=(a,s)=>{const f=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(f)},z=async()=>{if(!e.date)return H.warning("Debes de seleccionar una fecha del calendario");const a={id_pnte:e.id_pnte,title:e.title,...e.organiza&&{organiza:e.organiza},...e.numMypes&&{numMypes:e.numMypes},dateStart:g(e.date.start).format("YYYY-MM-DD"),dateEnd:g(e.date.end).format("YYYY-MM-DD"),...e.hours?{start:g(e.hours[0]).format("HH:mm"),end:g(e.hours[1]).format("HH:mm")}:{start:null,end:null},description:e.description,nameUser:e.nameUser,link:e.link};b.value=!0;try{const s=c.dataRow?`event/update/${c.dataRow.id}`:"event/create",f=c.dataRow?"PUT":"POST",i=await $({url:s,method:f,data:a});i.status===200&&(H.success(i.message),e.title="",e.hours=[],e.organiza="",e.numMypes="",e.description="</p>",e.nameUser="",e.link="",e.date=null,U("closeDraw"))}catch(s){H.error(s.message)}finally{b.value=!1}},q=()=>{e.id_pnte=null,e.numMypes="",e.organiza="",e.title="",e.description="</p>",e.nameUser="",e.link="",e.date=null},M=a=>{if(a){if(e.id_pnte=a.id_pnte,a.id_pnte==2||a.id_pnte==7){const s=Object.entries(p.value),f=s.findIndex(([n])=>n==="title"),i=[...s.slice(0,f+1),...Object.entries(C),...s.slice(f+1)];p.value=Object.fromEntries(i)}e.numMypes=a.numMypes,e.organiza=a.organiza,e.title=a.title,e.description=a.description,e.nameUser=a.nameUser,e.link=a.link,e.date={start:g(a.dateStart).toISOString(),end:g(a.dateEnd).toISOString()},a.start&&a.end?e.hours=[g(a.start,"HH:mm"),g(a.end,"HH:mm")]:e.hours=[]}};return B(()=>{c.dataRow&&M(c.dataRow)}),K(()=>c.dataRow,a=>{a?M(a):q()}),(a,s)=>{const f=y("a-select"),i=y("a-form-item"),n=y("a-input"),l=y("VDatePicker"),N=y("a-time-range-picker"),k=y("a-button"),L=y("a-form");return d(),v("div",null,[u(L,{class:"form-events",layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:z},{default:r(()=>[E("div",te,[(d(!0),v(I,null,Z(p.value,(t,m)=>(d(),v(I,{key:m},[t.type==="iSelect"?(d(),S(i,{key:0,class:"item-max",name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:r(()=>[u(f,{value:e[t.name],"onUpdate:value":o=>e[t.name]=o,options:P(t.name),"show-search":"","filter-option":Y,onChange:R},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):h("",!0),t.type==="iText"?(d(),S(i,{key:1,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:r(()=>[u(n,{value:e[t.name],"onUpdate:value":o=>e[t.name]=o,maxlength:t.max,disabled:t.disabled,placeholder:t.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):h("",!0),t.type==="iDate"?(d(),S(i,{key:2,name:t.name,label:t.label},{default:r(()=>[u(l,{modelValue:e[t.name],"onUpdate:modelValue":o=>e[t.name]=o,modelModifiers:{range:!0},mode:"date",attributes:A.value},null,8,["modelValue","onUpdate:modelValue","attributes"]),E("div",ae,[E("div",null,[s[1]||(s[1]=E("label",{style:{display:"block"},for:""},"HORARIO",-1)),u(N,{minuteStep:30,value:e.hours,"onUpdate:value":s[0]||(s[0]=o=>e.hours=o),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):h("",!0),t.type==="iSwitch"?(d(),v("div",ne)):h("",!0),t.type==="iTextArea"?(d(),S(i,{key:4,name:t.name,label:t.label,rules:[{required:t.required,message:t.message}]},{default:r(()=>[u(G(ee),{class:"quill-editor",content:e[t.name],"onUpdate:content":o=>e[t.name]=o,options:D,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):h("",!0)],64))),128))]),u(i,null,{default:r(()=>[u(k,{type:"primary","html-type":"submit",loading:b.value,style:{"margin-top":"1rem"}},{default:r(()=>[O(x(c.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const se={class:"advisory-table"},oe={key:0},ie={key:1},re={key:0},de={key:1},ue=["onClick"],me=["onClick"],be={__name:"EventosCalendario",setup(F){JSON.parse(localStorage.getItem("role"));const T=_([]),w=_(0),U=_(150),c=_(null),b=_(!1),D=_(!1),A=_(!1),p=_(!1);_(null);const e=j({asesor:null,name:null,page:1}),P=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"OFICINA",fixed:"left",dataIndex:"office",width:80,align:"center"},{title:"ÁREA",fixed:"left",dataIndex:"area",width:180},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"resultado",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],C=n=>{c.value=n.all,b.value=!0},R=n=>g(n).format("DD/MM/YYYY"),Y=n=>g(n,"HH:mm:ss").format("HH:mm"),z=()=>{c.value=null,p.value=!0},q=async()=>{},M=async n=>{try{const l=await $({url:`event/delete/${n.id}`,method:"DELETE"});l.status==200&&(H.success(l.message),i())}catch{console.log("Failed to delete")}},a=async n=>{e.page=n,await i()},s=async n=>{n&&(e.page=1,await i())},f=n=>{c.value=n.all,p.value=!0},i=async()=>{D.value=!0;try{const n={page:e.page};e.year&&(n.year=g(e.year).format("YYYY")),e.name&&(n.name=e.name),e.range&&(n.dateStart=e.range[0].format("YYYY/MM/DD"),n.dateEnd=e.range[1].format("YYYY/MM/DD")),e.offices&&(n.offices=e.offices);const l=await $({url:"event/list",method:"GET",params:n});T.value=l.data.data,w.value=l.data.total,U.value=l.data.per_page}catch(n){console.error("Error de red:",n)}finally{D.value=!1}};return B(async()=>{await i()}),V("search",e),V("loading",D),V("loadingFile",A),(n,l)=>{const N=y("a-tag"),k=y("a-menu-item"),L=y("a-popconfirm"),t=y("a-drawer");return d(),v("div",se,[u(Q,{title:"EVENTOS PNTE",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",tipooficina:!0,columns:P,titleSearch:"NOMBRE DEL EVENTO",pageSize:U.value,nameTotal:"Eventos",rangeDate:!0,dataSource:T.value,total:w.value,onHandleNew:z,onHandleDownloadExcel:q,onHandleSearch:s,onHandlePaginator:a},{"data-cell":r(({column:m,record:o})=>[m.dataIndex=="office"?(d(),v(I,{key:0},[o.office=="UGO"?(d(),S(N,{key:0,color:"blue"},{default:r(()=>l[4]||(l[4]=[O("UGO")])),_:1})):h("",!0),o.office=="UGSE"?(d(),S(N,{key:1,color:"red"},{default:r(()=>l[5]||(l[5]=[O("UGSE")])),_:1})):h("",!0)],64)):h("",!0),m.dataIndex=="date"?(d(),v(I,{key:1},[o.dateStart!=o.dateEnd?(d(),v("span",oe,[l[6]||(l[6]=E("b",null,"Desde:",-1)),O(" "+x(R(o.dateStart))+" ",1),l[7]||(l[7]=E("b",null,"Hasta:",-1)),O(" "+x(R(o.dateEnd)),1)])):(d(),v("span",ie,x(R(o.dateStart)),1))],64)):h("",!0),m.dataIndex=="hours"?(d(),v(I,{key:2},[o.start?(d(),v("span",de,x(Y(o.start))+" - "+x(Y(o.end)),1)):(d(),v("span",re,"Todo el día"))],64)):h("",!0)]),"custom-options":r(({record:m})=>[u(k,null,{default:r(()=>[E("a",{onClick:o=>C(m)},"Resultados",8,ue)]),_:2},1024),u(k,null,{default:r(()=>[E("a",{onClick:o=>f(m)},"Editar",8,me)]),_:2},1024),u(k,null,{default:r(()=>[u(L,{placement:"rightBottom",title:`¿Quieres eliminar ${m.title} ?`,onConfirm:o=>M(m)},{icon:r(()=>[u(G(J),{style:{color:"red"}})]),default:r(()=>[l[8]||(l[8]=E("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),u(t,{width:"500",title:"EVENTO PNTE",open:p.value,"onUpdate:open":l[1]||(l[1]=m=>p.value=m),placement:"right"},{default:r(()=>[u(le,{dataRow:c.value,onCloseDraw:l[0]||(l[0]=m=>(p.value=!1,i()))},null,8,["dataRow"])]),_:1},8,["open"]),u(t,{open:b.value,"onUpdate:open":l[3]||(l[3]=m=>b.value=m),title:"RESULTADOS",placement:"right",width:"550"},{default:r(()=>[u(W,{dataRow:c.value,onCloseDraw:l[2]||(l[2]=m=>{b.value=!1,i()})},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{be as default};
