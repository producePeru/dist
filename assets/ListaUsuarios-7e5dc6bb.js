import{L as ce,r as n,a as ne,b as u,o,q as g,w as l,e as y,d as U,F as x,x as pe,h as z,s as r,c as d,M as me,t as _,i as v,z as M,m as R,k as oe,K as ae,u as fe,v as _e,I as ve,J as he,N as ge}from"./index-06cb9dfe.js";import{u as se}from"./selectes-de8c5c4f.js";import{f as ye}from"./actualizarUsuario-3eaca126.js";import"./es-52b9c26f.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";import{M as be}from"./MoreOutlined-b45d3f74.js";const we={class:"grid-profile"},Ue="YYYY-MM-DD",xe={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(F,{emit:q}){ce.locale("es");const a=se(),V=JSON.parse(localStorage.getItem("profile")),D=q;a.$patch({genders:a.genders}),a.$patch({cdes:a.cdes}),a.$patch({Offices:a.Offices}),a.$patch({roles:a.roles}),a.$patch({supervisores:a.supervisores}),a.fetchGenders(),a.fetchCdes(),a.fetchOffices(),a.fetchRoles();const C=F,I=n(!1),s=n(ye),A=n(null),t=ne({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:V.id}),N=i=>{i&&(t.name=i.profile.name,t.lastname=i.profile.lastname,t.middlename=i.profile.middlename,t.birthday=i.profile.birthday,t.sick=i.profile.sick,t.phone=i.profile.phone,t.gender_id=i.profile.gender_id,t.cde_id=i.profile.cde_id,t.office_id=i.profile.office_id,t.email=i.email)},c=i=>{const w={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(i===2)a.fetchSupervisores(),s.value={...s.value,supervisor_id:w};else{const{supervisor_id:S,...E}=s.value;s.value=E}},h=async()=>{I.value=!0;let i=t;delete i.email;try{const w=await M({url:`user/update/${C.updateUser.profile.id}`,method:"PUT",data:i});R.success(w.message),D("closeDraw",!0)}catch{R.error("No se pudo registrar este usuario")}finally{I.value=!1}},$=()=>{R.error("Debes de completar todos los espacios requeridos")};return(i,w)=>{const S=u("a-select"),E=u("a-form-item"),L=u("a-input"),G=u("a-date-picker"),P=u("a-button"),m=u("a-form");return o(),g(m,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:h,onFinishFailed:$},{default:l(()=>[y("div",we,[(o(!0),U(x,null,pe(s.value,(e,O)=>(o(),U(x,{key:O},[e.type==="iSelect"?(o(),g(E,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[e.name=="gender_id"?(o(),g(S,{key:0,value:t[e.name],"onUpdate:value":f=>t[e.name]=f,options:z(a).genders},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="cde_id"?(o(),g(S,{key:1,value:t[e.name],"onUpdate:value":f=>t[e.name]=f,options:z(a).cdes},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="office_id"?(o(),g(S,{key:2,value:t[e.name],"onUpdate:value":f=>t[e.name]=f,options:z(a).Offices},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="role_id"?(o(),g(S,{key:3,value:t[e.name],"onUpdate:value":f=>t[e.name]=f,options:z(a).roles,onChange:c},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="supervisor_id"?(o(),g(S,{key:4,value:t[e.name],"onUpdate:value":f=>t[e.name]=f,options:z(a).supervisores},null,8,["value","onUpdate:value","options"])):r("",!0)]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iText"?(o(),g(E,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:l(()=>[d(L,{value:t[e.name],"onUpdate:value":f=>t[e.name]=f,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iDate"?(o(),g(E,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:l(()=>[d(G,{locale:z(me),value:A.value,"onUpdate:value":w[0]||(w[0]=f=>A.value=f),style:{width:"100%"},format:Ue},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):r("",!0)],64))),128))]),y("div",null,_(N(C.updateUser)),1),d(E,null,{default:l(()=>[d(P,{class:"btn-produce",type:"primary","html-type":"submit",loading:I.value},{default:l(()=>[v("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},Ce=ke(xe,[["__scopeId","data-v-3578053d"]]),Ie=y("br",null,null,-1),De=y("br",null,null,-1),Se={__name:"DrawAdministrarVistasUsuario",props:["idUser"],emits:["closeDraw"],setup(F,{emit:q}){const a=F,V=q,D=n(!0),C=n(!1),I=["home","asesorias","asesorias-formalizaciones","solicitudes","solicitantes","notarias","asesores","supervisores","usuarios","usuarios-nuevo","usuarios-lista","drive-mis-archivos","drive-subir-archivo","drive-mis-carpetas","convenios","estado-convenio"];oe(()=>{a.idUser&&N(a.idUser)});const s=ne({indeterminate:!0,checkAll:!1,checkedList:[]}),A=c=>{Object.assign(s,{checkedList:c.target.checked?I:[],indeterminate:!1})};ae(()=>s.checkedList,c=>{s.indeterminate=!!c.length&&c.length<I.length,s.checkAll=c.length===I.length}),ae(()=>a.idUser,c=>{c&&N()});const t=async()=>{C.value=!0;const c={views:s.checkedList};try{const h=await M({url:`user/views/${a.idUser.id}`,method:"PUT",data:c});if(h.status==403)return R.error(h.message);R.success(h.message),V("closeDraw",!0)}catch{R.error("No se pudo registrar este usuario")}finally{C.value=!1}},N=async()=>{D.value=!0;try{const{data:c}=await M({url:`user/views/${a.idUser.id}`,method:"GET"});s.checkedList=c}catch(c){console.log("Error",c)}finally{D.value=!1}};return(c,h)=>{const $=u("a-checkbox"),i=u("a-divider"),w=u("a-checkbox-group"),S=u("a-spin"),E=u("a-button");return o(),U(x,null,[y("div",null,[d($,{checked:s.checkAll,"onUpdate:checked":h[0]||(h[0]=L=>s.checkAll=L),indeterminate:s.indeterminate,onChange:A},{default:l(()=>[v(_(s.checkAll?"Desactivar":"Activar")+" todos ",1)]),_:1},8,["checked","indeterminate"])]),d(i),d(S,{spinning:D.value},{default:l(()=>[d(w,{value:s.checkedList,"onUpdate:value":h[1]||(h[1]=L=>s.checkedList=L),options:I,style:{display:"grid","grid-template-columns":"repeat(2,1fr)",gap:".5rem"}},null,8,["value"])]),_:1},8,["spinning"]),Ie,De,d(E,{type:"primary","html-type":"submit",loading:C.value,onClick:t},{default:l(()=>[v("GUARDAR")]),_:1},8,["loading"])],64)}}};const Ee=y("h3",{class:"title-produce"},"USUARIOS",-1),Ae=y("br",null,null,-1),$e=["onClick"],Le=["onClick"],Oe={class:"paginator"},te=50,Fe={__name:"ListaUsuarios",setup(F){const q=se();q.$patch({cdes:q.cdes});const a=n(!1),V=m=>{console.log("open",m)},D=n(null);n(!1),n(!1),n(!1);const C=n(!1);n(0),n(!1),n(!1),n(!1),n("solicitante"),n(5);const I=n([]),s=n(!1),A=n(0);fe();const t=n({page:1});n("");const N=n("user/list");n([]),n(null);const c=n(1200),h=n(window.innerHeight-100),$=()=>{h.value=window.innerHeight-300};_e(()=>{window.removeEventListener("resize",$)});const i=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:80},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"ROL",dataIndex:"role",width:160},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],w=()=>{G(),a.value=!1,C.value=!1},S=m=>{t.value.page=m,G()},E=m=>{D.value=m,a.value=!0},L=m=>{D.value=m,C.value=!0},G=async()=>{try{s.value=!0;let m=t.value.page==1?"":t.value;const e=await M({url:N.value,method:"GET",params:m});I.value=e.data,A.value=e.total}catch(m){console.error("Error de red:",m)}finally{s.value=!1}},P=ve(()=>m=>(t.value.page-1)*te+m+1);return oe(()=>{G(),window.addEventListener("resize",$),$()}),(m,e)=>{const O=u("a-tag"),f=u("a-button"),T=u("a-menu-item"),le=u("a-menu"),ie=u("a-dropdown"),re=u("a-table"),de=u("a-pagination"),B=u("a-drawer");return o(),U(x,null,[y("div",null,[Ee,Ae,d(re,{bordered:"",scroll:{x:c.value,y:h.value},class:"table-users",columns:i,"data-source":I.value,pagination:!1,loading:s.value,size:"small"},{bodyCell:l(({column:k,record:p,index:ue})=>{var Y,j,H,J,K,X,Q,W,Z,ee;return[k.dataIndex=="idx"?(o(),U(x,{key:0},[v(_(P.value(ue)),1)],64)):r("",!0),k.dataIndex=="documentnumber"?(o(),U(x,{key:1},[v(_((Y=p.profile)==null?void 0:Y.documentnumber),1)],64)):r("",!0),k.dataIndex=="name"?(o(),U(x,{key:2},[v(_((j=p.profile)==null?void 0:j.name),1)],64)):r("",!0),k.dataIndex=="lastname"?(o(),U(x,{key:3},[v(_((H=p.profile)==null?void 0:H.lastname)+" "+_((J=p.profile)==null?void 0:J.middlename),1)],64)):r("",!0),k.dataIndex=="phone"?(o(),U(x,{key:4},[v(_((K=p.profile)==null?void 0:K.phone),1)],64)):r("",!0),k.dataIndex=="office"?(o(),U(x,{key:5},[((X=p.profile)==null?void 0:X.office.name)=="UGSE"?(o(),g(O,{key:0,color:"blue"},{default:l(()=>{var b;return[v(_((b=p.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((Q=p.profile)==null?void 0:Q.office.name)=="UGO"?(o(),g(O,{key:1,color:"orange"},{default:l(()=>{var b;return[v(_((b=p.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((W=p.profile)==null?void 0:W.office.name)=="DE"?(o(),g(O,{key:2,color:"green"},{default:l(()=>{var b;return[v(_((b=p.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0),((Z=p.profile)==null?void 0:Z.office.name)=="UGEER"?(o(),g(O,{key:3,color:"gray"},{default:l(()=>{var b;return[v(_((b=p.profile)==null?void 0:b.office.name),1)]}),_:2},1024)):r("",!0)],64)):r("",!0),k.dataIndex=="cde"?(o(),U(x,{key:6},[v(_((ee=p.profile)==null?void 0:ee.cde.name),1)],64)):r("",!0),k.dataIndex=="role"?(o(),U(x,{key:7},[v(_(p.roles[0].name),1)],64)):r("",!0),k.dataIndex=="actions"?(o(),g(ie,{key:8,trigger:["click"]},{overlay:l(()=>[d(le,null,{default:l(()=>[d(T,null,{default:l(()=>[y("a",{onClick:b=>E(p)},"Editar",8,$e)]),_:2},1024),d(T,null,{default:l(()=>[y("a",{onClick:b=>L(p)},"Vistas",8,Le)]),_:2},1024)]),_:2},1024)]),default:l(()=>[y("a",{class:"ant-dropdown-link",onClick:e[0]||(e[0]=he(()=>{},["prevent"]))},[d(f,{shape:"circle",icon:ge(z(be)),size:"small"},null,8,["icon"])])]),_:2},1024)):r("",!0)]}),_:1},8,["scroll","data-source","loading"])]),y("div",Oe,[y("span",null,[d(O,{color:"blue"},{default:l(()=>[y("b",null,_(A.value),1)]),_:1}),v("Usuarios")]),d(de,{size:"small",total:A.value,pageSize:te,onChange:S,showSizeChanger:!1},null,8,["total"])]),d(B,{open:a.value,"onUpdate:open":e[1]||(e[1]=k=>a.value=k),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:V},{default:l(()=>[d(Ce,{updateUser:D.value,onCloseDraw:w},null,8,["updateUser"])]),_:1},8,["open"]),d(B,{width:"450",open:C.value,"onUpdate:open":e[2]||(e[2]=k=>C.value=k),class:"draw-notary",title:"Administrar Vistas",placement:"right"},{default:l(()=>[d(Se,{idUser:D.value,onCloseDraw:w},null,8,["idUser"])]),_:1},8,["open"])],64)}}};export{Fe as default};
