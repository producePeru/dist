import{_ as j}from"./TableComponent-d850761c.js";import{p as _,r as s,a as G,k as z,T as Z,W as I,o as c,y as L,i as F,L as J,d as m,c as p,h as B,m as V,b as k,w as f,F as H,j as O,z as Y,e as b,t as x,a2 as K}from"./index-0c2f6455.js";import{d as W}from"./downloadExcel-df70d755.js";import{_ as X}from"./FormComponent-4dded9d2.js";import{u as ee}from"./selectes-38dffded.js";import"./es-3651b87c.js";import{_ as te}from"./DrawResultados-6af33883.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-57c1f7bc.js";import"./quill.snow-8d150889.js";const ae={key:1,class:"f-20"},ie={__name:"DrawEventosCalendario",props:["info"],emits:["closeDraw"],setup(q,{emit:T}){_.locale("es");const v=s({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÌTULO DEL EVENTO",name:"title",required:!0,message:"Escribir el título del evento",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA",name:"province_id",required:!1,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO",name:"district_id",required:!1,message:"Seleccionar distrito",disabled:!0},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!1,message:"",disabled:!1,max:100},organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iNumber",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100},date:{type:"iDatePicker",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iQuillEditor",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:255}}),l=ee(),y=T,u=q,S=s(!1),h=s("GUARDAR"),e=G({}),n=s(!1),M=s(null),d=s({id_pnte:[],city_id:[],province_id:[],district_id:[]}),D=async a=>{a=="city_id"&&(console.log("city_id kakakaka"),await l.fetchProvinces(e.city_id),d.value.province_id=l.provinces,v.value.province_id.disabled=!1),a=="province_id"&&(await l.fetchDistricts(e.province_id),d.value.district_id=l.districts,v.value.district_id.disabled=!1)},N=async a=>{a=="id_pnte"&&(await l.fetchOfficesPnte(),d.value.id_pnte=l.officesPnte),a=="city_id"&&(await l.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,d.value.province_id=[],d.value.city_id=l.cities),a=="province_id"&&(e.province_id=null,e.district_id=null,d.value.district_id=[])},U=async()=>{if(!e.date)return B.warning("Debes de seleccionar una fecha del calendario");n.value=!0;const a={id_pnte:e.id_pnte,title:e.title,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,place:e.place,dateStart:_(e.date.start).format("YYYY-MM-DD"),dateEnd:_(e.date.end).format("YYYY-MM-DD"),organiza:e.organiza,numMypes:e.numMypes,description:e.description,nameUser:e.nameUser,link:e.link};try{const g=u.info?`event/update/${u.info.id}`:"event/create",w=u.info?"PUT":"POST";(await V({url:g,method:w,data:a})).status===200&&(C(),y("closeDraw",!0))}catch(g){console.error("Error:",g);const w=document.getElementsByClassName("ant-drawer-body")[0];w&&(w.scrollTop=0)}finally{n.value=!1}},C=()=>{e.id_pnte=null,e.title=null,e.city_id=null,e.province_id=null,e.district_id=null,e.place=null,e.date=null,e.organiza=null,e.numMypes=null,e.description="</p>",e.nameUser=null,e.link=null},R=async a=>{S.value=!0;try{a&&(await l.fetchOfficesPnte(),d.value.id_pnte=l.officesPnte,e.id_pnte=a.id_pnte,e.title=a.title,e.place=a.place,e.organiza=a.organiza,e.numMypes=a.numMypes,e.date={start:_(a.dateStart).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),end:_(a.dateEnd).format("YYYY-MM-DDTHH:mm:ss.SSSZ")},e.description=a.description,e.nameUser=a.nameUser,e.link=a.link,await l.fetchCities(),d.value.city_id=l.cities,e.city_id=a.city_id,await l.fetchProvinces(e.city_id),d.value.province_id=l.provinces,v.value.province_id.disabled=!1,e.province_id=a.province_id,await l.fetchDistricts(e.province_id),d.value.district_id=l.districts,v.value.district_id.disabled=!1,e.district_id=a.district_id)}finally{S.value=!1}};return z(()=>{u.info&&R(u.info)}),Z(()=>u.info,a=>{a?R(a):C()}),I("formState",e),I("loadingState",n),(a,g)=>S.value?(c(),L(F(J),{key:0,style:{color:"#00a6db"}})):(c(),m("div",ae,[p(X,{fields:v.value,options:d.value,btnSaveName:h.value,mayus:!1,resetSelect:M.value,onHandleChangeSelect:D,onHandleFocusSelect:N,onOnSubmit:U},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const ne={class:"advisory-table"},le={key:0},se={key:1},oe={key:0},de={key:1},re=["onClick"],ce=["onClick"],we={__name:"EventosCalendario",setup(q){JSON.parse(localStorage.getItem("role"));const T=s([]),v=s(0),l=s(150),y=s(null),u=s(!1),S=s(!1),h=s(!1),e=s(!1);s(null);const n=G({asesor:null,name:null,page:1}),M=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"OFICINA",fixed:"left",dataIndex:"office",width:80,align:"center"},{title:"TIPO DE ACTIVIDAD",fixed:"left",dataIndex:"area",width:120,align:"center"},{title:"TÍTULO",dataIndex:"title",width:200},{title:"REGIÓN",dataIndex:"city",width:140},{title:"PROVINCIA",dataIndex:"province",width:140},{title:"DISTRITO",dataIndex:"district",width:140},{title:"LUGAR",dataIndex:"place",width:180},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"resultado",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],d=t=>{y.value=t.all,u.value=!0},D=t=>_(t).format("DD/MM/YYYY"),N=t=>_(t,"HH:mm:ss").format("HH:mm"),U=()=>{y.value=null,e.value=!0},C=async()=>{h.value=!0;try{const t={};n.year&&(t.year=_(n.year).format("YYYY")),n.name&&(t.name=n.name),n.range&&(t.dateStart=n.range[0].format("YYYY/MM/DD"),t.dateEnd=n.range[1].format("YYYY/MM/DD")),n.offices&&(t.offices=n.offices),await W("download/events","eventos_pnte",t)}catch(t){console.error("Error de red:",t)}finally{h.value=!1}},R=async t=>{try{const i=await V({url:`event/delete/${t.id}`,method:"DELETE"});i.status==200&&(B.success(i.message),E())}catch{console.log("Failed to delete")}},a=async t=>{n.page=t,await E()},g=async t=>{t&&(n.page=1,await E())},w=t=>{y.value=t.all,e.value=!0},E=async()=>{S.value=!0;try{const t={page:n.page};n.year&&(t.year=_(n.year).format("YYYY")),n.name&&(t.name=n.name),n.range&&(t.dateStart=n.range[0].format("YYYY/MM/DD"),t.dateEnd=n.range[1].format("YYYY/MM/DD")),n.offices&&(t.offices=n.offices);const i=await V({url:"event/list",method:"GET",params:t});T.value=i.data.data,v.value=i.data.total,l.value=i.data.per_page}catch(t){console.error("Error de red:",t)}finally{S.value=!1}};return z(async()=>{await E()}),I("search",n),I("loading",S),I("loadingFile",h),(t,i)=>{const P=k("a-tag"),A=k("a-menu-item"),Q=k("a-popconfirm"),$=k("a-drawer");return c(),m("div",ne,[p(j,{title:"EVENTOS PNTE",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",tipooficina:!0,columns:M,titleSearch:"NOMBRE DEL EVENTO",pageSize:l.value,nameTotal:"Eventos",rangeDate:!0,dataSource:T.value,total:v.value,onHandleNew:U,onHandleDownloadExcel:C,onHandleSearch:g,onHandlePaginator:a},{"data-cell":f(({column:o,record:r})=>[o.dataIndex=="office"?(c(),m(H,{key:0},[r.office=="UGO"?(c(),L(P,{key:0,color:"blue"},{default:f(()=>i[4]||(i[4]=[O("UGO")])),_:1})):Y("",!0),r.office=="UGSE"?(c(),L(P,{key:1,color:"red"},{default:f(()=>i[5]||(i[5]=[O("UGSE")])),_:1})):Y("",!0)],64)):Y("",!0),o.dataIndex=="date"?(c(),m(H,{key:1},[r.dateStart!=r.dateEnd?(c(),m("span",le,[i[6]||(i[6]=b("b",null,"Desde:",-1)),O(" "+x(D(r.dateStart))+" ",1),i[7]||(i[7]=b("b",null,"Hasta:",-1)),O(" "+x(D(r.dateEnd)),1)])):(c(),m("span",se,x(D(r.dateStart)),1))],64)):Y("",!0),o.dataIndex=="hours"?(c(),m(H,{key:2},[r.start?(c(),m("span",de,x(N(r.start))+" - "+x(N(r.end)),1)):(c(),m("span",oe,"Todo el día"))],64)):Y("",!0)]),"custom-options":f(({record:o})=>[p(A,null,{default:f(()=>[b("a",{onClick:r=>d(o)},"Resultados",8,re)]),_:2},1024),p(A,null,{default:f(()=>[b("a",{onClick:r=>w(o)},"Editar",8,ce)]),_:2},1024),p(A,null,{default:f(()=>[p(Q,{placement:"rightBottom",title:`¿Quieres eliminar ${o.title} ?`,onConfirm:r=>R(o)},{icon:f(()=>[p(F(K),{style:{color:"red"}})]),default:f(()=>[i[8]||(i[8]=b("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),p($,{width:"500",title:"EVENTO PNTE",open:e.value,"onUpdate:open":i[1]||(i[1]=o=>e.value=o),placement:"right"},{default:f(()=>[p(ie,{info:y.value,onCloseDraw:i[0]||(i[0]=o=>(e.value=!1,E()))},null,8,["info"])]),_:1},8,["open"]),p($,{open:u.value,"onUpdate:open":i[3]||(i[3]=o=>u.value=o),title:"RESULTADOS",placement:"right",width:"550"},{default:f(()=>[p(te,{dataRow:y.value,onCloseDraw:i[2]||(i[2]=o=>{u.value=!1,E()})},null,8,["dataRow"])]),_:1},8,["open"])])}}};export{we as default};
