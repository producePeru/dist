import{_ as R}from"./FormComponent-bb3a8471.js";import{u as A}from"./selectes-846df974.js";import{r as l,a as k,p as d,k as w,U as T,X as v,o as g,y as q,i as x,L as B,d as j,c as F,h as c}from"./index-2325eb4f.js";import{u as L}from"./useBusinessman-15d96226.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";const Y={key:1},G={__name:"EditarEmpresario",props:{updateInfoBusinessman:{type:Object,required:!0,default:()=>({})},asesor:{type:Boolean,default:!1}},emits:["registered"],setup(E,{emit:h}){const o=E,S=h,a=A(),I=L(),u=l(!0),m=l(!1),e=k({}),O=l("VALIDAR"),s=l({city_id:[],province_id:[],district_id:[],gender_id:[],sick:[]}),D=async i=>{i=="city_id"&&(await a.fetchProvinces(e.city_id),s.value.province_id=a.provinces,n.value.province_id.disabled=!1),i=="province_id"&&(await a.fetchDistricts(e.province_id),s.value.district_id=a.districts,n.value.district_id.disabled=!1)},N=async(i,r)=>{i=="typedocument_id"&&(e.documentnumber=null,s.value.typedocument_id=a.typeDocuments,n.value.country_id.disabled=!1,r==1?e.country_id=155:e.country_id=null),i==="country_id"&&(e.typedocument_id==1?(n.value.country_id.disabled=!0,e.country_id=155,s.value.country_id=a.countries):(n.value.country_id.disabled=!1,s.value.country_id=a.countries.filter(t=>t.value!==155))),i=="city_id"&&(await a.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,s.value.province_id=[],s.value.city_id=a.cities),i=="province_id"&&(e.province_id=null,e.district_id=null,s.value.district_id=[]),i=="sick"&&p(),i=="gender_id"&&(await a.fetchGenders(),s.value.gender_id=a.genders),i=="hasSoon"&&y()},p=()=>{s.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},y=()=>{s.value.hasSoon=[{value:"si",label:"SI"},{value:"no",label:"NO"},{value:"na",label:"PREFIERO NO ESPECIFICAR"}]},P=async()=>{const i=[];if(e.typedocument_id===1&&e.country_id!==155&&i.push("El país debe ser Perú para este tipo de documento."),e.typedocument_id!=1&&e.country_id==155&&i.push("El país NO debe ser Perú para este tipo de documento."),e.country_id===null&&i.push("Falta seleccionar el país."),e.hasSoon===null&&i.push("Falta indicar el campo 'hasSoon'."),e.phone===null&&i.push("Falta registrar el teléfono."),i.length>0){c.warning(i.join(" "));return}m.value=!0;const r={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,country_id:e.country_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,birthday:d(e.birthday).format("YYYY-MM-DD"),phone:e.phone,email:e.email,gender_id:e.gender_id,sick:e.sick,hasSoon:e.hasSoon};try{const t=await I.update(r,o.updateInfoBusinessman.id);t.status==200&&(c.success(t.message),S("registered",t.data),b()),t.status==409&&c.error(t.message)}catch{c.error(a.error)}finally{m.value=!1}},b=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},n=l({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:o.asesor},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir número de documento",disabled:o.asesor,rules:[{validator:(i,r)=>{if(!r)return Promise.reject("Escribir número de documento");let t=10;switch(e.typedocument_id){case 1:t=8;break;case 2:t=9;break;case 3:t=12;break;case 4:t=9;break}return String(r).length!==t?Promise.reject(`Debe tener exactamente ${t} dígitos`):[1,2,4].includes(e.typedocument_id)&&!/^\d+$/.test(r)?Promise.reject("Solo se permiten dígitos"):Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!0},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!0},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country_id:{type:"iSelect",label:"PAÍS",name:"country_id",required:!0,message:"Seleccionar país"},city_id:{type:"iSelect",label:"REGIÓN RESIDENCIA",name:"city_id",required:!1,message:"Seleccionar región"},province_id:{type:"iSelect",label:"PROVINCIA RESIDENCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelect",label:"DISTRITO RESIDENCIA",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN RESIDENCIA",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"FECHA NACIMIENTO",name:"birthday",required:!0,disabled:!1,message:"Seleccionar fecha de nacimiento",disabledDate:i=>{if(!i)return!1;const r=d(),t=r.subtract(100,"year").endOf("day"),_=r.subtract(18,"year").endOf("day");return i.isAfter(_)||i.isBefore(t)},defaultPickerValue:(()=>{const i=d(),r=i.subtract(100,"year").endOf("day");let t=i.subtract(18,"year").endOf("day");for(;t.day()===0||t.day()===6;)t=t.subtract(1,"day");return t.isBefore(r)?r:t})(),rules:[{validator:(i,r)=>{if(!r)return Promise.reject(new Error("Seleccionar fecha de nacimiento"));const t=d(),_=t.subtract(100,"year").endOf("day"),C=t.subtract(18,"year").endOf("day");return d(r).isAfter(C)?Promise.reject(new Error("Debe tener 18 años o más")):d(r).isBefore(_)?Promise.reject(new Error("La edad no puede superar los 100 años")):Promise.resolve()},trigger:"change"}]},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(i,r)=>{if(!r)return Promise.reject(new Error("El número es requerido"));const t=r.toString();return t.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):t.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(i,r)=>r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"Seleccionar opción"},hasSoon:{type:"iSelect",label:"¿TIENE HIJOS?",name:"hasSoon",required:!0,message:"Seleccionar opción"}}),f=async i=>{u.value=!0;try{i&&(await a.fetchTypeDocuments(),s.value.typedocument_id=a.typeDocuments,e.typedocument_id=i.typedocument_id,e.documentnumber=i.documentnumber,e.lastname=i.lastname,e.middlename=i.middlename,e.name=i.name,await a.fetchCountries(),s.value.country_id=a.countries,e.country_id=i.country_id,await a.fetchCities(),s.value.city_id=a.cities,e.city_id=i.city_id,await a.fetchProvinces(e.city_id),s.value.province_id=a.provinces,e.province_id=i.province_id,await a.fetchDistricts(e.province_id),s.value.district_id=a.districts,e.district_id=i.district_id,e.address=i.address,i.birthday&&(e.birthday=d(i.birthday,"YYYY-MM-DD")),e.phone=i.phone,e.email=i.email,await a.fetchGenders(),s.value.gender_id=a.genders,e.gender_id=i.gender_id,p(),e.sick=i.sick,y(),e.hasSoon=i.hasSoon,n.value.country_id.disabled=!1)}catch(r){console.error("Error al cargar la información:",r)}finally{u.value=!1}};return w(()=>{o.updateInfoBusinessman&&f(o.updateInfoBusinessman)}),T(()=>o.updateInfoBusinessman,i=>{i?f(i):b()}),v("formState",e),v("loadingState",m),(i,r)=>u.value?(g(),q(x(B),{key:0,style:{color:"#00a6db"}})):(g(),j("div",Y,[F(R,{fields:n.value,options:s.value,btnSaveName:O.value,onHandleFocusSelect:N,onHandleChangeSelect:D,onOnSubmit:P,mayus:!0},null,8,["fields","options","btnSaveName"])]))}},J=M(G,[["__scopeId","data-v-4b472acd"]]);export{J as E};
