import{r as s,a as K,p as g,k as W,X as E,b as i,o as Y,d as Z,c as n,w as l,m as I,f as ee,e as u,y as te,i as k,a1 as ae,z as oe,O as ne,j as le,a2 as re,h as v}from"./index-9d5780b7.js";import{_ as se}from"./TableComponent-9eb495a8.js";import{_ as ie}from"./EventosUgo-6e933f91.js";import{d as de}from"./downloadExcel-d13b3d50.js";import{g as ce}from"./usePermissions-f41a8e70.js";import"./es-d01c9c29.js";import{g as S,a as ue}from"./publicInscripcion-ebc9ecb9.js";import"./icoexcel-1b303edf.js";import"./selectes-1e0e47ec.js";import"./MoreOutlined-f8c59c9b.js";const pe={class:"layout-content"},me={class:"filter-asesor",style:{width:"280px"}},fe=["onClick"],_e=["onClick"],ve=["onClick"],Se={__name:"eventos-index",setup(ye){const C=s([]),x=s(0),D=s(150),y=s({}),p=s(!1),w=s(!1),_=s(null),h=s(!1),b=s([]),a=K({year:g("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),N=[{title:"",dataIndex:"copy",fixed:"left",width:50},{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180},{title:"DESCRIPCIÓN",dataIndex:"description",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:100,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"LUGAR",dataIndex:"address",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],T=(e,t)=>{const o=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(o)};async function A(e,t){const o=O(e,t);await R(o)?v.success("Link copiado"):v.error("No se pudo copiar el link")}function O(e,t){return e===3?`${S()}/fortalece-tu-mercado/${t}`:`${ue()}/asistencias/${t}`}async function R(e){var t;try{if((t=navigator.clipboard)!=null&&t.writeText)return await navigator.clipboard.writeText(e),!0;const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),o.select();const m=document.execCommand("copy");return document.body.removeChild(o),m}catch{return!1}}const $=s([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]);function L(e,t){if(e==3){const o=`${S()}/fortalece-tu-mercado/${t}`;window.open(o,"_blank")}else{const o=`/asistencias/${t}`;window.open(o,"_blank")}}const F=e=>{_.value=e,p.value=!0},V=()=>{d(),p.value=!1},M=()=>{_.value=null,p.value=!0},U=async e=>{try{const t=await I({url:`attendance/delete/${e.id}`,method:"DELETE"});t.status==200&&(d(),v.success(t.message))}catch(t){console.error("Error de red:",t)}},z=async e=>{try{const t=await I({url:`attendance/event-finally/${e.id}`,method:"PUT"});t.status==200&&(d(),v.success(t.message))}catch(t){console.error("Error de red:",t)}},P=async()=>{h.value=!0;try{const e={};a.year&&(e.year=g(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor),await de("download/attendance-ugo","Eventos-UGO",e)}catch(e){console.error("Error de red:",e)}finally{h.value=!1}},G=async e=>{a.page=e,await d()},B=async e=>{e&&(a.page=1,await d())},d=async()=>{try{w.value=!0;const e={page:a.page};a.year&&(e.year=g(a.year).format("YYYY")),a.range&&(e.dateStart=a.range[0].format("YYYY/MM/DD"),e.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(e.name=a.name),a.orderby&&(e.orderby=a.orderby),a.asesor&&(e.asesor=a.asesor);const o=await I({url:"events-ugo/list",method:"GET",params:e});C.value=o.data.data,x.value=o.data.total,D.value=o.data.per_page}catch(e){console.error("Error de red:",e)}finally{w.value=!1}},H=async()=>{try{const e=await ee({url:"select/asesores",method:"GET"});e.status==200&&(b.value=e.data)}catch{console.log("Failed to delete")}};return W(async()=>{var e;y.value=await ce("eventos-ugo"),(e=y.value)!=null&&e.can_view_all&&(await d(),await H())}),E("search",a),E("loading",w),E("loadingFile",h),(e,t)=>{const o=i("a-select"),m=i("a-button"),j=i("a-tooltip"),q=i("a-input-group"),f=i("a-menu-item"),Q=i("router-link"),X=i("a-popconfirm"),J=i("a-drawer");return Y(),Z("div",pe,[n(se,{title:"LISTA EVENTOS UGO",textNuevo:"NUEVO EVENTO",new:!0,searchYear:!0,rangeDate:!0,btnUpdate:!0,btnImport:!0,downloadExcel:!0,placeholderSearch:"Buscar",columns:N,othersList:$.value,titleSearch:"BUSCAR POR EVENTO",pageSize:D.value,nameTotal:"Eventos UGO",dataSource:C.value,total:x.value,onHandleNew:M,onHandleDownloadExcel:P,onHandleSearch:B,permisos:y.value,onHandleCallFetchData:d,onHandlePaginator:G},{header:l(()=>[u("div",me,[t[2]||(t[2]=u("small",null,"POR ASESOR",-1)),n(o,{allowClear:!0,value:a.asesor,"onUpdate:value":t[0]||(t[0]=r=>a.asesor=r),placeholder:"Selecciona Asesor","show-search":"",options:b.value,"filter-option":T},null,8,["value","options"])])]),"data-cell":l(({column:r,record:c})=>[r.dataIndex=="copy"?(Y(),te(q,{key:0,compact:""},{default:l(()=>[n(j,{title:"copiar link"},{default:l(()=>[n(m,{type:"text",onClick:we=>A(c.eventsoffice_id,c.slug)},{icon:l(()=>[n(k(ae),{style:{"font-size":"11px"}})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):oe("",!0)]),"custom-options":l(({record:r})=>[n(f,null,{default:l(()=>[u("a",{href:"#",onClick:ne(c=>L(r.eventsoffice_id,r.slug),["prevent"])}," Ver Link ",8,fe)]),_:2},1024),n(f,null,{default:l(()=>[n(Q,{to:`eventos-inscritos/${r.slug}`},{default:l(()=>t[3]||(t[3]=[le("Inscritos")])),_:2},1032,["to"])]),_:2},1024),n(f,null,{default:l(()=>[u("a",{onClick:c=>F(r)},"Editar",8,_e)]),_:2},1024),n(f,null,{default:l(()=>[u("span",{style:{color:"#ff4d4f"},onClick:c=>z(r)},"Finalizar",8,ve)]),_:2},1024),n(f,null,{default:l(()=>[n(X,{placement:"rightBottom",title:`¿Quieres eliminar ${r.title} ?`,onConfirm:c=>U(r)},{icon:l(()=>[n(k(re),{style:{color:"red"}})]),default:l(()=>[t[4]||(t[4]=u("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["othersList","pageSize","dataSource","total","permisos"]),n(J,{open:p.value,"onUpdate:open":t[1]||(t[1]=r=>p.value=r),title:_.value?"EDITAR EVENTO UGO":"NUEVA ACTIVIDAD",placement:"right",width:"550"},{default:l(()=>[n(ie,{onCloseDraw:V,dataRow:_.value},null,8,["dataRow"])]),_:1},8,["open","title"])])}}};export{Se as default};
