import{L as C,y as ie,r as p,u as de,a as re,k as oe,b as c,o as d,d as D,c as _,w as m,e as q,F,x as ue,q as r,h as S,s as o,M as ce,t as me,i as pe,p as be,j as ve,m as y,z as $,Q as _e,f as M}from"./index-82550cb7.js";import{u as ye}from"./selectes-4a1e1ee8.js";import"./es-8385b054.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";const fe={typedocument_id:{type:"iSelect",label:"Tipo de documento",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0},documentnumber:{type:"iSearch",label:"Ingresar número",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!0},lastname:{type:"iText",label:"Apellido Paterno",name:"lastname",required:!0,message:"Escribir apellido paterno",disabled:!0},middlename:{type:"iText",label:"Apellido Materno",name:"middlename",required:!0,message:"Escribir apellido materno",disabled:!0},name:{type:"iText",label:"Nombres",name:"name",required:!0,message:"Escribir nombre",disabled:!0},country:{type:"iText",label:"País Origen",name:"country",required:!0,message:"Escribir nombre",disabled:!1},city_id:{type:"iSelect",label:"Región residente",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelect",label:"Provincia residente",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"Distrito residente",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iText",label:"Dirección",name:"address",required:!0,message:"Escribir dirección",disabled:!1},birthday:{type:"iDate",label:"Fecha de nacimiento",name:"birthday",required:!0,message:"Seleccionar fecha",disabled:!0},phone:{type:"iText",label:"Número Telefónico del contacto",name:"phone",required:!0,message:"Número de celular",min:9,max:9,disabled:!0},email:{type:"iText",label:"Correo electrónico",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},hasSoon:{type:"iSelect",label:"¿Tiene hijos? (Opcional)",name:"hasSoon",required:!1,message:"¿Tiene hijos?",disabled:!1}};const O=g=>(be("data-v-8e5bd834"),g=g(),ve(),g),ge={class:"agreement-wrapper"},Se=O(()=>q("h3",null,"Formulario de registro",-1)),qe=O(()=>q("br",null,null,-1)),ke={class:"grid-item"},xe="DD/MM/YYYY",De={__name:"NuevaPersona",setup(g){C.locale("es");const h=ie(),i=ye();i.$patch({typeDocuments:i.typeDocuments}),i.$patch({cities:i.cities}),i.$patch({provinces:i.provinces}),i.$patch({districts:i.districts}),i.$patch({genders:i.genders}),i.fetchTypeDocuments(),i.fetchCities(),i.fetchGenders();const T=p(null),N=p(null),R=de(),U=JSON.parse(localStorage.getItem("profile")),t=p(fe),f=p(!0),b=p(null),k=p(!1),Y=p(!0),z=[{value:"yes",label:"SI"},{value:"no",label:"NO"}],L=[{value:"SI",label:"SI"},{value:"NO",label:"NO"}],e=re({typedocument_id:null,documentnumber:null,lastname:null,middlename:null,name:null,country:null,city_id:null,address:null,province_id:null,district_id:null,phone:null,email:null,birthday:null,gender_id:null,sick:null,people_id:U.user_id,from_id:1}),G=async s=>{try{const{data:n}=await M({url:`select/provinces/${s}`,method:"GET"});T.value=n}catch(n){console.error("Error de red:",n)}},j=async s=>{try{const{data:n}=await M({url:`select/districts/${s}`,method:"GET"});N.value=n}catch(n){console.error("Error de red:",n)}},x=(s,n)=>{const u=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(u)},A=()=>{i.typeDocuments&&(Y.value=!1)},B=()=>{t.value.lastname.disabled=!1,t.value.middlename.disabled=!1,t.value.name.disabled=!1,t.value.city_id.disabled=!1,t.value.province_id.disabled=!1,t.value.district_id.disabled=!1,t.value.address.disabled=!1,t.value.phone.disabled=!1,t.value.email.disabled=!1,t.value.birthday.disabled=!1,t.value.gender_id.disabled=!1,t.value.sick.disabled=!1},w=s=>{s&&(t.value.documentnumber.disabled=!1,e.documentnumber=null)},I=async s=>{if(f.value=!0,!s)return y.warning("Ingresa un número de documento"),f.value=!1;try{if(e.typedocument_id==1){const n=await $({url:`user/only-dni/${e.documentnumber}`,method:"GET"});n.status===404&&_e.open({message:"Notificación",description:"Se superó el número de consultas, comentale a tu supervisor"}),n.status==200&&(e.country="PERÚ",e.lastname=n.data.apellidoPaterno,e.middlename=n.data.apellidoMaterno,e.name=n.data.nombres)}}catch(n){console.log("err",n)}finally{return B(),f.value=!1}},V=()=>{e.documentnumber=e.documentnumber.replace(/\D/g,"")},J=()=>{e.phone=e.phone.replace(/\D/g,"")},Q=s=>{e.province_id=null,e.district_id=null,G(s)},H=s=>{e.district_id=null,j(s)},K=()=>{e.lastname=null,e.middlename=null,e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.phone=null,e.email=null,e.birthday=null,e.gender_id=null,e.sick=null,e.typedocument_id=null,e.documentnumber=null,e.from_id=1,e.people_id=U.id,b.value=null,E()},E=()=>{t.value.documentnumber.disabled=!0,t.value.lastname.disabled=!0,t.value.middlename.disabled=!0,t.value.name.disabled=!0,t.value.city_id.disabled=!0,t.value.city_id.disabled=!0,t.value.province_id.disabled=!0,t.value.address.disabled=!0,t.value.phone.disabled=!0,t.value.email.disabled=!0,t.value.birthday.disabled=!0,t.value.gender_id.disabled=!0,t.value.sick.disabled=!0},W=async()=>{k.value=!0,e.birthday=b.value?C(b.value).format("YYYY-MM-DD"):null;try{const s=await $({url:"person/create",method:"POST",data:e});if(s.status==400)return y.error("El correo electrónico ya está registrado. Por favor, ingresa uno válido.");if(s.status==401)return y.error("El número de DNI ya está registrado. Por favor, ingresa uno válido.");if(s.status==200){const n={type:e.typedocument_id,number:e.documentnumber};return R.push({name:"asesorias-formalizaciones",query:n}),y.success(s.message),K()}}catch{y.error("No se pudo registrar este usuario")}finally{k.value=!1}},X=()=>{y.error("Debes de completar todos los espacios requeridos")},Z=async()=>{E(),h.query&&(e.typedocument_id=+h.query.type,w(h.query.type),e.documentnumber=h.query.number,await i.fetchCities(),await I(h.query.number))};return oe(()=>{Z()}),(s,n)=>{const u=c("a-select"),v=c("a-form-item"),ee=c("a-input-search"),P=c("a-input"),ae=c("a-date-picker"),te=c("a-button"),ne=c("a-form"),le=c("a-spin");return d(),D("div",ge,[Se,qe,_(le,{spinning:f.value},{default:m(()=>[_(ne,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:W,onFinishFailed:X},{default:m(()=>[q("div",ke,[(d(!0),D(F,null,ue(t.value,(a,se)=>(d(),D(F,{key:se},[a.type==="iSelect"?(d(),r(v,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[a.name=="typedocument_id"?(d(),r(u,{key:0,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:S(i).typeDocuments,disabled:a.disabled,onChange:w},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),a.name=="city_id"?(d(),r(u,{key:1,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:S(i).cities,"show-search":"","filter-option":x,onChange:Q,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),a.name=="province_id"?(d(),r(u,{key:2,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:T.value,"show-search":"","filter-option":x,onChange:H,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),a.name=="district_id"?(d(),r(u,{key:3,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:N.value,"show-search":"","filter-option":x,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),a.name=="gender_id"?(d(),r(u,{key:4,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:S(i).genders,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):o("",!0),a.name=="sick"?(d(),r(u,{key:5,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:z,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])):o("",!0),a.name=="hasSoon"?(d(),r(u,{key:6,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:L,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])):o("",!0)]),_:2},1032,["name","label","rules"])):o("",!0),a.type==="iSearch"?(d(),r(v,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[_(ee,{loading:f.value,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,onSearch:I,onInput:V,maxlength:e.typedocument_id==1?8:20,disabled:""},null,8,["loading","value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):o("",!0),a.type==="iText"?(d(),r(v,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email,max:a.max,min:a.min}]},{default:m(()=>[a.name=="phone"?(d(),r(P,{key:0,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,disabled:a.disabled,maxlength:a.max,onInput:J},null,8,["value","onUpdate:value","disabled","maxlength"])):(d(),r(P,{key:1,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,disabled:a.disabled,maxlength:a.max},null,8,["value","onUpdate:value","disabled","maxlength"]))]),_:2},1032,["name","label","rules"])):o("",!0),a.type==="iDate"?(d(),r(v,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[_(ae,{locale:S(ce),value:b.value,"onUpdate:value":n[0]||(n[0]=l=>b.value=l),style:{width:"100%"},format:xe,placeholder:"día/mes/año",onChange:n[1]||(n[1]=l=>e.birthday=b.value),disabled:a.disabled},null,8,["locale","value","disabled"])]),_:2},1032,["name","label","rules"])):o("",!0)],64))),128))]),q("div",null,me(A()),1),_(v,null,{default:m(()=>[_(te,{class:"btn-produce",type:"primary","html-type":"submit",loading:k.value},{default:m(()=>[pe("REGISTRAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Ie=he(De,[["__scopeId","data-v-8e5bd834"]]);export{Ie as default};
