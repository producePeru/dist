import{_ as $}from"./TableComponent-429ef20b.js";import{p as q,r as l,a as R,k as P,U as F,X as y,o as C,y as k,i as H,L as V,d as A,c as f,m as T,h as z,b as x,w,z as G,e as M}from"./index-b7079dd1.js";import{_ as L}from"./FormComponent-179f3a06.js";import{u as j}from"./selectes-ea112819.js";import"./es-ff465591.js";import{d as J}from"./downloadExcel-01235e87.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-48c3fdeb.js";import"./quill.snow-228cd9f7.js";const X={key:1,class:"f-20"},K={__name:"EditarCde",props:["info"],emits:["closeDraw"],setup(O,{emit:h}){q.locale("es");const c=l({name:{type:"iText",label:"NOMBRE DEL CDE",name:"name",required:!1,message:"",disabled:!1,max:100},city_id:{type:"iSelect",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},address:{type:"iTextArea",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir la dirección del CDE",disabled:!1,rows:3}}),i=j(),p=h,o=O,d=l(!1),v=l("GUARDAR"),e=R({}),m=l(!1),E=l(null),s=l({id_pnte:[],city_id:[],province_id:[],district_id:[]}),I=async t=>{t=="city_id"&&(console.log("city_id kakakaka"),await i.fetchProvinces(e.city_id),s.value.province_id=i.provinces,c.value.province_id.disabled=!1),t=="province_id"&&(await i.fetchDistricts(e.province_id),s.value.district_id=i.districts,c.value.district_id.disabled=!1)},b=async t=>{t=="id_pnte"&&(await i.fetchOfficesPnte(),s.value.id_pnte=i.officesPnte),t=="city_id"&&(await i.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,s.value.province_id=[],s.value.city_id=i.cities),t=="province_id"&&(e.province_id=null,e.district_id=null,s.value.district_id=[])},D=async()=>{m.value=!0;const t={name:e.name,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address};try{const a=o.info?`config/cde/${o.info.id}`:"config/cde",n=o.info?"PUT":"POST",r=await T({url:a,method:n,data:t});r.status===200&&(g(),z.success(r.message),p("closeDraw",!0))}catch(a){console.error("Error:",a);const n=document.getElementsByClassName("ant-drawer-body")[0];n&&(n.scrollTop=0)}finally{m.value=!1}},g=()=>{e.name=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null},u=async t=>{d.value=!0;try{t&&(e.name=t.name,e.address=t.address,await i.fetchCities(),s.value.city_id=i.cities,e.city_id=t.city_id,await i.fetchProvinces(e.city_id),s.value.province_id=i.provinces,c.value.province_id.disabled=!1,e.province_id=t.province_id,await i.fetchDistricts(e.province_id),s.value.district_id=i.districts,c.value.district_id.disabled=!1,e.district_id=t.district_id)}finally{d.value=!1}};return P(()=>{o.info&&u(o.info)}),F(()=>o.info,t=>{t?u(t):g()}),y("formState",e),y("loadingState",m),(t,a)=>d.value?(C(),k(H(V),{key:0,style:{color:"#00a6db"}})):(C(),A("div",X,[f(L,{fields:c.value,options:s.value,btnSaveName:v.value,mayus:!0,resetSelect:E.value,onHandleChangeSelect:I,onHandleFocusSelect:b,onOnSubmit:D},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const Q={class:"cde-table"},W=["onClick"],oe={__name:"CdesPnte",setup(O){JSON.parse(localStorage.getItem("role"));const h=l([]),c=l(0),i=l(150);l(!1);const p=l(!1),o=l(!1),d=l(!1),v=l(null),e=R({name:null,page:1}),m=[{title:"#",dataIndex:"idx",align:"center",width:70},{title:"NOMBRE CDE",dataIndex:"name",width:220},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:120},{title:"DISTRITO",dataIndex:"district",width:120},{title:"DIRECCIÓN",dataIndex:"address",width:250},{title:"TIPO",dataIndex:"cdeType",align:"center",width:200},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],E=()=>{v.value=null,d.value=!0},s=l([{label:"CDE",value:1},{label:"CDEAI INSTITUCIONES",value:2},{label:"CDEAN NOTARÍAS",value:3}]),I=a=>{v.value=a,d.value=!0},b=async()=>{o.value=!0;try{const a={};e.name&&(a.name=e.name),await J("download/cdes","cdes-pnte",a)}catch(a){console.error("Error de red:",a)}finally{o.value=!1}},D=async a=>{e.page=a,await u()},g=async a=>{a&&(e.page=1,await u())},u=async()=>{p.value=!0;try{const a={page:e.page};e.name&&(a.name=e.name);const n=await T({url:"config/cdes",method:"GET",params:a});h.value=n.data.data,c.value=n.data.total,i.value=n.data.per_page}catch(a){console.error("Error de red:",a)}finally{p.value=!1}},t=async(a,n)=>{try{const r={value:a};await T({url:`config/chooseCde/${n.id}`,method:"PUT",data:r})}catch{console.log("Failed to delete")}};return P(async()=>{await u()}),y("search",e),y("loading",p),y("loadingFile",o),(a,n)=>{const r=x("a-select"),U=x("a-menu-item"),B=x("a-drawer");return C(),A("div",Q,[f($,{title:"CDE PNTE",new:!0,textNuevo:"NUEVO CDE",placeholderSearch:"Buscar",columns:m,titleSearch:"NOMBRE CDE",pageSize:i.value,nameTotal:"Solicitantes",dataSource:h.value,total:c.value,onHandleNew:E,onHandleDownloadExcel:b,onHandleSearch:g,onHandlePaginator:D},{"data-cell":w(({column:_,record:S})=>[_.dataIndex=="cdeType"?(C(),k(r,{key:0,style:{width:"100%"},value:S.cdetype_id,"onUpdate:value":N=>S.cdetype_id=N,options:s.value,onChange:N=>t(N,S)},null,8,["value","onUpdate:value","options","onChange"])):G("",!0)]),"custom-options":w(({record:_})=>[f(U,null,{default:w(()=>[M("a",{onClick:S=>I(_)},"Editar",8,W)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),f(B,{width:"500",title:"EDITAR DATOS DE CDE",open:d.value,"onUpdate:open":n[1]||(n[1]=_=>d.value=_),placement:"right"},{default:w(()=>[f(K,{info:v.value,onCloseDraw:n[0]||(n[0]=_=>(d.value=!1,u()))},null,8,["info"])]),_:1},8,["open"])])}}};export{oe as default};
