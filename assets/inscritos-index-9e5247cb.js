import{l as K,r,a as Y,j as W,X as be,a6 as X,o as h,d as B,x as ee,h as P,L as Ee,c as n,e as u,t as U,F,R as G,E as he,u as ye,g as we,G as xe,Z as Ce,b as i,w as l,i as M,a9 as Se,y as Z,a2 as Oe,O as Re,q as Ie,m as Ne,K as Te}from"./index-14868efa.js";import{_ as De}from"./icoexcel-1b303edf.js";import{_ as Ae}from"./FormComponent-91435e3b.js";import{u as Le}from"./selectes-ac0dc035.js";import"./es-3fab58e6.js";import{M as ke}from"./MoreOutlined-bc9fcbaf.js";import"./vue-quill.esm-bundler-4fa0b59f.js";import"./quill.snow-93cbac5d.js";/* empty css                                                      */const Me={key:1,class:"f-20"},Pe={__name:"EventosUgoAsistentes",props:["info"],emits:["closeDraw"],setup(V,{emit:R}){K.locale("es");const m=Le(),I=JSON.parse(localStorage.getItem("role"));m.fetchCities();const N=r({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!I.some(t=>t.id==1||t.id==5)},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!I.some(t=>t.id==1||t.id==5),rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("Escribe número de documento"));const d=String(s);if(!/^\d+$/.test(d))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(d.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(d.length<3||d.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("El número es requerido"));const d=s.toString();return d.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):d.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(t,s)=>s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},ruc:{type:"iText",label:"RUC",name:"ruc",required:!1,message:"Escribir nombre",disabled:!1},comercialName:{type:"iText",label:"NOMBRE COMERCIAL",name:"comercialName",required:!1,message:"Escribir nombre",disabled:!1},comercialActivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialActivity",required:!1,message:"Escribir nombre",disabled:!1},mercado:{type:"iText",label:"MERCADO",name:"mercado",required:!1,message:"Escribir nombre",disabled:!1}}),$=R,f=V,y=r(!0),T=r("ACTUALIZAR"),e=Y({}),_=r(!1),D=r(null),p=r({typedocument_id:[],gender_id:[]}),w=t=>{console.log("handleInputEvent",t)},x=async t=>{t=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),N.value.dateTramite.disabled=!1)},v=async t=>{},q=async t=>{t=="typedocument_id"&&(p.value.typedocument_id=m.typeDocuments),t=="gender_id"&&(p.value.gender_id=m.genders)},A=t=>{},C=async()=>{_.value=!0;const t={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,gender_id:e.gender_id,phone:e.phone,email:e.email,ruc:e.ruc,comercialName:e.comercialName,comercialActivity:e.comercialActivity,mercado:e.mercado};try{(await G({url:`events-ugo/update-participant-data-ugo-event/${f.info.id}`,method:"PUT",data:t})).status===200&&(L(),$("closeDraw",!0))}catch(s){console.error("Error:",s);const d=document.getElementsByClassName("ant-drawer-body")[0];d&&(d.scrollTop=0)}finally{_.value=!1}},L=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},k=async t=>{y.value=!0;try{t&&(await m.fetchTypeDocuments(),p.value.typedocument_id=m.typeDocuments,e.typedocument_id=t.typedocument_id,e.documentnumber=t.documentnumber,e.lastname=t.lastname,e.middlename=t.middlename,e.name=t.name,e.phone=t.phone,e.email=t.email,await m.fetchGenders(),p.value.gender_id=m.genders,e.gender_id=t.gender_id,e.ruc=t.ruc,e.comercialName=t.comercialName,e.comercialActivity=t.comercialActivity,e.mercado=t.mercado)}catch(s){console.error("Error al cargar la información:",s)}finally{y.value=!1}};return W(()=>{f.info&&k(f.info)}),be(()=>f.info,t=>{t&&k(t)}),X("formState",e),X("loadingState",_),(t,s)=>(h(),B(F,null,[y.value?(h(),ee(P(Ee),{key:0,style:{color:"#00a6db"}})):(h(),B("div",Me,[n(Ae,{fields:N.value,options:p.value,btnSaveName:T.value,onHandleInputEvent:w,resetSelect:D.value,onHandleChangeSelect:v,onHandleFocusSelect:q,onHandleBlurSelect:A,onHandleChangeClock:x,onOnSubmit:C},null,8,["fields","options","btnSaveName","resetSelect"])])),u("pre",null,U(),1)],64))}};const Ue={class:"title-produce"},Be={style:{color:"var(--secondary)"}},$e=["onClick"],qe={class:"paginator"},Ze={__name:"inscritos-index",props:["idConvenio"],setup(V){K.locale("es");const R=he();ye();const m=JSON.parse(localStorage.getItem("role"))||[],I=we.get("token"),N="https://apituempresa.soporte-pnte.com/api/",$="http://127.0.0.1:8000/api/",f=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?$:N,y=m.some(o=>o.id===10||o.id===11||o.id===5),T=r(""),e=r(null),_=r(!1),D=r(null),p=r(!1),w=r(0),x=r(50),v=r({page:0}),q=r(1200),A=r([]),C=r(!1);r(!1);const L=r(window.innerHeight-100),k=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGISTRADO",dataIndex:"created_at",fixed:"left",width:120,align:"center"},{title:"APELLIDOS",dataIndex:"lastname",fixed:"left",width:160},{title:"NOMBRES ",dataIndex:"name",width:160,fixed:"left"},{title:"TIPO DOCUMENTO",dataIndex:"typedocument_name",width:100,align:"center"},{title:"NÚMERO DE DOCUMENTO",dataIndex:"documentnumber",align:"center",width:140},{title:"CELULAR",dataIndex:"phone",width:150,align:"center"},{title:"CORREO",dataIndex:"email",width:250},{title:"GÉNERO",dataIndex:"gender_name",align:"center",width:100},{title:"RUC",dataIndex:"ruc",align:"center",width:120},{title:"NOMBRE COMERCIAL",dataIndex:"comercialName",align:"center",width:140},{title:"RUBRO / ACTIVIDAD COMERCIAL",dataIndex:"comercialActivity",align:"center",width:200},...y?[{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}]:[]],t=Y({search:""}),s=()=>{b(),_.value=!1},d=o=>{D.value=o,_.value=!0},H=()=>{let o={search:t.search};b(o)},te=()=>{t.search||b()},ae=o=>{v.value.page=o,b()},j=()=>{L.value=window.innerHeight-320},ne=async o=>{try{const a=await G({url:`events-ugo/remove-participant-ugo-event/${o.id}`,method:"DELETE"});a.status==200&&(b(),Ne.success(a.message))}catch(a){console.error("Error de red:",a)}},oe=xe(()=>o=>v.value.page*x.value+o+1),b=async o=>{try{C.value=!0;let a;a=v.value.page==0?"":v.value,a=o?{...a,...o}:a;const S=R.params.slug,g=await G({url:`attendance/applicants/${S}`,method:"GET",params:a});T.value=g.nameEvent,e.value=g.typeEvent;const c=g.data;A.value=c==null?void 0:c.data,w.value=c.total,x.value=c.per_page}catch(a){console.error("Error de red:",a)}finally{C.value=!1}},le=async()=>{p.value=!0;try{const o=R.params.slug;let a=null;e.value==3?a=`${f}download/attendance-mercado/${o}`:a=`${f}download/attendance/${o}`;const S=await Te({url:a,method:e.value==3?"POST":"GET",responseType:"blob",headers:{Authorization:`Bearer ${I}`}}),g=window.URL.createObjectURL(new Blob([S.data])),c=document.createElement("a"),O=`${o}.xlsx`;c.href=g,c.setAttribute("download",O),document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(g),document.body.removeChild(c)}catch(o){console.error("Error downloading file:",o)}finally{p.value=!1}};return Ce(()=>{window.removeEventListener("resize",j)}),W(()=>{window.addEventListener("resize",j),j(),b()}),(o,a)=>{const S=i("router-link"),g=i("a-breadcrumb-item"),c=i("a-breadcrumb"),O=i("a-button"),J=i("a-col"),re=i("a-input"),se=i("a-input-group"),ie=i("a-row"),Q=i("a-menu-item"),de=i("a-popconfirm"),ce=i("a-menu"),ue=i("a-dropdown"),me=i("a-table"),pe=i("a-tag"),ge=i("a-pagination"),_e=i("a-drawer");return h(),B(F,null,[u("div",null,[n(c,null,{default:l(()=>[n(g,null,{default:l(()=>[n(S,{to:"/admin/eventos-ugo/lista"},{default:l(()=>[n(P(Se)),a[3]||(a[3]=u("span",{class:"fs-13"},"Atrás",-1))]),_:1})]),_:1}),n(g,null,{default:l(()=>[u("h3",Ue,[a[4]||(a[4]=M("EVENTOS REGISTRO DE ASISTENCIA - ")),u("span",Be,U(T.value),1)])]),_:1})]),_:1}),n(ie,{style:{margin:"1rem 0"}},{default:l(()=>[n(J,{xs:24,md:12,lg:18},{default:l(()=>[a[6]||(a[6]=u("span",null,null,-1)),n(O,{class:"btn-excel",onClick:le,loading:p.value,type:"primary"},{default:l(()=>a[5]||(a[5]=[u("img",{width:"20",style:{margin:"-2px 0 0 0"},src:De},null,-1)])),_:1},8,["loading"])]),_:1}),n(J,{xs:24,md:12,lg:6},{default:l(()=>[n(se,{compact:""},{default:l(()=>[n(re,{onPressEnter:H,value:t.search,"onUpdate:value":a[0]||(a[0]=E=>t.search=E),style:{width:"calc(100% - 80px)"},onInput:te,placeholder:"Buscar por NOMBRE, DNI o RUC"},null,8,["value"]),n(O,{type:"primary",disabled:t.search==="",onClick:H},{default:l(()=>a[7]||(a[7]=[M("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(me,{bordered:"",scroll:{x:q.value,y:L.value},class:"table-agreements-ugse",columns:k,"data-source":A.value,pagination:!1,loading:C.value,size:"small"},{bodyCell:l(({column:E,record:z,index:fe})=>[E.dataIndex=="idx"?(h(),B(F,{key:0},[M(U(oe.value(fe)),1)],64)):Z("",!0),E.dataIndex=="actions"?(h(),ee(ue,{key:1,trigger:["click"]},{overlay:l(()=>[n(ce,null,{default:l(()=>[n(Q,null,{default:l(()=>[u("a",{onClick:ve=>d(z)},"Editar",8,$e)]),_:2},1024),n(Q,null,{default:l(()=>[n(de,{placement:"rightBottom",title:`¿Quieres eliminar ${z.documentnumber} ?`,onConfirm:ve=>ne(z)},{icon:l(()=>[n(P(Oe),{style:{color:"red"}})]),default:l(()=>[a[8]||(a[8]=u("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:2},1024)]),default:l(()=>[u("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=Re(()=>{},["prevent"]))},[n(O,{shape:"circle",icon:Ie(P(ke)),size:"small"},null,8,["icon"])])]),_:2},1024)):Z("",!0)]),_:1},8,["scroll","data-source","loading"])]),u("div",qe,[u("span",null,[n(pe,{color:"blue"},{default:l(()=>[u("b",null,U(w.value),1)]),_:1}),a[9]||(a[9]=M("Inscritos"))]),n(ge,{size:"small",total:w.value,pageSize:x.value,onChange:ae,showSizeChanger:!1},null,8,["total","pageSize"])]),n(_e,{open:_.value,"onUpdate:open":a[2]||(a[2]=E=>_.value=E),title:"Nueva Feria",placement:"right",width:"650"},{default:l(()=>[n(Pe,{onCloseDraw:s,info:D.value},null,8,["info"])]),_:1},8,["open"])],64)}}};export{Ze as default};
