import{z as ee,E as h,D as ae,r as f,a as te,j as ne,b,o as c,d as v,c as m,w as u,h as y,F as O,L as re,f as E,e as d,i as k,G as oe,H as se,t as ie,v as le,p as g,q as p,B as ce,m as S,M as L}from"./index-08d187e2.js";import{_ as de}from"./calendar-e0a6119a.js";import{u as me}from"./selectes-c8cb3b68.js";import{F as ue}from"./FormalizacionFooter-e8785b28.js";import"./es-91d4c0fb.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./EnvironmentOutlined-6ee24bbe.js";const pe={class:"attendance"},be={class:"container"},ge={key:0,class:"fair-caducated"},_e={key:1,style:{padding:"5rem 5rem 1rem 5rem"}},fe={class:"attendance-title"},ve={class:"attendance-form"},he={key:7},ye="DD/MM/YYYY",Oe={__name:"IndexAsistencias",emits:["nextStep2"],setup(Ee,{emit:Se}){ee.locale("es");const P=h(re,{style:{fontSize:"24px"},spin:!0}),q=ae(),i=me();i.$patch({typeDocuments:i.typeDocuments}),i.$patch({comercialActivities:i.comercialActivities}),i.$patch({economicSectors:i.economicSectors}),i.$patch({genders:i.genders}),i.fetchEconomicSectors(),i.fetchTypeDocuments(),i.fetchComercialActivities(),i.fetchGenders();const N=f(!1),x=f(!0),U=f(null),R=f(!1),D=f(!1),T=f(!1),a=te({}),M=[{value:"si",label:"SI"},{value:"no",label:"NO"}],$=n=>{if(n==="country_id")return i.countries;if(n==="gender_id")return i.genders;if(n==="sick")return M;if(n==="typedocument_id")return i.typeDocuments},I=f({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO DE IDENTIDAD",name:"typedocument_id",required:!0,message:"Seleccionar tipo",disabled:!1},documentnumber:{type:"iSearch",label:"INGRESE NÚMERO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir tu número de documento",disabled:!0,max:11},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0,max:50},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir nombre",disabled:!0,max:50},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir nombre",disabled:!0,max:50},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!0,message:"Ingresar email",email:"email",disabled:!0,max:255},phone:{type:"iText",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe tu num. de celular",disabled:!0,max:9},ruc:{type:"iSearchRuc",label:"NÚMERO DE RUC",name:"ruc",required:!0,message:"Escribir RUC",disabled:!0,max:11},socialReason:{type:"iText",label:"RAZÓN SOCIAL",name:"socialReason",required:!0,message:"Escribir la razón social",disabled:!0,max:100},economicsector_id:{type:"iSelectWrite",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!0,message:"Seleccionar sector económnico",disabled:!0},comercialactivity_id:{type:"iSelectWrite",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity_id",required:!0,message:"Seleccionar actividad comercial",disabled:!0}}),F=(n,t)=>{if(!t)return Promise.reject("La fecha es requerida");const r=new Date,s=new Date(t);let o=r.getFullYear()-s.getFullYear();const _=r.getMonth()-s.getMonth();return(_<0||_===0&&r.getDate()<s.getDate())&&o--,o<18||o>99?Promise.reject("La edad debe estar entre 18 y 99 años"):Promise.resolve()},z=(n,t)=>{if(n.field==="phone"){const r=/^9\d{8}$/;if(t){if(!r.test(t))return Promise.reject("El número debe empezar con 9 y tener exactamente 9 dígitos")}else return Promise.reject("El número de teléfono es obligatorio")}if(n.field==="email"){const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(t){if(!r.test(t))return Promise.reject("Ingrese un correo electrónico válido")}else return Promise.reject("El correo electrónico es obligatorio")}return Promise.resolve()},G=n=>{const t=a[n]?a[n].trim():"";a[n]=t},j=n=>{n=="typedocument_id"&&(a.documentnumber=null,a.name=null,a.lastname=null,a.middlename=null,a.gender_id=null,a.sick=null,a.email=null,a.phone=null)},B=(n,t)=>{const r=a.typedocument_id;return/^\d+$/.test(t)?r===1&&t.length!==8?Promise.reject("Debe tener exactamente 8 caracteres."):r!==1&&t.length>12?Promise.reject("Debe tener exactamente 12 caracteres."):(r===1&&t.startsWith("0")&&t.length===8,Promise.resolve()):Promise.reject("Solo se permiten números.")},V=async()=>{const{typedocument_id:n,documentnumber:t}=a;if(!n||!t){S.error("El tipo de documento y el número de documento no pueden estar vacíos.");return}if(!/^\d+$/.test(t)){S.error("El número de documento solo debe contener caracteres numéricos.");return}if(n===1&&t.length!==8){S.error("El número de documento debe tener exactamente 8 caracteres para el tipo de documento DNI.");return}const r=["name","lastname","middlename","sick","email","phone","gender_id","ruc"],s=o=>{r.forEach(_=>{I.value[_].disabled=o})};try{if(R.value=!0,a.typedocument_id==1){const o=await E({url:`public/search-api-dni/${a.documentnumber}`,method:"GET"});o.status==200&&(a.name=o.data.name,a.lastname=o.data.lastname,a.middlename=o.data.middlename,a.gender_id=o.data.gender_id,a.sick=o.data.sick)}}catch(o){console.error("Error de red:",o)}finally{s(!1),R.value=!1}},Y=async()=>{const n=a.ruc,t=/^\d{11}$/.test(n)&&/^(10|15|20)/.test(n),r=["socialReason","economicsector_id","comercialactivity_id"],s=o=>{r.forEach(_=>{I.value[_].disabled=o})};if(!t)console.error("El RUC debe tener 11 caracteres, comenzar con 11, 15 o 20, y contener solo números."),s(!0);else{D.value=!0;try{const o=await E({url:`public/search-api-ruc/${a.ruc}`,method:"GET"});o.status==200&&(a.socialReason=o.data.socialReason,s(!1))}catch(o){console.error("Error de red:",o),o&&S.error("Este número de RUC no es válido")}finally{D.value=!1}}},A=(n,t)=>{const r=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(r)},w=()=>{a.typedocument_id=null,a.documentnumber=null,a.name=null,a.lastname=null,a.middlename=null,a.gender_id=null,a.sick=null,a.email=null,a.phone=null,a.ruc=null,a.socialReason=null,a.economicsector_id=null,a.comercialactivity_id=null},W=async()=>{T.value=!0;const t={slug:q.params.slug,typedocument_id:a.typedocument_id,documentnumber:a.documentnumber,name:a.name,lastname:a.lastname,middlename:a.middlename,gender_id:a.gender_id,sick:a.sick,email:a.email,phone:a.phone,ruc:a.ruc,socialReason:a.socialReason,economicsector_id:a.economicsector_id,comercialactivity_id:a.comercialactivity_id};try{const r=await E({url:"public/attendance-present",method:"POST",data:t});r.status==200&&L.success({title:"REGISTRADO",content:h("div",{},[h("p",r.message)]),onOk(){w(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"}),r.status==400&&L.warning({title:"REGISTRO AVISO",content:h("div",{},[h("p",r.message)]),onOk(){w(),window.scrollTo({top:0,behavior:"smooth"})},class:"attendance-modal"})}catch(r){console.error("Error de red:",r)}finally{T.value=!1}},K=async()=>{try{const n=q.params.slug,t=await E({url:`public/data-attendance/${n}`,method:"GET"});t.status==200&&(U.value=t.data.title,x.value=!1),t.status==400&&router.push("/404"),t.status==500&&(N.value=!0,x.value=!1)}catch(n){console.error("Error de red:",n)}finally{}};return ne(()=>{K()}),(n,t)=>{const r=b("a-input-search"),s=b("a-form-item"),o=b("a-input"),_=b("a-date-picker"),C=b("a-select"),H=b("a-textarea"),Z=b("a-button"),J=b("a-form"),Q=b("a-spin");return c(),v(O,null,[m(Q,{spinning:x.value,indicator:y(P)},{default:u(()=>[d("div",pe,[d("div",be,[N.value?(c(),v("section",ge,t[1]||(t[1]=[d("div",{class:"container"},[d("div",{class:"fair-caducated-info"},[d("img",{src:de,alt:""}),d("h4",null,"LA LISTA NO ESTA DISPONIBLE"),d("p",null,[k("El formulario de inscripción ya no está disponible. "),d("br"),k(" Agradecemos su interés y lo invitamos a estar atento a nuestros próximos eventos.")])])],-1)]))):(c(),v("section",_e,[m(J,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:W,onKeydown:t[0]||(t[0]=oe(se(()=>{},["prevent"]),["enter"]))},{default:u(()=>[d("div",fe,[t[2]||(t[2]=d("h2",null,"REGISTRO DE ASISTENCIA",-1)),d("h3",null,ie(U.value),1)]),d("div",ve,[(c(!0),v(O,null,le(I.value,(e,X)=>(c(),v(O,{key:X},[e.type==="iSearch"?(c(),g(s,{key:0,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,validator:B}]},{default:u(()=>[m(r,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,placeholder:"","enter-button":"BUSCAR",loading:R.value,maxlength:a.typedocument_id===1?8:12,onSearch:V},null,8,["value","onUpdate:value","loading","maxlength"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSearchRuc"?(c(),g(s,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,max:e.max},{pattern:/^(10|15|20)\d{9,}$/,message:"El número debe comenzar con 10, 15 o 20, tener solo números, y al menos 11 caracteres"}]},{default:u(()=>[m(r,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,placeholder:"Ingresar RUC","enter-button":"BUSCAR",loading:D.value,maxlength:e.max,onSearch:Y,disabled:e.disabled},null,8,["value","onUpdate:value","loading","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iText"?(c(),g(s,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,max:e.max},{validator:z}]},{default:u(()=>[m(o,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,maxlength:e.max,onBlur:l=>G(e.name),disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","onBlur","disabled"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iDate"?(c(),g(s,{key:3,name:e.name,label:e.label,rules:[{required:e.required,message:e.message},{validator:F,message:"La edad debe estar entre 18 y 99 años"}]},{default:u(()=>[m(_,{locale:y(ce),value:a[e.name],"onUpdate:value":l=>a[e.name]=l,style:{width:"100%"},format:ye,placeholder:"día/mes/año",disabled:e.disabled},null,8,["locale","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSelect"?(c(),g(s,{key:4,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[m(C,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,options:$(e.name),"show-search":"","filter-option":A,onChange:l=>j(e.name),disabled:e.disabled},null,8,["value","onUpdate:value","options","onChange","disabled"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iTextarea"?(c(),g(s,{key:5,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[m(H,{value:a[e.name],"onUpdate:value":l=>a[e.name]=l,rows:4,maxlength:e.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="iSelectWrite"?(c(),g(s,{key:6,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:u(()=>[e.name=="comercialactivity_id"?(c(),g(C,{key:0,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,"show-search":"",options:y(i).comercialActivities,"filter-option":A,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):p("",!0),e.name=="economicsector_id"?(c(),g(C,{key:1,value:a[e.name],"onUpdate:value":l=>a[e.name]=l,"show-search":"",options:y(i).economicSectors,"filter-option":A,disabled:e.disabled},null,8,["value","onUpdate:value","options","disabled"])):p("",!0)]),_:2},1032,["name","label","rules"])):p("",!0),e.type==="space1"?(c(),v("div",he)):p("",!0)],64))),128))]),m(s,null,{default:u(()=>[m(Z,{type:"primary","html-type":"submit",loading:T.value,class:"attendance-btn"},{default:u(()=>t[3]||(t[3]=[k("REGISTRARSE")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))])])]),_:1},8,["spinning","indicator"]),m(ue)],64)}}};export{Oe as default};
