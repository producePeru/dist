import{p as ae,s as te,E as ne,r as g,a as se,k as re,b,o as l,d as h,c as u,w as m,i as I,e as d,t as U,F as R,L as ie,f as O,j as C,N as oe,O as le,v as de,y as _,z as f,M as ce,h as N,Q as P}from"./index-bbd6fc13.js";import{_ as ue}from"./calendar-e0a6119a.js";import{u as me}from"./selectes-72920aa2.js";import{F as pe}from"./FormalizacionFooter-02e2d320.js";import{u as be}from"./useBusinessman-324d5d43.js";import"./es-d99c0441.js";/* empty css                                                                            */import"./_plugin-vue_export-helper-c27b6911.js";import"./EnvironmentOutlined-5d356006.js";const fe={class:"attendance"},ge={class:"container"},_e={key:0,class:"fair-caducated"},ye={key:1,class:"attendance-section"},ve={class:"attendance-title"},he={class:"attendance-form"},Ee={key:7},Se="DD/MM/YYYY",ke={__name:"IndexAsistencias",setup(xe){ae.locale("es");const w=te(ie,{style:{fontSize:"24px"},spin:!0}),T=ne(),s=me();s.$patch({typeDocuments:s.typeDocuments}),s.$patch({economicSectors:s.economicSectors}),s.$patch({genders:s.genders}),s.fetchEconomicSectors(),s.fetchTypeDocuments(),s.fetchGenders(),s.fetchCities();const q=g({}),M=be(),A=g(!1),S=g(!0),k=g(null),x=g(!1),D=g(!1),$=g(!1),e=se({}),z=[{value:"si",label:"SI"},{value:"no",label:"NO"}],B=n=>{if(console.log("aquiiiiiiiiiiiiiiiiii"),n==="country_id")return s.countries;if(n==="gender_id")return s.genders;if(n==="sick")return z;if(n==="typedocument_id")return s.typeDocuments;if(n=="city_id")return e.province_id=null,e.district_id=null,s.cities;if(n=="province_id")return e.district_id=null,s.provinces;if(n=="district_id")return s.districts},E=g({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO DE IDENTIDAD",name:"typedocument_id",required:!0,message:"Seleccionar tipo",disabled:!1},documentnumber:{type:"iSearch",label:"INGRESE NÚMERO DE IDENTIDAD",name:"documentnumber",required:!0,message:"Escribir tu número de documento",disabled:!0,max:11},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!0,max:50},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir nombre",disabled:!0,max:50},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir nombre",disabled:!0,max:50},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar un tipo de género",disabled:!0},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!0,message:"¿Tiene discapacidad?",disabled:!0},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Ingresar email",email:"email",disabled:!0,max:255},phone:{type:"iText",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe tu num. de celular",disabled:!0,max:9},ruc:{type:"iSearchRuc",label:"NÚMERO DE RUC",name:"ruc",required:!1,message:"Escribir RUC",disabled:!0,max:11},socialReason:{type:"iText",label:"NOMBRE COMERCIAL",name:"socialReason",required:!1,message:"Escribir la razón social",disabled:!1,max:100},economicsector_id:{type:"iSelectWrite",label:"SECTOR ECONÓMICO",name:"economicsector_id",required:!1,message:"Seleccionar sector económnico",disabled:!1},comercialactivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialactivity",required:!1,message:"Seleccionar sector económnico",disabled:!1,max:100},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelect",label:"PROVINCIA DEL NEGOCIO",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelect",label:"DISTRITO DEL NEGOCIO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0}}),F=(n,t)=>{if(!t)return Promise.reject("La fecha es requerida");const r=new Date,i=new Date(t);let c=r.getFullYear()-i.getFullYear();const p=r.getMonth()-i.getMonth();return(p<0||p===0&&r.getDate()<i.getDate())&&c--,c<18||c>99?Promise.reject("La edad debe estar entre 18 y 99 años"):Promise.resolve()},G=(n,t)=>{if(n.field==="phone"){const r=/^9\d{8}$/;if(t){if(!r.test(t))return Promise.reject("El número debe empezar con 9 y tener exactamente 9 dígitos")}else return Promise.reject("El número de teléfono es obligatorio")}return n.field,Promise.resolve()},V=n=>{const t=e[n]?e[n].trim():"";e[n]=t},j=async n=>{console.log("iaiiaiaiia"),n=="typedocument_id"&&(e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.email=null,e.phone=null),n=="city_id"&&(await s.fetchProvinces(e.city_id),q.value.province_id=s.provinces,E.value.province_id.disabled=!1),n=="province_id"&&(await s.fetchDistricts(e.province_id),q.value.district_id=s.districts,E.value.district_id.disabled=!1)},Y=(n,t)=>{const r=e.typedocument_id;return/^\d+$/.test(t)?r===1&&t.length!==8?Promise.reject("Debe tener exactamente 8 caracteres."):r!==1&&t.length>12?Promise.reject("Debe tener exactamente 12 caracteres."):(r===1&&t.startsWith("0")&&t.length===8,Promise.resolve()):Promise.reject("Solo se permiten números.")},W=async()=>{const{typedocument_id:n,documentnumber:t}=e;if(!n||!t){N.error("El tipo de documento y el número de documento no pueden estar vacíos.");return}if(!/^\d+$/.test(t)){N.error("El número de documento solo debe contener caracteres numéricos.");return}if(n===1&&t.length!==8){N.error("El número de documento debe tener exactamente 8 caracteres para el tipo de documento DNI.");return}const r=["name","lastname","middlename","sick","email","phone","gender_id","ruc"],i=c=>{r.forEach(p=>{E.value[p].disabled=c})};try{if(x.value=!0,e.typedocument_id==1){const c={documentnumber:e.documentnumber},p=await O({url:`api/consult-businessman-dni/${e.documentnumber}`,method:"POST"}),{data:y}=p;if(p.status==200)e.lastname=y.lastname,e.middlename=y.middlename,e.name=y.name,e.gender_id=y.gender_id;else if(p.status==404){const v=await M.reniec(c);return v.status==200&&(e.name=v.data.name,e.lastname=v.data.lastname,e.middlename=v.data.middlename),P.warning({message:"Aviso",description:"El servicio de consulta RENIEC no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}else return console.log("Error...")}}catch(c){console.error("Error de red:",c)}finally{i(!1),x.value=!1}},K=async()=>{if(!(/^\d{11}$/.test(e.ruc)&&/^(10|15|20)/.test(e.ruc)))return console.error("El RUC debe tener 11 caracteres, comenzar con 11, 15 o 20, y contener solo números.");D.value=!0;try{const t=await O({url:`api/consult-company-ruc/${e.ruc}`,method:"POST"});if(t.status==200){const{data:r}=t;e.socialReason=r.socialReason}else t.status==404&&P.warning({message:"Aviso",description:"El servicio de consulta SUNAT no está disponible. Por favor, registre los datos manualmente.",duration:2.5})}catch(t){console.log("Error: ",t)}finally{D.value=!1}},L=(n,t)=>{const r=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(r)},Q=async()=>{const t={slug:T.params.slug,typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,name:e.name,lastname:e.lastname,middlename:e.middlename,gender_id:e.gender_id,sick:e.sick,email:e.email,phone:e.phone,ruc:e.ruc,socialReason:e.socialReason,economicsector_id:e.economicsector_id,comercialActivity:e.comercialactivity,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id};return console.log("payload:",t)},H=async()=>{try{const n=T.params.slug,t=await O({url:`public/data-attendance/${n}`,method:"GET"});t.status==200&&(k.value=t.data.title,S.value=!1),t.status==400&&router.push("/404"),t.status==500&&(A.value=!0,S.value=!1)}catch(n){console.error("Error de red:",n)}finally{}};return re(async()=>{await H()}),(n,t)=>{const r=b("a-input-search"),i=b("a-form-item"),c=b("a-input"),p=b("a-date-picker"),y=b("a-select"),v=b("a-textarea"),J=b("a-button"),X=b("a-form"),Z=b("a-spin");return l(),h(R,null,[u(Z,{spinning:S.value,indicator:I(w)},{default:m(()=>[d("div",fe,[d("div",ge,[A.value?(l(),h("section",_e,t[1]||(t[1]=[d("div",{class:"container"},[d("div",{class:"fair-caducated-info"},[d("img",{src:ue,alt:""}),d("h4",null,"EL REGISTRO NO ESTÁ DISPONIBLE"),d("p",null,[C("El formulario de inscripción ya no está disponible. "),d("br"),C(" Agradecemos su interés y lo invitamos a estar atento a nuestros próximos eventos.")])])],-1)]))):(l(),h("section",ye,[u(X,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:Q,onKeydown:t[0]||(t[0]=oe(le(()=>{},["prevent"]),["enter"]))},{default:m(()=>[d("div",ve,[t[2]||(t[2]=d("h2",null,"REGISTRO DE ASISTENCIA",-1)),d("h3",null,U(k.value),1)]),d("div",he,[(l(!0),h(R,null,de(E.value,(a,ee)=>(l(),h(R,{key:ee},[a.type==="iSearch"?(l(),_(i,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,validator:Y}]},{default:m(()=>[u(r,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,placeholder:"","enter-button":"CONSULTAR DNI",loading:x.value,maxlength:e.typedocument_id===1?8:12,onSearch:W},null,8,["value","onUpdate:value","loading","maxlength"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iSearchRuc"?(l(),_(i,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{pattern:/^(10|15|20)\d{9,}$/,message:"El número debe comenzar con 10, 15 o 20, tener solo números, y al menos 11 caracteres"}]},{default:m(()=>[u(r,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,placeholder:"Ingresar RUC","enter-button":"BUSCAR",loading:D.value,maxlength:a.max,onSearch:K,disabled:a.disabled},null,8,["value","onUpdate:value","loading","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iText"?(l(),_(i,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max},{validator:G}]},{default:m(()=>[u(c,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,maxlength:a.max,onBlur:o=>V(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","onBlur","disabled"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iDate"?(l(),_(i,{key:3,name:a.name,label:a.label,rules:[{required:a.required,message:a.message},{validator:F,message:"La edad debe estar entre 18 y 99 años"}]},{default:m(()=>[u(p,{locale:I(ce),value:e[a.name],"onUpdate:value":o=>e[a.name]=o,style:{width:"100%"},format:Se,placeholder:"día/mes/año",disabled:a.disabled},null,8,["locale","value","onUpdate:value","disabled"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iSelect"?(l(),_(i,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[u(y,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:B(a.name),"show-search":"","filter-option":L,onChange:o=>j(a.name),disabled:a.disabled},null,8,["value","onUpdate:value","options","onChange","disabled"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iTextarea"?(l(),_(i,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[u(v,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,rows:4,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="iSelectWrite"?(l(),_(i,{key:6,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:m(()=>[a.name=="economicsector_id"?(l(),_(y,{key:0,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,"show-search":"",options:I(s).economicSectors,"filter-option":L,disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])):f("",!0)]),_:2},1032,["name","label","rules"])):f("",!0),a.type==="space1"?(l(),h("div",Ee)):f("",!0)],64))),128))]),u(i,null,{default:m(()=>[u(J,{type:"primary","html-type":"submit",loading:$.value,class:"attendance-btn"},{default:m(()=>t[3]||(t[3]=[C("REGISTRARSE")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]))])])]),_:1},8,["spinning","indicator"]),d("pre",null,U(e),1),u(pe)],64)}}};export{ke as default};
