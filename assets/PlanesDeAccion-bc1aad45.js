import{_ as re}from"./icoexcel-1b303edf.js";import{L as Y,r as v,a as Q,b as m,o as i,d as z,c as r,w as _,e as M,F as Z,x as de,q as p,s as d,h as E,M as ce,i as R,m as A,z as T,g as ue,H as pe,I as me,k as _e,t as K}from"./index-82550cb7.js";import{u as ee}from"./selectes-4a1e1ee8.js";import"./es-8385b054.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";const ge={numberDocument:{type:"iSearch",label:"Número de documento",name:"numberDocument",required:!0,message:"Ingresar Número de documento",disabled:!1},namePerson:{type:"iText",label:"Nombre",name:"namePerson",required:!0,message:"Escribe nombre",disabled:!0},city_id:{type:"iSelectWrite",label:"Región del negocio",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelectWrite",label:"Provincia del negocio",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelectWrite",label:"Distrito del negocio",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},gender_id:{type:"iSelect",label:"Género",name:"gender_id",required:!0,message:"Seleccionar género",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"Seleccionar estado",disabled:!0},ruc:{type:"iSearch",label:"Número de RUC",name:"ruc",required:!0,message:"Escribe el número de RUC",disabled:!1},divider:{type:"iDivider"},component_1:{type:"iSelectWrite",is:"component",label:"Componente 1",name:"component_1",required:!0,message:"Seleccionar componente 1",disabled:!1},component_2:{type:"iSelectWrite",is:"component",label:"Componente 2",name:"component_2",required:!1,message:"Seleccionar componente 2",disabled:!1},component_3:{type:"iSelectWrite",is:"component",label:"Componente 3",name:"component_3",required:!1,message:"Seleccionar componente 3",disabled:!1},startDate:{type:"iDate",label:"Día Inicio",name:"startDate",required:!0,message:"Seleccionar fecha de inicio",placeholder:"año-mes-día"},endDate:{type:"iDate",label:"Día Fin",name:"endDate",required:!0,message:"Seleccionar fecha de fin",placeholder:"año-mes-día"}};const he={class:"grid-planes"},fe="DD/MM/YYYY",be={__name:"NuevoPlanAccion",emits:["closeDraw"],setup(V,{emit:S}){Y.locale("es");const f=JSON.parse(localStorage.getItem("profile")),N=S,o=ee();o.$patch({cities:o.cities}),o.$patch({genders:o.genders}),o.$patch({components:o.components}),o.fetchCities(),o.fetchGenders(),o.fetchComponents();const I=v(ge),C=v(!1),D=v(null),O=[{value:1,label:"DNI"},{value:2,label:"RUC"}],H=[{label:"Si",value:"yes"},{label:"No",value:"no"}],a=Q({numberDocument:null,component_1:null,component_2:null,component_3:null}),$=l=>l&&l>Y().endOf("day"),k=l=>{a[l]=a[l].replace(/\D/g,"")},U=(l,n)=>{const g=l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(g)},F=async l=>{if(!a.numberDocument)return A.warning("Ingrese un número a buscar...");try{if(l=="numberDocument"){D.value=l;const n=await T({url:`person/data/${a.numberDocument}`,method:"GET"});if(n.status==404)return D.value=null,a.numberDocument=null,A.warning("Este usuario no fue registrado");n.status==200&&(a.idPerson=n.data.id,a.namePerson=n.data.namePerson,a.city_id=n.data.city_id,B(n.data.city_id),a.province_id=n.data.province_id,G(n.data.province_id),a.district_id=n.data.district_id,a.gender_id=n.data.gender_id,a.sick=n.data.sick)}if(l=="ruc"){D.value=l;const n=await T({url:`plans-action/components/${a.ruc}`,method:"GET"});if(n.status==200){const g=n.data;g.component_1&&(a.component_1=g.component_1),g.component_2&&(a.component_2=g.component_2),g.component_3&&(a.component_3=g.component_3),g.endDate&&(a.endDate=Y(g.endDate,"YYYY-MM-DD"))}else return D.value=null,a.ruc=null,A.warning("No se han registrado datos con ese número de RUC")}}catch{console.log("Failed to update record")}finally{D.value=null}},B=l=>{a.province_id=null,a.district_id=null,o.fetchProvinces(l)},G=l=>{a.district_id=null,o.fetchDistricts(l)},q=(l,n)=>{Object.keys(a).filter(c=>c!==n&&c.startsWith("component_")).some(c=>a[c]===l)?(a[n]=null,console.error("Opción ya seleccionada en otro campo")):a[n]=l},W=async()=>{C.value=!0;const l={people_id:a.idPerson,cde_id:f.cde_id,component_1:a.component_1,component_2:a.component_2,component_3:a.component_3,ruc:a.ruc,startDate:Y(a.startDate).format("YYYY-MM-DD"),endDate:Y(a.endDate).format("YYYY-MM-DD")};try{const n=await T({url:"plans-action/create",method:"POST",data:l});n.status==200&&(A.success(n.message),N("closeDraw")),n.status==400&&A.warning(n.message)}catch{console.log("Failed to update record")}finally{C.value=!1}};return(l,n)=>{const g=m("a-input"),c=m("a-form-item"),x=m("a-select"),j=m("a-input-search"),J=m("a-divider"),w=m("a-date-picker"),X=m("a-button"),u=m("a-form");return i(),z("div",null,[r(u,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:W},{default:_(()=>[M("div",he,[(i(!0),z(Z,null,de(I.value,(e,b)=>(i(),z(Z,{key:b},[e.type==="iText"?(i(),p(c,{key:0,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:_(()=>[r(g,{value:a[e.name],"onUpdate:value":t=>a[e.name]=t,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iSelect"?(i(),p(c,{key:1,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[e.name=="typeDocument"?(i(),p(x,{key:0,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:O},null,8,["value","onUpdate:value"])):d("",!0),e.name=="gender_id"?(i(),p(x,{key:1,disabled:e.disabled,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:E(o).genders},null,8,["disabled","value","onUpdate:value","options"])):d("",!0),e.name=="sick"?(i(),p(x,{key:2,disabled:e.disabled,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,options:H},null,8,["disabled","value","onUpdate:value"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iSearch"?(i(),p(c,{key:2,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[r(j,{loading:D.value==e.name,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,onSearch:t=>F(e.name),onInput:t=>k(e.name),onEnterButton:t=>F(e.name),maxlength:11},null,8,["loading","value","onUpdate:value","onSearch","onInput","onEnterButton"])]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iDivider"?(i(),p(J,{key:3,dashed:"",style:{"grid-column":"1/3",margin:".5rem 0 1rem 0"}})):d("",!0),e.type==="iSelectWrite"?(i(),p(c,{key:4,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[e.name=="city_id"?(i(),p(x,{key:0,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(o).cities,"filter-option":U,onChange:B},null,8,["value","onUpdate:value","options"])):d("",!0),e.name=="province_id"?(i(),p(x,{key:1,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(o).provinces,"filter-option":U,onChange:G,disabled:!a.city_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.name=="district_id"?(i(),p(x,{key:2,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(o).districts,"filter-option":U,disabled:!a.province_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),e.is=="component"?(i(),p(x,{key:3,value:a[e.name],"onUpdate:value":t=>a[e.name]=t,"show-search":"",options:E(o).components,"filter-option":U,onChange:t=>q(t,e.name)},null,8,["value","onUpdate:value","options","onChange"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iDate"?(i(),p(c,{key:5,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:_(()=>[r(w,{"disabled-date":$,locale:E(ce),value:a[e.name],"onUpdate:value":t=>a[e.name]=t,style:{width:"100%"},format:fe,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0)],64))),128))]),r(c,null,{default:_(()=>[r(X,{class:"btn-produce",type:"primary","html-type":"submit",loading:C.value},{default:_(()=>[R("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},ye=ve(be,[["__scopeId","data-v-b978611b"]]),De=ue.get("token"),we="https://apituempresa.soporte-pnte.com/api/",Ce="http://127.0.0.1:8000/api/",xe=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?Ce:we;async function Ee(V,S){try{S(!0);const f=await pe({url:`${xe}${V}`,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${De}`},method:"GET",responseType:"blob"}),N=window.URL.createObjectURL(new Blob([f.data])),o=document.createElement("a");o.href=N;const I=f.headers["content-disposition"],C=I?I.split("filename=")[1].split(";")[0]:"reporte.xlsx";o.setAttribute("download",C),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(f){console.error("Error al descargar el archivo:",f)}finally{S(!1)}}const Se=M("h3",{class:"title-produce"},"PLANES DE ACCIÓN",-1),Ie=M("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:re},null,-1),Ue={class:"paginator"},Ae={__name:"PlanesDeAccion",setup(V){const S=JSON.parse(localStorage.getItem("role")),f=ee();f.$patch({components:f.components}),f.fetchComponents(),v(null);const N=v(!1);v();const o=v(50),I=v([]),C=v(!1),D=v(0),O=v({page:1}),H=v("plans-action/list"),a=v(1200),$=v(window.innerHeight-100),k=v(!1);v(null);const U=v([{value:"si",label:"SI"},{value:"no",label:"NO"}]),F=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},...S[0].id!=2?[{title:"CENTRO TU EMPRESA",dataIndex:"centro_empresa",fixed:"left",width:150}]:[],...S[0].id!=2?[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180}]:[],{title:"RUC",dataIndex:"ruc",width:100,fixed:"left",align:"center"},{title:"NOMBRE DEL EMPRENDEDOR O MYPE",fixed:"left",dataIndex:"emprendedor_nombres",width:170},{title:"REGIÓN DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_region",width:170},{title:"PROVINCIA DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_provincia",width:170},{title:"DISTRITO DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_distrito",width:170},{title:"Genero",dataIndex:"genero",width:60,align:"center"},{title:"Tiene alguna Discapacidad ? (SI / NO)",dataIndex:"discapacidad",width:110,align:"center"},{title:"COMPONENTE 1",dataIndex:"component1",width:190,align:"center"},{title:"COMPONENTE 2",dataIndex:"component2",width:190,align:"center"},{title:"COMPONENTE 3",dataIndex:"component3",width:190,align:"center"},{title:"NÚMERO DE SESIONES",dataIndex:"numberSessions",width:100,align:"center"},{title:"DÍA INICIO",dataIndex:"startDate",width:100,align:"center"},{title:"DÍA FIN",dataIndex:"endDate",width:100,align:"center"},{title:"TOTAL DE DÍAS",dataIndex:"totalDate",width:100,align:"center"},{title:"ACTA DE COMPROMISO",dataIndex:"acta",width:160,align:"center"},{title:"CULMINÓ EL PLAN Y ENVIÓ CORREO",dataIndex:"envioCorreo",width:160,align:"center"},{title:"FECHA ACTUALIZACIÓN",dataIndex:"updated_at",width:140,align:"center"}],B=u=>{N.value=u},G=async()=>{Ee("download/actions-plans",B)},q=async(u,e,b)=>{const t={idPlan:e.id,nameComponent:b,valueComponent:u},P=await T({url:"plans-action/edit-component",method:"PUT",data:t});P.status==200&&w(),P.status==400&&(A.warning(P.message),w())},W=async(u,e,b)=>{const t={idPlan:e.id,type:b,value:u};(await T({url:"plans-action/edit-yes-no",method:"PUT",data:t})).status==200&&w()},l=(u,e)=>{const b=u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(b)},n=()=>{$.value=window.innerHeight-315},g=()=>{k.value=!1,w()},c=Q({search:""}),x=()=>{w({search:c.search})},j=()=>{c.search||w()},J=u=>{O.value.page=u,w()},w=async u=>{try{C.value=!0;const e=O.value.page===1?"":O.value,b=u?{...e,...u}:e,t=await T({url:H.value,method:"GET",params:b});I.value=t.data,D.value=t.pagination.total,o.value=t.pagination.per_page}catch(e){console.error("Error de red:",e)}finally{C.value=!1}},X=me(()=>u=>(O.value.page-1)*o.value+u+1);return _e(()=>{w(),window.addEventListener("resize",n),n()}),(u,e)=>{const b=m("a-button"),t=m("a-col"),P=m("a-input"),ae=m("a-input-group"),te=m("a-row"),L=m("a-select"),ne=m("a-table"),oe=m("a-tag"),le=m("a-pagination"),ie=m("a-drawer");return i(),z("div",null,[Se,r(te,{style:{margin:"1rem 0"}},{default:_(()=>[r(t,{xs:24,md:12,lg:18},{default:_(()=>[r(b,{onClick:e[0]||(e[0]=y=>k.value=!0),type:"primary"},{default:_(()=>[R("NUEVO")]),_:1}),r(b,{class:"btn-excel",loading:N.value,type:"primary",style:{"margin-left":".6rem"},onClick:G},{default:_(()=>[Ie,R(" DESCARGAR ")]),_:1},8,["loading"])]),_:1}),r(t,{xs:24,md:12,lg:6},{default:_(()=>[r(ae,{compact:""},{default:_(()=>[r(P,{value:c.search,"onUpdate:value":e[1]||(e[1]=y=>c.search=y),style:{width:"calc(100% - 80px)"},onInput:j},null,8,["value"]),r(b,{type:"primary",disabled:c.search==="",onClick:x},{default:_(()=>[R("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),r(ne,{bordered:"",scroll:{x:a.value,y:$.value},class:"table-users",columns:F,"data-source":I.value,pagination:!1,loading:C.value,size:"small"},{bodyCell:_(({column:y,record:h,index:se})=>[y.dataIndex==="idx"?(i(),z(Z,{key:0},[R(K(X.value(se)),1)],64)):d("",!0),y.dataIndex==="component1"?(i(),p(L,{key:1,style:{width:"170px"},value:h.component_1,"onUpdate:value":s=>h.component_1=s,options:E(f).components,"filter-option":l,onChange:s=>q(s,h,"component_1")},null,8,["value","onUpdate:value","options","onChange"])):d("",!0),y.dataIndex==="component2"?(i(),p(L,{key:2,style:{width:"170px"},value:h.component_2,"onUpdate:value":s=>h.component_2=s,options:E(f).components,"filter-option":l,onChange:s=>q(s,h,"component_2")},null,8,["value","onUpdate:value","options","onChange"])):d("",!0),y.dataIndex==="component3"?(i(),p(L,{key:3,style:{width:"170px"},value:h.component_3,"onUpdate:value":s=>h.component_3=s,options:E(f).components,"filter-option":l,onChange:s=>q(s,h,"component_3")},null,8,["value","onUpdate:value","options","onChange"])):d("",!0),y.dataIndex==="acta"?(i(),p(L,{key:4,value:h.actaCompromiso,"onUpdate:value":s=>h.actaCompromiso=s,style:{width:"70%"},options:U.value,onChange:s=>W(s,h,"actaCompromiso")},null,8,["value","onUpdate:value","options","onChange"])):d("",!0),y.dataIndex==="envioCorreo"?(i(),p(L,{key:5,value:h.envioCorreo,"onUpdate:value":s=>h.envioCorreo=s,style:{width:"70%"},options:U.value,onChange:s=>W(s,h,"envioCorreo")},null,8,["value","onUpdate:value","options","onChange"])):d("",!0)]),_:1},8,["scroll","data-source","loading"]),M("div",Ue,[M("span",null,[r(oe,{color:"blue"},{default:_(()=>[M("b",null,K(D.value),1)]),_:1}),R("Registros")]),r(le,{size:"small",total:D.value,pageSize:o.value,onChange:J,showSizeChanger:!1},null,8,["total","pageSize"])]),r(ie,{open:k.value,"onUpdate:open":e[2]||(e[2]=y=>k.value=y),title:"Agregar un nuevo Plan de Acción",placement:"right",width:"650"},{default:_(()=>[r(ye,{onCloseDraw:g})]),_:1},8,["open"])])}}};export{Ae as default};
