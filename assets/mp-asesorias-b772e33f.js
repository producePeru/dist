import{_ as ee}from"./TableComponent-420d8bc4.js";import{p as m,r as l,a as j,k as Z,T as ae,W as q,b as M,o as d,y as W,i as y,L as te,d as p,c as i,w as O,e as n,F as Q,v as K,j as L,$ as ne,z as I,h as V,m as X,u as se,t as S,n as le}from"./index-97c66ec9.js";import{_ as oe}from"./FormComponent-c87cb0e7.js";import{u as ie}from"./selectes-238909f3.js";import{U as re}from"./UpImage-f8127d84.js";import"./es-b4be28ac.js";import{u as de,t as ce}from"./timezone-e6d7537b.js";import"./downloadExcel-492cc3ce.js";import{G as ue}from"./GlobalOutlined-1b62d2ec.js";import{U as me}from"./UserOutlined-77276a43.js";import{M as pe}from"./MailOutlined-f3f1213a.js";import{P as fe}from"./PhoneOutlined-33753d42.js";import{S as _e}from"./SaveOutlined-1b0dc931.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-478f3a04.js";import"./MoreOutlined-81704372.js";import"./quill.snow-03c502f5.js";import"./_plugin-vue_export-helper-c27b6911.js";const he={key:1,class:"mp-asesoria"},ge={key:0},ve={class:"as-personalizada"},Se={__name:"DrawMPAsesorias",props:["info"],emits:["closeDraw"],setup(J,{emit:P}){m.locale("es"),m.extend(de),m.extend(ce);const H=l({title:{type:"iText",label:"NOMBRE DEL EVENTO",name:"title",required:!0,message:"Escribir nombre del evento",disabled:!1,max:255},description:{type:"iTextArea",label:"DESCRIPCIÓN DEL EVENTO",name:"description",required:!0,message:"Escribir nombre del evento",disabled:!1,rows:6,max:250},requirements:{type:"iQuillEditor",label:"MENSAJE DE LOS REQUISITOS",name:"requirements",required:!0,message:"Escribir los requisitos",disabled:!1,class:"quill-height-200"},capacitador_id:{type:"iSelect",label:"ASESOR DE LA ASESORÍA",name:"capacitador_id",required:!0,message:"Seleccionar capacitador",disabled:!1},imgBanner:{type:"iSlot",name:"iSlotOptions"}}),C=ie(),E=P,o=J,_=l(!0),z=l("GUARDAR"),t=j({}),N=l(!1),R=l(null),B=l(null),U=l({city_id:[],fairtype_id:[],modality_id:[],capacitador_id:[]}),u=j({schedules:[{date:null,startTime:null}]}),$=()=>{u.schedules.push({date:""})},F=e=>{u.schedules.splice(e,1)},Y=()=>o.info?{name:o.info.image_name,url:o.info.image_url}:null,A=e=>{e=="modality_id"&&console.log("a9a9a9a99a9a9")},s=async e=>{e=="dateReception"&&(t.dateTramite&&(t.dateTramite=null),H.value.dateTramite.disabled=!1)},f=async e=>{R.value=e.id},T=async e=>{e=="city_id"&&(t.city_id=null),e=="capacitador_id"&&(U.value.capacitadores=C.capacitadores)},G=async(e,a)=>{},h=async()=>{var a,x;const e=R.value??((x=(a=o.info)==null?void 0:a.image)==null?void 0:x.id);if(!u.schedules.length){V.error("Debe agregar al menos una fecha y horario.");return}for(const c of u.schedules)if(!c.date||!c.startTime||c.startTime.length!==2){V.error("Todas las fechas deben tener rango de horario válido.");return}N.value=!0;try{const c={title:t.title,description:t.description,requirements:t.requirements,capacitador_id:t.capacitador_id,image_id:e,link:t.link,schedules:u.schedules.map(w=>({date:m(w.date).format("YYYY-MM-DD"),startTime:m(w.startTime[0]).format("HH:mm"),endTime:m(w.startTime[1]).format("HH:mm")}))},v=o.info?`mp/update-personalized-advice/${o.info.id}`:"mp/create-personalized-advice",D=o.info?"PUT":"POST",b=await X({url:v,method:D,data:c});b.status===200&&(V.success(b.message),g(),E("closeDraw",!0))}catch(c){console.error("Error:",c);const v=document.getElementsByClassName("ant-drawer-body")[0];v&&(v.scrollTop=0)}finally{N.value=!1}},g=()=>{for(const e in t)delete t[e];u.schedules=[{date:null,startTime:null}],R.value=null},r=async e=>{_.value=!0;try{e&&(t.title=e.title,t.description=e.description,t.requirements=e.requirements,t.capacitador_id=e.capacitador_id,u.schedules=[],e.schedules&&e.schedules.length>0&&(u.schedules=e.schedules.map(a=>({date:m(a.date),startTime:[m(a.startTime,"HH:mm"),m(a.endTime,"HH:mm")]}))))}catch(a){console.error("Error al cargar la información:",a)}finally{_.value=!1}};return Z(async()=>{o.info?r(o.info):_.value=!1,await C.fetchCapacitadores(),U.value.capacitador_id=C.capacitadores}),ae(()=>o.info,e=>{e?r(e):g()}),q("formState",t),q("loadingState",N),(e,a)=>{const x=M("a-date-picker"),c=M("a-time-range-picker"),v=M("a-button");return _.value?(d(),W(y(te),{key:0,style:{color:"#00a6db"}})):(d(),p("div",he,[i(oe,{fields:H.value,options:U.value,btnSaveName:z.value,onHandleInputEvent:A,resetSelect:B.value,onHandleFocusSelect:T,onHandleChangeSelect:G,onHandleChangeClock:s,onOnSubmit:h},{default:O(({field:D})=>[D.name=="iSlotOptions"?(d(),p("div",ge,[n("div",null,[(d(!0),p(Q,null,K(u.schedules,(b,w)=>(d(),p("div",{class:"as-dates",key:w},[n("label",null,[a[0]||(a[0]=L(" FECHA DE LA ASESORÍA ")),i(x,{value:b.date,"onUpdate:value":k=>b.date=k,style:{width:"100%","margin-bottom":"8px"},format:"DD/MM/YYYY",placeholder:"Seleccionar fecha","disabled-date":k=>k&&k<y(m)().startOf("day")},null,8,["value","onUpdate:value","disabled-date"])]),n("label",null,[a[1]||(a[1]=L(" HORARIO DE LA ASESORÍA ")),i(c,{value:b.startTime,"onUpdate:value":k=>b.startTime=k,style:{width:"100%","margin-bottom":"8px"},format:"HH:mm"},null,8,["value","onUpdate:value"])]),w!=0?(d(),W(y(ne),{key:0,class:"as-date-delete",onClick:k=>F(w)},null,8,["onClick"])):I("",!0)]))),128)),i(v,{type:"dashed",block:"",onClick:$,style:{"margin-bottom":"2rem"}},{default:O(()=>a[2]||(a[2]=[L(" + Agregar fecha y horario ")])),_:1})]),n("div",ve,[a[3]||(a[3]=n("label",null,"CARGAR IMAGEN",-1)),i(re,{"accept-formats":["image/jpeg","image/png"],maxImages:1,nameType:"mp",onUploadSuccess:f,imageLoad:Y()},null,8,["imageLoad"])])])):I("",!0)]),_:1},8,["fields","options","btnSaveName","resetSelect"])]))}}};const ye={class:"layout-content"},Ee=["href"],Ae={style:{display:"flex","align-items":"center",gap:"5px"}},Te={key:0},xe={style:{"font-weight":"500"}},be={style:{"font-size":"13px"}},we={style:{"font-size":"13px"}},ke=["innerHTML"],Oe=["onClick"],je={__name:"mp-asesorias",setup(J){JSON.parse(localStorage.getItem("role"));const P=l([]),H=l(0),C=l(150),E=l(!1);l(!1),se();const o=l(!1),_=l(null),z=l(!1),t=j({page:1}),N=[{title:"#",dataIndex:"idx",align:"center",width:50,fixed:"left"},{title:"TEMA",dataIndex:"title",width:140},{title:"DESCRIPCIÓN",dataIndex:"description",width:200},{title:"HORARIO",dataIndex:"hours",width:220},{title:"REQUISITOS",dataIndex:"requirements",width:160},{title:"CAPACITADOR",dataIndex:"capacitador_name",width:160},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],R=s=>s?m(s,["HH:mm:ss","HH:mm"]).format("hh:mm A"):null,B=s=>{_.value=s,E.value=!0},U=()=>{A(),E.value=!1},u=()=>{_.value=null,E.value=!0},$=async()=>{},F=async s=>{t.page=s,await A()},Y=async s=>{s&&(t.page=1,await A())},A=async()=>{try{o.value=!0;const s={page:t.page},f=await X({url:"mp/mp-index-advice",method:"GET",params:s}),{data:T}=f;P.value=T.data,H.value=T.total,C.value=T.per_page}catch(s){console.error("Error de red:",s)}finally{o.value=!1}};return Z(async()=>{await A()}),q("search",t),q("loading",o),q("loadingFile",z),(s,f)=>{const T=M("a-menu-item"),G=M("a-drawer");return d(),p("div",ye,[i(ee,{title:"ASESORÍAS PERSONALIZADAS",new:!0,textNuevo:"NUEVO",placeholderSearch:"Buscar",columns:N,titleSearch:"BUSCAR POR EVENTO",pageSize:C.value,nameTotal:"Capacitaciones",dataSource:P.value,total:H.value,btnUpdate:!0,onHandleNew:u,onHandleCallFetchData:A,onHandleDownloadExcel:$,onHandleSearch:Y,onHandlePaginator:F},{header:O(()=>f[1]||(f[1]=[])),"data-cell":O(({column:h,record:g})=>[h.dataIndex=="link"?(d(),p(Q,{key:0},[g.link?(d(),p("a",{key:0,target:"'_blank'",href:g.link,style:{color:"#7d4fc6","font-size":"16px","margin-top":"-2px"}},[i(y(ue))],8,Ee)):I("",!0)],64)):I("",!0),h.dataIndex=="hours"?(d(!0),p(Q,{key:1},K(g.schedules,(r,e)=>{var a,x,c,v,D;return d(),p("div",{class:"hour-participant",key:e},[n("div",{class:le(r.participant?"hour-participant-detail":"hour-participant-no-detail")},[n("span",null,S(r.date_format),1),f[2]||(f[2]=L(" | ")),n("span",null,S(R(r.startTime))+" - "+S(R(r.endTime)),1),n("div",Ae,[r.participant?(d(),p("div",Te,[n("div",null,[n("span",xe,[i(y(me)),L(" "+S((a=r.participant)==null?void 0:a.names)+" "+S((x=r.participant)==null?void 0:x.last_name)+" "+S((c=r.participant)==null?void 0:c.middle_name),1)])]),n("div",null,[i(y(pe),{style:{"padding-right":"5px"}}),n("span",be,S((v=r.participant)==null?void 0:v.email),1)]),n("div",null,[i(y(fe),{style:{"padding-right":"5px"}}),n("span",we,S((D=r.participant)==null?void 0:D.phone),1)]),n("div",null,[i(y(_e),{style:{"padding-right":"5px"}}),n("span",null,S(g.created_at),1)])])):I("",!0)])],2)])}),128)):I("",!0),h.dataIndex=="requirements"?(d(),p("div",{key:2,innerHTML:g.requirements},null,8,ke)):I("",!0)]),"custom-options":O(({record:h})=>[i(T,null,{default:O(()=>[n("a",{onClick:g=>B(h)},"Editar",8,Oe)]),_:2},1024)]),_:1},8,["pageSize","dataSource","total"]),i(G,{open:E.value,"onUpdate:open":f[0]||(f[0]=h=>E.value=h),title:_.value?"EDITAR ASESORÍA":"REGISTRAR UNA ASESORÍA",placement:"right",width:"550"},{default:O(()=>[i(Se,{onCloseDraw:U,info:_.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{je as default};
