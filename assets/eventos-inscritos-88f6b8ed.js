import{p as K,r,a as Y,k as Z,U as _e,X,o as R,y as W,i as U,L as ve,d as G,c as n,m as F,E as fe,g as Ee,G as be,a3 as ye,b as i,e as u,w as o,j as L,a4 as he,t as j,F as we,z as J,a2 as Ce,O as xe,s as Se,h as Oe,K as Ie}from"./index-29ead3f6.js";import{_ as Re}from"./icoexcel-1b303edf.js";import{_ as Ne}from"./FormComponent-3f90cd54.js";import{u as Ae}from"./selectes-ef9758fb.js";import"./es-8df219f7.js";import{M as De}from"./MoreOutlined-9abb0882.js";import"./quill.snow-e98640c3.js";const Te={key:1,class:"f-20"},ke={__name:"EventosUgoAsistentes",props:["info","typeEvent"],emits:["closeDraw"],setup(V,{emit:N}){K.locale("es");const p=Ae(),M=JSON.parse(localStorage.getItem("role")),P=N,_=V;p.fetchCities();const C=r({typedocument_id:{type:"iSelect",label:"TIPO DE DOCUMENTO",name:"typedocument_id",required:!0,message:"Seleccionar tipo de documento",disabled:!1},documentnumber:{type:"iText",label:"NÚMERO DE DOCUMENTO",name:"documentnumber",required:!0,message:"Escribe número de documento",disabled:!M.some(t=>t.id==1||t.id==5),rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("Escribe número de documento"));const d=String(s);if(!/^\d+$/.test(d))return Promise.reject(new Error("Solo números son permitidos"));if(e.typedocument_id===1){if(d.length!==8)return Promise.reject(new Error("Debe tener exactamente 8 dígitos"))}else if(d.length<3||d.length>10)return Promise.reject(new Error("Debe tener entre 3 y 10 dígitos"));return Promise.resolve()},trigger:"change"}]},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Escribir apellido",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Escribir apellido",disabled:!1},name:{type:"iText",label:"NOMBRES",name:"name",required:!0,message:"Escribir nombre",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccionar tipo de documento"},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(t,s)=>{if(!s)return Promise.reject(new Error("El número es requerido"));const d=s.toString();return d.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):d.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},email:{type:"iText",label:"CORREO ELECTRÓNICO",name:"email",required:!1,message:"Escribir un email válido",disabled:!1,rules:[{validator:(t,s)=>s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?Promise.resolve():Promise.reject(new Error("Debe ingresar un email válido")):Promise.resolve(),trigger:"change"}]},sick:{type:"iSelect",label:"¿TIENE ALGUNA DISCAPACIDAD?",name:"sick",required:!1,message:"Seleccionar"},ruc:{type:"iText",label:"RUC",name:"ruc",required:!1,message:"Escribir nombre",disabled:!1},comercialName:{type:"iText",label:"NOMBRE COMERCIAL",name:"comercialName",required:!1,message:"Escribir nombre",disabled:!1},comercialActivity:{type:"iText",label:"ACTIVIDAD COMERCIAL",name:"comercialActivity",required:!1,message:"Escribir nombre",disabled:!1},..._.typeEvent===3&&{mercado:{type:"iText",label:"MERCADO",name:"mercado",required:!1,message:"Escribir nombre",disabled:!1}}}),v=r(!0),b=r("ACTUALIZAR"),e=Y({}),f=r(!1),x=r(null),m=r({typedocument_id:[],gender_id:[],sick:[]}),y=t=>{console.log("handleInputEvent",t)},B=async t=>{t=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),C.value.dateTramite.disabled=!1)},A=async t=>{},S=async t=>{t=="typedocument_id"&&(m.value.typedocument_id=p.typeDocuments),t=="gender_id"&&(m.value.gender_id=p.genders),t=="sick"&&T()},D=t=>{},T=()=>{m.value.sick=[{value:"si",label:"SI"},{value:"no",label:"NO"}]},E=async()=>{f.value=!0;const t={typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,gender_id:e.gender_id,phone:e.phone,email:e.email,ruc:e.ruc,comercialName:e.comercialName,comercialActivity:e.comercialActivity,mercado:e.mercado,sick:e.sick};try{(await F({url:`events-ugo/update-participant-data-ugo-event/${_.info.id}`,method:"PUT",data:t})).status===200&&($(),P("closeDraw",!0))}catch(s){console.error("Error:",s);const d=document.getElementsByClassName("ant-drawer-body")[0];d&&(d.scrollTop=0)}finally{f.value=!1}},$=()=>{e.typedocument_id=null,e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.country_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.birthday=null,e.phone=null,e.email=null,e.gender_id=null,e.sick=null,e.hasSoon=null},k=async t=>{v.value=!0;try{t&&(await p.fetchTypeDocuments(),m.value.typedocument_id=p.typeDocuments,e.typedocument_id=t.typedocument_id,e.documentnumber=t.documentnumber,e.lastname=t.lastname,e.middlename=t.middlename,e.name=t.name,e.phone=t.phone,e.email=t.email,await p.fetchGenders(),m.value.gender_id=p.genders,e.gender_id=t.gender_id,T(),e.sick=t.sick,e.ruc=t.ruc,e.comercialName=t.comercialName,e.comercialActivity=t.comercialActivity,e.mercado=t.mercado)}catch(s){console.error("Error al cargar la información:",s)}finally{v.value=!1}};return Z(()=>{_.info&&k(_.info)}),_e(()=>_.info,t=>{t&&k(t)}),X("formState",e),X("loadingState",f),(t,s)=>v.value?(R(),W(U(ve),{key:0,style:{color:"#00a6db"}})):(R(),G("div",Te,[n(Ne,{fields:C.value,options:m.value,btnSaveName:b.value,onHandleInputEvent:y,resetSelect:x.value,onHandleChangeSelect:A,onHandleFocusSelect:S,onHandleBlurSelect:D,onHandleChangeClock:B,onOnSubmit:E},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const Le={class:"layout-content"},Ue={class:"title-produce"},Me={style:{color:"var(--secondary)"}},Pe=["onClick"],Be={class:"paginator"},He={__name:"eventos-inscritos",setup(V){K.locale("es");const N=fe(),p=Ee.get("token"),M="https://apituempresa.soporte-pnte.com/api/",P="http://127.0.0.1:8000/api/",_=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?P:M,C=r(""),v=r(null),b=r(!1),e=r(null),f=r(!1),x=r(0),m=r(50),y=r({page:0}),B=r(1200),A=r([]),S=r(!1),D=r(window.innerHeight-100),T=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"REGISTRADO",dataIndex:"created_at",fixed:"left",width:120,align:"center"},{title:"APELLIDOS",dataIndex:"lastname",fixed:"left",width:160},{title:"NOMBRES ",dataIndex:"name",width:160,fixed:"left"},{title:"TIPO DOCUMENTO",dataIndex:"typedocument_name",width:100,align:"center"},{title:"NÚMERO DE DOCUMENTO",dataIndex:"documentnumber",align:"center",width:140},{title:"CELULAR",dataIndex:"phone",width:150,align:"center"},{title:"CORREO",dataIndex:"email",width:250},{title:"GÉNERO",dataIndex:"gender_name",align:"center",width:100},{title:"RUC",dataIndex:"ruc",align:"center",width:120},{title:"NOMBRE COMERCIAL",dataIndex:"comercialName",align:"center",width:140},{title:"RUBRO / ACTIVIDAD COMERCIAL",dataIndex:"comercialActivity",align:"center",width:200},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],E=Y({search:""}),$=()=>{h(),b.value=!1},k=l=>{e.value=l,b.value=!0},t=()=>{let l={search:E.search};h(l)},s=()=>{E.search||h()},d=l=>{y.value.page=l,h()},q=()=>{D.value=window.innerHeight-320},ee=async l=>{try{const a=await F({url:`events-ugo/remove-participant-ugo-event/${l.id}`,method:"DELETE"});a.status==200&&(h(),Oe.success(a.message))}catch(a){console.error("Error de red:",a)}},te=be(()=>l=>y.value.page*m.value+l+1),h=async l=>{try{S.value=!0;let a;a=y.value.page==0?"":y.value,a=l?{...a,...l}:a;const O=N.params.slug,g=await F({url:`attendance/applicants/${O}`,method:"GET",params:a});C.value=g.nameEvent,v.value=g.typeEvent;const c=g.data;A.value=c==null?void 0:c.data,x.value=c.total,m.value=c.per_page}catch(a){console.error("Error de red:",a)}finally{S.value=!1}},ae=async()=>{f.value=!0;try{const l=N.params.slug;let a=null;v.value==3?a=`${_}download/attendance-mercado/${l}`:a=`${_}download/attendance/${l}`;const O=await Ie({url:a,method:"GET",responseType:"blob",headers:{Authorization:`Bearer ${p}`}}),g=window.URL.createObjectURL(new Blob([O.data])),c=document.createElement("a"),I=`${l}.xlsx`;c.href=g,c.setAttribute("download",I),document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(g),document.body.removeChild(c)}catch(l){console.error("Error downloading file:",l)}finally{f.value=!1}};return ye(()=>{window.removeEventListener("resize",q)}),Z(()=>{window.addEventListener("resize",q),q(),h()}),(l,a)=>{const O=i("router-link"),g=i("a-breadcrumb-item"),c=i("a-breadcrumb"),I=i("a-button"),H=i("a-col"),ne=i("a-input"),oe=i("a-input-group"),le=i("a-row"),Q=i("a-menu-item"),re=i("a-popconfirm"),se=i("a-menu"),ie=i("a-dropdown"),de=i("a-table"),ce=i("a-tag"),ue=i("a-pagination"),me=i("a-drawer");return R(),G("div",Le,[u("div",null,[n(c,null,{default:o(()=>[n(g,null,{default:o(()=>[n(O,{to:"/admin/ugo/eventos"},{default:o(()=>[n(U(he)),a[3]||(a[3]=u("span",{class:"fs-13"},"Atrás",-1))]),_:1})]),_:1}),n(g,null,{default:o(()=>[u("h3",Ue,[a[4]||(a[4]=L(" EVENTOS REGISTRO DE ASISTENCIA - ")),u("span",Me,j(C.value),1)])]),_:1})]),_:1}),n(le,{style:{margin:"1rem 0"}},{default:o(()=>[n(H,{xs:24,md:12,lg:18},{default:o(()=>[a[6]||(a[6]=u("span",null,null,-1)),n(I,{class:"btn-excel",onClick:ae,loading:f.value,type:"primary"},{default:o(()=>a[5]||(a[5]=[u("img",{width:"20",style:{margin:"-2px 0 0 0"},src:Re},null,-1)])),_:1},8,["loading"])]),_:1}),n(H,{xs:24,md:12,lg:6},{default:o(()=>[n(oe,{compact:""},{default:o(()=>[n(ne,{onPressEnter:t,value:E.search,"onUpdate:value":a[0]||(a[0]=w=>E.search=w),style:{width:"calc(100% - 80px)"},onInput:s,placeholder:"Buscar por NOMBRE, DNI o RUC"},null,8,["value"]),n(I,{type:"primary",disabled:E.search==="",onClick:t},{default:o(()=>a[7]||(a[7]=[L("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(de,{bordered:"",scroll:{x:B.value,y:D.value},class:"table-agreements-ugse",columns:T,"data-source":A.value,pagination:!1,loading:S.value,size:"small"},{bodyCell:o(({column:w,record:z,index:pe})=>[w.dataIndex=="idx"?(R(),G(we,{key:0},[L(j(te.value(pe)),1)],64)):J("",!0),w.dataIndex=="actions"?(R(),W(ie,{key:1,trigger:["click"]},{overlay:o(()=>[n(se,null,{default:o(()=>[n(Q,null,{default:o(()=>[u("a",{onClick:ge=>k(z)},"Editar",8,Pe)]),_:2},1024),n(Q,null,{default:o(()=>[n(re,{placement:"rightBottom",title:`¿Quieres eliminar ${z.documentnumber} ?`,onConfirm:ge=>ee(z)},{icon:o(()=>[n(U(Ce),{style:{color:"red"}})]),default:o(()=>[a[8]||(a[8]=u("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[u("a",{class:"ant-dropdown-link",onClick:a[1]||(a[1]=xe(()=>{},["prevent"]))},[n(I,{shape:"circle",icon:Se(U(De)),size:"small"},null,8,["icon"])])]),_:2},1024)):J("",!0)]),_:1},8,["scroll","data-source","loading"])]),u("div",Be,[u("span",null,[n(ce,{color:"blue"},{default:o(()=>[u("b",null,j(x.value),1)]),_:1}),a[9]||(a[9]=L("Inscritos"))]),n(ue,{size:"small",total:x.value,pageSize:m.value,onChange:d,showSizeChanger:!1},null,8,["total","pageSize"])]),n(me,{open:b.value,"onUpdate:open":a[2]||(a[2]=w=>b.value=w),title:"Nueva Feria",placement:"right",width:"650"},{default:o(()=>[n(ke,{onCloseDraw:$,info:e.value,typeEvent:v.value},null,8,["info","typeEvent"])]),_:1},8,["open"])])}}};export{He as default};
