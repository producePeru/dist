import{_ as k}from"./TableComponent-4c388ccb.js";import{r as l,u as U,a as B,k as L,X as g,b as w,o as P,d as V,c as i,w as s,p as H,m as $,e as S,j as F}from"./index-1ce4b719.js";import{_ as G}from"./DrawMP-d02a1284.js";import{d as q}from"./downloadExcel-4fdf0e83.js";import"./es-428734aa.js";import{g as j}from"./publicInscripcion-ebc9ecb9.js";import"./icoexcel-1b303edf.js";import"./selectes-a0a85987.js";import"./SyncOutlined-abbc7ce8.js";import"./MoreOutlined-de2fccfc.js";import"./FormComponent-4bf685f9.js";import"./quill.snow-fce73ed6.js";import"./UpImage-6abc74da.js";import"./_plugin-vue_export-helper-c27b6911.js";const z={class:"layout-content"},J=["onClick"],X=["onClick"],ue={__name:"mp-diagnosticos",setup(K){JSON.parse(localStorage.getItem("role"));const E=l([]),h=l(0),v=l(150),d=l(!1);l(!1),U();const m=l(!1),u=l(null),p=l(!1),t=B({name:null,page:1}),I=l([]),O=e=>{u.value=e,d.value=!0},N=()=>{c(),d.value=!1},M=()=>{u.value=null,d.value=!0},T=async()=>{p.value=!0;try{const e={};t.name&&(e.name=t.name),t.range&&(e.startDate=t.range[0].format("YYYY/MM/DD"),e.endDate=t.range[1].format("YYYY/MM/DD")),await q("download/mp-export-participants-excel","diagnosticos",e)}catch(e){console.error("Error de red:",e)}finally{p.value=!1}},Y=async e=>{t.page=e,await c()},y=async e=>{e&&(t.page=1,await c())},R=e=>{const o=`${j()}/mujer-produce-asistencia/${e}`;window.open(o,"_blank")},c=async()=>{try{m.value=!0;const e={page:t.page};t.year&&(e.year=H(t.year).format("YYYY")),t.range&&(e.startDate=t.range[0].format("YYYY/MM/DD"),e.endDate=t.range[1].format("YYYY/MM/DD")),t.name&&(e.name=t.name),t.orderby&&(e.orderby=t.orderby);const o=await $({url:"mp/participant-diagnostic",method:"GET",params:e}),n=o,_=[{title:"#",dataIndex:"idx",align:"center",width:80,fixed:"left"},{title:"NOMBRE COMPLETO",dataIndex:"nombre_completo",width:200},{title:"APELLIDOS",dataIndex:"apellidos",width:200},{title:"FECHA NACIMIENTO",dataIndex:"fecha_nacimiento",width:100,align:"center"},{title:"CELULAR",dataIndex:"celular",width:100,align:"center"},{title:"TIPO DOCUMENTO",dataIndex:"tipo_documento",width:100,align:"center"},{title:"DOCUMENTO",dataIndex:"doc_number",width:100,align:"center"},{title:"EMAIL",dataIndex:"email",width:200},{title:"RUC",dataIndex:"ruc",width:100,align:"center"},{title:"ACTIVIDAD COMERCIAL",dataIndex:"actividad",width:200},{title:"RUBRO",dataIndex:"rubro",width:160,align:"center"},{title:"SECTOR ECONÓMICO",dataIndex:"economicSector",width:140,align:"center"},{title:"FECHA DEL DIAGNÓSTICO",dataIndex:"registrado",width:140,align:"center"}],f=o.questions.map(a=>({title:a.label,dataIndex:a.model,width:160}));I.value=[..._,...f];const r=n.data.map((a,b)=>{const D={idx:b+1,participant_id:a.participant_id,ruc:a.ruc,nombre_completo:a.nombre_completo,apellidos:a.apellidos,fecha_nacimiento:a.fecha_nacimiento,celular:a.celular,tipo_documento:a.tipo_documento,doc_number:a.doc_number,email:a.email,actividad:a.actividad,rubro:a.rubro,economicSector:a.economicSector,registrado:a.registrado};return n.questions.forEach(x=>{const C=a.responses.find(A=>A.question_model===x.model);D[x.model]=C?C.answer:null}),D});E.value=r,h.value=n.total,v.value=n.per_page}catch(e){console.error("Error de red:",e)}finally{m.value=!1}};return L(async()=>{await c()}),g("search",t),g("loading",m),g("loadingFile",p),(e,o)=>{const n=w("a-menu-item"),_=w("router-link"),f=w("a-drawer");return P(),V("div",z,[i(k,{title:"DIAGNÓSTICOS DE EMPRESAS",new:!1,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",columns:I.value,titleSearch:"BUSCAR DNI - RUC - NOMBRES",pageSize:v.value,downloadExcel:!0,rangeDate:!0,nameTotal:"Registros",dataSource:E.value,total:h.value,btnUpdate:!0,onHandleNew:M,onHandleCallFetchData:c,onHandleDownloadExcel:T,onHandleSearch:y,onHandlePaginator:Y},{"data-cell":s(({column:r,record:a})=>o[1]||(o[1]=[])),"custom-options":s(({record:r})=>[i(n,null,{default:s(()=>[S("span",{onClick:a=>R(r.slug)}," Asistencia ",8,J)]),_:2},1024),i(n,null,{default:s(()=>[i(_,{to:`/admin/mp/inscritos/${r.slug}`},{default:s(()=>o[2]||(o[2]=[F(" Inscritos ")])),_:2},1032,["to"])]),_:2},1024),i(n,null,{default:s(()=>[S("a",{onClick:a=>O(r)},"Editar",8,X)]),_:2},1024)]),_:1},8,["columns","pageSize","dataSource","total"]),i(f,{open:d.value,"onUpdate:open":o[0]||(o[0]=r=>d.value=r),title:u.value?"EDITAR EVENTO MP":"REGISTRAR UN EVENTO",placement:"right",width:"550"},{default:s(()=>[i(G,{onCloseDraw:N,info:u.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{ue as default};
