import{f as R}from"./actualizarUsuario-3eaca126.js";import{u as j}from"./selectes-bf919936.js";import{L as w,r as g,a as G,k as J,b as r,o as s,d as x,e as k,c as d,w as u,z as M,i as Y,F as q,x as Z,q as i,h as c,s as l,M as H,p as K,j as Q,m as C}from"./index-6362222c.js";import"./es-e67a45aa.js";import"./storage-ea575e7d.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";const X=v=>(K("data-v-2eb3143b"),v=v(),Q(),v),ee={class:"profile-header"},ae=X(()=>k("h3",null,"MIS DATOS",-1)),te={class:"my-profile"},ne={class:"grid-profile"},oe="DD/MM/YYYY",se={__name:"MiPerfil",props:["updateUser"],emits:["closeDraw"],setup(v,{emit:ie}){w.locale("es");const t=j(),h=JSON.parse(localStorage.getItem("profile")),F=JSON.parse(localStorage.getItem("email")),U=g(!1);t.$patch({genders:t.genders}),t.$patch({cdes:t.cdes}),t.$patch({Offices:t.Offices}),t.$patch({roles:t.roles}),t.$patch({cities:t.cities}),t.$patch({supervisores:t.supervisores}),t.fetchCities(),t.fetchGenders(),t.fetchCdes(),t.fetchOffices(),t.fetchRoles();const S=g(!1),_=g(R);g(null);const e=G({email:null,documentnumber:null,name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:h.id}),I=n=>{const p={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(n===2)t.fetchSupervisores(),_.value={..._.value,supervisor_id:p};else{const{supervisor_id:f,...b}=_.value;_.value=b}},D=(n,p)=>{const f=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return p.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(f)},N=n=>{e.province_id=null,e.district_id=null,t.fetchProvinces(n)},O=n=>{e.district_id=null,t.fetchDistricts(n)},L=async()=>{S.value=!0;const n={email:e.email,documentnumber:e.documentnumber,name:e.name,lastname:e.lastname,middlename:e.middlename,birthday:e.birthday?w(e.birthday).format("YYYY-MM-DD"):null,sick:e.sick,phone:e.phone,gender_id:e.gender_id,cde_id:e.cde_id,office_id:e.office_id,user_id:h.id};try{const p=await M({url:`user/update/${h.id}`,method:"PUT",data:n});C.success(p.message)}catch{C.error("No se pudo registrar este usuario")}finally{S.value=!1}},$=()=>{C.error("Debes de completar todos los espacios requeridos")},z=async()=>{try{U.value=!0;const{data:n}=await M({url:"user/my-profile",method:"GET"});n&&(e.email=F,e.documentnumber=h.documentnumber,e.name=n.name,e.lastname=n.lastname,e.middlename=n.middlename,e.birthday=n.birthday,e.sick=n.sick,e.phone=n.phone,e.gender_id=n.gender_id,e.cde_id=n.cde_id,e.office_id=n.office_id,e.birthday=n.birthday?w(n.birthday,"YYYY-MM-DD"):null)}catch(n){console.error("Error de red:",n)}finally{U.value=!1}};return J(()=>{z()}),(n,p)=>{const f=r("a-button"),b=r("router-link"),A=r("a-divider"),m=r("a-select"),y=r("a-form-item"),P=r("a-input"),T=r("a-date-picker"),E=r("a-form"),V=r("a-spin");return s(),x("div",null,[k("div",ee,[ae,d(b,{to:"cambiar-clave"},{default:u(()=>[d(f,null,{default:u(()=>[Y("Cambiar contraseña")]),_:1})]),_:1})]),d(A),k("section",te,[d(V,{spinning:U.value},{default:u(()=>[d(E,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:L,onFinishFailed:$},{default:u(()=>[k("div",ne,[(s(!0),x(q,null,Z(_.value,(a,B)=>(s(),x(q,{key:B},[a.type==="iSelect"?(s(),i(y,{key:0,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:u(()=>[a.name=="gender_id"?(s(),i(m,{key:0,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).genders},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="cde_id"?(s(),i(m,{key:1,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).cdes},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="office_id"?(s(),i(m,{key:2,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).Offices},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="role_id"?(s(),i(m,{key:3,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).roles,onChange:I},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="supervisor_id"?(s(),i(m,{key:4,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).supervisores},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="city_id"?(s(),i(m,{key:5,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).cities,"show-search":"","filter-option":D,onChange:N},null,8,["value","onUpdate:value","options"])):l("",!0),a.name=="province_id"?(s(),i(m,{key:6,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).provinces,"show-search":"","filter-option":D,onChange:O,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):l("",!0),a.name=="district_id"?(s(),i(m,{key:7,value:e[a.name],"onUpdate:value":o=>e[a.name]=o,options:c(t).districts,"show-search":"","filter-option":D,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):l("",!0)]),_:2},1032,["name","label","rules"])):l("",!0),a.type==="iText"?(s(),i(y,{key:1,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:u(()=>[d(P,{value:e[a.name],"onUpdate:value":o=>e[a.name]=o,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):l("",!0),a.type==="iDate"?(s(),i(y,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:u(()=>[d(T,{locale:c(H),value:e[a.name],"onUpdate:value":o=>e[a.name]=o,style:{width:"100%"},format:oe,placeholder:"DÍA/MES/AÑO"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):l("",!0)],64))),128))]),d(y,null,{default:u(()=>[d(f,{class:"btn-produce",type:"primary","html-type":"submit",loading:S.value},{default:u(()=>[Y("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])])}}},pe=W(se,[["__scopeId","data-v-2eb3143b"]]);export{pe as default};
