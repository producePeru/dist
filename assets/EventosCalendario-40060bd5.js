import{r as p,a as G,l as E,j as Q,T as ee,b as l,o as r,d as u,c as a,w as s,e as f,F as O,s as te,x as P,q as x,h as j,i as D,t as U,m as F,K as J,E as _e,X as fe,p as W,y as ve,J as ge}from"./index-7867bbe2.js";import{u as ae}from"./selectes-5e36ad1b.js";import{Q as ne}from"./quill.snow-d1cffc79.js";import"./es-6f7efd55.js";import{M as ye}from"./MoreOutlined-186dc1bc.js";const be={class:"grid-events"},we={style:{display:"flex",margin:"1rem 0 .5rem"}},he={key:3,class:"grid-events-hour"},Ee={__name:"DrawEventosCalendario",props:["dataRow"],emits:["closeDraw"],setup($,{emit:I}){const g=ae();g.$patch({officesPnte:g.officesPnte}),g.fetchOfficesPnte();const k=I,m=$,R=p(!1),C={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=p([{dates:new Date}]),c=p({id_pnte:{type:"iSelect",label:"ÁREA DE",name:"id_pnte",required:!0,message:"",disabled:!1},title:{type:"iText",label:"TÍTULO",name:"title",required:!0,message:"",disabled:!1,max:255},date:{type:"iDate",label:"FECHA",name:"date",required:!1,message:"ssss",disabled:!1},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!1,message:"Escribe descripción del evento",max:250},nameUser:{type:"iText",label:"RESPONSABLE",name:"nameUser",required:!1,message:"",disabled:!1,max:100},link:{type:"iText",label:"SI ES VIRTUAL PERGAR LINK",name:"link",required:!1,message:"",disabled:!1,max:100}}),t=G({allDay:1}),M=p([{start:null,end:E().subtract(0,"day").format("YYYY-MM-DD")}]),b=n=>n==="id_pnte"?g.officesPnte:[],d={organiza:{type:"iText",label:"ORGANIZA",name:"organiza",required:!1,message:"",disabled:!1,max:150,placeholder:"Ejemplo: Municipalidad de ..."},numMypes:{type:"iText",label:"NÚMEROS DE MYPES QUE PARTICIPARÁN",name:"numMypes",required:!1,message:"",disabled:!1,max:100}},H=n=>{if(n==2||n==7){const o=Object.entries(c.value),v=o.findIndex(([z])=>z==="title"),_=[...o.slice(0,v+1),...Object.entries(d),...o.slice(v+1)];c.value=Object.fromEntries(_)}else{const o={...c.value};delete o.organiza,delete o.numMypes,c.value=o}},L=(n,o)=>{const v=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(v)},Y=async()=>{if(!t.date)return F.warning("Debes de seleccionar una fecha del calendario");if(!t.hours)return F.warning("Debes de seleccionar una hora");const n={id_pnte:t.id_pnte,title:t.title,...t.organiza&&{organiza:t.organiza},...t.numMypes&&{numMypes:t.numMypes},dateStart:E(t.date.start).format("YYYY-MM-DD"),dateEnd:E(t.date.end).format("YYYY-MM-DD"),start:E(t.hours[0]).format("HH:mm"),end:E(t.hours[1]).format("HH:mm"),description:t.description,nameUser:t.nameUser,link:t.link};R.value=!0;try{const o=m.dataRow?`event/update/${m.dataRow.id}`:"event/create",v=m.dataRow?"PUT":"POST",_=await J({url:o,method:v,data:n});_.status===200&&(F.success(_.message),t.title="",t.hours=[],t.organiza="",t.numMypes="",t.description="</p>",t.nameUser="",t.link="",t.date=null,k("closeDraw"))}catch(o){F.error(o.message)}finally{R.value=!1}},T=()=>{t.id_pnte=null,t.numMypes="",t.organiza="",t.title="",t.description="</p>",t.nameUser="",t.link="",t.date=null},N=n=>{if(n){if(t.id_pnte=n.id_pnte,n.id_pnte==2||n.id_pnte==7){const o=Object.entries(c.value),v=o.findIndex(([z])=>z==="title"),_=[...o.slice(0,v+1),...Object.entries(d),...o.slice(v+1)];c.value=Object.fromEntries(_)}t.numMypes=n.numMypes,t.organiza=n.organiza,t.title=n.title,t.description=n.description,t.nameUser=n.nameUser,t.link=n.link,t.date={start:E(n.dateStart).toISOString(),end:E(n.dateEnd).toISOString()},t.hours=[E(n.start,"HH:mm"),E(n.end,"HH:mm")]}};return Q(()=>{m.dataRow&&N(m.dataRow)}),ee(()=>m.dataRow,n=>{n?N(n):T()}),(n,o)=>{const v=l("a-select"),_=l("a-form-item"),z=l("a-input"),V=l("VDatePicker"),B=l("a-time-range-picker"),A=l("a-button"),i=l("a-form");return r(),u("div",null,[a(i,{class:"form-events",layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:Y},{default:s(()=>[f("div",be,[(r(!0),u(O,null,te(c.value,(e,w)=>(r(),u(O,{key:w},[e.type==="iSelect"?(r(),P(_,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[a(v,{value:t[e.name],"onUpdate:value":S=>t[e.name]=S,options:b(e.name),"show-search":"","filter-option":L,onChange:H},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):x("",!0),e.type==="iText"?(r(),P(_,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[a(z,{value:t[e.name],"onUpdate:value":S=>t[e.name]=S,maxlength:e.max,disabled:e.disabled,placeholder:e.placeholder},null,8,["value","onUpdate:value","maxlength","disabled","placeholder"])]),_:2},1032,["name","label","rules"])):x("",!0),e.type==="iDate"?(r(),P(_,{key:2,name:e.name,label:e.label},{default:s(()=>[a(V,{modelValue:t[e.name],"onUpdate:modelValue":S=>t[e.name]=S,modelModifiers:{range:!0},mode:"date",attributes:q.value,"disabled-dates":M.value},null,8,["modelValue","onUpdate:modelValue","attributes","disabled-dates"]),f("div",we,[f("div",null,[o[1]||(o[1]=f("label",{style:{display:"block"},for:""},"HORARIO",-1)),a(B,{minuteStep:30,value:t.hours,"onUpdate:value":o[0]||(o[0]=S=>t.hours=S),format:"HH:mm"},null,8,["value"])])])]),_:2},1032,["name","label"])):x("",!0),e.type==="iSwitch"?(r(),u("div",he)):x("",!0),e.type==="iTextArea"?(r(),P(_,{key:4,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[a(j(ne),{class:"quill-editor",content:t[e.name],"onUpdate:content":S=>t[e.name]=S,options:C,contentType:"html"},null,8,["content","onUpdate:content"])]),_:2},1032,["name","label","rules"])):x("",!0)],64))),128))]),a(_,null,{default:s(()=>[a(A,{type:"primary","html-type":"submit",loading:R.value,style:{"margin-top":"1rem"}},{default:s(()=>[D(U(m.dataRow?"ACTUALIZAR":"CREAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const xe={class:"grid-event-resultado"},Re={__name:"DrawResultados",props:["dataRow"],emits:["closeDraw"],setup($,{emit:I}){const g=ae();g.$patch({officesPnte:g.officesPnte}),g.fetchOfficesPnte();const k=I,m=$,R=p(!1),C={theme:"snow",modules:{toolbar:[["bold","italic","underline"],[{align:[]}],[{color:[]},{background:[]}],["link"]]},contentType:"html"},q=p({resultados:{type:"iTextArea",label:"DESCRIBIR RESULTADOS",name:"resultados",required:!1,message:"Escribe los resultados de los evento",max:500}}),c=G({resultado:null}),t=async()=>{const b={resultado:c.resultado};R.value=!0;try{const d=await J({url:`event/update/${m.dataRow.id}`,method:"PUT",data:b});d.status===200&&(F.success(d.message),k("closeDraw"))}catch(d){console.error("Failed to update record",d)}finally{R.value=!1}},M=b=>{console.log("Setting info",b),c.resultado=b.resultado};return Q(()=>{m.dataRow&&M(m.dataRow)}),ee(()=>m.dataRow,b=>{b&&M(b)}),(b,d)=>{const H=l("a-form-item"),L=l("a-button"),Y=l("a-form");return r(),u("div",null,[a(Y,{class:"form-events",layout:"vertical",model:c,name:"basic",autocomplete:"off",onFinish:t},{default:s(()=>[f("div",xe,[(r(!0),u(O,null,te(q.value,(T,N)=>(r(),u(O,{key:N},[T.type==="iTextArea"?(r(),P(H,{key:0,name:T.name,label:T.label,rules:[{required:T.required,message:T.message}]},{default:s(()=>[a(j(ne),{class:"quill-editor",content:c.resultado,"onUpdate:content":d[0]||(d[0]=n=>c.resultado=n),options:C,contentType:"html"},null,8,["content"])]),_:2},1032,["name","label","rules"])):x("",!0)],64))),128))]),a(H,null,{default:s(()=>[a(L,{type:"primary","html-type":"submit",loading:R.value,style:{"margin-top":"1rem"}},{default:s(()=>d[1]||(d[1]=[D("GUARDAR")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}};const Se={key:0},ke={key:1},De={key:0},Ie={key:1},Te=["innerHTML"],Ue=["onClick"],Oe=["onClick"],Ce={class:"paginator"},Pe={__name:"EventosCalendario",setup($){E.locale("es"),JSON.parse(localStorage.getItem("role"));const I=p(!1),g=p(!1),k=p(null),m=p(0),R=p(50),C=p({page:0}),q=p(1200),c=p([]),t=p(!1),M=p(window.innerHeight-100),b=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"ÁREA",fixed:"left",dataIndex:"office",width:100},{title:"TÍTULO",dataIndex:"title",width:200},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"HORARIO",dataIndex:"hours",width:120,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"RESULTADOS",dataIndex:"results",width:300},{title:"RESPONSABLE",dataIndex:"nameUser",width:240},{title:"",dataIndex:"actions",width:40,align:"center",fixed:"right"}],d=G({search:""}),H=()=>{A(),I.value=!1},L=i=>{k.value=i,g.value=!0},Y=i=>{k.value=i,I.value=!0},T=()=>{k.value=null,console.log("Nueva Feria"),I.value=!0},N=()=>{let i={search:d.search};A(i)},n=()=>{d.search||A()},o=i=>E(i).format("DD/MM/YYYY"),v=i=>E(i,"HH:mm:ss").format("HH:mm"),_=i=>({ferias:"FERIAS",rd:"RUTA DIGITAL",ugse:"UGSE",uger:"UGGER",ugo:"UGO"})[i],z=i=>{C.value.page=i,A()},V=()=>{M.value=window.innerHeight-330},B=_e(()=>i=>C.value.page*R.value+i+1),A=async i=>{try{t.value=!0;let e;e=C.value.page==0?"":C.value,e=i?{...e,...i}:e;const{data:w}=await J({url:"event/list",method:"GET",params:e});c.value=w==null?void 0:w.data,m.value=w.total,R.value=w.per_page}catch(e){console.error("Error de red:",e)}finally{t.value=!1}};return fe(()=>{window.removeEventListener("resize",V)}),Q(()=>{window.addEventListener("resize",V),V(),A()}),(i,e)=>{const w=l("a-button"),S=l("router-link"),K=l("a-col"),se=l("a-input"),oe=l("a-input-group"),le=l("a-row"),X=l("a-menu-item"),re=l("a-menu"),ie=l("a-dropdown"),de=l("a-table"),ue=l("a-tag"),me=l("a-pagination"),Z=l("a-drawer");return r(),u(O,null,[f("div",null,[e[10]||(e[10]=f("h3",{class:"title-produce"},"EVENTOS PNTE 2025",-1)),a(le,{style:{margin:"1rem 0"}},{default:s(()=>[a(K,{xs:24,md:12,lg:18},{default:s(()=>[a(w,{type:"primary",onClick:T,class:"box-btn-add"},{default:s(()=>e[5]||(e[5]=[D(" NUEVO EVENTO ")])),_:1}),a(S,{to:"/eventos",target:"_blank",style:{"margin-left":"1rem"}},{default:s(()=>[a(w,{type:"dashed",icon:W(j(ve))},{default:s(()=>e[6]||(e[6]=[D("Ver Calendario")])),_:1},8,["icon"])]),_:1})]),_:1}),a(K,{xs:24,md:12,lg:6},{default:s(()=>[a(oe,{compact:""},{default:s(()=>[a(se,{value:d.search,"onUpdate:value":e[0]||(e[0]=y=>d.search=y),style:{width:"calc(100% - 80px)"},onInput:n},null,8,["value"]),a(w,{type:"primary",disabled:d.search==="",onClick:N},{default:s(()=>e[7]||(e[7]=[D("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(de,{bordered:"",scroll:{x:q.value,y:M.value},class:"table-events-google",columns:b,"data-source":c.value,pagination:!1,loading:t.value,size:"small"},{bodyCell:s(({column:y,record:h,index:ce})=>[y.dataIndex=="idx"?(r(),u(O,{key:0},[D(U(B.value(ce)),1)],64)):x("",!0),y.dataIndex=="date"?(r(),u(O,{key:1},[h.dateStart!=h.dateEnd?(r(),u("span",Se,[e[8]||(e[8]=f("b",null,"Desde:",-1)),D(" "+U(o(h.dateStart))+" ",1),e[9]||(e[9]=f("b",null,"Hasta:",-1)),D(" "+U(o(h.dateEnd)),1)])):(r(),u("span",ke,U(o(h.dateStart)),1))],64)):x("",!0),y.dataIndex=="office"?(r(),u(O,{key:2},[D(U(_(h.office)),1)],64)):x("",!0),y.dataIndex=="hours"?(r(),u(O,{key:3},[h.allDay==1?(r(),u("span",De,"Todo el día")):(r(),u("span",Ie,U(v(h.start))+" - "+U(v(h.end)),1))],64)):x("",!0),y.dataIndex=="results"?(r(),u("div",{key:4,class:"html-format",innerHTML:h.resultado},null,8,Te)):x("",!0),y.dataIndex=="actions"?(r(),P(ie,{key:5,trigger:["click"]},{overlay:s(()=>[a(re,null,{default:s(()=>[a(X,null,{default:s(()=>[f("a",{onClick:pe=>L(h)},"Resultados",8,Ue)]),_:2},1024),a(X,null,{default:s(()=>[f("a",{onClick:pe=>Y(h)},"Editar",8,Oe)]),_:2},1024)]),_:2},1024)]),default:s(()=>[f("a",{class:"ant-dropdown-link",onClick:e[1]||(e[1]=ge(()=>{},["prevent"]))},[a(w,{shape:"circle",icon:W(j(ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):x("",!0)]),_:1},8,["scroll","data-source","loading"])]),f("div",Ce,[f("span",null,[a(ue,{color:"blue"},{default:s(()=>[f("b",null,U(m.value),1)]),_:1}),e[11]||(e[11]=D("Eventos creados"))]),a(me,{size:"small",total:m.value,pageSize:R.value,onChange:z,showSizeChanger:!1},null,8,["total","pageSize"])]),a(Z,{open:I.value,"onUpdate:open":e[2]||(e[2]=y=>I.value=y),title:k.value?"EDITAR EVENTO":"NUEVO EVENTO",placement:"right",width:"450"},{default:s(()=>[a(Ee,{onCloseDraw:H,dataRow:k.value},null,8,["dataRow"])]),_:1},8,["open","title"]),a(Z,{open:g.value,"onUpdate:open":e[4]||(e[4]=y=>g.value=y),title:"RESULTADOS",placement:"right",width:"550"},{default:s(()=>[a(Re,{dataRow:k.value,onCloseDraw:e[3]||(e[3]=y=>{g.value=!1,A()})},null,8,["dataRow"])]),_:1},8,["open"])],64)}}};export{Pe as default};
