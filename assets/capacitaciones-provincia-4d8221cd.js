import{F as V,r as j,u as O}from"./xlsx-ca502257.js";import{r as m,a as T,j as D,b as f,o as r,d as _,c as v,w as y,e as a,i as h,t as b,y as w,R as k,q as E,h as C,x as I,F as M,s as P,m as S}from"./index-fec5dae2.js";import{M as q}from"./MailOutlined-1b422d36.js";const U={class:"email-wrapper"},G={style:{display:"flex","justify-content":"space-between"}},$={class:"email-list"},z={key:0},H={style:{display:"flex",gap:"10px","align-items":"center"}},J={style:{color:"#00a6db"}},Y={__name:"capacitaciones-provincia",setup(K){const i=m(!1),A=m([]),s=m([]),o=m(null),N=T({message:""}),F=async t=>{const e=["xls","xlsx"],c=t.name.split(".").pop().toLowerCase();if(!e.includes(c))return alert("Por favor, sube un archivo en formato Excel (.xls o .xlsx)."),!1;const u=new FileReader;return u.onload=x=>{const g=new Uint8Array(x.target.result),n=j(g,{type:"array"}),d=n.Sheets[n.SheetNames[0]],p=O.sheet_to_json(d);s.value=p.map(l=>l.Email).filter(l=>!!l)},u.readAsArrayBuffer(t),!1},B=async()=>{i.value=!0;const t={emails:s.value,message:N.message};try{const e=await k({url:"automatic/invitaciones-capacitaciones-provincia",method:"POST",data:t});e.status==200&&(S.success(e.message),s.value=[])}catch(e){S.error("error"),console.log("error",e)}finally{i.value=!1}},L=async()=>{try{const e=await k({url:"email/pp03/provincia/capacitaciones_tuempresa@produce.gob.pe",method:"GET"});o.value=e.data[0]}catch(t){console.error("Error de red:",t)}finally{i.value=!1}};return D(async()=>{await L()}),(t,e)=>{var n,d,p;const c=f("a-button"),u=f("a-upload"),x=f("a-card"),g=f("a-image");return r(),_("div",U,[v(x,{title:"Capacitaciones provincia"},{default:y(()=>[a("div",G,[v(u,{"before-upload":F,"file-list":A.value,"show-upload-list":!1,accept:".xls,.xlsx"},{default:y(()=>[v(c,{type:"primary",icon:E(C(V)),style:{"background-color":"#006e37"}},{default:y(()=>e[0]||(e[0]=[h(" SELECCIONAR LISTA ")])),_:1},8,["icon"])]),_:1},8,["file-list"]),s.value.length>=1?(r(),I(c,{key:0,onClick:B,loading:i.value,class:"email-btn-send",type:"primary",icon:E(C(q))},{default:y(()=>e[1]||(e[1]=[h("ENVIAR")])),_:1},8,["loading","icon"])):w("",!0)]),e[2]||(e[2]=a("br",null,null,-1)),a("div",$,[a("ol",null,[(r(!0),_(M,null,P(s.value,(l,R)=>(r(),_("li",{key:R},b(l),1))),128))])])]),_:1}),o.value?(r(),_("div",z,[a("p",null,[e[3]||(e[3]=h("Correo: ")),a("b",null,b((n=o.value)==null?void 0:n.emailAccount),1)]),a("div",H,[e[4]||(e[4]=a("p",null,"Cantidad: ",-1)),a("h3",J,b((d=o.value)==null?void 0:d.count),1)]),v(g,{width:200,src:(p=o.value)==null?void 0:p.image},null,8,["src"])])):w("",!0)])}}};export{Y as default};
