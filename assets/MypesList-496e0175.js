import{r,a as M,k as P,K as Z,b as l,o as g,d as C,c as n,w as o,e as p,F as D,x as ee,h as ae,q as L,s as q,i as b,z,m as N,I as te,t as $,N as ne,O as oe}from"./index-a89c85d3.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const se={ruc:{type:"iText",label:"Número de RUC",name:"ruc",required:!0,message:"Escribe el número de RUC",max:11,disabled:!1},razonSocial:{type:"iText",label:"Razón Social",name:"razonSocial",required:!0,message:"Escribe la razón Social",disabled:!1},actividadEconomica:{type:"iText",label:"Actividad Económica",name:"actividadEconomica",required:!0,message:"Escribe la Actividad Económica"},departamento:{type:"iText",label:"Departamento",name:"departamento",required:!0,message:"Escribe el departamento"},provincia:{type:"iText",label:"Provincia",name:"provincia",required:!0,message:"Escribe la provincia"},distrito:{type:"iText",label:"Distrito",name:"distrito",required:!0,message:"Escribe el distrito"},direccion:{type:"iText",label:"Direccion",name:"direccion",required:!0,message:"Escribe la dirección",disabled:!1}};const le={class:"grid-mype"},re={__name:"DrawerMypeInfo",props:{info:{type:Object,required:!0}},emits:["closeDraw"],setup(R,{emit:y}){const c=R,I=y,m=r(!1),e=M({});function _(a){e.ruc=a.ruc,e.razonSocial=a.razonSocial,e.actividadEconomica=a.actividadEconomica,e.departamento=a.departamento,e.provincia=a.provincia,e.distrito=a.distrito,e.direccion=a.direccion}const w=async()=>{m.value=!0;const a={ruc:e.ruc,razonSocial:e.razonSocial,actividadEconomica:e.actividadEconomica,departamento:e.departamento,provincia:e.provincia,distrito:e.distrito,direccion:e.direccion};try{const h=await z({url:`mype/update-by-ruc/${c.info.id}`,method:"PUT",data:a});h.status==200&&(N.success(h.message),I("closeDraw"))}catch{console.log("Failed to update record")}finally{m.value=!1}};return P(()=>{c.info&&_(c.info)}),Z(()=>c.info,a=>{a&&_(a)}),(a,h)=>{const U=l("a-input"),E=l("a-form-item"),k=l("a-button"),S=l("a-form");return g(),C("div",null,[n(S,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:w},{default:o(()=>[p("div",le,[(g(!0),C(D,null,ee(ae(se),(s,v)=>(g(),C(D,{key:v},[s.type==="iText"?(g(),L(E,{key:0,name:s.name,label:s.label,rules:[{required:s.required,message:s.message,type:s.email}]},{default:o(()=>[n(U,{value:e[s.name],"onUpdate:value":T=>e[s.name]=T,maxlength:s.max,disabled:s.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):q("",!0)],64))),128))]),n(E,null,{default:o(()=>[n(k,{class:"btn-produce",type:"primary","html-type":"submit",loading:m.value},{default:o(()=>[b("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},ce=ie(re,[["__scopeId","data-v-1947d279"]]);const de=p("h3",{class:"title-produce"},"LISTA DE MYPES",-1),ue=p("span",{class:"fs-13"},"Actualizar lista con: ",-1),pe={class:"paginator"},me=p("span",{class:"fs-13"},"mypes registradas",-1),ge={__name:"MypesList",setup(R){const y=r(null),c=r(!1),I=r(null),m=r(100),e=r([]),_=r(!1),w=r(0),a=r({page:1}),h=r("mype/list"),U=r(1200),E=r(window.innerHeight-100),k=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"RUC",dataIndex:"ruc",fixed:"left",width:80},{title:"Razón Social",dataIndex:"razonSocial",fixed:"left",width:150},{title:"Actividad Economica",dataIndex:"actividadEconomica",width:180},{title:"Departamento",dataIndex:"departamento",width:100,align:"center"},{title:"Provincia",dataIndex:"provincia",width:100,align:"center"},{title:"Distrito",dataIndex:"distrito",width:100,align:"center"},{title:"Dirección",dataIndex:"direccion",width:100,align:"center"},{title:"Actualizar",dataIndex:"update",width:100,align:"center"}],S=async i=>{_.value=!0,(await z({url:`formalization/${i}`,method:"PUT"})).status==200&&f()},s=()=>{E.value=window.innerHeight-302},v=M({search:""}),T=()=>{let i={search:v.search};f(i)},B=()=>{v.search||f()},F=()=>{f(),c.value=!1},G=i=>{a.value.page=i,f()},V=async i=>{y.value=i.ruc;try{if((await z({url:`mype/update/${i.ruc}`,method:"PUT"})).status==200)f(),N.success("¡Actualización exitosa!");else{const d=await z({url:`mype/get-by-ruc/${i.ruc}`,method:"GET"});I.value=d.data,c.value=!0}}catch{console.log("Failed to update")}finally{y.value=null}},f=async i=>{try{_.value=!0;const t=a.value.page===1?"":a.value,d=i?{...t,...i}:t,{data:x}=await z({url:h.value,method:"GET",params:d});e.value=x.data,w.value=x.total,m.value=x.per_page}catch(t){console.error("Error de red:",t)}finally{_.value=!1}},Y=te(()=>i=>(a.value.page-1)*m.value+i+1);return P(()=>{f(),window.addEventListener("resize",s),s()}),(i,t)=>{const d=l("a-button"),x=l("a-col"),H=l("a-input"),O=l("a-input-group"),j=l("a-row"),K=l("a-table"),X=l("a-tag"),J=l("a-pagination"),Q=l("a-drawer");return g(),C(D,null,[p("div",null,[de,n(j,{style:{margin:"1rem 0"}},{default:o(()=>[n(x,{xs:24,md:12,lg:18},{default:o(()=>[ue,n(d,{class:"fs-13",onClick:t[0]||(t[0]=u=>S("set-ruc-advisories")),type:"text"},{default:o(()=>[b("Asesorías")]),_:1}),n(d,{class:"fs-13",onClick:t[1]||(t[1]=u=>S("set-ruc-ruc-10")),type:"text"},{default:o(()=>[b("RUC 10")]),_:1}),n(d,{class:"fs-13",onClick:t[2]||(t[2]=u=>S("set-ruc-ruc-20")),type:"text"},{default:o(()=>[b("RUC 20")]),_:1})]),_:1}),n(x,{xs:24,md:12,lg:6},{default:o(()=>[n(O,{compact:""},{default:o(()=>[n(H,{value:v.search,"onUpdate:value":t[3]||(t[3]=u=>v.search=u),style:{width:"calc(100% - 80px)"},onInput:B},null,8,["value"]),n(d,{type:"primary",disabled:v.search==="",onClick:T},{default:o(()=>[b("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(K,{bordered:"",scroll:{x:U.value,y:E.value},class:"table-users",columns:k,"data-source":e.value,pagination:!1,loading:_.value,size:"small"},{bodyCell:o(({column:u,record:A,index:W})=>[u.dataIndex==="idx"?(g(),C(D,{key:0},[b($(Y.value(W)),1)],64)):q("",!0),u.dataIndex=="update"?(g(),L(d,{key:1,type:"text",class:"fs-13 color-primary",onClick:_e=>V(A),loading:y.value==A.ruc},{default:o(()=>[ne(p("span",null,"Actualizar",512),[[oe,y.value!=A.ruc]])]),_:2},1032,["onClick","loading"])):q("",!0)]),_:1},8,["scroll","data-source","loading"])]),p("div",pe,[p("span",null,[n(X,{color:"blue"},{default:o(()=>[p("b",null,$(w.value),1)]),_:1}),me]),n(J,{size:"small",total:w.value,pageSize:m.value,onChange:G,showSizeChanger:!1},null,8,["total","pageSize"])]),n(Q,{width:"550",open:c.value,"onUpdate:open":t[4]||(t[4]=u=>c.value=u),class:"draw",title:"Editar datos de MYPE",placement:"right"},{default:o(()=>[n(ce,{onCloseDraw:F,info:I.value},null,8,["info"])]),_:1},8,["open"])],64)}}};export{ge as default};
