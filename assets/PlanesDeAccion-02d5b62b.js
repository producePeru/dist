import{L as q,r as p,a as ne,k as oe,K as _e,b as c,o as d,d as k,c as i,w as s,e as S,F as Z,x as ve,q as v,s as _,h as A,M as fe,i as Y,m as I,z as $,g as ge,H as he,I as be,t as te,U as ye,P as De,J as we}from"./index-7c359e2e.js";import{_ as Ce}from"./icoexcel-1b303edf.js";import{u as le}from"./selectes-93e76959.js";import"./es-cc0cc935.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{M as xe}from"./MoreOutlined-dd4700c8.js";const Ie={numberDocument:{type:"iSearch",label:"Número de documento",name:"numberDocument",required:!0,message:"Ingresar Número de documento",disabled:!1,max:11},namePerson:{type:"iText",label:"Nombre",name:"namePerson",required:!0,message:"Escribe nombre",disabled:!0},city_id:{type:"iSelectWrite",label:"Región del negocio",name:"city_id",required:!0,message:"Seleccionar región",disabled:!0},province_id:{type:"iSelectWrite",label:"Provincia del negocio",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!0},district_id:{type:"iSelectWrite",label:"Distrito del negocio",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!0},sick:{type:"iSelect",label:"¿Tiene discapacidad?",name:"sick",required:!0,message:"Seleccionar estado",disabled:!0},divider:{type:"iDivider"},ruc:{type:"iSearch",label:"Número de RUC",name:"ruc",required:!1,message:"Escribe el número de RUC",disabled:!1,max:11},component_1:{type:"iSelectWrite",is:"component",label:"Componente 1",name:"component_1",required:!0,message:"Seleccionar componente 1",disabled:!1},component_2:{type:"iSelectWrite",is:"component",label:"Componente 2",name:"component_2",required:!0,message:"Seleccionar componente 2",disabled:!1},component_3:{type:"iSelectWrite",is:"component",label:"Componente 3",name:"component_3",required:!1,message:"Seleccionar componente 3",disabled:!1},startDate:{type:"iDate",label:"Día Inicio",name:"startDate",required:!0,message:"Seleccionar fecha de inicio",placeholder:"año-mes-día"},endDate:{type:"iDate",label:"Día Fin",name:"endDate",required:!0,message:"Seleccionar fecha de fin",placeholder:"año-mes-día"}};const Se={class:"grid-planes"},Ne="DD/MM/YYYY",Ue={__name:"NuevoPlanAccion",props:["info"],emits:["closeDraw"],setup(G,{emit:N}){q.locale("es");const h=JSON.parse(localStorage.getItem("profile")),f=le(),b=N,g=G;f.$patch({cities:f.cities}),f.fetchCities();const M=p(Ie),U=p(!1),y=p(null),T=[{label:"DESARROLLO PRODUCTIVO",value:1},{label:"DIGITALIZACIÓN",value:2},{label:"FINANZAS",value:3},{label:"FORMALIZACIÓN",value:4},{label:"GESTIÓN EMPRESARIAL",value:5}],j=[{value:1,label:"DNI"},{value:2,label:"RUC"}],J=[{label:"Si",value:"yes"},{label:"No",value:"no"}],e=ne({numberDocument:null,component_1:null,component_2:null,component_3:null,ruc:null}),O=()=>{e.numberDocument=null,e.component_1=null,e.component_2=null,e.component_3=null,e.ruc=null,e.idPerson=null,e.namePerson=null,e.city_id=null,e.province_id=null,e.district_id=null,e.gender_id=null,e.sick=null,e.startDate=null,e.endDate=null},V=t=>{const o=Object.keys(e).reduce((n,m)=>(m!==t&&e[m]!==null&&n.push(e[m]),n),[]);return T.filter(n=>!o.includes(n.value))},K=()=>{const t=e.ruc;return t&&!/^\d{11}$/.test(t)?(I.error("El número de RUC debe contener exactamente 11 dígitos numéricos."),{valid:!1}):t&&!/^(10|15|20)/.test(t)?(I.error("El número de RUC debe comenzar con 10, 15 o 20."),{valid:!1}):{valid:!0}},Q=t=>{if(!t)return!1;const o=e.startDate?q(e.startDate):null;return o&&t.isBefore(o,"day")||t.isAfter(q().endOf("day"),"day")},X=t=>{e[t]=e[t].replace(/\D/g,"")},L=(t,o)=>{const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)},z=async t=>{if(!e.numberDocument)return I.warning("Ingrese un número a buscar...");try{if(t=="numberDocument"){y.value=t;const o=await $({url:`person/data/${e.numberDocument}`,method:"GET"});if(o.status==404)return y.value=null,e.numberDocument=null,I.warning("Este usuario no fue registrado");o.status==200&&(e.idPerson=o.data.id,e.namePerson=o.data.namePerson,e.city_id=o.data.city_id,F(o.data.city_id),e.province_id=o.data.province_id,B(o.data.province_id),e.district_id=o.data.district_id,console.log("FormState",o.data.gender_id),e.sick=o.data.sick)}if(t=="ruc"){y.value=t;const o=await $({url:`plans-action/components/${e.ruc}`,method:"GET"});if(o.status==200){const n=o.data;n.component_1&&(e.component_1=n.component_1),n.component_2&&(e.component_2=n.component_2),n.component_3&&(e.component_3=n.component_3),n.endDate&&(e.endDate=q(n.endDate,"YYYY-MM-DD"))}else return y.value=null,e.ruc=null,I.warning("No se han registrado datos con ese número de RUC")}}catch{console.log("Failed to update record")}finally{y.value=null}},F=t=>{e.province_id=null,e.district_id=null,f.fetchProvinces(t)},B=t=>{e.district_id=null,f.fetchDistricts(t)},ee=(t,o)=>{},P=async()=>{U.value=!0;const t=K();if(e.ruc&&t.valid===!1){U.value=!1;return}const o={people_id:e.idPerson,cde_id:h.cde_id,component_1:e.component_1,component_2:e.component_2,component_3:e.component_3,ruc:e.ruc,startDate:q(e.startDate).format("YYYY-MM-DD"),endDate:q(e.endDate).format("YYYY-MM-DD"),...g.info&&{idItem:g.info.id}};let n=null;g.info?n="plans-action/update":n="plans-action/create";try{const m=await $({url:`${n}`,method:"POST",data:o});m.status==200&&(I.success(m.message),O(),b("closeDraw")),m.status==400&&I.warning(m.message)}catch{console.log("Failed to update record")}finally{U.value=!1}};function W(t){t?(e.numberDocument=t.emprendedor_dni,z("numberDocument"),e.ruc=t.ruc,e.component_1=t.component_1,e.component_2=t.component_2,e.component_3=t.component_3):O()}return oe(()=>{g.info&&W(g.info)}),_e(()=>g.info,t=>{t&&W(t)}),(t,o)=>{const n=c("a-input"),m=c("a-form-item"),r=c("a-select"),u=c("a-input-search"),D=c("a-divider"),w=c("a-date-picker"),R=c("a-button"),ae=c("a-form");return d(),k("div",null,[i(ae,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:P},{default:s(()=>[S("div",Se,[(d(!0),k(Z,null,ve(M.value,(a,H)=>(d(),k(Z,{key:H},[a.type==="iText"?(d(),v(m,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,type:a.email}]},{default:s(()=>[i(n,{value:e[a.name],"onUpdate:value":l=>e[a.name]=l,maxlength:a.max,disabled:a.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):_("",!0),a.type==="iSelect"?(d(),v(m,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[a.name=="typeDocument"?(d(),v(r,{key:0,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:j},null,8,["value","onUpdate:value"])):_("",!0),a.name=="gender_id"?(d(),v(r,{key:1,disabled:a.disabled,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:A(f).genders},null,8,["disabled","value","onUpdate:value","options"])):_("",!0),a.name=="sick"?(d(),v(r,{key:2,disabled:a.disabled,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,options:J},null,8,["disabled","value","onUpdate:value"])):_("",!0)]),_:2},1032,["name","label","rules"])):_("",!0),a.type==="iSearch"?(d(),v(m,{key:2,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(u,{loading:y.value==a.name,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,onSearch:l=>z(a.name),onInput:l=>X(a.name),onEnterButton:l=>z(a.name),maxlength:a.max},null,8,["loading","value","onUpdate:value","onSearch","onInput","onEnterButton","maxlength"])]),_:2},1032,["name","label","rules"])):_("",!0),a.type==="iDivider"?(d(),v(D,{key:3,dashed:"",style:{"grid-column":"1/3",margin:".5rem 0 1rem 0"}})):_("",!0),a.type==="iSelectWrite"?(d(),v(m,{key:4,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[a.name=="city_id"?(d(),v(r,{key:0,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,"show-search":"",options:A(f).cities,"filter-option":L,onChange:F},null,8,["value","onUpdate:value","options"])):_("",!0),a.name=="province_id"?(d(),v(r,{key:1,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,"show-search":"",options:A(f).provinces,"filter-option":L,onChange:B,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):_("",!0),a.name=="district_id"?(d(),v(r,{key:2,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,"show-search":"",options:A(f).districts,"filter-option":L,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):_("",!0),a.is=="component"?(d(),v(r,{key:3,value:e[a.name],"onUpdate:value":l=>e[a.name]=l,"show-search":"",options:V(a.name),"filter-option":L,onChange:l=>ee(l,a.name)},null,8,["value","onUpdate:value","options","onChange"])):_("",!0)]),_:2},1032,["name","label","rules"])):_("",!0),a.type==="iDate"?(d(),v(m,{key:5,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(w,{"disabled-date":Q,locale:A(fe),value:e[a.name],"onUpdate:value":l=>e[a.name]=l,style:{width:"100%"},format:Ne,placeholder:"día/mes/año"},null,8,["locale","value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):_("",!0)],64))),128))]),i(m,null,{default:s(()=>[i(R,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:s(()=>[Y("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},Oe=Ee(Ue,[["__scopeId","data-v-f3d08954"]]),ke=ge.get("token"),Pe="https://apituempresa.soporte-pnte.com/api/",Re="http://127.0.0.1:8000/api/",Ae=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?Re:Pe;async function Me(G,N){try{N(!0);const h=await he({url:`${Ae}${G}`,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${ke}`},method:"GET",responseType:"blob"}),f=window.URL.createObjectURL(new Blob([h.data])),b=document.createElement("a");b.href=f;const g=h.headers["content-disposition"],M=g?g.split("filename=")[1].split(";")[0]:"reporte.xlsx";b.setAttribute("download",M),document.body.appendChild(b),b.click(),document.body.removeChild(b)}catch(h){console.error("Error al descargar el archivo:",h)}finally{N(!1)}}const Te=S("h3",{class:"title-produce"},"PLANES DE ACCIÓN",-1),Le=S("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Ce},null,-1),qe={key:0},Ye={key:1,style:{color:"#1677ff"}},$e=["onClick"],ze=S("a",null,"Eliminar",-1),Fe={class:"paginator"},je={__name:"PlanesDeAccion",setup(G){const N=JSON.parse(localStorage.getItem("role")),h=le();h.$patch({components:h.components}),h.fetchComponents();const f=p(null);p(null);const b=p(!1);p();const g=p(50),M=p([]),U=p(!1),y=p(0),T=p({page:1}),j=p("plans-action/list"),J=p(1200),e=p(window.innerHeight-100),O=p(!1);p(null);const V=p([{value:"si",label:"SI"},{value:"no",label:"NO"}]),K=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},...N[0].id!=2?[{title:"CENTRO TU EMPRESA",dataIndex:"centro_empresa",fixed:"left",width:150}]:[],...N[0].id!=2?[{title:"ASESOR",dataIndex:"asesor",fixed:"left",width:180}]:[],{title:"RUC",dataIndex:"ruc",width:100,fixed:"left",align:"center"},{title:"NOMBRE DEL EMPRENDEDOR O MYPE",fixed:"left",dataIndex:"emprendedor_nombres",width:170},{title:"REGIÓN DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_region",width:170},{title:"PROVINCIA DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_provincia",width:170},{title:"DISTRITO DEL EMPRENDEDOR O MYPE",dataIndex:"emprendedor_distrito",width:170},{title:"Genero",dataIndex:"genero",width:60,align:"center"},{title:"Tiene alguna Discapacidad ? (SI / NO)",dataIndex:"discapacidad",width:110,align:"center"},{title:"COMPONENTE 1",dataIndex:"component_1",width:190,align:"center"},{title:"COMPONENTE 2",dataIndex:"component_2",width:190,align:"center"},{title:"COMPONENTE 3",dataIndex:"component_3",width:190,align:"center"},{title:"NÚMERO DE SESIONES",dataIndex:"numberSessions",width:100,align:"center"},{title:"DÍA INICIO",dataIndex:"startDate",width:100,align:"center"},{title:"DÍA FIN",dataIndex:"endDate",width:100,align:"center"},{title:"TOTAL DE DÍAS",dataIndex:"totalDate",width:100,align:"center"},{title:"ACTA DE COMPROMISO",dataIndex:"acta",width:160,align:"center"},{title:"CULMINÓ EL PLAN Y ENVIÓ CORREO",dataIndex:"envioCorreo",width:160,align:"center"},{title:"FECHA ACTUALIZACIÓN",dataIndex:"updated_at",width:140,align:"center"},...N[0].id!=2?[{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}]:[]],Q=async r=>{try{const u=await $({url:`plans-action/delete/${r.id}`,method:"DELETE"});u.status==200&&(I.success(u.message),n())}catch{console.log("Failed to delete")}},X=r=>{f.value=r,O.value=!0},L=r=>{b.value=r},z=async()=>{Me("download/actions-plans",L)},F=async(r,u,D)=>{const w={idPlan:u.id,type:D,value:r},R=await $({url:"plans-action/edit-yes-no",method:"PUT",data:w});R.status==200&&n(),R.status==400&&(I.warning(R.message),n())},B=()=>{e.value=window.innerHeight-315},ee=()=>{f.value=null,O.value=!1,n()},P=ne({search:""}),W=()=>{n({search:P.search})},t=()=>{P.search||n()},o=r=>{T.value.page=r,n()},n=async r=>{try{U.value=!0;const u=T.value.page===1?"":T.value,D=r?{...u,...r}:u,w=await $({url:j.value,method:"GET",params:D});M.value=w.data,y.value=w.pagination.total,g.value=w.pagination.per_page}catch(u){console.error("Error de red:",u)}finally{U.value=!1}},m=be(()=>r=>(T.value.page-1)*g.value+r+1);return oe(()=>{n(),window.addEventListener("resize",B),B()}),(r,u)=>{const D=c("a-button"),w=c("a-col"),R=c("a-input"),ae=c("a-input-group"),a=c("a-row"),H=c("a-select"),l=c("a-menu-item"),ie=c("a-popconfirm"),se=c("a-menu"),re=c("a-dropdown"),de=c("a-table"),ce=c("a-tag"),ue=c("a-pagination"),me=c("a-drawer");return d(),k("div",null,[Te,i(a,{style:{margin:"1rem 0"}},{default:s(()=>[i(w,{xs:24,md:12,lg:18},{default:s(()=>[i(D,{onClick:u[0]||(u[0]=C=>O.value=!0),type:"primary"},{default:s(()=>[Y("NUEVO")]),_:1}),i(D,{class:"btn-excel",loading:b.value,type:"primary",style:{"margin-left":".6rem"},onClick:z},{default:s(()=>[Le,Y(" DESCARGAR ")]),_:1},8,["loading"])]),_:1}),i(w,{xs:24,md:12,lg:6},{default:s(()=>[i(ae,{compact:""},{default:s(()=>[i(R,{value:P.search,"onUpdate:value":u[1]||(u[1]=C=>P.search=C),style:{width:"calc(100% - 80px)"},onInput:t},null,8,["value"]),i(D,{type:"primary",disabled:P.search==="",onClick:W},{default:s(()=>[Y("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(de,{bordered:"",scroll:{x:J.value,y:e.value},class:"table-actions",columns:K,"data-source":M.value,pagination:!1,loading:U.value,size:"small"},{bodyCell:s(({column:C,record:E,index:pe})=>[C.dataIndex==="idx"?(d(),k(Z,{key:0},[Y(te(m.value(pe)),1)],64)):_("",!0),C.dataIndex==="ruc"?(d(),k(Z,{key:1},[E.ruc?(d(),k("span",qe,te(E.ruc),1)):(d(),k("span",Ye,"En trámite"))],64)):_("",!0),C.dataIndex==="acta"?(d(),v(H,{key:2,value:E.actaCompromiso,"onUpdate:value":x=>E.actaCompromiso=x,style:{width:"70%"},options:V.value,onChange:x=>F(x,E,"actaCompromiso")},null,8,["value","onUpdate:value","options","onChange"])):_("",!0),C.dataIndex==="envioCorreo"?(d(),v(H,{key:3,value:E.envioCorreo,"onUpdate:value":x=>E.envioCorreo=x,style:{width:"70%"},options:V.value,onChange:x=>F(x,E,"envioCorreo")},null,8,["value","onUpdate:value","options","onChange"])):_("",!0),C.dataIndex=="actions"?(d(),v(re,{key:4,trigger:["click"]},{overlay:s(()=>[i(se,null,{default:s(()=>[i(l,null,{default:s(()=>[S("a",{onClick:x=>X(E)},"Editar",8,$e)]),_:2},1024),i(l,null,{default:s(()=>[i(ie,{title:"¿Seguro de eliminar?",onConfirm:x=>Q(E)},{icon:s(()=>[i(A(ye),{style:{color:"red"}})]),default:s(()=>[ze]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:s(()=>[S("a",{class:"ant-dropdown-link",onClick:u[2]||(u[2]=we(()=>{},["prevent"]))},[i(D,{shape:"circle",icon:De(A(xe)),size:"small"},null,8,["icon"])])]),_:2},1024)):_("",!0)]),_:1},8,["scroll","data-source","loading"]),S("div",Fe,[S("span",null,[i(ce,{color:"blue"},{default:s(()=>[S("b",null,te(y.value),1)]),_:1}),Y("Registros")]),i(ue,{size:"small",total:y.value,pageSize:g.value,onChange:o,showSizeChanger:!1},null,8,["total","pageSize"])]),i(me,{open:O.value,"onUpdate:open":u[3]||(u[3]=C=>O.value=C),title:"Agregar un nuevo Plan de Acción",placement:"right",width:"650"},{default:s(()=>[i(Oe,{onCloseDraw:ee,info:f.value},null,8,["info"])]),_:1},8,["open"])])}}};export{je as default};
