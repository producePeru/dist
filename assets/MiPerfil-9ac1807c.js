import{f as L}from"./actualizarUsuario-dcb6b189.js";import{u as R}from"./selectes-ef044ac1.js";import{K as D,r as b,a as j,k as G,b as r,o as n,d as q,e as y,c as l,w as i,y as w,i as C,F as Y,B as J,q as u,h as m,s as d,L as K,p as Z,j as z,m as M}from"./index-6613f228.js";import"./es-c4cf1bc1.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const Q=v=>(Z("data-v-f158a49b"),v=v(),z(),v),W={class:"profile-header"},X=Q(()=>y("h3",null,"MIS DATOS",-1)),ee={class:"my-profile"},ae={class:"grid-profile"},F="YYYY-MM-DD",te={__name:"MiPerfil",props:["updateUser"],emits:["closeDraw"],setup(v,{emit:oe}){D.locale("es");const t=R(),g=JSON.parse(localStorage.getItem("profile")),k=b(!1);t.$patch({genders:t.genders}),t.$patch({cdes:t.cdes}),t.$patch({Offices:t.Offices}),t.$patch({roles:t.roles}),t.$patch({supervisores:t.supervisores}),t.fetchGenders(),t.fetchCdes(),t.fetchOffices(),t.fetchRoles();const S=b(!1),p=b(L),_=b(null),a=j({documentnumber:null,name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:g.id}),I=o=>{const c={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(o===2)t.fetchSupervisores(),p.value={...p.value,supervisor_id:c};else{const{supervisor_id:U,...x}=p.value;p.value=x}},N=async()=>{S.value=!0,a.birthday=_.value?D(_.value).format("YYYY-MM-DD"):null;let o=a;delete o.documentnumber;try{const c=await w({url:`user/update/${g.id}`,method:"PUT",data:o});M.success(c.message)}catch{M.error("No se pudo registrar este usuario")}finally{S.value=!1}},O=()=>{M.error("Debes de completar todos los espacios requeridos")},T=async()=>{try{k.value=!0;const{data:o}=await w({url:"user/my-profile",method:"GET"});o&&(a.documentnumber=g.documentnumber,a.name=o.name,a.lastname=o.lastname,a.middlename=o.middlename,a.birthday=o.birthday,a.sick=o.sick,a.phone=o.phone,a.gender_id=o.gender_id,a.cde_id=o.cde_id,a.office_id=o.office_id,o.birthday&&(_.value=D(o.birthday,F)))}catch(o){console.error("Error de red:",o)}finally{k.value=!1}};return G(()=>{T()}),(o,c)=>{const U=r("a-button"),x=r("router-link"),$=r("a-divider"),f=r("a-select"),h=r("a-form-item"),B=r("a-input"),V=r("a-date-picker"),A=r("a-form"),P=r("a-spin");return n(),q("div",null,[y("div",W,[X,l(x,{to:"cambiar-clave"},{default:i(()=>[l(U,null,{default:i(()=>[C("Cambiar contraseÃ±a")]),_:1})]),_:1})]),l($),y("section",ee,[l(P,{spinning:k.value},{default:i(()=>[l(A,{layout:"vertical",model:a,name:"basic",autocomplete:"off",onFinish:N,onFinishFailed:O},{default:i(()=>[y("div",ae,[(n(!0),q(Y,null,J(p.value,(e,E)=>(n(),q(Y,{key:E},[e.type==="iSelect"?(n(),u(h,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:i(()=>[e.name=="gender_id"?(n(),u(f,{key:0,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).genders},null,8,["value","onUpdate:value","options"])):d("",!0),e.name=="cde_id"?(n(),u(f,{key:1,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).cdes},null,8,["value","onUpdate:value","options"])):d("",!0),e.name=="office_id"?(n(),u(f,{key:2,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).Offices},null,8,["value","onUpdate:value","options"])):d("",!0),e.name=="role_id"?(n(),u(f,{key:3,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).roles,onChange:I},null,8,["value","onUpdate:value","options"])):d("",!0),e.name=="supervisor_id"?(n(),u(f,{key:4,value:a[e.name],"onUpdate:value":s=>a[e.name]=s,options:m(t).supervisores},null,8,["value","onUpdate:value","options"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iText"?(n(),u(h,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:i(()=>[l(B,{value:a[e.name],"onUpdate:value":s=>a[e.name]=s,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):d("",!0),e.type==="iDate"?(n(),u(h,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:i(()=>[l(V,{locale:m(K),value:_.value,"onUpdate:value":c[0]||(c[0]=s=>_.value=s),style:{width:"100%"},format:F},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):d("",!0)],64))),128))]),l(h,null,{default:i(()=>[l(U,{class:"btn-produce",type:"primary","html-type":"submit",loading:S.value},{default:i(()=>[C("ACTUALIZAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])])}}},ue=H(te,[["__scopeId","data-v-f158a49b"]]);export{ue as default};
