import{_ as Q}from"./TableComponent-74c1de65.js";import{l as p,r as o,a as G,j as z,X as Z,a6 as I,o as m,d as Y,c as v,R as O,m as $,u as K,b as L,w as u,x as N,h as U,y as b,F as X,e as w,i as q,t as V,a2 as W}from"./index-f8d1f2b5.js";import{_ as ee}from"./FormComponent-b415cd92.js";import{u as ae}from"./selectes-fd0ee159.js";import"./es-eebcc750.js";import{d as te}from"./downloadExcel-de9202b7.js";import{C as ne}from"./CloudUploadOutlined-2c94cb08.js";import"./icoexcel-1b303edf.js";import"./MoreOutlined-f0237bd8.js";import"./quill.snow-07761e5a.js";const le={class:"f-20"},ie={__name:"DrawerPP03",props:["info"],emits:["closeDraw"],setup(B,{emit:R}){p.locale("es");const f=o({nameEvent:{type:"iText",label:"NOMBRE DEL EVENTO",name:"nameEvent",required:!0,message:"Escribir nombre del evento",disabled:!1},city_id:{type:"iSelect",label:"REGIÓN DEL NEGOCIO",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},place:{type:"iText",label:"LUGAR DEL EVENTO",name:"place",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:""},modality_id:{type:"iSelect",label:"MODALIDAD",name:"modality_id",required:!0,message:"Seleccionar la modalidad",disabled:!1},dates:{type:"iDatePicker",label:"FECHA DEL EVENTO",name:"dates",required:!0,message:"Seleccionar fecha",disabled:!1},hours:{type:"iText",label:"HORARIO",name:"hours",required:!0,message:"Escribir nombre del evento",disabled:!1,placeholder:"Ejemplo: 5:00 pm a 8:00 pm"},description:{type:"iTextArea",label:"DESCRIPCIÓN",name:"description",required:!0,message:"Escribir el detalle",disabled:!1,rows:7}});JSON.parse(localStorage.getItem("profile"));const x=R,s=B,_=o("GUARDAR"),e=G({hours:s.info?null:"HORARIO: 5:00 pm a 8:00 pm",description:s.info?null:"Estimado(a) Empresario(a) El Programa Nacional Tu Empresa - PNTE del Ministerio de la Producción, como parte del objetivo de apoyo y fortalecimiento a las MYPE, lo invita a participar de los cursos que mejorarán su proceso de reactivación económica. Vamos !!! Ingrese y confirme su participación en el tema de:"}),y=o(!1),i=ae(),D=o(null),a=o({city_id:[],province_id:[],district_id:[],modality_id:[]}),M=n=>{console.log("handleInputEvent",n)},P=async n=>{n=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),f.value.dateTramite.disabled=!1)},k=async n=>{n=="city_id"&&(await i.fetchProvinces(e.city_id),a.value.province_id=i.provinces,f.value.province_id.disabled=!1),n=="province_id"&&(await i.fetchDistricts(e.province_id),a.value.district_id=i.districts,f.value.district_id.disabled=!1)},H=async n=>{console.log("handleFocusSelect",n),n=="city_id"&&(await i.fetchCities(),e.city_id=null,e.province_id=null,e.district_id=null,a.value.province_id=[],a.value.city_id=i.cities),n=="province_id"&&(e.province_id=null,e.district_id=null,a.value.district_id=[]),n=="modality_id"&&(await i.fetchModalities(),a.value.modality_id=i.modalities)},A=n=>{},F=async()=>{y.value=!0;const n={nameEvent:e.nameEvent,city_id:e.city_id,place:e.place,modality_id:e.modality_id,dateStart:p(e.dates.start).format("YYYY-MM-DD"),dateEnd:p(e.dates.end).format("YYYY-MM-DD"),hours:e.hours,description:e.description};try{const h=s.info?`pp03/update/${s.info.id}`:"pp03/store",E=s.info?"PUT":"POST",g=await O({url:h,method:E,data:n});g.status===200&&($.success(g.message),C(),x("closeDraw",!0))}catch(h){console.error("Error:",h);const E=document.getElementsByClassName("ant-drawer-body")[0];E&&(E.scrollTop=0)}finally{y.value=!1}},C=()=>{e.nameEvent=null,e.city_id=null,e.place=null,e.modality_id=null,e.dates=null,e.hours=null,e.description=null},T=async n=>{n&&(e.nameEvent=n.nameEvent,e.place=n.place,e.hours=n.hours,e.description=n.description,await i.fetchCities(),a.value.city_id=i.cities,e.city_id=n.city_id,await i.fetchModalities(),a.value.modality_id=i.modalities,e.modality_id=n.modality_id,e.dates={start:p(n.dateStart).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),end:p(n.dateEnd).format("YYYY-MM-DDTHH:mm:ss.SSSZ")})};return z(()=>{s.info&&T(s.info)}),Z(()=>s.info,n=>{n?T(n):C()}),I("formState",e),I("loadingState",y),(n,h)=>(m(),Y("div",le,[v(ee,{fields:f.value,options:a.value,btnSaveName:_.value,onHandleInputEvent:M,resetSelect:D.value,onHandleChangeSelect:k,onHandleFocusSelect:H,onHandleBlurSelect:A,onHandleChangeClock:P,onOnSubmit:F},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const oe={class:"advisory-table"},se={key:0,style:{"line-height":"1.5"}},re={key:1},de=["onClick"],ce=["onClick"],ue=["onClick"],we={__name:"Pp03Index",setup(B){const R=JSON.parse(localStorage.getItem("role"))||[],f=o([]),x=o(0),s=o(150),_=o(!1),e=K(),y=o(!1),i=o(null),D=o(!1),a=G({year:p("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),M=[{title:"#",fixed:"left",dataIndex:"idx",align:"center",width:70},{title:"LINK",dataIndex:"link",fixed:"left",width:70,align:"center"},{title:"EVENTO",dataIndex:"nameEvent",width:220},{title:"INSCRITOS",dataIndex:"number",width:120,align:"center"},{title:"REGIÓN",dataIndex:"city_name",width:150},{title:"LUGAR",dataIndex:"place",width:200},{title:"MODALIDAD",dataIndex:"modality_name",width:140,align:"center"},{title:"FECHA",dataIndex:"date",width:160,align:"center"},{title:"HORARIO",dataIndex:"hours",width:150,align:"center"},{title:"DESCRIPCIÓN",dataIndex:"description",width:300},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],P=o([{value:1,label:"Mayor inscritos"},{value:2,label:"Menor inscritos"},{value:3,label:"Finalizados"}]),k=t=>{e.push(`/admin/asistencia/inscritos/${t.slug}`)},H=t=>{i.value=t,_.value=!0},A=()=>{S(),_.value=!1},F=()=>{i.value=null,_.value=!0},C=async t=>{try{const l=await O({url:`attendance/delete/${t.id}`,method:"DELETE"});l.status==200&&(S(),$.success(l.message))}catch(l){console.error("Error de red:",l)}},T=async t=>{try{const l=await O({url:`attendance/event-finally/${t.id}`,method:"PUT"});l.status==200&&(S(),$.success(l.message))}catch(l){console.error("Error de red:",l)}},n=async()=>{D.value=!0;try{const t={};a.year&&(t.year=p(a.year).format("YYYY")),a.range&&(t.dateStart=a.range[0].format("YYYY/MM/DD"),t.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(t.name=a.name),a.orderby&&(t.orderby=a.orderby),a.asesor&&(t.asesor=a.asesor),await te("download/attendance-ugo","eventos-ugo",t)}catch(t){console.error("Error de red:",t)}finally{D.value=!1}},h=async t=>{a.page=t,await S()},E=async t=>{t&&(a.page=1,await S())},g=t=>R.some(l=>t.includes(l.id)),S=async()=>{try{y.value=!0;const t={page:a.page};a.year&&(t.year=p(a.year).format("YYYY")),a.range&&(t.dateStart=a.range[0].format("YYYY/MM/DD"),t.dateEnd=a.range[1].format("YYYY/MM/DD")),a.name&&(t.name=a.name),a.orderby&&(t.orderby=a.orderby);const d=await O({url:"pp03/list",method:"GET",params:t});f.value=d.data.data,x.value=d.data.total,s.value=d.data.per_page}catch(t){console.error("Error de red:",t)}finally{y.value=!1}};return z(async()=>{await S()}),I("search",a),I("loading",y),I("loadingFile",D),(t,l)=>{const d=L("a-menu-item"),j=L("a-popconfirm"),J=L("a-drawer");return m(),Y("div",oe,[v(Q,{title:"LISTA EVENTOS PP03",new:!0,textNuevo:"NUEVO EVENTO",placeholderSearch:"Buscar",searchYear:!0,rangeDate:!0,columns:M,othersList:P.value,titleSearch:"BUSCAR POR EVENTO",pageSize:s.value,nameTotal:"Eventos PP03",dataSource:f.value,total:x.value,onHandleNew:F,onHandleDownloadExcel:n,onHandleSearch:E,onHandlePaginator:h},{"data-cell":u(({column:r,record:c})=>[r.dataIndex=="link"?(m(),N(U(ne),{key:0,style:{"font-size":"18px"}})):b("",!0),r.dataIndex=="date"?(m(),Y(X,{key:1},[c.dateStart!=c.dateEnd?(m(),Y("span",se,[l[1]||(l[1]=w("b",null,"Desde:",-1)),q(" "+V(c.dateStartFormat)+" ",1),l[2]||(l[2]=w("b",null,"Hasta:",-1)),q(" "+V(c.dateEndFormat),1)])):(m(),Y("span",re,V(c.dateStartFormat),1))],64)):b("",!0)]),"custom-options":u(({record:r})=>[v(d,null,{default:u(()=>[w("a",{onClick:c=>k(r)},"Inscritos",8,de)]),_:2},1024),g([1,5])?(m(),N(d,{key:0},{default:u(()=>[w("a",{onClick:c=>H(r)},"Editar",8,ce)]),_:2},1024)):b("",!0),g([1,5])?(m(),N(d,{key:1},{default:u(()=>[w("span",{style:{color:"#ff4d4f"},onClick:c=>T(r)},"Finalizar",8,ue)]),_:2},1024)):b("",!0),g([1,5])?(m(),N(d,{key:2},{default:u(()=>[v(j,{placement:"rightBottom",title:`¿Quieres eliminar ${r.title} ?`,onConfirm:c=>C(r)},{icon:u(()=>[v(U(W),{style:{color:"red"}})]),default:u(()=>[l[3]||(l[3]=w("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):b("",!0)]),_:1},8,["othersList","pageSize","dataSource","total"]),v(J,{open:_.value,"onUpdate:open":l[0]||(l[0]=r=>_.value=r),title:i.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:u(()=>[v(ie,{onCloseDraw:A,info:i.value},null,8,["info"])]),_:1},8,["open","title"])])}}};export{we as default};
