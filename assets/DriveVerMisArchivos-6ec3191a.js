import{g as j,r as t,y as q,k as G,b as s,o as c,d as w,e as l,O as J,P,c as n,w as o,i as x,F as Q,B as D,t as u,s as h,q as E,h as y,Q as K,R as W,J as X,S as Z,m as ee,H as ae,T as te}from"./index-f6eaa518.js";import{M as oe}from"./MoreOutlined-e78843b9.js";const ne=l("h3",null,"ARCHIVOS",-1),se={class:"w-search"},le={key:0},ie={key:1},re=l("a",null,"Eliminar",-1),de={class:"paginator-drive"},pe={__name:"DriveVerMisArchivos",setup(ce){const k=JSON.parse(localStorage.getItem("profile")),A="https://apituempresa.soporte-pnte.com/api/",I="http://127.0.0.1:8000/api/",S=window.location.hostname=="localhost"||window.location.hostname=="127.0.0.1"?I:A,z=j.get("token"),d=t({}),v=t([]),m=t(!1),b=t(0);t(0),t([]),t(""),t(!1);const O=[{title:"AUTOR",dataIndex:"user",fixed:"left",width:180},{title:"NOMBRE DEL ARCHIVO",dataIndex:"name",width:140},{title:"FECHA",dataIndex:"date",width:120,align:"center"},{title:"DESCARGAR",dataIndex:"download",width:120,align:"center"},{title:"",dataIndex:"actions",width:50,align:"center",fixed:"right"}],R=async e=>{try{const a=await D({url:`drive/delete-file/${e.id}`,method:"DELETE"});a&&(f(),ee.success(a.message))}catch(a){console.error("Error de red:",a)}},B=async e=>{d.value={...d.value,[e]:!0};try{const a=await ae.get(`${S}drive/download/${e}`,{responseType:"blob",headers:{Accept:"application/json",Authorization:`Bearer ${z}`}}),p=window.URL.createObjectURL(new Blob([a.data])),i=document.createElement("a");i.href=p,i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(a){console.error("Error al descargar el archivo",a)}finally{d.value={...d.value,[e]:!1}}},M=e=>te(e).format("DD/MM/YYYY HH:mm A"),C=t(window.innerHeight-100),g=()=>{C.value=window.innerHeight-300};q(()=>{window.removeEventListener("resize",g)});const H=t({page:1}),V=e=>{H.value.page=e,f()},f=async()=>{try{m.value=!0;const{data:e}=await D({url:`drive/list-files/${k.user_id}/${k.documentnumber}`,method:"GET"});v.value=e.data,b.value=e.total}catch(e){console.error("Error de red:",e)}finally{m.value=!1}};return G(()=>{f(),window.addEventListener("resize",g),g()}),(e,a)=>{const p=s("a-button"),i=s("a-popconfirm"),$=s("a-menu-item"),L=s("a-menu"),N=s("a-dropdown"),T=s("a-table"),U=s("a-tag"),Y=s("a-pagination");return c(),w(Q,null,[l("div",null,[ne,J(l("div",se,null,512),[[P,!m.value]]),n(T,{bordered:"",class:"ant-table-striped",sticky:"",scroll:{y:C.value},columns:O,"data-source":v.value,pagination:!1,loading:m.value,size:"small"},{bodyCell:o(({column:_,record:r})=>[_.dataIndex=="date"?(c(),w("div",le,u(M(r.created_at)),1)):h("",!0),_.dataIndex=="user"?(c(),w("div",ie,u(r.profile.name)+" "+u(r.profile.lastname)+" "+u(r.profile.middlename),1)):h("",!0),_.dataIndex=="download"?(c(),E(p,{key:2,size:"small",onClick:F=>B(r.path),type:"primary",ghost:"",loading:d.value[r.path]},{icon:o(()=>[n(y(K))]),default:o(()=>[x(" Descargar ")]),_:2},1032,["onClick","loading"])):h("",!0),_.dataIndex=="actions"?(c(),E(N,{key:3,trigger:["click"]},{overlay:o(()=>[n(L,null,{default:o(()=>[n($,null,{default:o(()=>[n(i,{title:"Â¿Seguro de eliminar?",onConfirm:F=>R(r)},{icon:o(()=>[n(y(W),{style:{color:"red"}})]),default:o(()=>[re]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[l("a",{class:"ant-dropdown-link",onClick:a[0]||(a[0]=X(()=>{},["prevent"]))},[n(p,{shape:"circle",icon:Z(y(oe)),size:"small"},null,8,["icon"])])]),_:2},1024)):h("",!0)]),_:1},8,["scroll","data-source","loading"])]),l("div",de,[l("span",null,[n(U,{color:"blue"},{default:o(()=>[l("b",null,u(v.value.length),1)]),_:1}),x(" Archivos Subidos")]),n(Y,{size:"small",pageSize:20,total:b.value,onChange:V,showSizeChanger:!1},null,8,["total"])])],64)}}};export{pe as default};
