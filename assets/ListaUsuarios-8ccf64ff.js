import{L as ke,r as h,a as H,b as d,o as n,q as v,w as s,e as x,d as b,F as w,x as be,h as N,s as r,c as l,M as we,t as _,i as m,z as T,m as F,k as pe,K as ce,I as xe,J as Ue,P as Ce}from"./index-35c2d705.js";import{f as Ie}from"./actualizarUsuario-3eaca126.js";import{u as Se}from"./selectes-6ff0a8ca.js";import"./es-36023a69.js";import{_ as De}from"./_plugin-vue_export-helper-c27b6911.js";import{M as Ae}from"./MoreOutlined-98ae2477.js";const Ee={class:"grid-profile"},Oe="YYYY-MM-DD",$e={__name:"EditarPerfil.componente",props:["updateUser"],emits:["closeDraw"],setup(V,{emit:O}){ke.locale("es");const a=Se(),$=JSON.parse(localStorage.getItem("profile")),D=O;a.$patch({genders:a.genders}),a.$patch({cdes:a.cdes}),a.$patch({Offices:a.Offices}),a.$patch({roles:a.roles}),a.$patch({supervisores:a.supervisores}),a.fetchGenders(),a.fetchCdes(),a.fetchOffices(),a.fetchRoles();const A=V,U=h(!1),u=h(Ie),E=h(null),t=H({name:null,lastname:null,middlename:null,birthday:null,sick:null,phone:null,gender_id:null,cde_id:null,office_id:null,user_id:$.id}),z=i=>{i&&(t.name=i.profile.name,t.lastname=i.profile.lastname,t.middlename=i.profile.middlename,t.birthday=i.profile.birthday,t.sick=i.profile.sick,t.phone=i.profile.phone,t.gender_id=i.profile.gender_id,t.cde_id=i.profile.cde_id,t.office_id=i.profile.office_id,t.email=i.email)},p=i=>{const C={type:"iSelect",label:"Supervisador",name:"supervisor_id",required:!0,message:"Seleccionar tipo de documento",disabled:!0};if(i===2)a.fetchSupervisores(),u.value={...u.value,supervisor_id:C};else{const{supervisor_id:S,...I}=u.value;u.value=I}},g=async()=>{U.value=!0;let i=t;delete i.email;try{const C=await T({url:`user/update/${A.updateUser.profile.id}`,method:"PUT",data:i});F.success(C.message),D("closeDraw",!0)}catch{F.error("No se pudo registrar este usuario")}finally{U.value=!1}},P=()=>{F.error("Debes de completar todos los espacios requeridos")};return(i,C)=>{const S=d("a-select"),I=d("a-form-item"),L=d("a-input"),B=d("a-date-picker"),Y=d("a-button"),R=d("a-form");return n(),v(R,{layout:"vertical",model:t,name:"basic",autocomplete:"off",onFinish:g,onFinishFailed:P},{default:s(()=>[x("div",Ee,[(n(!0),b(w,null,be(u.value,(e,j)=>(n(),b(w,{key:j},[e.type==="iSelect"?(n(),v(I,{key:0,class:"item-max",name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[e.name=="gender_id"?(n(),v(S,{key:0,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:N(a).genders},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="cde_id"?(n(),v(S,{key:1,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:N(a).cdes},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="office_id"?(n(),v(S,{key:2,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:N(a).Offices},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="role_id"?(n(),v(S,{key:3,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:N(a).roles,onChange:p},null,8,["value","onUpdate:value","options"])):r("",!0),e.name=="supervisor_id"?(n(),v(S,{key:4,value:t[e.name],"onUpdate:value":o=>t[e.name]=o,options:N(a).supervisores},null,8,["value","onUpdate:value","options"])):r("",!0)]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iText"?(n(),v(I,{key:1,name:e.name,label:e.label,rules:[{required:e.required,message:e.message,type:e.email}]},{default:s(()=>[l(L,{value:t[e.name],"onUpdate:value":o=>t[e.name]=o,maxlength:e.max,disabled:e.disabled},null,8,["value","onUpdate:value","maxlength","disabled"])]),_:2},1032,["name","label","rules"])):r("",!0),e.type==="iDate"?(n(),v(I,{key:2,name:e.name,label:e.label,rules:[{required:e.required,message:e.message}]},{default:s(()=>[l(B,{locale:N(we),value:E.value,"onUpdate:value":C[0]||(C[0]=o=>E.value=o),style:{width:"100%"},format:Oe},null,8,["locale","value"])]),_:2},1032,["name","label","rules"])):r("",!0)],64))),128))]),x("div",null,_(z(A.updateUser)),1),l(I,null,{default:s(()=>[l(Y,{class:"btn-produce",type:"primary","html-type":"submit",loading:U.value},{default:s(()=>[m("GUARDAR")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}},Le=De($e,[["__scopeId","data-v-3578053d"]]),Re=x("br",null,null,-1),Ne=x("br",null,null,-1),ze={__name:"DrawAdministrarVistasUsuario",props:["idUser"],emits:["closeDraw"],setup(V,{emit:O}){const a=V,$=O,D=h(!0),A=h(!1),U=["home","asesorias","planes-accion","asesorias-formalizaciones","solicitudes","solicitantes","notarias","asesores","supervisores","usuarios","usuarios-nuevo","usuarios-lista","asesor-externo-notario","drive-mis-archivos","drive-subir-archivo","drive-mis-carpetas","convenios","estado-convenio","configuraciones","tokens"];pe(()=>{a.idUser&&z(a.idUser)});const u=H({indeterminate:!0,checkAll:!1,checkedList:[]}),E=p=>{Object.assign(u,{checkedList:p.target.checked?U:[],indeterminate:!1})};ce(()=>u.checkedList,p=>{u.indeterminate=!!p.length&&p.length<U.length,u.checkAll=p.length===U.length}),ce(()=>a.idUser,p=>{p&&z()});const t=async()=>{A.value=!0;const p={views:u.checkedList};try{const g=await T({url:`user/views/${a.idUser.id}`,method:"PUT",data:p});if(g.status==403)return F.error(g.message);F.success(g.message),$("closeDraw",!0)}catch{F.error("No se pudo registrar este usuario")}finally{A.value=!1}},z=async()=>{D.value=!0;try{const{data:p}=await T({url:`user/views/${a.idUser.id}`,method:"GET"});u.checkedList=p}catch(p){console.log("Error",p)}finally{D.value=!1}};return(p,g)=>{const P=d("a-checkbox"),i=d("a-divider"),C=d("a-checkbox-group"),S=d("a-spin"),I=d("a-button");return n(),b(w,null,[x("div",null,[l(P,{checked:u.checkAll,"onUpdate:checked":g[0]||(g[0]=L=>u.checkAll=L),indeterminate:u.indeterminate,onChange:E},{default:s(()=>[m(_(u.checkAll?"Desactivar":"Activar")+" todos ",1)]),_:1},8,["checked","indeterminate"])]),l(i),l(S,{spinning:D.value},{default:s(()=>[l(C,{value:u.checkedList,"onUpdate:value":g[1]||(g[1]=L=>u.checkedList=L),options:U,style:{display:"grid","grid-template-columns":"repeat(2,1fr)",gap:".5rem"}},null,8,["value"])]),_:1},8,["spinning"]),Re,Ne,l(I,{type:"primary","html-type":"submit",loading:A.value,onClick:t},{default:s(()=>[m("GUARDAR")]),_:1},8,["loading"])],64)}}};const Pe=x("h3",{class:"title-produce"},"USUARIOS DEL PROGRAMA PNTE",-1),qe=["onClick"],Fe=["onClick"],Ge={class:"paginator"},He={__name:"ListaUsuarios",setup(V){const O=h(null),a=h(!1),$=h(!1),D=h(50),A=h([]),U=h(!1),u=h(0),E=h({page:1}),t=h("user/list"),z=h(1200),p=h(window.innerHeight-100),g=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"documentnumber",fixed:"left",width:80},{title:"Nombres",dataIndex:"name",width:120},{title:"Apellidos",dataIndex:"lastname",width:120},{title:"Correo",dataIndex:"email",width:200},{title:"Celular",dataIndex:"phone",width:100,align:"center"},{title:"Fecha Nac.",dataIndex:"birthday",width:100,align:"center"},{title:"Oficina",dataIndex:"office",width:120,align:"center"},{title:"CDE",dataIndex:"cde",width:140},{title:"ROL",dataIndex:"role",width:160},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],P=()=>{p.value=window.innerHeight-300},i=H({search:""}),C=()=>{let o={search:i.search};R(o)},S=()=>{i.search||R()},I=()=>{R(),a.value=!1,$.value=!1},L=o=>{E.value.page=o,R()},B=o=>{O.value=o,a.value=!0},Y=o=>{O.value=o,$.value=!0},R=async o=>{try{U.value=!0;const y=E.value.page===1?"":E.value,M=o?{...y,...o}:y,{data:G}=await T({url:t.value,method:"GET",params:M});A.value=G.data,u.value=G.total,D.value=G.per_page}catch(y){console.error("Error de red:",y)}finally{U.value=!1}},e=xe(()=>o=>(E.value.page-1)*D.value+o+1);pe(()=>{R(),window.addEventListener("resize",P),P()});const j=()=>{console.log("Drawer state changed")};return(o,y)=>{const M=d("a-col"),G=d("a-input"),J=d("a-button"),me=d("a-input-group"),fe=d("a-row"),q=d("a-tag"),K=d("a-menu-item"),_e=d("a-menu"),he=d("a-dropdown"),ve=d("a-table"),ge=d("a-pagination"),X=d("a-drawer");return n(),b(w,null,[x("div",null,[Pe,l(fe,{style:{margin:"1rem 0"}},{default:s(()=>[l(M,{xs:24,md:12,lg:18}),l(M,{xs:24,md:12,lg:6},{default:s(()=>[l(me,{compact:""},{default:s(()=>[l(G,{value:i.search,"onUpdate:value":y[0]||(y[0]=f=>i.search=f),style:{width:"calc(100% - 80px)"},onInput:S},null,8,["value"]),l(J,{type:"primary",disabled:i.search==="",onClick:C},{default:s(()=>[m("BUSCAR")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),l(ve,{bordered:"",scroll:{x:z.value,y:p.value},class:"table-users",columns:g,"data-source":A.value,pagination:!1,loading:U.value,size:"small"},{bodyCell:s(({column:f,record:c,index:ye})=>{var Q,W,Z,ee,ae,te,ne,oe,se,le,ie,re,de,ue;return[f.dataIndex==="idx"?(n(),b(w,{key:0},[m(_(e.value(ye)),1)],64)):r("",!0),f.dataIndex=="documentnumber"?(n(),b(w,{key:1},[m(_((Q=c.profile)==null?void 0:Q.documentnumber),1)],64)):r("",!0),f.dataIndex=="name"?(n(),b(w,{key:2},[m(_((W=c.profile)==null?void 0:W.name),1)],64)):r("",!0),f.dataIndex=="lastname"?(n(),b(w,{key:3},[m(_((Z=c.profile)==null?void 0:Z.lastname)+" "+_((ee=c.profile)==null?void 0:ee.middlename),1)],64)):r("",!0),f.dataIndex=="phone"?(n(),b(w,{key:4},[m(_((ae=c.profile)!=null&&ae.phone?(te=c.profile)==null?void 0:te.phone:"ğŸ”’"),1)],64)):r("",!0),f.dataIndex=="birthday"?(n(),b(w,{key:5},[m(_((ne=c.profile)!=null&&ne.birthday?(oe=c.profile)==null?void 0:oe.birthday:"ğŸ”’"),1)],64)):r("",!0),f.dataIndex=="office"?(n(),b(w,{key:6},[((se=c.profile.office)==null?void 0:se.name)=="UGSE"?(n(),v(q,{key:0,color:"blue"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):r("",!0),((le=c.profile.office)==null?void 0:le.name)=="UGO"?(n(),v(q,{key:1,color:"orange"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):r("",!0),((ie=c.profile.office)==null?void 0:ie.name)=="DE"?(n(),v(q,{key:2,color:"green"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):r("",!0),((re=c.profile.office)==null?void 0:re.name)=="UGEER"?(n(),v(q,{key:3,color:"gray"},{default:s(()=>{var k;return[m(_((k=c.profile)==null?void 0:k.office.name),1)]}),_:2},1024)):r("",!0),((de=c.profile.office)==null?void 0:de.id)==5?(n(),v(q,{key:4,color:"blue"},{default:s(()=>[m("Asesor NotarÃ­a ")]),_:1})):r("",!0)],64)):r("",!0),f.dataIndex=="cde"?(n(),b(w,{key:7},[m(_((ue=c.profile)==null?void 0:ue.cde.name),1)],64)):r("",!0),f.dataIndex=="role"?(n(),b(w,{key:8},[m(_(c.roles[0].name),1)],64)):r("",!0),f.dataIndex=="actions"?(n(),v(he,{key:9,trigger:["click"]},{overlay:s(()=>[l(_e,null,{default:s(()=>[l(K,null,{default:s(()=>[x("a",{onClick:k=>B(c)},"Editar",8,qe)]),_:2},1024),l(K,null,{default:s(()=>[x("a",{onClick:k=>Y(c)},"Vistas",8,Fe)]),_:2},1024)]),_:2},1024)]),default:s(()=>[x("a",{class:"ant-dropdown-link",onClick:y[1]||(y[1]=Ue(()=>{},["prevent"]))},[l(J,{shape:"circle",icon:Ce(N(Ae)),size:"small"},null,8,["icon"])])]),_:2},1024)):r("",!0)]}),_:1},8,["scroll","data-source","loading"])]),x("div",Ge,[x("span",null,[l(q,{color:"blue"},{default:s(()=>[x("b",null,_(u.value),1)]),_:1}),m("Usuarios")]),l(ge,{size:"small",total:u.value,pageSize:D.value,onChange:L,showSizeChanger:!1},null,8,["total","pageSize"])]),l(X,{width:"550",open:a.value,"onUpdate:open":y[2]||(y[2]=f=>a.value=f),class:"draw-notary",title:"Editar Perfil",placement:"right",onAfterOpenChange:j},{default:s(()=>[l(Le,{updateUser:O.value,onCloseDraw:I},null,8,["updateUser"])]),_:1},8,["open"]),l(X,{width:"450",open:$.value,"onUpdate:open":y[3]||(y[3]=f=>$.value=f),class:"draw-notary",title:"Administrar Vistas",placement:"right"},{default:s(()=>[l(ze,{idUser:O.value,onCloseDraw:I},null,8,["idUser"])]),_:1},8,["open"])],64)}}};export{He as default};
