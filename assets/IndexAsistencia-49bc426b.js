import{l as w,r as p,D as be,a as oe,T as te,j as re,b as r,o,v as m,w as s,e as b,d as R,F as L,q as he,c as i,x as d,h as S,H as Ie,i as k,t as q,K as ne,m as j,u as we,g as xe,E as Ee,X as Se,ac as Ce,s as ie,ad as ke,a0 as Re,J as Ae,p as Oe}from"./index-76bfbfaa.js";import{_ as Te}from"./icoexcel-1b303edf.js";import{u as de}from"./selectes-eea4ccd0.js";import"./es-6ee62255.js";import{d as Ne}from"./downloadExcel-f7a604d9.js";import{C as Ue}from"./CloudOutlined-3dd44bdf.js";import{M as Ye}from"./MoreOutlined-0ba9bbe3.js";const qe={class:"form-attendance"},Le="DD/MM/YYYY",Fe={__name:"NuevoAsistencia",props:["dataRow"],emits:["closeDraw"],setup(J,{emit:y}){w.locale("es");const v=de();v.$patch({cities:v.cities}),v.$patch({provinces:v.provinces}),v.$patch({districts:v.districts}),v.fetchCities(),v.fetchAsesores();const F=p(!1),g=J,O=y;be();const e=oe({}),M={eventsoffice_id:{type:"iSelect",label:"TIPO",name:"eventsoffice_id",required:!0,message:"Seleccionar un tipo",disabled:!0},title:{type:"iText",label:"NOMBRE DE LA ACTIVIDAD",name:"title",required:!0,message:"Escribir el nombre de la Feria",disabled:!0,max:100},startDate:{type:"iDate",label:"FECHA INICIO",name:"startDate",required:!0,message:"Seleccionar fecha de Inicio",disabled:!1},endDate:{type:"iDate",label:"FECHA FIN",name:"endDate",required:!0,message:"Seleccionar fecha de Fin",disabled:!1},modality:{type:"iSelect",label:"MODALIDAD",name:"modality",required:!0,message:"Seleccionar una opción",disabled:!0},city_id:{type:"iSelectWrite",label:"REGIÓN",name:"city_id",required:!0,message:"Seleccionar región",disabled:!1},province_id:{type:"iSelectWrite",label:"PROVINCIA",name:"province_id",required:!0,message:"Seleccionar provincia",disabled:!1},district_id:{type:"iSelectWrite",label:"DISTRITO",name:"district_id",required:!0,message:"Seleccionar distrito",disabled:!1},address:{type:"iText",label:"DIRECCIÓN",name:"address",required:!0,message:"Escribir dirección",disabled:!0,max:100},people_id:{type:"iSelectWrite",label:"ASESOR - RESPONSABLE",name:"people_id",required:!0,message:"Seleccionar al asesor",disabled:!0},description:{type:"iTextarea",label:"DETALLE DEL EVENTO",name:"description",required:!1,message:"Escribir detalles",disabled:!0}},z=[{label:"PRESENCIAL",value:"p"},{label:"VIRTUAL",value:"v"}],C=n=>_=>{const I=new Date().setHours(0,0,0,0);if(n==="startDate")return _&&_.valueOf()<I;if(n==="endDate"){const c=e.startDate?new Date(e.startDate).setHours(0,0,0,0):null;return _&&(_.valueOf()<I||c&&_.valueOf()<c)}return _&&_.valueOf()<I};te(()=>e.startDate,n=>{e.endDate&&new Date(n)>new Date(e.endDate)&&(e.endDate=null)}),te(()=>e.endDate,n=>{e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=null)});const T=(n,_)=>{const I=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return _.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(I)},H=n=>{if(n=="modality")return z;if(n=="powerBy")return pertenece;if(n=="fairtype_id")return typeFair;if(n=="eventsoffice_id")return P()},P=()=>[{value:1,label:"DESPEGA TU EMPRESA"},{value:8,label:"DIFUSIÓN"},{value:3,label:"FORTALECE TU MERCADO"},{value:5,label:"POTENCIA TU EMPRESA"}],$=n=>{e.province_id=null,e.district_id=null,v.fetchProvinces(n)},x=n=>{e.district_id=null,v.fetchDistricts(n)},V=()=>{e.eventsoffice_id=null,e.title=null,e.startDate=null,e.endDate=null,e.modality=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.people_id=null,e.description=null},G=async()=>{F.value=!0;const n={eventsoffice_id:e.eventsoffice_id,title:e.title,startDate:w(e.startDate).format("YYYY-MM-DD"),endDate:w(e.endDate).format("YYYY-MM-DD"),modality:e.modality,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,people_id:e.people_id,description:e.description};try{const _=g.dataRow?"PUT":"POST",I=g.dataRow?`attendance/update/${g.dataRow.id}`:"attendance/create",c=await ne({url:I,method:_,data:n});c.status==200&&(j.success(c.message),O("closeDraw"),V()),c.status==500&&(j.error(c.message),V())}catch(_){j.error("Se presentó un error, los valores son requeridos",_)}finally{F.value=!1}},h=n=>{const _=e[n]?e[n].trim():"";e[n]=_};function N(n){e.eventsoffice_id=n.id_pnte,e.title=n.title,e.startDate=n.startDate?w(n.startDate,"DD/MM/YYYY"):null,e.endDate=n.endDate?w(n.endDate,"DD/MM/YYYY"):null,e.modality=n.modality,e.city_id=n.city_id,$(n.city_id),e.province_id=n.province_id,x(n.province_id),e.district_id=n.district_id,e.address=n.address,e.people_id=n.people_id,e.description=n.description}return re(()=>{g.dataRow&&N(g.dataRow)}),te(()=>g.dataRow,n=>{n?N(n):V()}),(n,_)=>{const I=r("a-input"),c=r("a-form-item"),A=r("a-select"),K=r("a-textarea"),Q=r("a-input-number"),X=r("a-date-picker"),B=r("a-button"),Z=r("a-form");return o(),m(Z,{layout:"vertical",model:e,name:"basic",autocomplete:"off",onFinish:G},{default:s(()=>[b("div",qe,[(o(),R(L,null,he(M,(a,E)=>(o(),R(L,{key:E},[a.type==="iText"?(o(),m(c,{key:0,name:a.name,label:a.label,rules:[{required:a.required,message:a.message,max:a.max}]},{default:s(()=>[i(I,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,maxlength:a.max,onBlur:u=>h(a.name)},null,8,["value","onUpdate:value","maxlength","onBlur"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelect"?(o(),m(c,{key:1,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(A,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:H(a.name)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iTextarea"?(o(),m(c,{key:2,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(K,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,rows:8,maxlength:a.max},null,8,["value","onUpdate:value","maxlength"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iNumber"?(o(),m(c,{key:3,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(Q,{value:e[a.name],"onUpdate:value":u=>e[a.name]=u,min:1,max:500,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iDate"?(o(),m(c,{key:4,name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[i(X,{locale:S(Ie),value:e[a.name],"onUpdate:value":u=>e[a.name]=u,style:{width:"100%"},format:Le,placeholder:"día/mes/año","disabled-date":C(a.name)},null,8,["locale","value","onUpdate:value","disabled-date"])]),_:2},1032,["name","label","rules"])):d("",!0),a.type==="iSelectWrite"?(o(),m(c,{key:5,class:"item-max",name:a.name,label:a.label,rules:[{required:a.required,message:a.message}]},{default:s(()=>[a.name=="city_id"?(o(),m(A,{key:0,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(v).cities,"show-search":"","filter-option":T,onChange:$},null,8,["value","onUpdate:value","options"])):d("",!0),a.name=="province_id"?(o(),m(A,{key:1,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(v).provinces,"show-search":"","filter-option":T,onChange:x,disabled:!e.city_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="district_id"?(o(),m(A,{key:2,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(v).districts,"show-search":"","filter-option":T,disabled:!e.province_id},null,8,["value","onUpdate:value","options","disabled"])):d("",!0),a.name=="people_id"?(o(),m(A,{key:3,value:e[a.name],"onUpdate:value":u=>e[a.name]=u,options:S(v).asesores,"show-search":"","filter-option":T},null,8,["value","onUpdate:value","options"])):d("",!0)]),_:2},1032,["name","label","rules"])):d("",!0)],64))),64))]),i(c,null,{default:s(()=>[i(B,{type:"primary","html-type":"submit",loading:F.value},{default:s(()=>[k(q(J.dataRow?"ACTUALIZAR":"GUARDAR"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])}}};const Me={key:0,class:"ant-table-cell"},ze={class:"table-order"},Pe={key:1},$e={key:1},Ve=["onClick"],Be=["onClick"],He={class:"paginator"},Ze={__name:"IndexAsistencia",props:["idConvenio"],setup(J){w.locale("es");const y=p(w("2025","YYYY")),v=we(),F=JSON.parse(localStorage.getItem("role"))||[];de(),xe.get("token");const g=p(!1),O=p(null),e=p(!1);p(null);const M=p(0),z=p(50),C=p({page:1}),T=p(1200),H=p([]),P=p(!1);p(!1),p(!1),p(!1),p(!1),p(null);const $=p(window.innerHeight-100),x=p(""),V=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:70},{title:"DESCRIPCIÓN",dataIndex:"description",fixed:"left",width:450},{title:"NOMBRE DE LA ACTIVIDAD",dataIndex:"title",width:220},{title:"LINK",dataIndex:"slug",width:100,align:"center"},{title:"INSCRITOS",dataIndex:"attendance_list_count",width:140,align:"center"},{title:"FECHA DE INICIO",dataIndex:"startDate",align:"center",width:140},{title:"FECHA DE FIN",dataIndex:"endDate",align:"center",width:140},{title:"DÍAS RESTANTES",dataIndex:"dateDiff",align:"center",width:140},{title:"MODALIDAD",dataIndex:"modality",align:"center",width:140},{title:"REGIÓN",dataIndex:"city",width:120},{title:"PROVINCIA",dataIndex:"province",width:150},{title:"DISTRITO",dataIndex:"district",width:150},{title:"ASESOR",dataIndex:"asesor",width:180},{title:"FECHA CREACIÓN",dataIndex:"created_at",width:140,align:"center"},{title:"",dataIndex:"actions",width:60,align:"center",fixed:"right"}],G=l=>{x.value=l,E()},h=oe({search:""}),N=l=>F.some(t=>l.includes(t.id)),n=()=>{E(),g.value=!1},_=l=>{O.value=l,g.value=!0},I=()=>{O.value=null,g.value=!0},c=l=>{const t=w().startOf("day"),Y=w(l).startOf("day").diff(t,"days");return Y<=-1?Y:Y===0?1:Y},A=()=>{C.value.page=1,h.search,E()},K=()=>{h.search||E()},Q=l=>{v.push(`/admin/asistencia/inscritos/${l.slug}`)},X=l=>{C.value.page=l,E()},B=()=>{$.value=window.innerHeight-320},Z=async l=>{try{const t=await ne({url:`attendance/delete/${l.id}`,method:"DELETE"});t.status==200&&(E(),j.success(t.message))}catch(t){console.error("Error de red:",t)}},a=Ee(()=>l=>(C.value.page-1)*z.value+l+1),E=async()=>{try{P.value=!0;const l={};y!=null&&y.value&&(l.year=w(y.value).format("YYYY")),h.search&&(l.search=h.search),C.value.page&&(l.page=C.value.page),x.value&&(l.order_by=x.value);const{data:t}=await ne({url:"attendance/list",method:"GET",params:l});H.value=t==null?void 0:t.data,M.value=t.total,z.value=t.per_page}catch(l){console.error("Error de red:",l)}finally{P.value=!1}},u=async()=>{try{e.value=!0;const l={};y!=null&&y.value&&(l.year=w(y.value).format("YYYY")),h.search&&(l.search=h.search),C.value.page&&(l.page=C.value.page),x.value&&(l.order_by=x.value),await Ne("download/attendance-ugo","eventos-ugo",l)}catch(l){console.error("Error de red:",l)}finally{e.value=!1}};return Se(()=>{window.removeEventListener("resize",B)}),re(()=>{window.addEventListener("resize",B),B(),E()}),(l,t)=>{const U=r("a-button"),Y=r("a-date-picker"),le=r("a-col"),ue=r("a-input"),ce=r("a-input-group"),pe=r("a-row"),me=r("router-link"),W=r("a-tag"),ee=r("a-menu-item"),_e=r("a-popconfirm"),ve=r("a-menu"),fe=r("a-dropdown"),ye=r("a-table"),ge=r("a-pagination"),De=r("a-drawer");return o(),R(L,null,[b("div",null,[t[14]||(t[14]=b("h3",{class:"title-produce"},"LISTA EVENTOS UGO",-1)),i(pe,{style:{margin:"1rem 0"}},{default:s(()=>[i(le,{xs:24,md:12,lg:18},{default:s(()=>[N([1,2,5])?(o(),m(U,{key:0,type:"primary",onClick:I},{default:s(()=>t[6]||(t[6]=[k("NUEVO EVENTO")])),_:1})):d("",!0),i(U,{class:"btn-excel",onClick:u,loading:e.value,type:"primary",style:{"margin-left":".6rem"}},{default:s(()=>t[7]||(t[7]=[b("img",{width:"20",style:{margin:"-2px 4px 0 0"},src:Te},null,-1)])),_:1},8,["loading"]),i(Y,{allowClear:!1,value:y.value,"onUpdate:value":t[0]||(t[0]=f=>y.value=f),picker:"year",placeholder:"Seleccionar año",onChange:E,style:{width:"80px",margin:"0 0 0 8px"}},null,8,["value"])]),_:1}),i(le,{xs:24,md:12,lg:6},{default:s(()=>[i(ce,{compact:""},{default:s(()=>[i(ue,{value:h.search,"onUpdate:value":t[1]||(t[1]=f=>h.search=f),style:{width:"calc(100% - 80px)"},onInput:K,placeholder:"Buscar por Nombre Evento"},null,8,["value"]),i(U,{type:"primary",disabled:h.search==="",onClick:A},{default:s(()=>t[8]||(t[8]=[k("BUSCAR")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),i(ye,{bordered:"",scroll:{x:T.value,y:$.value},class:"table-fairs",columns:V,"data-source":H.value,pagination:!1,loading:P.value,size:"small"},{headerCell:s(({column:f,text:D})=>[f.dataIndex==="attendance_list_count"?(o(),R("span",Me,[t[9]||(t[9]=k(" INSCRITOS ")),b("span",ze,[i(S(Ce),{onClick:t[2]||(t[2]=ae=>G("desc")),style:ie({color:x.value==="desc"?"#e91e63":""})},null,8,["style"]),i(S(ke),{onClick:t[3]||(t[3]=ae=>G("asc")),style:ie({color:x.value==="asc"?"#e91e63":""})},null,8,["style"])])])):d("",!0)]),bodyCell:s(({column:f,record:D,index:ae})=>[f.dataIndex=="idx"?(o(),R(L,{key:0},[k(q(a.value(ae)),1)],64)):d("",!0),f.dataIndex=="title"?(o(),R("span",Pe,q(D.pnte)+" - "+q(D.title),1)):d("",!0),f.dataIndex=="slug"?(o(),m(me,{key:2,to:`/asistencias/${D.slug}`,target:"_blank"},{default:s(()=>[i(S(Ue),{class:"fair-link"})]),_:2},1032,["to"])):d("",!0),f.dataIndex=="modality"?(o(),R(L,{key:3},[D.modality=="p"?(o(),m(W,{key:0,color:"blue"},{default:s(()=>t[10]||(t[10]=[k("PRESENCIAL")])),_:1})):d("",!0),D.modality=="v"?(o(),m(W,{key:1,color:"orange"},{default:s(()=>t[11]||(t[11]=[k("VIRTUAL")])),_:1})):d("",!0)],64)):d("",!0),f.dataIndex=="dateDiff"?(o(),R(L,{key:4},[c(D.endDate2)<0?(o(),m(W,{key:0,color:"red"},{default:s(()=>t[12]||(t[12]=[k(" FINALIZADO ")])),_:1})):(o(),R("span",$e,q(c(D.endDate2)),1))],64)):d("",!0),f.dataIndex=="actions"?(o(),m(fe,{key:5,trigger:["click"]},{overlay:s(()=>[i(ve,null,{default:s(()=>[i(ee,null,{default:s(()=>[b("a",{onClick:se=>Q(D)},"Inscritos",8,Ve)]),_:2},1024),N([1,5])?(o(),m(ee,{key:0},{default:s(()=>[b("a",{onClick:se=>_(D)},"Editar",8,Be)]),_:2},1024)):d("",!0),N([1,5])?(o(),m(ee,{key:1},{default:s(()=>[i(_e,{placement:"rightBottom",title:`¿Quieres eliminar ${D.title} ?`,onConfirm:se=>Z(D)},{icon:s(()=>[i(S(Re),{style:{color:"red"}})]),default:s(()=>[t[13]||(t[13]=b("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)):d("",!0)]),_:2},1024)]),default:s(()=>[b("a",{class:"ant-dropdown-link",onClick:t[4]||(t[4]=Ae(()=>{},["prevent"]))},[i(U,{shape:"circle",icon:Oe(S(Ye)),size:"small"},null,8,["icon"])])]),_:2},1024)):d("",!0)]),_:1},8,["scroll","data-source","loading"])]),b("div",He,[b("span",null,[i(W,{color:"blue"},{default:s(()=>[b("b",null,q(M.value),1)]),_:1}),t[15]||(t[15]=k("Eventos creados"))]),i(ge,{size:"small",total:M.value,pageSize:z.value,onChange:X,showSizeChanger:!1},null,8,["total","pageSize"])]),i(De,{open:g.value,"onUpdate:open":t[5]||(t[5]=f=>g.value=f),title:O.value?"EDITAR REGISTRO":"NUEVO REGISTRO",placement:"right",width:"550"},{default:s(()=>[i(Fe,{onCloseDraw:n,dataRow:O.value},null,8,["dataRow"])]),_:1},8,["open","title"])],64)}}};export{Ze as default};
