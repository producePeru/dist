import{_ as Z}from"./TableComponent-361d31bc.js";import{p as I,r as s,a as z,k as B,U as ee,X as D,o as P,d as G,c as d,m as L,h as $,b as R,w as u,t as ae,z as q,y as te,e as T,i as ne,a2 as le}from"./index-2325eb4f.js";import{_ as oe}from"./FormComponent-bb3a8471.js";import{u as V}from"./selectes-846df974.js";import"./es-78c82cd8.js";import{_ as se,a as ie}from"./AsignarVistas-2ba0c734.js";import"./downloadExcel-d04d6f6e.js";import{g as re}from"./usePermissions-a86528ed.js";import"./icoexcel-1b303edf.js";import"./SyncOutlined-6863e8af.js";import"./MoreOutlined-119c012b.js";import"./quill.snow-c43e46b7.js";const de={class:"usuarios-pnte"},ce={__name:"UsuariosUgo",props:["info"],emits:["closeDraw"],setup(H,{emit:O}){I.locale("es");const S=s({dni:{type:"iInputSearch",label:"DNI",name:"dni",required:!0,message:"Ingrese el DNI",disabled:!1,max:8,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("Escribe número de documento"));const i=String(c).trim();return/^\d{8}$/.test(i)?Promise.resolve():Promise.reject(new Error("DNI incorrecto."))},trigger:["change","blur"]}]},name:{type:"iText",label:"NOMBRE",name:"name",required:!0,message:"Ingrese el nombre",disabled:!1},lastname:{type:"iText",label:"APELLIDO PATERNO",name:"lastname",required:!0,message:"Ingrese el apellido paterno",disabled:!1},middlename:{type:"iText",label:"APELLIDO MATERNO",name:"middlename",required:!0,message:"Ingrese el apellido materno",disabled:!1},phone:{type:"iNumber",label:"NÚMERO DE CELULAR",name:"phone",required:!0,message:"Escribe un número de contacto de 9 dígitos",maxlength:9,disabled:!1,rules:[{validator:(a,c)=>{if(!c)return Promise.reject(new Error("El número es requerido"));const i=c.toString();return i.length!==9?Promise.reject(new Error("El número debe tener exactamente 9 dígitos")):i.substring(0,1)!=="9"?Promise.reject(new Error("El número debe comenzar con 9")):Promise.resolve()},trigger:"change"}]},birthday:{type:"iDate",label:"FECHA DE NACIMIENTO",name:"birthday",required:!1,message:"Seleccione la fecha de nacimiento",disabled:!1},gender_id:{type:"iSelect",label:"GÉNERO",name:"gender_id",required:!0,message:"Seleccione el género",disabled:!1},cde_id:{type:"iSelect",label:"CDE",name:"cde_id",required:!0,message:"Seleccione la CDE",disabled:!1}}),N=O,g=H,v=s("GUARDAR"),e=z({office_id:1}),y=s(!1),l=V(),C=s(null),r=s({gender_id:[],office_id:[],cde_id:[]}),b=a=>{console.log("handleInputEvent",a)},x=async a=>{a=="dateReception"&&(e.dateTramite&&(e.dateTramite=null),S.value.dateTramite.disabled=!1)},Y=async a=>{console.log("handleChangeSelect",a)},m=async a=>{a=="gender_id"&&(await l.fetchGenders(),r.value.gender_id=l.genders),a=="office_id"&&(await l.fetchOffices(),r.value.office_id=l.Offices),a=="cde_id"&&(await l.fetchCdes(),r.value.cde_id=l.cdes)},k=async()=>{var c;y.value=!0;const a={dni:e.dni,name:e.name,lastname:e.lastname,middlename:e.middlename,phone:(c=e.phone)==null?void 0:c.toString().trim(),birthday:I(e.birthday).format("YYYY-MM-DD"),gender_id:e.gender_id,office_id:e.office_id,cde_id:e.cde_id,rol:2};try{let i,_=null;g.info?(i=`users/update-user-pnte/${g.info.id}`,_="PUT"):(i="users/register-user-pnte",_="POST");const A=await L({url:i,method:_,data:a});A.status===200&&($.success(A.message),w(),N("closeDraw",!0))}catch(i){i.response&&i.response.data&&i.response.data.message?$.error(i.response.data.message):$.error("Ocurrió un error inesperado.");const _=document.getElementsByClassName("ant-drawer-body")[0];_&&(_.scrollTop=0)}finally{y.value=!1}},w=()=>{e.dni=null,e.name=null,e.lastname=null,e.middlename=null,e.phone=null,e.birthday=null,e.gender_id=null,e.office_id=null,e.cde_id=null},U=async a=>{a&&(e.dni=a.dni,e.name=a.name,e.lastname=a.lastname,e.middlename=a.middlename,await l.fetchCdes(),r.value.cde_id=l.cdes,e.cde_id=a.cde_id,await l.fetchOffices(),r.value.office_id=l.Offices,e.office_id=a.office_id,await l.fetchGenders(),r.value.gender_id=l.genders,e.gender_id=a.gender_id,e.phone=a.phone,a.birthday&&(e.birthday=I(a.birthday,"YYYY-MM-DD")))};return B(()=>{g.info&&U(g.info)}),ee(()=>g.info,a=>{a?U(a):w()}),D("formState",e),D("loadingState",y),(a,c)=>(P(),G("div",de,[d(oe,{fields:S.value,options:r.value,btnSaveName:v.value,onHandleInputEvent:b,resetSelect:C.value,onHandleChangeSelect:Y,onHandleFocusSelect:m,onHandleChangeClock:x,onOnSubmit:k,mayus:!0},null,8,["fields","options","btnSaveName","resetSelect"])]))}};const ue={class:"layout-content"},me={key:0},fe=["onClick"],pe=["onClick"],ge=["onClick"],Ne={__name:"list-ugo",setup(H){const O=V(),S=s([]),N=s(0),g=s(150),v=s(!1),e=s(!1),y=s({}),l=s(!1),C=s(!1),r=s(null),b=s(!1),x=s([]),Y=s(!1),m=z({year:I("2025","YYYY"),range:null,asesor:null,name:null,page:1,type:1,typeCde:null,orderby:null}),k=[{title:"#",dataIndex:"idx",fixed:"left",align:"center",width:50},{title:"DNI",dataIndex:"dni",fixed:"left",width:100,align:"center"},{title:"NOMBRES",dataIndex:"name",width:160},{title:"APELLIDOS",dataIndex:"fullname",width:160},{title:"CORREO PNTE",dataIndex:"email",width:240},{title:"CELULAR",dataIndex:"phone",width:100,align:"center"},{title:"FECHA NACIMIENTO",dataIndex:"birthday",width:100,align:"center"},{title:"OFICINA",dataIndex:"office_name",width:120,align:"center"},{title:"CDE",dataIndex:"cde_name",width:260,align:"center"},{title:"",dataIndex:"actions",align:"center",width:50,fixed:"right"}],w=(t,n)=>{r.value=t,n.value=!0},U=t=>w(t,l),a=t=>w(t,e),c=t=>w(t,v),i=(t,n)=>{const f=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(f)},_=async(t,n)=>{const f={cde_id:t,user_id:n};try{const p=await L({url:"users/update-cde",method:"PUT",data:f});console.log("response",p)}catch(p){console.log("error",p)}},A=()=>{r.value=null,l.value=!0},j=()=>{E(),l.value=!1},Q=async t=>{try{const n=await L({url:`users/delete-user-pnte/${t.id}`,method:"DELETE"});n.status==200&&(E(),$.success(n.message))}catch(n){console.error("Error de red:",n)}},X=async()=>{b.value=!0;try{}catch(t){console.error("Error de red:",t)}finally{b.value=!1}},J=async t=>{m.page=t,await E()},K=async t=>{t&&(m.page=1,await E())},E=async()=>{try{C.value=!0;const t={page:m.page};m.year&&(t.year=I(m.year).format("YYYY")),m.name&&(t.name=m.name);const f=await L({url:"users/ugo",method:"GET",params:t});S.value=f.data.data,N.value=f.data.total,g.value=f.data.per_page}catch(t){console.error("Error de red:",t)}finally{C.value=!1}};return B(async()=>{y.value=await re("usuarios-lista-ugo"),await E(),await O.fetchCdes(),x.value=O.cdes}),D("search",m),D("loading",C),D("loadingFile",b),(t,n)=>{const f=R("a-select"),p=R("a-menu-item"),W=R("a-popconfirm"),M=R("a-drawer");return P(),G("div",ue,[d(Z,{title:"USUARIOS UGO",nameTotal:"Usuarios UGO",titleSearch:"FILTRAR POR NÚMERO DE DNI",placeholderSearch:"Buscar",textNuevo:"NUEVO REGISTRO",new:!0,columns:k,pageSize:g.value,dataSource:S.value,total:N.value,btnUpdate:!0,permisos:y.value,onHandleNew:A,onHandleDownloadExcel:X,onHandleSearch:K,onHandleCallFetchData:E,onHandlePaginator:J},{"data-cell":u(({column:o,record:h})=>[o.dataIndex=="type_activity"?(P(),G("span",me,ae(h.pnte),1)):q("",!0),o.dataIndex=="cde_name"?(P(),te(f,{key:1,value:h.cde_id,"onUpdate:value":F=>h.cde_id=F,"show-search":"",placeholder:"Seleccionar CDE",class:"ugo-cde",loading:Y.value,options:x.value,"filter-option":i,onChange:F=>_(F,h.id)},null,8,["value","onUpdate:value","loading","options","onChange"])):q("",!0)]),"custom-options":u(({record:o})=>[d(p,null,{default:u(()=>[T("a",{onClick:h=>U(o)},"Editar",8,fe)]),_:2},1024),d(p,null,{default:u(()=>[T("a",{onClick:h=>a(o)},"Cambiar de contraseña",8,pe)]),_:2},1024),d(p,null,{default:u(()=>[T("a",{onClick:h=>c(o)},"Vistas",8,ge)]),_:2},1024),d(p,null,{default:u(()=>[d(W,{placement:"rightBottom",title:`¿Quieres eliminar a ${o.name} ${o.lastname} ?`,onConfirm:h=>Q(o)},{icon:u(()=>[d(ne(le),{style:{color:"red"}})]),default:u(()=>[n[5]||(n[5]=T("a",null,"Eliminar",-1))]),_:2},1032,["title","onConfirm"])]),_:2},1024)]),_:1},8,["pageSize","dataSource","total","permisos"]),d(M,{open:l.value,"onUpdate:open":n[0]||(n[0]=o=>l.value=o),title:r.value?"EDITAR DATOS PNTE":"NUEVO USUARIO UGO",placement:"right",width:"550"},{default:u(()=>[d(ce,{onCloseDraw:j,info:r.value},null,8,["info"])]),_:1},8,["open","title"]),d(M,{open:e.value,"onUpdate:open":n[2]||(n[2]=o=>e.value=o),title:"CAMBIAR CONTRASEÑA",placement:"right",width:"450"},{default:u(()=>[d(se,{onCloseDraw:n[1]||(n[1]=o=>e.value=!1),info:r.value},null,8,["info"])]),_:1},8,["open"]),d(M,{open:v.value,"onUpdate:open":n[4]||(n[4]=o=>v.value=o),title:"ASIGNAR VISTAS",placement:"right",width:"1300"},{default:u(()=>[d(ie,{onCloseDraw:n[3]||(n[3]=o=>v.value=!1),info:r.value,typeOffice:"UGO"},null,8,["info"])]),_:1},8,["open"])])}}};export{Ne as default};
